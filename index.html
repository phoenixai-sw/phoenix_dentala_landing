<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê</title>
    
    <!-- Ïπ¥Ïπ¥Ïò§ÌÜ° Ïù∏Ïï± Î∏åÎùºÏö∞Ï†Ä Ï∫êÏãú Î∞©ÏßÄ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">
    
    <!-- SheetJS ÎùºÏù¥Î∏åÎü¨Î¶¨ Ï∂îÍ∞Ä (ÏóëÏÖÄ ÌååÏùº ÏÉùÏÑ±Ïö©) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            -webkit-text-size-adjust: 100%;
            -webkit-touch-callout: none;
        }

        /* Î∞∞ÎÑà Ïä§ÌÉÄÏùº */
        .top-banner, .bottom-banner {
            position: fixed;
            left: 0;
            right: 0;
            background: #ffd700;
            color: #333;
            padding: 15px 20px;
            text-align: center;
            z-index: 1000;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: bold;
            font-size: 18px;
        }

        .top-banner {
            top: 0;
            animation: pulse 2s infinite;
        }

        .bottom-banner {
            bottom: 0;
        }

        .top-banner:hover, .bottom-banner:hover {
            background: #ffed4e;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Î©îÏù∏ Ïª®ÌÖêÏ∏† */
        .container {
            max-width: 800px;
            margin: 70px auto 80px;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
        }

        .hospital-name {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }

        .hospital-description {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: left;
        }

        .hospital-description p {
            margin: 8px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .info-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .info-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .info-title::before {
            content: "üìã";
            margin-right: 10px;
        }

        .info-item {
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .time-info {
            color: #27ae60;
            font-weight: bold;
        }

        .location-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .address-text p {
            margin: 10px 0;
            font-size: 14px;
        }

        .map-container {
            min-height: 200px;
        }

        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .service-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .service-item:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .service-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .contact-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: black;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .phone {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .address {
            opacity: 0.9;
        }

        /* Î°úÍ∑∏Ïù∏ Î≤ÑÌäº */
        .admin-buttons {
            text-align: center;
            margin-top: 30px;
        }

        .admin-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: #3d8bfe;
            transform: translateY(-2px);
        }

        .admin-btn.customer {
            background: #ff69b4;
            color: black;
        }

        .admin-btn.customer:hover {
            background: #ff1493;
            color: black;
        }

        .admin-btn.chatbot {
            background: #90EE90;
            color: black;
        }

        .admin-btn.chatbot:hover {
            background: #32CD32;
            color: black;
        }

        /* Î¨¥Î£å Í≤ÄÏßÑ ÌôïÏù∏ Î≤ÑÌäº */
        .dental-checkup-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .dental-checkup-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #ff5252 0%, #fdd835 100%);
        }

        .dental-checkup-btn:active {
            transform: translateY(-1px);
        }

        /* ÌåùÏóÖ ÌéòÏù¥ÏßÄ Í≥µÌÜµ Ïä§ÌÉÄÏùº */
        .popup-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }

        .popup-header {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .popup-content {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº */
        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #2980b9;
        }

        .nav-btn.logout {
            background: #e74c3c;
        }

        .nav-btn.logout:hover {
            background: #c0392b;
        }

        .admin-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 20px;
        }

        /* API ÏÑ§Ï†ï Ïä§ÌÉÄÏùº */
        .api-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover {
            background: #3d8bfe;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-warning.message-send {
            background: #ff69b4;
            border-color: #ff69b4;
            color: white;
        }

        .btn-warning.message-send:hover {
            background: #ff1493;
            border-color: #ff1493;
        }

        /* Î°úÎî© Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .loading-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
        }

        .loading-content h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 24px;
        }

        .loading-progress {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }

        .loading-spinner {
            font-size: 32px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Í≤∞Í≥º Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .result-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .result-content h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 24px;
            text-align: center;
        }

        .result-summary {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .success-count {
            color: #28a745;
            font-weight: bold;
            font-size: 16px;
        }

        .fail-count {
            color: #dc3545;
            font-weight: bold;
            font-size: 16px;
        }

        .result-section {
            margin-bottom: 20px;
        }

        .result-section h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
        }

        .result-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }

        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item.success {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .result-item.fail {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .result-item strong {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .result-item small {
            color: #666;
            font-size: 12px;
        }

        /* Î∞úÏÜ° Í≤∞Í≥º Ï∂îÍ∞Ä Ïä§ÌÉÄÏùº */
        .send-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4facfe;
        }

        .info-item {
            margin-bottom: 8px;
            font-size: 14px;
            color: #2c3e50;
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .cost-info {
            color: #e67e22;
            font-weight: bold;
            font-size: 16px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .phone {
            color: #666;
            font-size: 13px;
            font-family: monospace;
        }

        .result-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 10px;
        }

        .message-preview {
            margin-top: 10px;
        }

        .message-preview details {
            cursor: pointer;
        }

        .message-preview summary {
            color: #4facfe;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .message-content {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-line;
            border-left: 3px solid #4facfe;
            margin-top: 5px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .result-actions .btn {
            padding: 12px 20px;
            font-size: 14px;
        }

        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
            white-space: pre-line;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ÌååÏùº ÏóÖÎ°úÎìú Ïä§ÌÉÄÏùº */
        .upload-area {
            border: 2px dashed #4facfe;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #3d8bfe;
            background: #f0f8ff;
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #f8fff8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-types {
            font-size: 12px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .file-details {
            font-size: 12px;
            color: #666;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .file-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }



        .reservation-link-btn {
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
            transition: all 0.2s;
        }

        .reservation-link-btn:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        /* ÏòàÏïΩ ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº */
        .reservation-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Ï∫òÎ¶∞Îçî Ïä§ÌÉÄÏùº */
        .calendar-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .calendar-nav {
            background: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            color: #666;
        }

        .calendar-nav:hover {
            background: #f8f9fa;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0;
        }

        .calendar-day-header {
            text-align: center;
            padding: 10px 0;
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }

        .calendar-day-header:first-child {
            color: #e74c3c;
        }

        .calendar-day-header:last-child {
            color: #3498db;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #eee;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .calendar-day:hover:not(.disabled):not(.selected) {
            background: #f8f9fa;
        }

        .calendar-day.disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background: #4facfe;
            color: white;
            font-weight: bold;
        }

        .calendar-day.sunday {
            color: #e74c3c;
        }

        .calendar-day.saturday {
            color: #3498db;
        }

        /* ÏãúÍ∞Ñ ÏÑ†ÌÉù Ïä§ÌÉÄÏùº */
        .time-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .time-header {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .time-header::before {
            content: "üïê";
            margin-right: 8px;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .time-slot {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .time-slot:hover:not(.disabled):not(.selected) {
            border-color: #4facfe;
            background: #f0f8ff;
        }

        .time-slot.selected {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .time-slot.disabled {
            background: #f8f9fa;
            color: #ccc;
            cursor: not-allowed;
        }

        /* ÏòàÏïΩÏûê Ï†ïÎ≥¥ Ïä§ÌÉÄÏùº */
        .info-form-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-header {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .form-header::before {
            content: "üë§";
            margin-right: 8px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .form-label .required {
            color: #e74c3c;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .form-input::placeholder {
            color: #999;
        }

        /* ÏòàÏïΩÌïòÍ∏∞ Î≤ÑÌäº */
        .reservation-submit {
            width: 100%;
            padding: 15px;
            background: #00aa82;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reservation-submit:hover {
            background: #008866;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 170, 130, 0.3);
        }

        .reservation-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÏòàÏïΩ ÌôïÏù∏ ÌåùÏóÖ */
        .confirmation-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .confirmation-content {
            background: white;
            border-radius: 20px;
            padding: 32px 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .confirmation-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .confirmation-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .confirmation-message {
            font-size: 16px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 30px;
        }

        .confirmation-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: left;
            margin-bottom: 30px;
        }

        .confirmation-details p {
            margin: 8px 0;
            font-size: 14px;
            color: #333;
        }

        .confirmation-details strong {
            color: #2c3e50;
        }

        .confirmation-note {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 30px;
            padding: 15px;
            background: #fffbeb;
            border-radius: 8px;
        }

        .confirmation-button {
            padding: 15px 40px;
            background: #00aa82;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirmation-button:hover {
            background: #008866;
            transform: translateY(-2px);
        }

        /* Î©îÏãúÏßÄ Î∞úÏÜ° ÌåùÏóÖ */
        .message-sending-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .message-popup-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .message-popup-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-popup-title {
            font-size: 20px;
            font-weight: bold;
        }

        .message-popup-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-popup-close:hover {
            opacity: 0.7;
        }

        .message-popup-body {
            padding: 30px;
        }

        .message-target-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .message-target-count {
            font-size: 24px;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 8px;
        }

        .message-target-desc {
            color: #666;
            font-size: 14px;
        }

        /* ÌÉ≠ Ïä§ÌÉÄÏùº */
        .message-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #4facfe;
            border-bottom-color: #4facfe;
        }

        .tab-button:hover {
            color: #4facfe;
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ÌååÏùº ÏóÖÎ°úÎìú Ïä§ÌÉÄÏùº */
        .file-upload-section {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .file-upload-section:hover {
            border-color: #4facfe;
            background: #f0f8ff;
        }

        .file-upload-icon {
            font-size: 48px;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .file-upload-text {
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
        }

        .file-upload-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }

        .file-upload-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-btn:hover {
            background: #3d8bfe;
        }

        .file-upload-input {
            display: none;
        }

        .file-selected {
            margin-top: 15px;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 8px;
            color: #2d8f44;
            font-weight: bold;
            border: 1px solid #c3e6cb;
        }

        /* Î∞úÏÜ° Î≤ÑÌäº */
        .send-message-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .send-message-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .send-message-btn.kakao {
            background: linear-gradient(135deg, #fee500 0%, #ffd500 100%);
            color: #333;
        }

        .send-message-btn.kakao:hover {
            box-shadow: 0 8px 25px rgba(254, 229, 0, 0.4);
        }

        /* Î™®Î∞îÏùº ÏïàÏ†ïÏÑ± Í∞ïÌôî */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        input, textarea, select, button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Í≥†Ï†ï ÌåùÏóÖ AIÏ±óÎ¥á Î∞∞ÎÑà */
        .chatbot-fixed-banner {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            animation: chatbotFloat 3s ease-in-out infinite;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: block;
            opacity: 1;
        }

        .chatbot-fixed-banner:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .chatbot-fixed-content {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .chatbot-fixed-icon {
            font-size: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            animation: chatbotIconPulse 2s ease-in-out infinite;
        }

        .chatbot-fixed-text {
            display: flex;
            flex-direction: column;
        }

        .chatbot-fixed-title {
            font-size: 14px;
            font-weight: bold;
            line-height: 1.2;
        }

        .chatbot-fixed-desc {
            font-size: 11px;
            opacity: 0.9;
            line-height: 1.2;
        }

        .chatbot-fixed-pulse {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            animation: chatbotPulse 2s ease-in-out infinite;
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes chatbotFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        @keyframes chatbotIconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes chatbotPulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .container {
                margin: 60px 10px 70px;
                padding: 10px;
            }
            
            .hospital-name {
                font-size: 24px;
            }
            
            .services {
                grid-template-columns: repeat(2, 1fr);
            }

            .location-info {
                grid-template-columns: 1fr;
            }
            
            .admin-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .admin-btn {
                width: 200px;
                margin: 5px 0;
            }

            .section-header > div {
                flex-direction: column;
                gap: 10px;
            }

            .section-header .btn {
                width: 100%;
                text-align: center;
            }



            .message-popup-content {
                width: 95%;
                max-height: 85vh;
            }

            .message-popup-header {
                padding: 15px 20px;
            }

            .message-popup-title {
                font-size: 18px;
            }

            .message-popup-body {
                padding: 20px;
            }

            .message-tabs {
                flex-direction: column;
            }

            .tab-button {
                padding: 12px 15px;
                font-size: 15px;
            }

            .file-upload-section {
                padding: 20px;
            }

            .file-upload-icon {
                font-size: 36px;
            }

            .send-message-btn {
                padding: 15px;
                font-size: 16px;
            }

            /* Í≥†Ï†ï Ï±óÎ¥á Î∞∞ÎÑà Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .chatbot-fixed-banner {
                bottom: 15px;
                right: 15px;
                padding: 12px 16px;
            }

            .chatbot-fixed-icon {
                font-size: 20px;
                width: 35px;
                height: 35px;
            }

            .chatbot-fixed-title {
                font-size: 12px;
            }

            .chatbot-fixed-desc {
                font-size: 10px;
            }

            .chatbot-fixed-pulse {
                width: 8px;
                height: 8px;
                top: -3px;
                right: -3px;
                background: #4CAF50;
            }
        }
        

    </style>
</head>
<body>
    <!-- ÏÉÅÎã® Î¨¥Î£å Í≤ÄÏßÑ ÌôïÏù∏ Î∞∞ÎÑà -->
    <div class="top-banner" onclick="location.href='dental_checkup.html'">
        ü¶∑ Î¨¥Î£å Í≤ÄÏßÑ(Íµ¨Í∞ï) ÌôïÏù∏
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">ü¶∑</div>
            <h1 class="hospital-name">ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê</h1>
            <p class="subtitle">Í±¥Í∞ïÌïú ÎØ∏ÏÜå, Î∞ùÏùÄ ÎÇ¥ÏùºÏùÑ ÏúÑÌïú ÏπòÍ≥º</p>
            <div class="hospital-description">
                <p>üèÜ <strong>25ÎÖÑ Í≤ΩÎ†•Ïùò ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏ ÌôçÍ∏∏Îèô ÏõêÏû•ÎãòÏù¥ ÏßÅÏ†ë ÏßÑÎ£åÌï©ÎãàÎã§</strong></p>
                <p>‚ú® ÏµúÏã† Ïû•ÎπÑÏôÄ Î¨¥Í∑† ÏãúÏÑ§Î°ú ÏïàÏ†ÑÌïòÍ≥† Ï†ïÌôïÌïú ÏπòÎ£å</p>
                <p>üíù ÌôòÏûê Ï§ëÏã¨Ïùò ÎßûÏ∂§Ìòï ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω</p>
                <p>üéØ ÌÜµÏ¶ù ÏóÜÎäî ÏπòÎ£åÎ•º ÏúÑÌïú ÎîîÏßÄÌÑ∏ ÎßàÏ∑® ÏãúÏä§ÌÖú</p>
                <p>üìû <strong>24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä• (070-1234-1234)</strong></p>
            </div>
        </div>

        <!-- ÏúÑÏπò ÏïàÎÇ¥ -->
        <div class="info-section">
            <h2 class="info-title">Ï∞æÏïÑÏò§ÏãúÎäî Í∏∏</h2>
            <div class="location-info">
                <div class="address-text">
                    <p><strong>üìç Ï£ºÏÜå:</strong> ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏</p>
                    <p><strong>üöá ÏßÄÌïòÏ≤†:</strong> 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ</p>
                    <p><strong>üöå Î≤ÑÏä§:</strong> Í∞ïÎÇ®Ïó≠ Ï†ïÎ•òÏû• ÌïòÏ∞® ÌõÑ ÎèÑÎ≥¥ 3Î∂Ñ</p>
                    <p><strong>üöó Ï£ºÏ∞®:</strong> Í±¥Î¨º ÏßÄÌïò 1~3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)</p>
                </div>
                <div class="map-container">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3165.4823!2d127.0276!3d37.4979!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMzfCsDI5JzUyLjQiTiAxMjfCsDA2JzI3LjQiRQ!5e0!3m2!1sko!2skr!4v1234567890"
                        width="100%" 
                        height="200" 
                        style="border:0; border-radius: 10px;" 
                        allowfullscreen="" 
                        loading="lazy">
                    </iframe>
                </div>
            </div>
        </div>

        <!-- ÏßÑÎ£å ÏïàÎÇ¥ -->
        <div class="info-section">
            <h2 class="info-title">ÏßÑÎ£å ÏïàÎÇ¥</h2>
            <div class="info-item">
                <strong>ÌèâÏùº:</strong> <span class="time-info">09:00 ~ 18:00</span>
            </div>
            <div class="info-item">
                <strong>ÌÜ†ÏöîÏùº:</strong> <span class="time-info">09:00 ~ 15:00</span>
            </div>
            <div class="info-item">
                <strong>Ï†êÏã¨ÏãúÍ∞Ñ:</strong> 12:30 ~ 13:30
            </div>
            <div class="info-item">
                <strong>Ìú¥ÏßÑ:</strong> ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            </div>
        </div>

        <!-- ÏßÑÎ£å Í≥ºÎ™© -->
        <div class="info-section">
            <h2 class="info-title">ÏßÑÎ£å Í≥ºÎ™©</h2>
            <p style="color: #666; margin-bottom: 15px; font-size: 14px;">Í∞Å Ìï≠Î™©ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
            <div class="services">
                <div class="service-item" onclick="showServiceDetail('general')">
                    <div class="service-icon">ü¶∑</div>
                    <div>ÏùºÎ∞òÏßÑÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('whitening')">
                    <div class="service-icon">‚ú®</div>
                    <div>ÎØ∏Î∞±ÏπòÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('orthodontics')">
                    <div class="service-icon">üîß</div>
                    <div>ÍµêÏ†ïÏπòÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('implant')">
                    <div class="service-icon">ü¶¥</div>
                    <div>ÏûÑÌîåÎûÄÌä∏</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('prosthetic')">
                    <div class="service-icon">üëë</div>
                    <div>Î≥¥Ï≤†ÏπòÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('pediatric')">
                    <div class="service-icon">üßí</div>
                    <div>ÏÜåÏïÑÏπòÍ≥º</div>
                </div>
            </div>
        </div>

        <!-- Ïó∞ÎùΩÏ≤ò -->
        <div class="contact-info">
            <div class="phone">üìû 070-1234-1234</div>
            <div class="address">üìç ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏</div>
        </div>



        <!-- Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î≤ÑÌäº -->
        <div class="admin-buttons">
                <button class="admin-btn customer" onclick="loginCustomerAdmin()" title="ÏïÑÏù¥Îîî: phoenix | ÎπÑÎ∞ÄÎ≤àÌò∏: phoenix">‚òÄÔ∏è Í≥†Í∞ù Í¥ÄÎ¶¨Ïûê</button>
                <button class="admin-btn chatbot" onclick="loginChatbotAdmin2()" title="ÏïÑÏù¥Îîî: phoenix | ÎπÑÎ∞ÄÎ≤àÌò∏: phoenix">üë©‚Äç‚öïÔ∏è AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê</button>
        </div>


    </div>

    <!-- ÌïòÎã® ÏòàÏïΩ Î∞∞ÎÑà -->
    <div class="bottom-banner" onclick="location.href='reservation.html'">
        üìÖ ÏßÄÍ∏à ÏòàÏïΩÌïòÍ∏∞
    </div>

    <!-- Í≥†Ï†ï ÌåùÏóÖ AIÏ±óÎ¥á Î∞∞ÎÑà -->
    <div class="chatbot-fixed-banner" id="chatbotFixedBanner" onclick="goToChatbot()">
        <div class="chatbot-fixed-content">
            <div class="chatbot-fixed-icon">üë©‚Äç‚öïÔ∏è</div>
            <div class="chatbot-fixed-text">
                <div class="chatbot-fixed-title">AI ÏÉÅÎã¥ÏÇ¨</div>
                <div class="chatbot-fixed-desc">24ÏãúÍ∞Ñ ÏÉÅÎã¥</div>
            </div>
        </div>
        <div class="chatbot-fixed-pulse"></div>
    </div>







    <!-- Î©îÏãúÏßÄ Î∞úÏÜ° ÌåùÏóÖ -->
    <div class="message-sending-popup" id="messageSendingPopup">
        <div class="message-popup-content">
            <!-- ÌåùÏóÖ Ìó§Îçî -->
            <div class="message-popup-header">
                <div class="message-popup-title">ü¶∑ Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûê Î©îÏãúÏßÄ Î∞úÏÜ°</div>
                <button class="message-popup-close" onclick="closeMessageSendingPopup()">‚úï</button>
            </div>
            
            <!-- ÌåùÏóÖ ÎÇ¥Ïö© -->
            <div class="message-popup-body">
                <!-- ÎåÄÏÉÅÏûê Ï†ïÎ≥¥ -->
                <div class="message-target-info">
                    <div class="message-target-count" id="messageCustomerCount">0</div>
                    <div class="message-target-desc">Î™ÖÏùò Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÏóêÍ≤å Î©îÏãúÏßÄÎ•º Î∞úÏÜ°Ìï©ÎãàÎã§</div>
                </div>
                
                <!-- ÌÉ≠ Î©îÎâ¥ -->
                <div class="message-tabs">
                    <button class="tab-button active" onclick="switchMessageTab('sms')">üì± SMS Î¨∏Ïûê Î©îÏãúÏßÄ</button>
                    <button class="tab-button" onclick="switchMessageTab('kakao')">üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ°</button>
                </div>
                
                <!-- SMS ÌÉ≠ ÎÇ¥Ïö© -->
                <div class="tab-content active" id="smsTab">
                    <div class="file-upload-section">
                        <div class="file-upload-icon">üìÅ</div>
                        <div class="file-upload-text">SMS Î∞úÏÜ°Ïö© CSV ÌååÏùº ÏóÖÎ°úÎìú</div>
                        <div class="file-upload-desc">
                            Î∞úÏÜ°Ìï† ÎÇ¥Ïö©Ïù¥ Ìè¨Ìï®Îêú CSV ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî<br>
                            <small>ÏßÄÏõê ÌòïÏãù: .csv (Excel ÌååÏùºÏùÄ CSVÎ°ú Î≥ÄÌôò ÌõÑ ÏóÖÎ°úÎìú)</small>
                        </div>
                        <button class="file-upload-btn" onclick="document.getElementById('smsFileInput').click()">
                            üìÅ ÌååÏùº ÏÑ†ÌÉù
                        </button>
                        <input type="file" id="smsFileInput" class="file-upload-input" accept=".csv" onchange="uploadSmsFile(event)">
                        <div class="file-selected" id="smsFileName" style="display: none;">ÏÑ†ÌÉùÎêú ÌååÏùº ÏóÜÏùå</div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #333;">üìã SMS Î©îÏãúÏßÄ ÌÖúÌîåÎ¶ø ÏòàÏãú:</h4>
                        <div style="background: white; padding: 12px; border-radius: 5px; font-family: monospace; font-size: 13px; line-height: 1.6; white-space: pre-line;">
[ÌîºÎãâÏä§ÏπòÍ≥º] ÏïàÎÖïÌïòÏÑ∏Ïöî #{Ïù¥Î¶Ñ}Îãò!

#{Í≤ÄÏßÑÏó∞ÎèÑ}ÎÖÑ Íµ≠Í∞Ä Î¨¥Î£å Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÎ°ú ÌôïÏù∏ÎêòÏñ¥ ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§.

ü¶∑ Î¨¥Î£å Í≤ÄÏßÑ ÌòúÌÉù:
- Íµ¨Í∞ïÍ≤ÄÏßÑ (Ï∂©Ïπò, ÏûáÎ™∏ÏßàÌôò Îì±)
- Ï†ÑÎ¨∏Ïùò ÏÉÅÎã¥
- ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω

üìÖ Ïò®ÎùºÏù∏ ÏòàÏïΩÌïòÍ∏∞:
https://phoenixai-agent.site/reservation.html

üìû Ï†ÑÌôî ÏòàÏïΩ: 02-1234-5678
üïò ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00
üìç ÏúÑÏπò: Í∞ïÎÇ®Ïó≠ 3Î≤àÏ∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ

Í±¥Í∞ïÌïú ÏπòÏïÑ Í¥ÄÎ¶¨Ïùò Ï≤´Í±∏ÏùåÏùÑ Ìï®ÍªòÌïòÏÑ∏Ïöî!

- ÌîºÎãâÏä§ÏπòÍ≥º -
                        </div>
                        <div style="margin-top: 10px; padding: 8px; background: #e8f5e8; border-radius: 5px; font-size: 12px; color: #2d5f3f;">
                            üí° <strong>Í∞úÏù∏Ìôî Î≥ÄÏàò:</strong> #{Ïù¥Î¶Ñ}, #{ÎÇòÏù¥}, #{Í≤ÄÏßÑÏó∞ÎèÑ}Í∞Ä Ïã§Ï†ú Í≥†Í∞ù Ï†ïÎ≥¥Î°ú ÏûêÎèô ÏπòÌôòÎê©ÎãàÎã§.
                        </div>
                    </div>
                    
                    <button class="send-message-btn" onclick="sendSmsMessage()">
                        üì± SMS Î©îÏãúÏßÄ Î∞úÏÜ°ÌïòÍ∏∞
                    </button>
                </div>
                
                <!-- Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° ÌÉ≠ ÎÇ¥Ïö© -->
                <div class="tab-content" id="kakaoTab">
                    <div class="file-upload-section">
                        <div class="file-upload-icon">üìÅ</div>
                        <div class="file-upload-text">Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ°Ïö© ÏóëÏÖÄ ÌååÏùº ÏóÖÎ°úÎìú</div>
                        <div class="file-upload-desc">
                            Î∞úÏÜ°Ìï† ÎÇ¥Ïö©Ïù¥ Ìè¨Ìï®Îêú ÏóëÏÖÄ ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî<br>
                            <small>ÏßÄÏõê ÌòïÏãù: .xlsx, .xls</small>
                        </div>
                        <button class="file-upload-btn" onclick="document.getElementById('kakaoFileInput').click()">
                            üìÅ ÌååÏùº ÏÑ†ÌÉù
                        </button>
                        <input type="file" id="kakaoFileInput" class="file-upload-input" accept=".xlsx,.xls" onchange="uploadKakaoFile(event)">
                        <div class="file-selected" id="kakaoFileName" style="display: none;">ÏÑ†ÌÉùÎêú ÌååÏùº ÏóÜÏùå</div>
                    </div>
                    
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #fbbf24;">
                        <h4 style="margin-bottom: 10px; color: #333;">üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° ÌÖúÌîåÎ¶ø ÏòàÏãú:</h4>
                        <div style="background: white; padding: 12px; border-radius: 5px; font-family: monospace; font-size: 14px; line-height: 1.5;">
                            [ÌîºÎãâÏä§ÏπòÍ≥º] Î¨¥Î£å Íµ¨Í∞ïÍ≤ÄÏßÑ ÏïàÎÇ¥<br><br>
                            ÏïàÎÖïÌïòÏÑ∏Ïöî #{Ïù¥Î¶Ñ}Îãò!<br>
                            #{Í≤ÄÏßÑÏó∞ÎèÑ}ÎÖÑ Íµ≠Í∞Ä Î¨¥Î£å Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÏûÖÎãàÎã§.<br><br>
                            ü¶∑ Í≤ÄÏßÑ ÌòúÌÉù: Î¨¥Î£å<br>
                            üìû ÏòàÏïΩ: 070-1234-1234<br>
                            üìç ÏúÑÏπò: ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ<br><br>
                            Í±¥Í∞ïÌïú ÏπòÏïÑ Í¥ÄÎ¶¨Î•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî!
                        </div>
                    </div>
                    
                    <button class="send-message-btn kakao" onclick="sendKakaoMessage()">
                        üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ°ÌïòÍ∏∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="serviceDetailPage">
        <div class="popup-header">
            <h2 id="serviceDetailTitle">ÏßÑÎ£å Í≥ºÎ™© ÏÉÅÏÑ∏</h2>
            <button class="close-btn" onclick="closeServiceDetail()">‚úï</button>
        </div>
        <div class="popup-content" id="serviceDetailContent">
            <!-- ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
        </div>
    </div>

    <!-- AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="chatbotAdminPage">
        <div class="admin-header">
            <div class="admin-title">ü§ñ AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeChatbotAdmin()">üè† Î©îÏù∏ÏúºÎ°ú</button>
                <button class="nav-btn logout" onclick="closeChatbotAdmin()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- AI Î™®Îç∏ API ÏÑ§Ï†ï -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ü§ñ Ï±óÎ¥á AI Î™®Îç∏ Ïó∞Í≤∞ÌïòÍ∏∞</h3>
                </div>
                
                <div class="api-form">
                    <!-- ChatGPT ÏÑ§Ï†ï -->
                    <div class="form-group">
                        <label for="chatgptApiKey">ChatGPT API Key</label>
                        <input type="password" id="chatgptApiKey" placeholder="sk-proj-...">
                    </div>
                    <div class="form-group">
                        <label for="chatgptModel">ChatGPT Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="chatgptModel" onchange="toggleFinetuningInput('chatgpt')">
                            <option value="">-- ChatGPT Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="gpt-4o">GPT-4o (ÏµúÏã† Î©ÄÌã∞Î™®Îã¨)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Í≤ΩÏ†úÏ†Å)</option>
                            <option value="finetuning">Finetuning Model (Ïª§Ïä§ÌÖÄ Î™®Îç∏)</option>
                        </select>
                    </div>
                    <div class="form-group" id="chatgptFinetuningGroup" style="display: none;">
                        <label for="chatgptFinetuningModel">Finetuning Î™®Îç∏Î™Ö ÏûÖÎ†•</label>
                        <input type="text" id="chatgptFinetuningModel" placeholder="ft:gpt-4o-mini-2024-07-18:...">
                    </div>

                    <!-- Gemini ÏÑ§Ï†ï -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="geminiApiKey">Gemini Î™®Îç∏ API Key</label>
                        <input type="password" id="geminiApiKey" placeholder="AIza...">
                    </div>
                    <div class="form-group">
                        <label for="geminiModel">Gemini Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="geminiModel">
                            <option value="">-- Gemini Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (Îπ†Î•∏ ÏùëÎãµ)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (Í≥†ÏÑ±Îä•)</option>
                            <option value="gemini-1.0-pro">Gemini 1.0 Pro (ÏïàÏ†ïÏÑ±)</option>
                        </select>
                    </div>

                    <!-- Claude ÏÑ§Ï†ï -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="claudeApiKey">Claude Î™®Îç∏ API Key</label>
                        <input type="password" id="claudeApiKey" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label for="claudeModel">Claude Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="claudeModel">
                            <option value="">-- Claude Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="claude-3-haiku">Claude 3 Haiku (Îπ†Î•¥Í≥† Ìö®Ïú®Ï†Å)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (Í∑†ÌòïÏ†Å ÏÑ±Îä•)</option>
                            <option value="claude-3-opus">Claude 3 Opus (ÏµúÍ≥† ÏÑ±Îä•)</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet (ÏµúÏã† Î™®Îç∏)</option>
                        </select>
                    </div>

                    <div class="btn-group" style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="saveApiSettings()">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
                        <button class="btn btn-success" onclick="testApiConnection()">üîó Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
                        <button class="btn btn-danger" onclick="resetApiSettings()">üîÑ ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    <div id="apiStatus" class="status-message"></div>
                </div>
            </div>

            <!-- AI ÏßÄÏãù ÌååÏùº ÏóÖÎ°úÎìú -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>üìö AI ÏßÄÏãù ÌååÏùº ÏóÖÎ°úÎìú</h3>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ Ïó¨Í∏∞Î°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</div>
                    <div class="upload-types">üí° <strong>ÏßÄÏõê ÌòïÏãù: ÌÖçÏä§Ìä∏(.txt), JSONL(.jsonl)</strong><br>
                    <small style="color: #666;">‚Äª ÌÖçÏä§Ìä∏ ÌååÏùºÏùÄ Q&A ÌòïÏãùÏúºÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî</small></div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".txt,.jsonl" multiple onchange="handleFileUpload(event)">
                
                <div class="file-list" id="fileList">
                    <!-- ÏóÖÎ°úÎìúÎêú ÌååÏùºÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <div id="knowledgeStatus" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                    üìñ ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº: 0Í∞ú | ÏÉÅÌÉú: ÎπÑÌôúÏÑ±
                </div>
                
                <!-- ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº -->
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveKnowledgeSettings()">üíæ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•</button>
                    <button class="btn btn-primary" onclick="testKnowledgeBase()">üîç ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏</button>
                    <button class="btn" style="background: #17a2b8; color: white;" onclick="showParsedData()">üìã ÌååÏã±Îêú Q&A Î≥¥Í∏∞</button>
                    <button class="btn btn-danger" onclick="clearAllKnowledge()">üóëÔ∏è Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú</button>
                </div>
                <div id="knowledgeSettingsStatus" class="status-message"></div>
                
                <!-- ÌååÏã±Îêú Q&A ÌëúÏãú ÏòÅÏó≠ -->
                <div id="parsedDataView" style="display: none; margin-top: 20px; background: white; border-radius: 10px; padding: 20px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">üìã ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞</h4>
                    <div id="parsedDataContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Í≥†Í∞ù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="customerAdminPage">
        <div class="admin-header">
            <div class="admin-title">üë• ÌîºÎãâÏä§ÏπòÍ≥º Í≥†Í∞ù Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeCustomerAdmin()">üè† Î©îÏù∏ÏúºÎ°ú</button>
                <button class="nav-btn logout" onclick="closeCustomerAdmin()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalReservations">3</div>
                    <div class="stat-label">Ï¥ù ÏòàÏïΩ Ïàò</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayReservations">1</div>
                    <div class="stat-label">Ïò§Îäò ÏòàÏïΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="thisWeekReservations">2</div>
                    <div class="stat-label">Ïù¥Î≤àÏ£º ÏòàÏïΩ</div>
                </div>
            </div>

            <!-- ÏòàÏïΩ Î™ÖÎã® -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>üìã ÏòàÏïΩ Î™ÖÎã®</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="downloadAllReservations()">
                            üì• Ï†ÑÏ≤¥ ÏòàÏïΩ Í≥†Í∞ù ÏóëÏÖÄ Î∞õÍ∏∞
                        </button>
                        <button class="btn btn-primary" onclick="downloadDentalCheckupExcel()">
                            üì• Î¨¥Î£å Í≤ÄÏßÑ(Íµ¨Í∞ï) ÎåÄÏÉÅÏûêÎßå ÏóëÏÖÄ Î∞õÍ∏∞
                        </button>
                        <button class="btn btn-warning message-send" onclick="sendMessageToDentalTargets()">
                            üì® Î¨¥Î£å Í≤ÄÏßÑ(Íµ¨Í∞ï) ÎåÄÏÉÅÏûê Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞
                        </button>
                    </div>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ÏàúÎ≤à</th>
                            <th>ÏòàÏïΩÏûêÎ™Ö</th>
                            <th>ÏÉùÎÖÑÏõîÏùº</th>
                            <th>Ï†ÑÌôîÎ≤àÌò∏</th>
                            <th>ÏòàÏïΩÎÇ†Ïßú</th>
                            <th>ÏòàÏïΩÏãúÍ∞Ñ</th>
                            <th>Íµ¨Í∞ïÍ≤ÄÏßÑ Ï†ïÎ≥¥</th>
                            <th>ÏòàÏïΩÏùºÏãú</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                        <tr>
                            <td>1</td>
                            <td>ÍπÄÏ≤†Ïàò</td>
                            <td>850315</td>
                            <td>010-1234-5678</td>
                            <td>2025-06-15</td>
                            <td>10:00</td>
                            <td style="background: #e8f5e8;">ÎÇòÏù¥(40ÏÑ∏), 2025ÎÖÑ Íµ≠Í∞Ä Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅ</td>
                            <td>2025-06-12 09:30</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Ïù¥ÏòÅÌù¨</td>
                            <td>920722</td>
                            <td>010-9876-5432</td>
                            <td>2025-06-16</td>
                            <td>14:30</td>
                            <td style="background: #ffeaa7;">ÎÇòÏù¥(33ÏÑ∏), 2026ÎÖÑ Íµ≠Í∞Ä Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅ</td>
                            <td>2025-06-12 11:15</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Î∞ïÎØºÏàò</td>
                            <td>780904</td>
                            <td>010-5555-7777</td>
                            <td>2025-06-12</td>
                            <td>16:00</td>
                            <td style="background: #ffeaa7;">ÎÇòÏù¥(47ÏÑ∏), 2026ÎÖÑ Íµ≠Í∞Ä Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅ</td>
                            <td>2025-06-11 14:20</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ2 -->
    <div class="popup-page" id="chatbotAdminPage2" style="display: none;">
        <div class="admin-header">
            <div class="admin-title">ü§ñ AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <div class="admin-login-info">
                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">üîê Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥</div>
                <div style="font-size: 14px; font-weight: bold;">ÏïÑÏù¥Îîî: <span style="color: #ffd700;">phoenix</span> | ÎπÑÎ∞ÄÎ≤àÌò∏: <span style="color: #ffd700;">phoenix</span></div>
            </div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeChatbotAdmin2()">üè† Î©îÏù∏ÏúºÎ°ú</button>
                <button class="nav-btn logout" onclick="closeChatbotAdmin2()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- ÎãµÎ≥Ä Ïö∞ÏÑ†ÏàúÏúÑ Ï†ïÎ≥¥ -->
            <div class="admin-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="section-header">
                    <h3>üéØ AI Ï±óÎ¥á ÎãµÎ≥Ä Ïö∞ÏÑ†ÏàúÏúÑ</h3>
                </div>
                <div style="padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 15px;">
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 15px; text-align: center;">
                        ÎãµÎ≥Ä Ï≤òÎ¶¨ ÏàúÏÑú
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 14px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">1Ï∞®</div>
                            <div>üîê Í¥ÄÎ¶¨Ïûê Í∏∞Îä•</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">2Ï∞®</div>
                            <div>üìö ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">3Ï∞®</div>
                            <div>‚ùì Í∏∞Î≥∏ FAQ ÎãµÎ≥Ä</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">4Ï∞®</div>
                            <div>ü§ñ AI API Ìò∏Ï∂ú</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 5px;">5Ï∞®</div>
                            <div>üé≠ ÏãúÎÆ¨Î†àÏù¥ÏÖò ÎãµÎ≥Ä</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px; text-align: center; font-size: 13px;">
                        <span id="adminApiStatus2">
                            üî¥ AI API ÏÑ§Ï†ï ÌïÑÏöî
                        </span>
                    </div>
                </div>
            </div>

            <!-- AI Î™®Îç∏ API ÏÑ§Ï†ï -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ü§ñ Ï±óÎ¥á AI Î™®Îç∏ Ïó∞Í≤∞ÌïòÍ∏∞</h3>
                </div>
                
                <div class="api-form">
                    <!-- ChatGPT ÏÑ§Ï†ï -->
                    <div class="form-group">
                        <label for="chatgptApiKey2">ChatGPT API Key</label>
                        <input type="password" id="chatgptApiKey2" placeholder="sk-proj-...">
                    </div>
                    <div class="form-group">
                        <label for="chatgptModel2">ChatGPT Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="chatgptModel2">
                            <option value="">-- ChatGPT Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="gpt-4o">GPT-4o (ÏµúÏã† Î©ÄÌã∞Î™®Îã¨)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Í≤ΩÏ†úÏ†Å)</option>
                        </select>
                    </div>

                    <!-- Gemini ÏÑ§Ï†ï -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="geminiApiKey2">Gemini Î™®Îç∏ API Key</label>
                        <input type="password" id="geminiApiKey2" placeholder="AIza...">
                    </div>
                    <div class="form-group">
                        <label for="geminiModel2">Gemini Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="geminiModel2">
                            <option value="">-- Gemini Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (Îπ†Î•∏ ÏùëÎãµ)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (Í≥†ÏÑ±Îä•)</option>
                            <option value="gemini-1.0-pro">Gemini 1.0 Pro (ÏïàÏ†ïÏÑ±)</option>
                        </select>
                    </div>

                    <!-- Claude ÏÑ§Ï†ï -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="claudeApiKey2">Claude Î™®Îç∏ API Key</label>
                        <input type="password" id="claudeApiKey2" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label for="claudeModel2">Claude Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="claudeModel2">
                            <option value="">-- Claude Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="claude-3-haiku">Claude 3 Haiku (Îπ†Î•¥Í≥† Ìö®Ïú®Ï†Å)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (Í∑†ÌòïÏ†Å ÏÑ±Îä•)</option>
                            <option value="claude-3-opus">Claude 3 Opus (ÏµúÍ≥† ÏÑ±Îä•)</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet (ÏµúÏã† Î™®Îç∏)</option>
                        </select>
                    </div>

                    <div class="btn-group" style="margin-top: 30px;">
                        <button class="btn btn-primary" id="saveApiBtn2">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
                        <button class="btn btn-success" id="testApiBtn2">üîó Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
                        <button class="btn btn-danger" id="resetApiBtn2">üîÑ ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    <div id="apiStatus2" class="status-message"></div>
                </div>
            </div>

            <!-- AI ÏßÄÏãù ÌååÏùº ÏóÖÎ°úÎìú -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>üìö AI ÏßÄÏãù ÌååÏùº ÏóÖÎ°úÎìú</h3>
                </div>
                
                <div class="upload-area" id="uploadArea2">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ Ïó¨Í∏∞Î°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</div>
                    <div class="upload-types">üí° <strong>ÏßÄÏõê ÌòïÏãù: ÌÖçÏä§Ìä∏(.txt), JSONL(.jsonl)</strong><br>
                    <small style="color: #666;">‚Äª ÌÖçÏä§Ìä∏ ÌååÏùºÏùÄ Q&A ÌòïÏãùÏúºÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî</small></div>
                </div>
                <input type="file" id="fileInput2" class="file-input" accept=".txt,.jsonl" multiple>
                
                <div class="file-list" id="fileList2">
                    <!-- ÏóÖÎ°úÎìúÎêú ÌååÏùºÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <div id="knowledgeStatus2" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                    üìñ ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº: 0Í∞ú | ÏÉÅÌÉú: ÎπÑÌôúÏÑ±
                </div>
                
                <!-- ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº -->
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" id="saveKnowledgeBtn2">üíæ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•</button>
                    <button class="btn btn-primary" id="testKnowledgeBtn2">üîç ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏</button>
                                            <button class="btn" style="background: #ffd700; color: #333;" id="showParsedDataBtn2">üìã ÌååÏã±Îêú Q&A Î≥¥Í∏∞</button>
                    <button class="btn btn-danger" id="clearKnowledgeBtn2">üóëÔ∏è Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú</button>
                </div>
                <div id="knowledgeSettingsStatus2" class="status-message"></div>
                
                <!-- ÌååÏã±Îêú Q&A ÌëúÏãú ÏòÅÏó≠ -->
                <div id="parsedDataView2" style="display: none; margin-top: 20px; background: white; border-radius: 10px; padding: 20px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">üìã ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞</h4>
                    <div id="parsedDataContent2"></div>
                </div>
            </div>

            <!-- ÎåÄÌôî Ïù¥Î†• Í¥ÄÎ¶¨ -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>üí¨ ÎåÄÌôî Ïù¥Î†• Í¥ÄÎ¶¨</h3>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">üìä ÎåÄÌôî Ïù¥Î†• ÌòÑÌô©</h4>
                        <div id="chatHistoryStatus2" style="padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #4facfe;">
                            üí¨ ÌòÑÏû¨ ÎåÄÌôî Ïù¥Î†•: 0Í∞ú Î©îÏãúÏßÄ | ÏµúÎåÄ Ï†ÄÏû•: 20Í∞ú Î©îÏãúÏßÄ
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #2c3e50; margin-bottom: 10px;">‚öôÔ∏è ÎåÄÌôî Ïù¥Î†• ÏÑ§Ï†ï</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div>
                                <label style="font-weight: bold; display: block; margin-bottom: 5px;">ÏµúÎåÄ ÎåÄÌôî Ïù¥Î†• Í∞úÏàò</label>
                                <select id="maxHistorySelect2" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="10">10Í∞ú</option>
                                    <option value="20" selected>20Í∞ú</option>
                                    <option value="30">30Í∞ú</option>
                                    <option value="50">50Í∞ú</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-weight: bold; display: block; margin-bottom: 5px;">API Ìò∏Ï∂ú ÏµúÎåÄ ÌÜ†ÌÅ∞</label>
                                <select id="maxTokensSelect2" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                                    <option value="1000">1,000 ÌÜ†ÌÅ∞</option>
                                    <option value="1500" selected>1,500 ÌÜ†ÌÅ∞</option>
                                    <option value="2000">2,000 ÌÜ†ÌÅ∞</option>
                                    <option value="3000">3,000 ÌÜ†ÌÅ∞</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÎåÄÌôî Ïù¥Î†• Í¥ÄÎ¶¨ Î≤ÑÌäº -->
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="viewChatHistoryBtn2">üëÅÔ∏è ÎåÄÌôî Ïù¥Î†• Î≥¥Í∏∞</button>
                        <button class="btn btn-warning" id="clearChatHistoryBtn2">üóëÔ∏è ÎåÄÌôî Ïù¥Î†• ÏÇ≠Ï†ú</button>
                        <button class="btn btn-success" id="exportChatHistoryBtn2">üì• ÎåÄÌôî Ïù¥Î†• ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏãúÏûë');

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï
        function initializeData() {
            const existingData = localStorage.getItem('phoenixDentalReservations');
            if (!existingData) {
                // Ï¥àÍ∏∞ ÏÉòÌîå Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóê Ï†ÄÏû•
                const initialData = getSampleReservationData().map(item => ({
                    ...item,
                    id: Date.now() + Math.random() // Í≥†Ïú† ID ÏÉùÏÑ±
                }));
                localStorage.setItem('phoenixDentalReservations', JSON.stringify(initialData));
                console.log('Ï¥àÍ∏∞ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï ÏôÑÎ£å');
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', function() {
            initializeData();
            console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å');
            
            // Ï±óÎ¥á Î∞∞ÎÑà Î°úÍ∑∏
            console.log('AIÏ±óÎ¥á Î∞∞ÎÑà ÌëúÏãúÎê®');
        });

        // Î¨¥Î£å Í≤ÄÏßÑ(Íµ¨Í∞ï) ÌôïÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        function goToDentalCheckup() {
            console.log('Î¨¥Î£å Í≤ÄÏßÑ(Íµ¨Í∞ï) ÌôïÏù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô');
            window.location.href = 'dental_checkup.html';
        }

        // AIÏ±óÎ¥á ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        function goToChatbot() {
            console.log('AIÏ±óÎ¥á ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô');
            window.location.href = 'chatbot.html';
        }

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let chatbotOpen = false;
        let apiSettings = {
            chatgpt: {
                apiKey: '',
                model: '',
                enabled: false
            },
            gemini: {
                apiKey: '',
                model: '',
                enabled: false
            },
            claude: {
                apiKey: '',
                model: '',
                enabled: false
            },
            activeProvider: '' // ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêú AI ÏÑúÎπÑÏä§
        };
        let knowledgeBase = {
            files: [],
            content: '',
            parsedData: [], // ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            enabled: false
        };



        function loginCustomerAdmin() {
            console.log('Í≥†Í∞ù Í¥ÄÎ¶¨ Î°úÍ∑∏Ïù∏ ÌåùÏóÖ Ïó¥Í∏∞');
            window.currentLoginType = 'customer';
            document.getElementById('adminLoginPopup').style.display = 'flex';
        }

        // AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏2 Ìï®Ïàò
        function loginChatbotAdmin2() {
            console.log('AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÌåùÏóÖ Ïó¥Í∏∞');
            window.currentLoginType = 'chatbot';
            document.getElementById('adminLoginPopup').style.display = 'flex';
        }



        function openCustomerAdmin() {
            console.log('Í≥†Í∞ù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞');
            document.getElementById('customerAdminPage').style.display = 'block';
            
            // ÏµúÏã† ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
            updateCustomerTable();
            updateStatistics();
        }

        function closeCustomerAdmin() {
            console.log('Í≥†Í∞ù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Îã´Í∏∞');
            document.getElementById('customerAdminPage').style.display = 'none';
        }

        // AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïó¥Í∏∞/Îã´Í∏∞
        function openChatbotAdmin2() {
            console.log('AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ2 Ïó¥Í∏∞');
            document.getElementById('chatbotAdminPage2').style.display = 'block';
            
            // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ API ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            setTimeout(() => {
                updateAdminApiStatus2();
            }, 100);
            
            // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            setTimeout(() => {
                setupAdminEventListeners2();
            }, 100);
        }

        function closeChatbotAdmin2() {
            console.log('AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ2 Îã´Í∏∞');
            document.getElementById('chatbotAdminPage2').style.display = 'none';
        }

        // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ API ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateAdminApiStatus2() {
            const adminApiStatus = document.getElementById('adminApiStatus2');
            if (adminApiStatus) {
                // API ÏÑ§Ï†ï ÌôïÏù∏
                const settings = JSON.parse(localStorage.getItem('chatbotApiSettings') || '{}');
                const hasActiveAPI = settings.chatgpt?.enabled || settings.gemini?.enabled || settings.claude?.enabled;
                adminApiStatus.innerHTML = hasActiveAPI ? 'üü¢ AI API Ïó∞Í≤∞Îê®' : 'üî¥ AI API ÏÑ§Ï†ï ÌïÑÏöî';
            }
        }

        // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupAdminEventListeners2() {
            console.log('üîß AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ2 Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏãúÏûë');
            
            // API ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº
            const saveApiBtn = document.getElementById('saveApiBtn2');
            if (saveApiBtn) {
                saveApiBtn.addEventListener('click', function() {
                    try {
                        console.log('üíæ API ÏÑ§Ï†ï Ï†ÄÏû• ÏãúÏûë');
                        
                        // ÏûÖÎ†• ÌïÑÎìúÏóêÏÑú Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
                        const chatgptApiKey = document.getElementById('chatgptApiKey2');
                        const chatgptModel = document.getElementById('chatgptModel2');
                        const geminiApiKey = document.getElementById('geminiApiKey2');
                        const geminiModel = document.getElementById('geminiModel2');
                        const claudeApiKey = document.getElementById('claudeApiKey2');
                        const claudeModel = document.getElementById('claudeModel2');
                        
                        if (!chatgptApiKey || !chatgptModel || !geminiApiKey || !geminiModel || !claudeApiKey || !claudeModel) {
                            throw new Error('ÌïÑÏàò ÏûÖÎ†• ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        }
                        
                        const settings = {
                            chatgpt: {
                                enabled: chatgptApiKey.value.trim() !== '',
                                apiKey: chatgptApiKey.value.trim(),
                                model: chatgptModel.value
                            },
                            gemini: {
                                enabled: geminiApiKey.value.trim() !== '',
                                apiKey: geminiApiKey.value.trim(),
                                model: geminiModel.value
                            },
                            claude: {
                                enabled: claudeApiKey.value.trim() !== '',
                                apiKey: claudeApiKey.value.trim(),
                                model: claudeModel.value
                            }
                        };
                        
                        localStorage.setItem('chatbotApiSettings', JSON.stringify(settings));
                        console.log('‚úÖ API ÏÑ§Ï†ï Ï†ÄÏû• ÏôÑÎ£å:', settings);
                        
                        // ÏÉÅÌÉú Î©îÏãúÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                        const statusDiv = document.getElementById('apiStatus2');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<div style="color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">‚úÖ API ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!</div>';
                        }
                        
                        // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                        updateAdminApiStatus2();
                        
                        // ÏÑ±Í≥µ ÏïåÎ¶º
                        alert('‚úÖ API ÏÑ§Ï†ïÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                        
                    } catch (error) {
                        console.error('‚ùå API ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®:', error);
                        alert('‚ùå API ÏÑ§Ï†ï Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                });
                console.log('‚úÖ API ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            // API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Î≤ÑÌäº
            const testApiBtn = document.getElementById('testApiBtn2');
            if (testApiBtn) {
                testApiBtn.addEventListener('click', function() {
                    try {
                        console.log('üîó API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÏãúÏûë');
                        
                        const statusDiv = document.getElementById('apiStatus2');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<div style="color: #856404; padding: 10px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">üîÑ API Ïó∞Í≤∞ÏùÑ ÌÖåÏä§Ìä∏ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</div>';
                        }
                        
                        setTimeout(() => {
                            try {
                                const settings = JSON.parse(localStorage.getItem('chatbotApiSettings') || '{}');
                                let activeApis = [];
                                
                                if (settings.chatgpt?.enabled && settings.chatgpt?.apiKey) activeApis.push('ChatGPT');
                                if (settings.gemini?.enabled && settings.gemini?.apiKey) activeApis.push('Gemini');
                                if (settings.claude?.enabled && settings.claude?.apiKey) activeApis.push('Claude');
                                
                                console.log('üîç ÌôúÏÑ±ÌôîÎêú API:', activeApis);
                                
                                if (activeApis.length > 0) {
                                    const successMessage = `‚úÖ Ïó∞Í≤∞ ÏÑ±Í≥µ! ÌôúÏÑ±ÌôîÎêú API: ${activeApis.join(', ')}`;
                                    if (statusDiv) {
                                        statusDiv.innerHTML = `<div style="color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">${successMessage}</div>`;
                                    }
                                    alert(successMessage);
                                    
                                    // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                                    updateAdminApiStatus2();
                                } else {
                                    const errorMessage = '‚ùå ÌôúÏÑ±ÌôîÎêú APIÍ∞Ä ÏóÜÏäµÎãàÎã§. API ÌÇ§Î•º ÏûÖÎ†•ÌïòÍ≥† ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.';
                                    if (statusDiv) {
                                        statusDiv.innerHTML = `<div style="color: #721c24; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">${errorMessage}</div>`;
                                    }
                                    alert(errorMessage);
                                }
                            } catch (error) {
                                console.error('‚ùå API ÌÖåÏä§Ìä∏ Ïã§Ìå®:', error);
                                const errorMessage = '‚ùå API ÌÖåÏä§Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message;
                                if (statusDiv) {
                                    statusDiv.innerHTML = `<div style="color: #721c24; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">${errorMessage}</div>`;
                                }
                                alert(errorMessage);
                            }
                        }, 2000);
                        
                    } catch (error) {
                        console.error('‚ùå API ÌÖåÏä§Ìä∏ ÏãúÏûë Ïã§Ìå®:', error);
                        alert('‚ùå API ÌÖåÏä§Ìä∏Î•º ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§: ' + error.message);
                    }
                });
                console.log('‚úÖ API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            // API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî Î≤ÑÌäº
            const resetApiBtn = document.getElementById('resetApiBtn2');
            if (resetApiBtn) {
                resetApiBtn.addEventListener('click', function() {
                    if (confirm('‚ö†Ô∏è Î™®Îì† API ÏÑ§Ï†ïÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                        try {
                            console.log('üîÑ API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî ÏãúÏûë');
                            
                            // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
                            const inputs = ['chatgptApiKey2', 'chatgptModel2', 'geminiApiKey2', 'geminiModel2', 'claudeApiKey2', 'claudeModel2'];
                            inputs.forEach(id => {
                                const element = document.getElementById(id);
                                if (element) {
                                    element.value = '';
                                }
                            });
                            
                            // localStorageÏóêÏÑú ÏÑ§Ï†ï ÏÇ≠Ï†ú
                            localStorage.removeItem('chatbotApiSettings');
                            
                            // ÏÉÅÌÉú Î©îÏãúÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                            const statusDiv = document.getElementById('apiStatus2');
                            if (statusDiv) {
                                statusDiv.innerHTML = '<div style="color: #856404; padding: 10px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">üîÑ API ÏÑ§Ï†ïÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.</div>';
                            }
                            
                            // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                            updateAdminApiStatus2();
                            
                            console.log('‚úÖ API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
                            alert('‚úÖ API ÏÑ§Ï†ïÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§!');
                            
                        } catch (error) {
                            console.error('‚ùå API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                            alert('‚ùå API ÏÑ§Ï†ï Ï¥àÍ∏∞ÌôîÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                        }
                    }
                });
                console.log('‚úÖ API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            // Í∏∞Ï°¥ ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
            try {
                const settings = JSON.parse(localStorage.getItem('chatbotApiSettings') || '{}');
                
                if (settings.chatgpt?.apiKey) {
                    const chatgptApiKey = document.getElementById('chatgptApiKey2');
                    if (chatgptApiKey) chatgptApiKey.value = settings.chatgpt.apiKey;
                }
                if (settings.chatgpt?.model) {
                    const chatgptModel = document.getElementById('chatgptModel2');
                    if (chatgptModel) chatgptModel.value = settings.chatgpt.model;
                }
                if (settings.gemini?.apiKey) {
                    const geminiApiKey = document.getElementById('geminiApiKey2');
                    if (geminiApiKey) geminiApiKey.value = settings.gemini.apiKey;
                }
                if (settings.gemini?.model) {
                    const geminiModel = document.getElementById('geminiModel2');
                    if (geminiModel) geminiModel.value = settings.gemini.model;
                }
                if (settings.claude?.apiKey) {
                    const claudeApiKey = document.getElementById('claudeApiKey2');
                    if (claudeApiKey) claudeApiKey.value = settings.claude.apiKey;
                }
                if (settings.claude?.model) {
                    const claudeModel = document.getElementById('claudeModel2');
                    if (claudeModel) claudeModel.value = settings.claude.model;
                }
                
                console.log('‚úÖ Í∏∞Ï°¥ API ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å');
            } catch (error) {
                console.error('‚ùå Í∏∞Ï°¥ API ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
            }

            // ÌååÏùº ÏóÖÎ°úÎìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            const fileInput2 = document.getElementById('fileInput2');
            if (fileInput2) {
                fileInput2.addEventListener('change', function(event) {
                    const files = event.target.files;
                    processUploadedFiles2(files);
                });
                console.log('‚úÖ ÌååÏùº ÏóÖÎ°úÎìú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å (fileInput2)');
            }

            // ÌååÏùº ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            const uploadArea2 = document.getElementById('uploadArea2');
            if (uploadArea2) {
                // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                uploadArea2.addEventListener('click', function() {
                    document.getElementById('fileInput2').click();
                });
                
                // ÎìúÎûòÍ∑∏ Ïò§Î≤Ñ Ïù¥Î≤§Ìä∏
                uploadArea2.addEventListener('dragover', function(event) {
                    event.preventDefault();
                    this.style.borderColor = '#4facfe';
                });
                
                // ÎìúÎûòÍ∑∏ Î¶¨Î∏å Ïù¥Î≤§Ìä∏
                uploadArea2.addEventListener('dragleave', function(event) {
                    event.preventDefault();
                    this.style.borderColor = '#ddd';
                });
                
                // ÎìúÎ°≠ Ïù¥Î≤§Ìä∏
                uploadArea2.addEventListener('drop', function(event) {
                    event.preventDefault();
                    this.style.borderColor = '#ddd';
                    
                    const files = event.dataTransfer.files;
                    processUploadedFiles2(files);
                });
                console.log('‚úÖ ÌååÏùº ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å (uploadArea2)');
            }

            // ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº
            const saveKnowledgeBtn2 = document.getElementById('saveKnowledgeBtn2');
            if (saveKnowledgeBtn2) {
                saveKnowledgeBtn2.addEventListener('click', function() {
                    try {
                        console.log('üíæ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû• ÏãúÏûë');
                        
                        const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                        
                        // ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÌôúÏÑ±Ìôî
                        knowledgeData.enabled = knowledgeData.parsedData.length > 0;
                        
                        // ÌååÏùº Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ (Ïã§Ï†ú ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞ÏóêÏÑú ÌååÏùºÎ™Ö Ï∂îÏ∂ú)
                        const fileNames = [...new Set(knowledgeData.parsedData.map(qa => qa.source).filter(Boolean))];
                        knowledgeData.files = fileNames;
                        
                        localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
                        
                        const statusDiv = document.getElementById('knowledgeSettingsStatus2');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<div style="color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">‚úÖ ÏßÄÏãù ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!</div>';
                        }
                        
                        updateKnowledgeStatus2();
                        updateFileList2();
                        
                        alert('‚úÖ ÏßÄÏãù ÏÑ§Ï†ïÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                        
                    } catch (error) {
                        console.error('‚ùå ÏßÄÏãù ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®:', error);
                        alert('‚ùå ÏßÄÏãù ÏÑ§Ï†ï Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                    }
                });
                console.log('‚úÖ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            // ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏ Î≤ÑÌäº
            const testKnowledgeBtn2 = document.getElementById('testKnowledgeBtn2');
            if (testKnowledgeBtn2) {
                testKnowledgeBtn2.addEventListener('click', function() {
                    const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                    
                    if (!knowledgeData.enabled || knowledgeData.parsedData.length === 0) {
                        alert('üìö ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏\n\nÌôúÏÑ±ÌôîÎêú ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÏÇ¨Ïö©Î≤ï:\n1. ÏßÄÏãù ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî (.txt, .jsonl)\n2. "ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî\n3. Ïù¥ Î≤ÑÌäºÏúºÎ°ú ÏóÖÎ°úÎìúÎêú ÏßÄÏãùÏù¥ Ï†úÎåÄÎ°ú Í≤ÄÏÉâÎêòÎäîÏßÄ ÌÖåÏä§Ìä∏ÌïòÏÑ∏Ïöî');
                        return;
                    }
                    
                    const testQuery = prompt(`üîç ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏\n\nÏóÖÎ°úÎìúÎêú ${knowledgeData.parsedData.length}Í∞úÏùò Q&A Ï§ëÏóêÏÑú Í≤ÄÏÉâÌï† ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:\n\nÏòàÏãú: ÏßÑÎ£åÏãúÍ∞Ñ, ÏòàÏïΩÎ∞©Î≤ï, ÏπòÎ£åÎπÑÏö© Îì±`);
                    if (!testQuery) return;
                    
                    console.log('üîç ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏:', testQuery);
                    console.log('Í≤ÄÏÉâ ÎåÄÏÉÅ Q&A Í∞úÏàò:', knowledgeData.parsedData.length);
                    
                    const result = searchInKnowledgeBase2(testQuery, knowledgeData.parsedData);
                    if (result) {
                        alert(`üîç Í≤ÄÏÉâ Í≤∞Í≥º:\n\nQ: ${result.question}\n\nA: ${result.answer}\n\nÏ∂úÏ≤ò: ${result.source || 'Ïïå Ïàò ÏóÜÏùå'}\n\n‚úÖ ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÏûëÎèôÌï©ÎãàÎã§!`);
                    } else {
                        alert(`‚ùå Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå\n\nÏßàÎ¨∏: "${testQuery}"\n\nÍ¥ÄÎ†® ÎãµÎ≥ÄÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.\nÎã§Î•∏ ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî.\n\nüí° ÏóÖÎ°úÎìúÎêú ÌååÏùºÏùò ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÎ†§Î©¥ "üìã ÌååÏã±Îêú Q&A Î≥¥Í∏∞" Î≤ÑÌäºÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.`);
                    }
                });
                console.log('‚úÖ ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            // ÌååÏã±Îêú Q&A Î≥¥Í∏∞ Î≤ÑÌäº
            const showParsedDataBtn2 = document.getElementById('showParsedDataBtn2');
            if (showParsedDataBtn2) {
                showParsedDataBtn2.addEventListener('click', function() {
                    const parsedDataView2 = document.getElementById('parsedDataView2');
                    const parsedDataContent2 = document.getElementById('parsedDataContent2');
                    
                    if (parsedDataView2.style.display === 'none') {
                        const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                        
                        if (knowledgeData.parsedData.length === 0) {
                            alert('ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                            return;
                        }
                        
                        let content = '';
                        knowledgeData.parsedData.forEach((qa, index) => {
                            content += `
                                <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
                                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">
                                        Q${index + 1}: ${qa.question}
                                    </div>
                                    <div style="color: #666; line-height: 1.5;">
                                        A: ${qa.answer}
                                    </div>
                                    <div style="font-size: 12px; color: #999; margin-top: 5px;">
                                        Ï∂úÏ≤ò: ${qa.source || 'Ïïå Ïàò ÏóÜÏùå'}
                                    </div>
                                </div>
                            `;
                        });
                        
                        parsedDataContent2.innerHTML = content;
                        parsedDataView2.style.display = 'block';
                        showParsedDataBtn2.textContent = 'üìã ÌååÏã±Îêú Q&A Ïà®Í∏∞Í∏∞';
                    } else {
                        parsedDataView2.style.display = 'none';
                        showParsedDataBtn2.textContent = 'üìã ÌååÏã±Îêú Q&A Î≥¥Í∏∞';
                    }
                });
                console.log('‚úÖ ÌååÏã±Îêú Q&A Î≥¥Í∏∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            // Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú Î≤ÑÌäº
            const clearKnowledgeBtn2 = document.getElementById('clearKnowledgeBtn2');
            if (clearKnowledgeBtn2) {
                clearKnowledgeBtn2.addEventListener('click', function() {
                    if (confirm('‚ö†Ô∏è Î™®Îì† ÏßÄÏãù Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                        try {
                            console.log('üóëÔ∏è Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú ÏãúÏûë');
                            
                            // localStorageÏóêÏÑú ÏßÄÏãù Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                            localStorage.removeItem('chatbotKnowledgeBase');
                            
                            // ÌååÏùº Î™©Î°ù Ï¥àÍ∏∞Ìôî
                            const fileList2 = document.getElementById('fileList2');
                            if (fileList2) {
                                fileList2.innerHTML = '';
                            }
                            
                            // ÌååÏã±Îêú Q&A Î≥¥Í∏∞ ÏòÅÏó≠ Ïà®Í∏∞Í∏∞
                            const parsedDataView2 = document.getElementById('parsedDataView2');
                            if (parsedDataView2) {
                                parsedDataView2.style.display = 'none';
                            }
                            
                            // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                            updateKnowledgeStatus2();
                            
                            const statusDiv = document.getElementById('knowledgeSettingsStatus2');
                            if (statusDiv) {
                                statusDiv.innerHTML = '<div style="color: #856404; padding: 10px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">üóëÔ∏è Î™®Îì† ÏßÄÏãù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.</div>';
                            }
                            
                            console.log('‚úÖ Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú ÏôÑÎ£å');
                            alert('‚úÖ Î™®Îì† ÏßÄÏãù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§!');
                            
                        } catch (error) {
                            console.error('‚ùå ÏßÄÏãù ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                            alert('‚ùå ÏßÄÏãù ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
                        }
                    }
                });
                console.log('‚úÖ Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä ÏôÑÎ£å');
            }

            console.log('üîß AIÏ±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ2 Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï ÏôÑÎ£å');
        }

        // AI Ï±óÎ¥á Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ2 ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ Ìï®ÏàòÎì§
        function processUploadedFiles2(files) {
            console.log('ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ ÏãúÏûë (Í¥ÄÎ¶¨Ïûê2):', files.length, 'Í∞ú');
            showStatus2('knowledgeSettingsStatus2', 'üìÅ ÌååÏùºÏùÑ Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'success');
            
            let processedCount = 0;
            const totalFiles = files.length;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                console.log('ÌååÏùº Ï≤òÎ¶¨ Ï§ë (Í¥ÄÎ¶¨Ïûê2):', file.name, file.type, file.size);
                
                const fileData = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    uploadTime: new Date(),
                    content: ''
                };
                
                // ÌååÏùº ÌôïÏû•Ïûê ÌôïÏù∏
                const fileExtension = file.name.toLowerCase().split('.').pop();
                
                // PDF ÌååÏùº Í≤ΩÍ≥†
                if (fileExtension === 'pdf' || file.type === 'application/pdf') {
                    console.warn('PDF ÌååÏùº Í∞êÏßÄ (Í¥ÄÎ¶¨Ïûê2):', file.name);
                    processedCount++;
                    
                    if (processedCount === totalFiles) {
                        showStatus2('knowledgeSettingsStatus2', 
                            `‚ùå PDF ÌååÏùºÏùÄ ÌòÑÏû¨ ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§.\nPDF ÎÇ¥Ïö©ÏùÑ ÌÖçÏä§Ìä∏ ÌååÏùº(.txt)Î°ú Î≥µÏÇ¨Ìï¥ÏÑú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.`, 
                            'error');
                    }
                    continue;
                }
                
                // ÏßÄÏõêÎêòÎäî ÌååÏùº ÌòïÏãù Ï≤òÎ¶¨
                if (fileExtension === 'txt' || file.type === 'text/plain' || file.type === '') {
                    // ÌÖçÏä§Ìä∏ ÌååÏùº Ï≤òÎ¶¨
                    processTextFileWithEncoding2(file, fileData, () => {
                        processedCount++;
                        checkAllFilesProcessed2();
                    });

                } else if (fileExtension === 'jsonl' || file.type === 'application/jsonl' || file.type === 'text/plain') {
                    // JSONL ÌååÏùº Ï≤òÎ¶¨
                    processJsonlFile2(file, fileData, () => {
                        processedCount++;
                        checkAllFilesProcessed2();
                    });
                } else {
                    // ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãù
                    console.warn('ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãù (Í¥ÄÎ¶¨Ïûê2):', file.name, file.type);
                    processedCount++;
                    
                    if (processedCount === totalFiles) {
                        showStatus2('knowledgeSettingsStatus2', 
                            `‚ùå ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§: ${file.name}\n\nüìÅ ÌòÑÏû¨ ÏßÄÏõêÎêòÎäî ÌååÏùº ÌòïÏãù:\n‚Ä¢ ÌÖçÏä§Ìä∏ ÌååÏùº (.txt)\n‚Ä¢ JSONL ÌååÏùº (.jsonl)`, 
                            'error');
                    }
                    checkAllFilesProcessed2();
                }
            }
            
            // Î™®Îì† ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å ÌôïÏù∏ Ìï®Ïàò
            function checkAllFilesProcessed2() {
                if (processedCount === totalFiles) {
                    console.log('Ï†ÑÏ≤¥ ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å (Í¥ÄÎ¶¨Ïûê2)');
                    
                    // ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÏûêÎèô ÌôúÏÑ±Ìôî
                    const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                    knowledgeData.enabled = knowledgeData.parsedData.length > 0;
                    localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
                    
                    // ÌååÏùº Î™©Î°ùÍ≥º ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    updateFileList2();
                    updateKnowledgeStatus2();
                    
                    if (knowledgeData.parsedData.length > 0) {
                        const message = `‚úÖ ${totalFiles}Í∞ú ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å!\nüìö Ï¥ù ${knowledgeData.parsedData.length}Í∞úÏùò Q&AÍ∞Ä ÌååÏã±ÎêòÏóàÏäµÎãàÎã§.\nü§ñ ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä ÏûêÎèôÏúºÎ°ú ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!\n\nüíæ "ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•ÌïòÏÑ∏Ïöî.`;
                        showStatus2('knowledgeSettingsStatus2', message, 'success');
                    } else {
                        showStatus2('knowledgeSettingsStatus2', 
                            `‚ö†Ô∏è ÌååÏùºÏùÄ ÏùΩÏóàÏßÄÎßå Q&A Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.\n\nüìù Ïò¨Î∞îÎ•∏ ÌòïÏãù ÏòàÏãú:\nQ: ÏßÑÎ£åÏãúÍ∞ÑÏù¥ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?\nA: ÌèâÏùº 09:00-18:00ÏûÖÎãàÎã§.`, 
                            'error');
                    }
                }
            }
        }

        // ÌÖçÏä§Ìä∏ ÌååÏùºÏùÑ Îã§ÏñëÌïú Ïù∏ÏΩîÎî©ÏúºÎ°ú ÏùΩÍ∏∞ ÏãúÎèÑ (Í¥ÄÎ¶¨Ïûê2)
        function processTextFileWithEncoding2(file, fileData, callback) {
            console.log('üî§ ÌÖçÏä§Ìä∏ ÌååÏùº Ïù∏ÏΩîÎî© Ï≤òÎ¶¨ (Í¥ÄÎ¶¨Ïûê2):', file.name);
            
            // UTF-8Î°ú Î®ºÏ†Ä ÏãúÎèÑ
            const reader1 = new FileReader();
            reader1.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    // ÌïúÍ∏ÄÏù¥ Ï†úÎåÄÎ°ú ÏùΩÌòîÎäîÏßÄ ÌôïÏù∏
                    const hasKorean = /[Í∞Ä-Ìû£]/.test(content);
                    const hasBrokenChars = /[‚óÜ]/.test(content) || content.includes('');
                    
                    if (hasKorean && !hasBrokenChars) {
                        console.log('‚úÖ UTF-8 Ïù∏ÏΩîÎî© ÏÑ±Í≥µ (Í¥ÄÎ¶¨Ïûê2):', file.name);
                        fileData.content = content;
                        processKnowledgeFile2(fileData);
                        callback();
                        return;
                    }
                    
                    console.log('‚ùå UTF-8 Ïã§Ìå®, EUC-KR ÏãúÎèÑ (Í¥ÄÎ¶¨Ïûê2)');
                    // EUC-KRÎ°ú Ïû¨ÏãúÎèÑ
                    tryEucKrEncoding2();
                    
                } catch (error) {
                    console.error('UTF-8 ÏùΩÍ∏∞ Ïò§Î•ò (Í¥ÄÎ¶¨Ïûê2):', error);
                    tryEucKrEncoding2();
                }
            };
            
            reader1.onerror = function() {
                console.error('UTF-8 ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò (Í¥ÄÎ¶¨Ïûê2)');
                tryEucKrEncoding2();
            };
            
            // EUC-KR ÏãúÎèÑ Ìï®Ïàò
            function tryEucKrEncoding2() {
                const reader2 = new FileReader();
                reader2.onload = function(e) {
                    try {
                        const content = e.target.result;
                        const hasKorean = /[Í∞Ä-Ìû£]/.test(content);
                        const hasBrokenChars = /[‚óÜ]/.test(content) || content.includes('');
                        
                        if (hasKorean && !hasBrokenChars) {
                            console.log('‚úÖ EUC-KR Ïù∏ÏΩîÎî© ÏÑ±Í≥µ (Í¥ÄÎ¶¨Ïûê2):', file.name);
                            fileData.content = content;
                            processKnowledgeFile2(fileData);
                            callback();
                            return;
                        }
                        
                        // Îëò Îã§ Ïã§Ìå®Ìïú Í≤ΩÏö∞ UTF-8 Í≤∞Í≥º ÏÇ¨Ïö©
                        console.log('‚ö†Ô∏è ÌïúÍ∏Ä Í∞êÏßÄ Ïã§Ìå®, UTF-8 Í≤∞Í≥º ÏÇ¨Ïö© (Í¥ÄÎ¶¨Ïûê2):', file.name);
                        fileData.content = reader1.result || '';
                        processKnowledgeFile2(fileData);
                        callback();
                        
                    } catch (error) {
                        console.error('EUC-KR ÏùΩÍ∏∞ Ïò§Î•ò (Í¥ÄÎ¶¨Ïûê2):', error);
                        // ÎßàÏßÄÎßâ ÏàòÎã®ÏúºÎ°ú UTF-8 ÏÇ¨Ïö©
                        fileData.content = reader1.result || '';
                        processKnowledgeFile2(fileData);
                        callback();
                    }
                };
                
                reader2.onerror = function() {
                    console.error('EUC-KR ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò (Í¥ÄÎ¶¨Ïûê2)');
                    // UTF-8 Í≤∞Í≥ºÎùºÎèÑ ÏÇ¨Ïö©
                    fileData.content = reader1.result || '';
                    processKnowledgeFile2(fileData);
                    callback();
                };
                
                reader2.readAsText(file, 'EUC-KR');
            }
            
            // UTF-8Î∂ÄÌÑ∞ ÏãúÏûë
            reader1.readAsText(file, 'UTF-8');
        }



        // JSONL ÌååÏùº Ï≤òÎ¶¨ Ìï®Ïàò (Í¥ÄÎ¶¨Ïûê2)
        function processJsonlFile2(file, fileData, callback) {
            console.log('üìÑ JSONL ÌååÏùº Ï≤òÎ¶¨ ÏãúÏûë (Í¥ÄÎ¶¨Ïûê2):', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    fileData.content = content;
                    processJsonlContent2(fileData);
                    callback();
                    
                } catch (error) {
                    console.error('JSONL ÌååÏùº Ï≤òÎ¶¨ Ïò§Î•ò (Í¥ÄÎ¶¨Ïûê2):', error);
                    showStatus2('knowledgeSettingsStatus2', 
                        `‚ùå JSONL ÌååÏùº Ï≤òÎ¶¨ Ïã§Ìå®: ${file.name}`, 
                        'error');
                    callback();
                }
            };
            
            reader.onerror = function() {
                console.error('JSONL ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò (Í¥ÄÎ¶¨Ïûê2)');
                showStatus2('knowledgeSettingsStatus2', 
                    `‚ùå JSONL ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®: ${file.name}`, 
                    'error');
                callback();
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // JSONL ÎÇ¥Ïö© Ï≤òÎ¶¨ (Í¥ÄÎ¶¨Ïûê2)
        function processJsonlContent2(fileData) {
            console.log('üìÑ JSONL ÎÇ¥Ïö© Ï≤òÎ¶¨ (Í¥ÄÎ¶¨Ïûê2):', fileData.name);
            
            if (!fileData.content || fileData.content.trim().length === 0) {
                console.log('JSONL ÎÇ¥Ïö©Ïù¥ ÎπÑÏñ¥ÏûàÏùå (Í¥ÄÎ¶¨Ïûê2):', fileData.name);
                return;
            }
            
            const content = fileData.content;
            const lines = content.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
            console.log('JSONL ÌååÏã±Ìï† ÎùºÏù∏ Ïàò (Í¥ÄÎ¶¨Ïûê2):', lines.length);
            
            const parsedQA = [];
            
            // Í∞Å ÎùºÏù∏ÏùÑ JSONÏúºÎ°ú ÌååÏã±
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                try {
                    const jsonData = JSON.parse(line);
                    
                    // Îã§ÏñëÌïú JSON Íµ¨Ï°∞ ÏßÄÏõê
                    let question = '';
                    let answer = '';
                    
                    if (jsonData.question && jsonData.answer) {
                        question = jsonData.question;
                        answer = jsonData.answer;
                    } else if (jsonData.q && jsonData.a) {
                        question = jsonData.q;
                        answer = jsonData.a;
                    } else if (jsonData.ÏßàÎ¨∏ && jsonData.ÎãµÎ≥Ä) {
                        question = jsonData.ÏßàÎ¨∏;
                        answer = jsonData.ÎãµÎ≥Ä;
                    } else if (jsonData.text && jsonData.response) {
                        question = jsonData.text;
                        answer = jsonData.response;
                    } else if (jsonData.prompt && jsonData.completion) {
                        question = jsonData.prompt;
                        answer = jsonData.completion;
                    } else if (jsonData.input && jsonData.output) {
                        question = jsonData.input;
                        answer = jsonData.output;
                    }
                    
                    if (question && answer && question.length > 2 && answer.length > 3) {
                        const qaItem = {
                            question: question,
                            answer: answer,
                            source: fileData.name,
                            lineNumber: i + 1,
                            pattern: 'JSONL'
                        };
                        
                        parsedQA.push(qaItem);
                        console.log('JSONL Q&A Ï∂îÍ∞Ä (Í¥ÄÎ¶¨Ïûê2):', question.substring(0, 30) + '...');
                    }
                    
                } catch (error) {
                    console.warn(`JSONL ÎùºÏù∏ ${i + 1} ÌååÏã± Ïã§Ìå® (Í¥ÄÎ¶¨Ïûê2):`, error);
                    continue;
                }
            }
            
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä (Ï§ëÎ≥µ Ï†úÍ±∞)
            const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
            parsedQA.forEach(newQA => {
                const isDuplicate = knowledgeData.parsedData.some(existingQA => 
                    existingQA.question === newQA.question && existingQA.source === newQA.source
                );
                
                if (!isDuplicate) {
                    knowledgeData.parsedData.push(newQA);
                }
            });
            
            localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
            console.log(`${fileData.name}ÏóêÏÑú ÏÉàÎ°ú ÌååÏã±Îêú Q&A (Í¥ÄÎ¶¨Ïûê2):`, parsedQA.length, 'Í∞ú');
        }

        // ÏßÄÏãù ÌååÏùº Ï≤òÎ¶¨ Ìï®Ïàò (Í¥ÄÎ¶¨Ïûê2)
        function processKnowledgeFile2(fileData) {
            console.log('ÏßÄÏãù ÌååÏùº Ï≤òÎ¶¨ (Í¥ÄÎ¶¨Ïûê2):', fileData.name);
            
            if (!fileData.content || fileData.content.trim().length === 0) {
                console.log('ÌååÏùº ÎÇ¥Ïö©Ïù¥ ÎπÑÏñ¥ÏûàÏùå (Í¥ÄÎ¶¨Ïûê2):', fileData.name);
                return;
            }
            
            const content = fileData.content;
            const lines = content.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
            console.log('ÌååÏã±Ìï† ÎùºÏù∏ Ïàò (Í¥ÄÎ¶¨Ïûê2):', lines.length);
            
            const parsedQA = [];
            
            // Ìå®ÌÑ¥Î≥Ñ ÌååÏã± ÏãúÎèÑ
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let question = '';
                let answer = '';
                
                // Ìå®ÌÑ¥ 1: Q: ÏßàÎ¨∏, A: ÎãµÎ≥Ä
                if (line.match(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]\s*(.+)$/i)) {
                    question = line.replace(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]\s*/i, '').trim();
                    
                    // Îã§Ïùå Ï§ÑÏóêÏÑú ÎãµÎ≥Ä Ï∞æÍ∏∞
                    for (let j = i + 1; j < lines.length && j < i + 5; j++) {
                        const nextLine = lines[j];
                        if (nextLine.match(/^[AaAnswÎãµÎ≥ÄÎãµÏùëÎãµ]\s*[:Ôºö]\s*(.+)$/i)) {
                            answer = nextLine.replace(/^[AaAnswÎãµÎ≥ÄÎãµÏùëÎãµ]\s*[:Ôºö]\s*/i, '').trim();
                            i = j; // Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
                            break;
                        } else if (!nextLine.match(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]/i)) {
                            // Q:Í∞Ä ÏïÑÎãàÎ©¥ ÎãµÎ≥ÄÏúºÎ°ú Í∞ÑÏ£º
                            answer = nextLine;
                            i = j;
                            break;
                        }
                    }
                }
                
                // Ìå®ÌÑ¥ 2: Ïà´Ïûê. ÏßàÎ¨∏?
                else if (line.match(/^\d+\.\s*(.+[?Ôºü])\s*$/)) {
                    question = line.replace(/^\d+\.\s*/, '').trim();
                    if (i + 1 < lines.length && !lines[i + 1].match(/^\d+\./)) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                
                // Ìå®ÌÑ¥ 3: - ÏßàÎ¨∏?
                else if (line.match(/^[-‚Ä¢*]\s*(.+[?Ôºü])\s*$/)) {
                    question = line.replace(/^[-‚Ä¢*]\s*/, '').trim();
                    if (i + 1 < lines.length && !lines[i + 1].match(/^[-‚Ä¢*]/)) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                
                // Ìå®ÌÑ¥ 4: ÏßàÎ¨∏ ÌÇ§ÏõåÎìú Ìè¨Ìï®
                else if (line.length > 5 && 
                         (line.includes('?') || line.includes('Ôºü') ||
                          line.match(/(Ïñ¥ÎñªÍ≤å|Ïñ∏Ï†ú|Ïñ¥ÎîîÏÑú|Ïôú|Î¨¥Ïóá|ÎàÑÍ∞Ä|ÏñºÎßà|Î™áÏãú|Ïñ¥Îñ§|Î≠îÍ∞Ä|Ïñ¥Îîî|Î™á|Ïñ∏Ï†úÍπåÏßÄ)/))) {
                    question = line;
                    
                    // Îã§Ïùå Î™á Ï§ÑÏùÑ ÎãµÎ≥ÄÏúºÎ°ú ÏàòÏßë
                    const answerLines = [];
                    for (let j = i + 1; j < Math.min(i + 4, lines.length); j++) {
                        const nextLine = lines[j];
                        // Îã§Ïùå ÏßàÎ¨∏Ïù¥ ÎÇòÏò§Î©¥ Ï§ëÎã®
                        if (nextLine.match(/(Ïñ¥ÎñªÍ≤å|Ïñ∏Ï†ú|Ïñ¥ÎîîÏÑú|Ïôú|Î¨¥Ïóá|ÎàÑÍ∞Ä|ÏñºÎßà|Î™áÏãú|Ïñ¥Îñ§)[?Ôºü]/) ||
                            nextLine.match(/^[\d\-‚Ä¢*Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]/)) {
                            break;
                        }
                        answerLines.push(nextLine);
                        if (answerLines.join(' ').length > 200) break; // ÎÑàÎ¨¥ Í∏∏Î©¥ Ï§ëÎã®
                    }
                    
                    if (answerLines.length > 0) {
                        answer = answerLines.join(' ').trim();
                        i += answerLines.length;
                    }
                }
                
                // Ìå®ÌÑ¥ 5: Ï†úÎ™©: ÎÇ¥Ïö©
                else if (line.match(/^([^:Ôºö]{2,20})[:Ôºö]\s*(.{5,})$/)) {
                    const matches = line.match(/^([^:Ôºö]{2,20})[:Ôºö]\s*(.{5,})$/);
                    if (matches) {
                        question = matches[1].trim();
                        answer = matches[2].trim();
                    }
                }
                
                // Ïú†Ìö®Ìïú Q&A Ïåç Ï†ÄÏû•
                if (question && answer && question.length > 2 && answer.length > 3) {
                    const qaItem = {
                        question: question,
                        answer: answer,
                        source: fileData.name,
                        lineNumber: i + 1,
                        pattern: 'ÏûêÎèôÍ∞êÏßÄ'
                    };
                    
                    parsedQA.push(qaItem);
                    console.log('Q&A Ï∂îÍ∞Ä (Í¥ÄÎ¶¨Ïûê2):', question.substring(0, 30) + '...');
                }
            }
            
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä (Ï§ëÎ≥µ Ï†úÍ±∞)
            const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
            parsedQA.forEach(newQA => {
                const isDuplicate = knowledgeData.parsedData.some(existingQA => 
                    existingQA.question === newQA.question && existingQA.source === newQA.source
                );
                
                if (!isDuplicate) {
                    knowledgeData.parsedData.push(newQA);
                }
            });
            
            localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
            console.log(`${fileData.name}ÏóêÏÑú ÏÉàÎ°ú ÌååÏã±Îêú Q&A (Í¥ÄÎ¶¨Ïûê2):`, parsedQA.length, 'Í∞ú');
        }

        // ÌååÏùº Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏ (Í¥ÄÎ¶¨Ïûê2)
        function updateFileList2() {
            const fileList2 = document.getElementById('fileList2');
            if (!fileList2) return;
            
            const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
            
            // ÌååÏùºÎ≥Ñ Q&A Í∞úÏàò Í≥ÑÏÇ∞
            const fileQACounts = {};
            knowledgeData.parsedData.forEach(qa => {
                if (qa.source) {
                    fileQACounts[qa.source] = (fileQACounts[qa.source] || 0) + 1;
                }
            });
            
            // ÌååÏùº Î™©Î°ù ÏÉùÏÑ±
            let fileListHTML = '';
            Object.keys(fileQACounts).forEach(filename => {
                const qaCount = fileQACounts[filename];
                fileListHTML += `
                    <div class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">
                        <div>
                            <strong>üìÑ ${filename}</strong>
                            <div style="font-size: 12px; color: #666;">Q&A: ${qaCount}Í∞ú</div>
                        </div>
                        <button onclick="removeFile2('${filename}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">ÏÇ≠Ï†ú</button>
                    </div>
                `;
            });
            
            fileList2.innerHTML = fileListHTML;
        }

        // ÌååÏùº ÏÇ≠Ï†ú (Í¥ÄÎ¶¨Ïûê2)
        function removeFile2(filename) {
            if (confirm(`ÌååÏùº "${filename}"ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                
                // Ìï¥Îãπ ÌååÏùºÏùò Q&A Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                knowledgeData.parsedData = knowledgeData.parsedData.filter(qa => qa.source !== filename);
                
                localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
                
                updateFileList2();
                updateKnowledgeStatus2();
                
                alert(`ÌååÏùº "${filename}"Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`);
            }
        }

        // ÏßÄÏãù ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ (Í¥ÄÎ¶¨Ïûê2)
        function updateKnowledgeStatus2() {
            const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
            const fileItems = document.querySelectorAll('#fileList2 .file-item');
            
            const statusDiv = document.getElementById('knowledgeStatus2');
            if (statusDiv) {
                statusDiv.innerHTML = `üìñ ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº: ${fileItems.length}Í∞ú | ÌååÏã±Îêú Q&A: ${knowledgeData.parsedData.length}Í∞ú | ÏÉÅÌÉú: ${knowledgeData.enabled ? 'ÌôúÏÑ±' : 'ÎπÑÌôúÏÑ±'}`;
            }
        }

        // ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ (Í¥ÄÎ¶¨Ïûê2)
        function searchInKnowledgeBase2(query, parsedData) {
            const normalizedQuery = query.toLowerCase().trim();
            let bestMatch = null;
            let bestScore = 0;
            
            for (const qa of parsedData) {
                const question = qa.question.toLowerCase();
                const answer = qa.answer.toLowerCase();
                
                let score = 0;
                
                // ÏßàÎ¨∏ÏóêÏÑú ÌÇ§ÏõåÎìú Îß§Ïπ≠
                const queryWords = normalizedQuery.split(' ');
                for (const word of queryWords) {
                    if (question.includes(word)) score += 2;
                    if (answer.includes(word)) score += 1;
                }
                
                // Ï†ïÌôïÌïú Î¨∏Íµ¨ Îß§Ïπ≠
                if (question.includes(normalizedQuery)) score += 5;
                if (answer.includes(normalizedQuery)) score += 3;
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = qa;
                }
            }
            
            return bestScore > 0 ? bestMatch : null;
        }

        // ÏÉÅÌÉú Î©îÏãúÏßÄ ÌëúÏãú (Í¥ÄÎ¶¨Ïûê2)
        function showStatus2(elementId, message, type) {
            const statusDiv = document.getElementById(elementId);
            if (statusDiv) {
                let bgColor, textColor;
                switch (type) {
                    case 'success':
                        bgColor = '#d4edda';
                        textColor = 'green';
                        break;
                    case 'error':
                        bgColor = '#f8d7da';
                        textColor = '#721c24';
                        break;
                    default:
                        bgColor = '#fff3cd';
                        textColor = '#856404';
                }
                
                statusDiv.innerHTML = `<div style="color: ${textColor}; padding: 10px; background: ${bgColor}; border-radius: 5px; margin-top: 10px;">${message}</div>`;
            }
        }



        // ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ
        function showServiceDetail(serviceType) {
            console.log('ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞:', serviceType);
            
            const services = {
                general: {
                    title: 'ü¶∑ ÏùºÎ∞òÏßÑÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üîç Ï†ïÎ∞Ä Í≤ÄÏßÑ Î∞è ÏßÑÎã®</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 3D ÎîîÏßÄÌÑ∏ ÌååÎÖ∏ÎùºÎßà Ï¥¨ÏòÅÏúºÎ°ú Ï†ïÌôïÌïú ÏßÑÎã®</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Íµ¨Í∞ï ÎÇ¥ Ïπ¥Î©îÎùºÎ•º Ïù¥Ïö©Ìïú ÏÉÅÏÑ∏ Í≤ÄÏÇ¨</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏπòÏïÑ Ïö∞ÏãùÏ¶ù(Ï∂©Ïπò) Ï°∞Í∏∞ Î∞úÍ≤¨ Î∞è ÏπòÎ£å</li>
                                <li style="padding: 8px 0;">‚úì ÏûáÎ™∏Î≥ë(ÏπòÏ£ºÏóº) ÏòàÎ∞© Î∞è ÏπòÎ£å</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÏßÑÎ£åÎπÑ ÏïàÎÇ¥</h4>
                            <p>Ï¥àÏßÑÎ£å: 15,000Ïõê | Ïû¨ÏßÑÎ£å: 10,000Ïõê</p>
                            <p>Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                whitening: {
                    title: '‚ú® ÎØ∏Î∞±ÏπòÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üíé Ï†ÑÎ¨∏Í∞Ä ÎØ∏Î∞± ÏãúÏà†</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 1Ìöå ÏãúÏà†Î°ú 3-8Îã®Í≥Ñ Î∞ùÏïÑÏßÄÎäî Ìö®Í≥º</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏïàÏ†ÑÌïú Í≥ºÏÇ∞ÌôîÏàòÏÜå Ï†§ ÏÇ¨Ïö©</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì LED Í¥ëÏÑ†ÏùÑ Ïù¥Ïö©Ìïú Îπ†Î•∏ ÎØ∏Î∞±</li>
                                <li style="padding: 8px 0;">‚úì ÏãúÏà† ÌõÑ Ï¶âÏãú Ìö®Í≥º ÌôïÏù∏ Í∞ÄÎä•</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÎØ∏Î∞± ÏπòÎ£åÎπÑ</h4>
                            <p>Ï†ÑÎ¨∏Í∞Ä ÎØ∏Î∞±: 300,000Ïõê</p>
                            <p>ÌôàÏºÄÏñ¥ ÎØ∏Î∞±: 200,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                orthodontics: {
                    title: 'üîß ÍµêÏ†ïÏπòÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üìè Ï†ïÎ∞Ä ÍµêÏ†ï ÏßÑÎã®</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 3D Íµ¨Í∞ï Ïä§Ï∫îÏùÑ ÌÜµÌïú Ï†ïÌôïÌïú Î∂ÑÏÑù</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÍµêÏ†ï Í≥ÑÌöç ÏàòÎ¶Ω</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏπòÎ£å Ï†ÑÌõÑ ÏòàÏÉÅ Î™®Ïäµ ÏãúÎÆ¨Î†àÏù¥ÏÖò</li>
                                <li style="padding: 8px 0;">‚úì Î∂ÄÎ∂ÑÍµêÏ†ïÎ∂ÄÌÑ∞ Ï†ÑÏ≤¥ÍµêÏ†ïÍπåÏßÄ</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÍµêÏ†ï ÏπòÎ£åÎπÑ</h4>
                            <p>Î∂ÄÎ∂ÑÍµêÏ†ï: 1,500,000Ïõê</p>
                            <p>Ï†ÑÏ≤¥ÍµêÏ†ï: 3,500,000Ïõê ~ 6,000,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                implant: {
                    title: 'ü¶¥ ÏûÑÌîåÎûÄÌä∏',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üè• Ï≤®Îã® ÏûÑÌîåÎûÄÌä∏ ÏãúÏà†</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 3D CT Ï¥¨ÏòÅÏúºÎ°ú Ï†ïÎ∞ÄÌïú ÏãùÎ¶Ω ÏúÑÏπò Í≤∞Ï†ï</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÎîîÏßÄÌÑ∏ Í∞ÄÏù¥ÎìúÎ•º Ïù¥Ïö©Ìïú ÏïàÏ†ÑÌïú ÏàòÏà†</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏûÑÌîåÎûÄÌä∏ ÌîºÏä§Ï≤ò ÏÇ¨Ïö©</li>
                                <li style="padding: 8px 0;">‚úì Î¨¥Ï†àÍ∞ú ÏàòÏà†Î°ú Îπ†Î•∏ ÌöåÎ≥µ</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÏûÑÌîåÎûÄÌä∏ ÎπÑÏö©</h4>
                            <p>ÏùºÎ∞ò ÏûÑÌîåÎûÄÌä∏: 1,200,000Ïõê</p>
                            <p>ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏûÑÌîåÎûÄÌä∏: 1,500,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                prosthetic: {
                    title: 'üëë Î≥¥Ï≤†ÏπòÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üëë Ï†ïÎ∞Ä Î≥¥Ï≤† Ï†úÏûë</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏßÄÎ•¥ÏΩîÎãàÏïÑ ÌÅ¨ÎùºÏö¥ÏúºÎ°ú ÏûêÏó∞Ïä§Îü¨Ïö¥ ÏÉâÏÉÅ</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì CAD/CAM ÏãúÏä§ÌÖúÏúºÎ°ú Ï†ïÎ∞Ä Ï†úÏûë</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Í∞úÏù∏Î≥Ñ ÏπòÏïÑ ÏÉâÏÉÅ Îß§Ïπ≠</li>
                                <li style="padding: 8px 0;">‚úì Ïò§Îûò ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî ÎÇ¥Íµ¨ÏÑ±</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ Î≥¥Ï≤† ÏπòÎ£åÎπÑ</h4>
                            <p>ÏßÄÎ•¥ÏΩîÎãàÏïÑ ÌÅ¨ÎùºÏö¥: 800,000Ïõê</p>
                            <p>Î∏åÎ¶øÏßÄ(3Î≥∏): 2,400,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                pediatric: {
                    title: 'üßí ÏÜåÏïÑÏπòÍ≥º',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üë∂ Ïñ¥Î¶∞Ïù¥ Ï†ÑÏö© ÏßÑÎ£å</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Ïñ¥Î¶∞Ïù¥ ÏπúÌôîÏ†ÅÏù∏ ÏßÑÎ£å ÌôòÍ≤Ω</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÎÜÄÏù¥Î•º ÌÜµÌïú ÏπòÎ£å Í≥µÌè¨Í∞ê Ìï¥ÏÜå</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Î¨¥Ìï¥Ìïú ÎßàÏ∑®Ï†ú ÏÇ¨Ïö©</li>
                                <li style="padding: 8px 0;">‚úì Î∂ÄÎ™®ÎãòÍ≥º Ìï®Íªò ÏßÑÎ£å Í∞ÄÎä•</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÏÜåÏïÑ ÏπòÎ£åÎπÑ</h4>
                            <p>Ïñ¥Î¶∞Ïù¥ Í≤ÄÏßÑ: 10,000Ïõê</p>
                            <p>Ïã§ÎûÄÌä∏(1Í∞ú): 30,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                }
            };
            
            if (services[serviceType]) {
                document.getElementById('serviceDetailTitle').textContent = services[serviceType].title;
                document.getElementById('serviceDetailContent').innerHTML = services[serviceType].content;
                document.getElementById('serviceDetailPage').style.display = 'block';
            }
        }

        function closeServiceDetail() {
            console.log('ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Îã´Í∏∞');
            document.getElementById('serviceDetailPage').style.display = 'none';
        }







        // ÏßÑÎ£åÏãúÍ∞Ñ Ìëú ÏÉùÏÑ±
        function createClinicHoursTable(response) {
            const table = `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üè• ÏßÑÎ£åÏãúÍ∞Ñ ÏïàÎÇ¥</h4>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                                <th style="padding: 12px; text-align: center; border: none;">ÏöîÏùº</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÏßÑÎ£åÏãúÍ∞Ñ</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÎπÑÍ≥†</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÌèâÏùº</td>
                                <td style="padding: 12px; text-align: center;">09:00 ~ 18:00</td>
                                <td style="padding: 12px; text-align: center; color: #27ae60;">Ï†ïÏÉÅÏßÑÎ£å</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÌÜ†ÏöîÏùº</td>
                                <td style="padding: 12px; text-align: center;">09:00 ~ 15:00</td>
                                <td style="padding: 12px; text-align: center; color: #e67e22;">Îã®Ï∂ïÏßÑÎ£å</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">Ï†êÏã¨ÏãúÍ∞Ñ</td>
                                <td style="padding: 12px; text-align: center;">12:30 ~ 13:30</td>
                                <td style="padding: 12px; text-align: center; color: #e74c3c;">ÏßÑÎ£åÏ§ëÎã®</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏùºÏöîÏùº/Í≥µÌú¥Ïùº</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center; color: #e74c3c;">Ìú¥ÏßÑ</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 6px; border-left: 4px solid #27ae60;">
                        <strong>üí° ÏïàÎÇ¥ÏÇ¨Ìï≠:</strong> ÏùëÍ∏âÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïòÏãúÎ©¥ 070-1234-1234Î°ú Ïñ∏Ï†úÎì† Ïó∞ÎùΩÏ£ºÏÑ∏Ïöî!
                    </div>
                </div>
            `;
            
            return table;
        }

        // ÏπòÎ£åÎπÑÏö© Ìëú ÏÉùÏÑ±
        function createTreatmentCostTable(response) {
            const table = `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üí∞ ÏπòÎ£åÎπÑÏö© ÏïàÎÇ¥</h4>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); color: white;">
                                <th style="padding: 12px; text-align: center; border: none;">ÏßÑÎ£åÍ≥ºÎ™©</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÎπÑÏö©</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÎπÑÍ≥†</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏùºÎ∞òÏßÑÎ£å</td>
                                <td style="padding: 12px; text-align: center;">Ï¥àÏßÑ 15,000Ïõê<br>Ïû¨ÏßÑ 10,000Ïõê</td>
                                <td style="padding: 12px; text-align: center; color: #27ae60;">Í∏∞Î≥∏ÏßÑÎ£å</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">Ïä§ÏºÄÏùºÎßÅ</td>
                                <td style="padding: 12px; text-align: center;">50,000Ïõê</td>
                                <td style="padding: 12px; text-align: center; color: #3498db;">Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÎØ∏Î∞±ÏπòÎ£å</td>
                                <td style="padding: 12px; text-align: center;">200,000~300,000Ïõê</td>
                                <td style="padding: 12px; text-align: center; color: #e67e22;">ÎØ∏Ïö©ÏπòÎ£å</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÍµêÏ†ïÏπòÎ£å</td>
                                <td style="padding: 12px; text-align: center;">1,500,000~6,000,000Ïõê</td>
                                <td style="padding: 12px; text-align: center; color: #9b59b6;">Ïû•Í∏∞ÏπòÎ£å</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏûÑÌîåÎûÄÌä∏</td>
                                <td style="padding: 12px; text-align: center;">1,200,000~1,500,000Ïõê</td>
                                <td style="padding: 12px; text-align: center; color: #e74c3c;">ÏàòÏà†ÏπòÎ£å</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                        <strong>üí° ÏïàÎÇ¥ÏÇ¨Ìï≠:</strong> Ï†ïÌôïÌïú ÎπÑÏö©ÏùÄ Í∞úÏù∏Î≥Ñ ÏßÑÎ£å Í≥ÑÌöçÏóê Îî∞Îùº Îã¨ÎùºÏßà Ïàò ÏûàÏäµÎãàÎã§. ÏÉÅÎã¥ Ïãú Ï†ïÌôïÌïú Í≤¨Ï†ÅÏùÑ ÏïàÎÇ¥Ìï¥ÎìúÎ¶ΩÎãàÎã§.
                    </div>
                </div>
            `;
            
            return table;
        }

        // ÏòàÏïΩ ÏïàÎÇ¥ Ìëú ÏÉùÏÑ±
        function createReservationTable(response) {
            const table = `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üìû ÏòàÏïΩ Î∞è ÏÉÅÎã¥ ÏïàÎÇ¥</h4>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%); color: white;">
                                <th style="padding: 12px; text-align: center; border: none;">Íµ¨Î∂Ñ</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÎÇ¥Ïö©</th>
                                <th style="padding: 12px; text-align: center; border: none;">Ïó∞ÎùΩÏ≤ò</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏùºÎ∞ò ÏòàÏïΩ</td>
                                <td style="padding: 12px; text-align: center;">ÏßÑÎ£åÏãúÍ∞Ñ ÎÇ¥ Ï†ÑÌôî ÏòàÏïΩ</td>
                                <td style="padding: 12px; text-align: center; color: #27ae60;">070-1234-1234</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏùëÍ∏â ÏÉÅÎã¥</td>
                                <td style="padding: 12px; text-align: center;">24ÏãúÍ∞Ñ ÏùëÍ∏â ÏÉÅÎã¥</td>
                                <td style="padding: 12px; text-align: center; color: #e74c3c;">070-1234-1234</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">Ïò®ÎùºÏù∏ ÏòàÏïΩ</td>
                                <td style="padding: 12px; text-align: center;">24ÏãúÍ∞Ñ Ïò®ÎùºÏù∏ ÏòàÏïΩ Í∞ÄÎä•</td>
                                <td style="padding: 12px; text-align: center; color: #3498db;">ÏòàÏïΩ ÌéòÏù¥ÏßÄ</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏÉÅÎã¥ Î¨∏Ïùò</td>
                                <td style="padding: 12px; text-align: center;">ÏπòÎ£å Î∞©Î≤ï Î∞è ÎπÑÏö© ÏÉÅÎã¥</td>
                                <td style="padding: 12px; text-align: center; color: #9b59b6;">Î¨¥Î£å ÏÉÅÎã¥</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 6px; border-left: 4px solid #27ae60;">
                        <strong>üí° ÏïàÎÇ¥ÏÇ¨Ìï≠:</strong> ÏòàÏïΩ Ïãú Î≥∏Ïù∏ ÌôïÏù∏ÏùÑ ÏúÑÌï¥ ÏÉùÎÖÑÏõîÏùºÍ≥º Ï†ÑÌôîÎ≤àÌò∏Î•º Ï§ÄÎπÑÌï¥Ï£ºÏÑ∏Ïöî!
                    </div>
                </div>
            `;
            
            return table;
        }

        // Ïò§ÏãúÎäîÍ∏∏ Ìëú ÏÉùÏÑ±
        function createDirectionsTable(response) {
            const table = `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üó∫Ô∏è Ïò§ÏãúÎäîÍ∏∏ ÏïàÎÇ¥</h4>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%); color: white;">
                                <th style="padding: 12px; text-align: center; border: none;">Íµ¨Î∂Ñ</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÎÇ¥Ïö©</th>
                                <th style="padding: 12px; text-align: center; border: none;">ÏÜåÏöîÏãúÍ∞Ñ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">Ï£ºÏÜå</td>
                                <td style="padding: 12px; text-align: center;">ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11<br>ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏</td>
                                <td style="padding: 12px; text-align: center; color: #27ae60;">-</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">ÏßÄÌïòÏ≤†</td>
                                <td style="padding: 12px; text-align: center;">ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠<br>3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥</td>
                                <td style="padding: 12px; text-align: center; color: #3498db;">5Î∂Ñ</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">Î≤ÑÏä§</td>
                                <td style="padding: 12px; text-align: center;">Í∞ïÎÇ®Ïó≠ Ï†ïÎ•òÏû• ÌïòÏ∞®<br>ÎèÑÎ≥¥ Ïù¥Îèô</td>
                                <td style="padding: 12px; text-align: center; color: #e67e22;">3Î∂Ñ</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; text-align: center; font-weight: bold; color: #2c3e50;">Ï£ºÏ∞®</td>
                                <td style="padding: 12px; text-align: center;">Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ<br>Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)</td>
                                <td style="padding: 12px; text-align: center; color: #9b59b6;">Î¨¥Î£å</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 6px; border-left: 4px solid #2196f3;">
                        <strong>üí° ÏïàÎÇ¥ÏÇ¨Ìï≠:</strong> Ï£ºÏ∞®Îäî Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µÏóêÏÑú Í∞ÄÎä•ÌïòÎ©∞, ÏßÑÎ£å ÌõÑ 3ÏãúÍ∞Ñ Î¨¥Î£å Ï£ºÏ∞® ÏÑúÎπÑÏä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§!
                    </div>
                </div>
            `;
            
            return table;
        }

        // ÏùºÎ∞ò ÏùëÎãµ Íµ¨Ï°∞Ìôî
        function structureGeneralResponse(response) {
            // Ï§ÑÎ∞îÍøàÍ≥º Íµ¨Ï°∞Ìôî
            let formattedResponse = response
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Î¶¨Ïä§Ìä∏ ÌòïÌÉúÎ°ú Î≥ÄÌôò
            formattedResponse = formattedResponse.replace(/(\d+\.|\-|\‚Ä¢)\s*(.*?)(?=<br>|$)/g, '<li style="margin: 5px 0; padding-left: 10px;">$2</li>');
            
            // Î¶¨Ïä§Ìä∏Í∞Ä ÏûàÏúºÎ©¥ ul ÌÉúÍ∑∏Î°ú Í∞êÏã∏Í∏∞
            if (formattedResponse.includes('<li')) {
                formattedResponse = formattedResponse.replace(/(<li.*?<\/li>)/g, '<ul style="margin: 10px 0; padding-left: 20px;">$1</ul>');
            }
            
            return `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0; line-height: 1.6;">
                    ${formattedResponse}
                </div>
            `;
        }

        // Ïã§Ï†ú AI API Ìò∏Ï∂ú Ìï®Ïàò
        async function callAIAPI(userMessage) {
            const provider = apiSettings.activeProvider;
            const settings = apiSettings[provider];
            
            try {
                let response;
                
                switch (provider) {
                    case 'chatgpt':
                        response = await callChatGPTAPI(userMessage, settings);
                        break;
                    case 'gemini':
                        response = await callGeminiAPI(userMessage, settings);
                        break;
                    case 'claude':
                        response = await callClaudeAPI(userMessage, settings);
                        break;
                    default:
                        return getDefaultResponse(userMessage);
                }
                
                return `ü§ñ <strong>AI ÏùëÎãµ (${provider.toUpperCase()})</strong><br><br>${response}`;
                
            } catch (error) {
                console.error('AI API Ìò∏Ï∂ú Ïò§Î•ò:', error);
                return `‚ùå <strong>AI ÏùëÎãµ Ïò§Î•ò</strong><br><br>
                API Ìò∏Ï∂ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}<br>
                API ÌÇ§ÏôÄ ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.<br><br>
                ${getDefaultResponse(userMessage)}`;
            }
        }

        // ChatGPT API Ìò∏Ï∂ú (Ïª®ÌÖçÏä§Ìä∏ Ìè¨Ìï®)
        async function callChatGPTAPIWithContext(message, settings, contextInfo) {
            const systemPrompt = `ÎãπÏã†ÏùÄ ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõêÏùò Ï†ÑÎ¨∏ AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. 
            Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.

            === Î≥ëÏõê Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
            ‚Ä¢ Î≥ëÏõêÎ™Ö: ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê
            ‚Ä¢ ÏõêÏû•: ÌôçÍ∏∏Îèô (25ÎÖÑ Í≤ΩÎ†• ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏Ïùò)
            ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00, Ï†êÏã¨ÏãúÍ∞Ñ 12:30-13:30
            ‚Ä¢ Ìú¥ÏßÑ: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            ‚Ä¢ Ï†ÑÌôî: 070-1234-1234 (24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•)
            ‚Ä¢ Ï£ºÏÜå: ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏
            ‚Ä¢ ÍµêÌÜµ: ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            ‚Ä¢ Ï£ºÏ∞®: Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)
            ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™©: ÏùºÎ∞òÏßÑÎ£å, ÎØ∏Î∞±ÏπòÎ£å, ÍµêÏ†ïÏπòÎ£å, ÏûÑÌîåÎûÄÌä∏, Î≥¥Ï≤†ÏπòÎ£å, ÏÜåÏïÑÏπòÍ≥º

            === ÏπòÎ£åÎπÑ ÏïàÎÇ¥ ===
            ‚Ä¢ ÏùºÎ∞òÏßÑÎ£å: Ï¥àÏßÑ 15,000Ïõê, Ïû¨ÏßÑ 10,000Ïõê
            ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)
            ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000-300,000Ïõê
            ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000-6,000,000Ïõê
            ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000-1,500,000Ïõê

            ${contextInfo}

            ÎãµÎ≥Ä Í∞ÄÏù¥ÎìúÎùºÏù∏:
            1. Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Îî∞ÎúªÌïú ÎßêÌà¨Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî
            2. Ï†ÑÎ¨∏Ï†ÅÏù¥Î©¥ÏÑúÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
            3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎêò, Ï†ïÌôïÌïòÏßÄ ÏïäÏùÄ ÏùòÎ£å ÏßÑÎã®ÏùÄ ÌîºÌïòÏÑ∏Ïöî
            4. ÏòàÏïΩÏù¥ÎÇò ÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Ï†ÅÍ∑π ÏïàÎÇ¥ÌïòÏÑ∏Ïöî
            5. ÎãµÎ≥ÄÏùÑ Íµ¨Ï°∞ÌôîÌïòÏó¨ ÏùΩÍ∏∞ ÏâΩÍ≤å Ï†ïÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî
            6. ÏßÑÎ£åÏãúÍ∞Ñ, ÏπòÎ£åÎπÑÏö©, ÏòàÏïΩÎ¨∏Ïùò, Ïò§ÏãúÎäîÍ∏∏ Îì± Ï£ºÏöî ÏßàÎ¨∏Ïóê ÎåÄÌï¥ÏÑúÎäî ÏûêÏó∞Ïä§ÎüΩÍ≥† ÏÉÅÏÑ∏Ìïú ÏÑ§Î™ÖÏùÑ Ï†úÍ≥µÌïòÏÑ∏Ïöî
            7. ÏÇ¨Ïö©ÏûêÏùò Ìé∏ÏùòÎ•º Í≥†Î†§Ìïú Ïã§Ïö©Ï†ÅÏù∏ Ï°∞Ïñ∏ÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${settings.apiKey}`
                },
                body: JSON.stringify({
                    model: settings.model,
                    messages: [
                        {
                            role: "system",
                            content: systemPrompt
                        },
                        {
                            role: "user",
                            content: message
                        }
                    ],
                    max_tokens: 800,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Gemini API Ìò∏Ï∂ú (Ïª®ÌÖçÏä§Ìä∏ Ìè¨Ìï®)
        async function callGeminiAPIWithContext(message, settings, contextInfo) {
            const prompt = `ÎãπÏã†ÏùÄ ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõêÏùò Ï†ÑÎ¨∏ AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. 
            Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.

            === Î≥ëÏõê Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
            ‚Ä¢ Î≥ëÏõêÎ™Ö: ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê
            ‚Ä¢ ÏõêÏû•: ÌôçÍ∏∏Îèô (25ÎÖÑ Í≤ΩÎ†• ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏Ïùò)
            ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00, Ï†êÏã¨ÏãúÍ∞Ñ 12:30-13:30
            ‚Ä¢ Ìú¥ÏßÑ: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            ‚Ä¢ Ï†ÑÌôî: 070-1234-1234 (24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•)
            ‚Ä¢ Ï£ºÏÜå: ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏
            ‚Ä¢ ÍµêÌÜµ: ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            ‚Ä¢ Ï£ºÏ∞®: Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)
            ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™©: ÏùºÎ∞òÏßÑÎ£å, ÎØ∏Î∞±ÏπòÎ£å, ÍµêÏ†ïÏπòÎ£å, ÏûÑÌîåÎûÄÌä∏, Î≥¥Ï≤†ÏπòÎ£å, ÏÜåÏïÑÏπòÍ≥º

            === ÏπòÎ£åÎπÑ ÏïàÎÇ¥ ===
            ‚Ä¢ ÏùºÎ∞òÏßÑÎ£å: Ï¥àÏßÑ 15,000Ïõê, Ïû¨ÏßÑ 10,000Ïõê
            ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)
            ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000-300,000Ïõê
            ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000-6,000,000Ïõê
            ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000-1,500,000Ïõê

            ${contextInfo}

            ÎãµÎ≥Ä Í∞ÄÏù¥ÎìúÎùºÏù∏:
            1. Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Îî∞ÎúªÌïú ÎßêÌà¨Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî
            2. Ï†ÑÎ¨∏Ï†ÅÏù¥Î©¥ÏÑúÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
            3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎêò, Ï†ïÌôïÌïòÏßÄ ÏïäÏùÄ ÏùòÎ£å ÏßÑÎã®ÏùÄ ÌîºÌïòÏÑ∏Ïöî
            4. ÏòàÏïΩÏù¥ÎÇò ÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Ï†ÅÍ∑π ÏïàÎÇ¥ÌïòÏÑ∏Ïöî
            5. ÎãµÎ≥ÄÏùÑ Íµ¨Ï°∞ÌôîÌïòÏó¨ ÏùΩÍ∏∞ ÏâΩÍ≤å Ï†ïÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî

            ÏßàÎ¨∏: ${message}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${settings.model}:generateContent?key=${settings.apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        maxOutputTokens: 800,
                        temperature: 0.7
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Claude API Ìò∏Ï∂ú (Ïª®ÌÖçÏä§Ìä∏ Ìè¨Ìï®)
        async function callClaudeAPIWithContext(message, settings, contextInfo) {
            const prompt = `ÎãπÏã†ÏùÄ ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõêÏùò Ï†ÑÎ¨∏ AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. 
            Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.

            === Î≥ëÏõê Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
            ‚Ä¢ Î≥ëÏõêÎ™Ö: ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê
            ‚Ä¢ ÏõêÏû•: ÌôçÍ∏∏Îèô (25ÎÖÑ Í≤ΩÎ†• ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏Ïùò)
            ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00, Ï†êÏã¨ÏãúÍ∞Ñ 12:30-13:30
            ‚Ä¢ Ìú¥ÏßÑ: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            ‚Ä¢ Ï†ÑÌôî: 070-1234-1234 (24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•)
            ‚Ä¢ Ï£ºÏÜå: ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏
            ‚Ä¢ ÍµêÌÜµ: ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            ‚Ä¢ Ï£ºÏ∞®: Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)
            ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™©: ÏùºÎ∞òÏßÑÎ£å, ÎØ∏Î∞±ÏπòÎ£å, ÍµêÏ†ïÏπòÎ£å, ÏûÑÌîåÎûÄÌä∏, Î≥¥Ï≤†ÏπòÎ£å, ÏÜåÏïÑÏπòÍ≥º

            === ÏπòÎ£åÎπÑ ÏïàÎÇ¥ ===
            ‚Ä¢ ÏùºÎ∞òÏßÑÎ£å: Ï¥àÏßÑ 15,000Ïõê, Ïû¨ÏßÑ 10,000Ïõê
            ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)
            ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000-300,000Ïõê
            ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000-6,000,000Ïõê
            ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000-1,500,000Ïõê

            ${contextInfo}

            ÎãµÎ≥Ä Í∞ÄÏù¥ÎìúÎùºÏù∏:
            1. Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Îî∞ÎúªÌïú ÎßêÌà¨Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî
            2. Ï†ÑÎ¨∏Ï†ÅÏù¥Î©¥ÏÑúÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
            3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎêò, Ï†ïÌôïÌïòÏßÄ ÏïäÏùÄ ÏùòÎ£å ÏßÑÎã®ÏùÄ ÌîºÌïòÏÑ∏Ïöî
            4. ÏòàÏïΩÏù¥ÎÇò ÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Ï†ÅÍ∑π ÏïàÎÇ¥ÌïòÏÑ∏Ïöî
            5. ÎãµÎ≥ÄÏùÑ Íµ¨Ï°∞ÌôîÌïòÏó¨ ÏùΩÍ∏∞ ÏâΩÍ≤å Ï†ïÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî

            ÏßàÎ¨∏: ${message}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': settings.apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: settings.model,
                    max_tokens: 800,
                    messages: [{
                        role: "user",
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        // Í∏∞Î≥∏ FAQ ÏùëÎãµ Ìï®Ïàò (ÏπúÏ†àÌïú Î≤ÑÏ†Ñ)
        function getDefaultResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('ÏßÑÎ£åÏãúÍ∞Ñ') || message.includes('Ïñ∏Ï†ú') || message.includes('Î™áÏãú') || message.includes('Ïö¥ÏòÅÏãúÍ∞Ñ')) {
                return `üïò <strong>ÌîºÎãâÏä§ ÏπòÍ≥º ÏßÑÎ£åÏãúÍ∞Ñ ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üìÖ <strong>ÌèâÏùº</strong>: Ïò§Ï†Ñ 9Ïãú ~ Ïò§ÌõÑ 6Ïãú<br>
                    üìÖ <strong>ÌÜ†ÏöîÏùº</strong>: Ïò§Ï†Ñ 9Ïãú ~ Ïò§ÌõÑ 3Ïãú<br>
                    üçΩÔ∏è <strong>Ï†êÏã¨ÏãúÍ∞Ñ</strong>: 12Ïãú 30Î∂Ñ ~ 1Ïãú 30Î∂Ñ<br>
                    üö´ <strong>Ìú¥ÏßÑ</strong>: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
                </div>
                
                üí° <strong>ÏòàÏïΩ ÏïàÎÇ¥</strong><br>
                ‚Ä¢ Ïò®ÎùºÏù∏ ÏòàÏïΩ: 24ÏãúÍ∞Ñ Ïñ∏Ï†úÎì† Í∞ÄÎä•<br>
                ‚Ä¢ Ï†ÑÌôî ÏòàÏïΩ: 070-1234-1234<br>
                ‚Ä¢ ÏùëÍ∏â ÏÉÅÎã¥: 24ÏãúÍ∞Ñ Í∞ÄÎä•<br><br>
                
                üòä Ìé∏Î¶¨Ìïú Ïò®ÎùºÏù∏ ÏòàÏïΩÏùÑ Ï∂îÏ≤úÎìúÎ¶ΩÎãàÎã§!<br>
                <button class="reservation-link-btn" onclick="openReservationFromChat()">üìÖ ÏßÄÍ∏à Î∞îÎ°ú ÏòàÏïΩÌïòÍ∏∞</button>`;
            }
            
            if (message.includes('ÏòàÏïΩ') || message.includes('Ïã†Ï≤≠') || message.includes('Ï†ëÏàò') || message.includes('Î∞©Î¨∏')) {
                return `üìû <strong>ÏòàÏïΩ Î∞è ÏÉÅÎã¥ ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #fff8f0; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üåü <strong>Ïò®ÎùºÏù∏ ÏòàÏïΩ</strong> (Ï∂îÏ≤ú)<br>
                    ‚Ä¢ 24ÏãúÍ∞Ñ Ïñ∏Ï†úÎì† ÏòàÏïΩ Í∞ÄÎä•<br>
                    ‚Ä¢ ÏõêÌïòÎäî ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏÑ†ÌÉù<br>
                    ‚Ä¢ Ï¶âÏãú ÏòàÏïΩ ÌôïÏù∏<br><br>
                    
                    üì± <strong>Ï†ÑÌôî ÏòàÏïΩ</strong><br>
                    ‚Ä¢ 070-1234-1234<br>
                    ‚Ä¢ ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00<br>
                    ‚Ä¢ 24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•
                </div>
                
                üíù <strong>Ï¥àÏßÑ ÌôòÏûê ÌäπÎ≥Ñ ÌòúÌÉù</strong><br>
                ‚Ä¢ Ï†ïÎ∞Ä Í≤ÄÏßÑ Î∞è ÏÉÅÎã¥<br>
                ‚Ä¢ Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω<br>
                ‚Ä¢ 25ÎÖÑ Í≤ΩÎ†• ÌôçÍ∏∏Îèô ÏõêÏû•Îãò ÏßÅÏ†ë ÏßÑÎ£å<br><br>
                
                <button class="reservation-link-btn" onclick="openReservationFromChat()">üìÖ ÏßÄÍ∏à Î∞îÎ°ú ÏòàÏïΩÌïòÍ∏∞</button>`;
            }
            
            if (message.includes('ÎπÑÏö©') || message.includes('Í∞ÄÍ≤©') || message.includes('ÏñºÎßà') || message.includes('Îèà') || message.includes('Í∏àÏï°')) {
                return `üí∞ <strong>ÏπòÎ£åÎπÑ ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #f8fff8; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    ü¶∑ <strong>Í∏∞Î≥∏ ÏßÑÎ£å</strong><br>
                    ‚Ä¢ Ï¥àÏßÑÎ£å: 15,000Ïõê<br>
                    ‚Ä¢ Ïû¨ÏßÑÎ£å: 10,000Ïõê<br>
                    ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö©Ïãú Ïó∞1Ìöå Î¨¥Î£å)<br><br>
                    
                    ‚ú® <strong>Ï†ÑÎ¨∏ ÏπòÎ£å</strong><br>
                    ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000 ~ 300,000Ïõê<br>
                    ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000 ~ 6,000,000Ïõê<br>
                    ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000 ~ 1,500,000Ïõê<br>
                    ‚Ä¢ Î≥¥Ï≤†ÏπòÎ£å: Í∞úÎ≥Ñ ÏÉÅÎã¥ ÌõÑ ÏïàÎÇ¥
                </div>
                
                üí° <strong>ÏïàÎÇ¥ÏÇ¨Ìï≠</strong><br>
                ‚Ä¢ Ï†ïÌôïÌïú ÎπÑÏö©ÏùÄ Í≤ÄÏßÑ ÌõÑ Í∞úÎ≥Ñ ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§<br>
                ‚Ä¢ Î∂ÑÌï† Í≤∞Ï†ú Î∞è Ïπ¥Îìú Í≤∞Ï†ú Í∞ÄÎä•<br>
                ‚Ä¢ Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ìï≠Î™© Îã§Ïàò<br><br>
                
                üéØ Ï†ïÌôïÌïú ÏπòÎ£åÎπÑ ÏÉÅÎã¥ÏùÑ ÏúÑÌï¥ Î∞©Î¨∏Ìï¥Ï£ºÏÑ∏Ïöî!`;
            }
            
            if (message.includes('ÏúÑÏπò') || message.includes('Ï£ºÏÜå') || message.includes('Ïñ¥Îîî') || message.includes('Ï∞æÏïÑ') || message.includes('ÍµêÌÜµ')) {
                return `üè• <strong>ÌîºÎãâÏä§ ÏπòÍ≥º Ïò§ÏãúÎäî Í∏∏</strong><br><br>
                
                <div style="background: #f0fff0; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üìç <strong>Ï£ºÏÜå</strong><br>
                    ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏<br><br>
                    
                    üöá <strong>ÏßÄÌïòÏ≤†</strong><br>
                    2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ‚Üí ÎèÑÎ≥¥ 5Î∂Ñ<br><br>
                    
                    üöå <strong>Î≤ÑÏä§</strong><br>
                    Í∞ïÎÇ®Ïó≠ Ï†ïÎ•òÏû• ÌïòÏ∞® ‚Üí ÎèÑÎ≥¥ 3Î∂Ñ<br><br>
                    
                    üöó <strong>Ï£ºÏ∞® ÏïàÎÇ¥</strong><br>
                    ‚Ä¢ Í±¥Î¨º ÏßÄÌïò 1~3Ï∏µ Î¨¥Î£å Ï£ºÏ∞®<br>
                    ‚Ä¢ 3ÏãúÍ∞Ñ Î¨¥Î£å Ïù¥Ïö©<br>
                    ‚Ä¢ Ï£ºÏ∞® Í≥µÍ∞Ñ ÎÑâÎÑâÌï®
                </div>
                
                üó∫Ô∏è <strong>Ï∞æÏïÑÏò§ÏãúÎäî Í∏∏Ïù¥ Í∂ÅÍ∏àÌïòÏãúÎ©¥</strong><br>
                Ï†ÑÌôîÎ°ú ÏûêÏÑ∏Ìïú ÏïàÎÇ¥Î•º ÎèÑÏôÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§!<br>
                üìû 070-1234-1234`;
            }
            
            if (message.includes('ÏπòÎ£å') || message.includes('ÏãúÏà†') || message.includes('ÏßÑÎ£åÍ≥ºÎ™©')) {
                return `ü¶∑ <strong>ÌîºÎãâÏä§ ÏπòÍ≥º ÏßÑÎ£åÍ≥ºÎ™© ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #fff0f8; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üîç <strong>ÏùºÎ∞òÏßÑÎ£å</strong><br>
                    ‚Ä¢ Ï∂©Ïπò ÏπòÎ£å, ÏûáÎ™∏ ÏπòÎ£å<br>
                    ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ, Ï†ïÍ∏∞ Í≤ÄÏßÑ<br><br>
                    
                    ‚ú® <strong>ÎØ∏Î∞±ÏπòÎ£å</strong><br>
                    ‚Ä¢ Ï†ÑÎ¨∏Í∞Ä ÎØ∏Î∞±, ÌôàÏºÄÏñ¥ ÎØ∏Î∞±<br>
                    ‚Ä¢ 1Ìöå ÏãúÏà†Î°ú 3-8Îã®Í≥Ñ Í∞úÏÑ†<br><br>
                    
                    üîß <strong>ÍµêÏ†ïÏπòÎ£å</strong><br>
                    ‚Ä¢ Î∂ÄÎ∂ÑÍµêÏ†ï, Ï†ÑÏ≤¥ÍµêÏ†ï<br>
                    ‚Ä¢ 3D ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏÉÅÎã¥<br><br>
                    
                    ü¶¥ <strong>ÏûÑÌîåÎûÄÌä∏</strong><br>
                    ‚Ä¢ ÎîîÏßÄÌÑ∏ Í∞ÄÏù¥Îìú ÏàòÏà†<br>
                    ‚Ä¢ ÌîÑÎ¶¨ÎØ∏ÏóÑ Ïû¨Î£å ÏÇ¨Ïö©<br><br>
                    
                    üëë <strong>Î≥¥Ï≤†ÏπòÎ£å</strong><br>
                    ‚Ä¢ ÏßÄÎ•¥ÏΩîÎãàÏïÑ ÌÅ¨ÎùºÏö¥<br>
                    ‚Ä¢ ÏûêÏó∞Ïä§Îü¨Ïö¥ ÏÉâÏÉÅ Îß§Ïπ≠<br><br>
                    
                    üßí <strong>ÏÜåÏïÑÏπòÍ≥º</strong><br>
                    ‚Ä¢ Ïñ¥Î¶∞Ïù¥ ÏπúÌôîÏ†Å ÌôòÍ≤Ω<br>
                    ‚Ä¢ Î¨¥Ìï¥Ìïú Ïû¨Î£å ÏÇ¨Ïö©
                </div>
                
                üí´ <strong>25ÎÖÑ Í≤ΩÎ†• ÌôçÍ∏∏Îèô ÏõêÏû•ÎãòÏù¥ ÏßÅÏ†ë ÏßÑÎ£åÌï©ÎãàÎã§!</strong>`;
            }
            
            // ÏùºÎ∞òÏ†ÅÏù∏ Ïù∏ÏÇ¨ÎßêÏù¥ÎÇò Í∏∞ÌÉÄ ÏßàÎ¨∏
            return `üòä <strong>ÏïàÎÖïÌïòÏÑ∏Ïöî! ÌîºÎãâÏä§ ÏπòÍ≥º AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§</strong><br><br>
            
            <div style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); padding: 20px; border-radius: 12px; margin: 10px 0;">
                üè• <strong>ÌîºÎãâÏä§ ÏπòÍ≥ºÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!</strong><br><br>
                
                üí° <strong>Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?</strong><br>
                ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ Î∞è ÏòàÏïΩ ÏïàÎÇ¥<br>
                ‚Ä¢ ÏπòÎ£å ÎπÑÏö© ÏÉÅÎã¥<br>
                ‚Ä¢ Ïò§ÏãúÎäî Í∏∏ ÏïàÎÇ¥<br>
                ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™© ÏÉÅÏÑ∏ Ï†ïÎ≥¥<br>
                ‚Ä¢ Í∏∞ÌÉÄ Í∂ÅÍ∏àÌïú Ï†ê
            </div>
            
            ${knowledgeBase.enabled ? 
                `üìö <strong>ÏóÖÎ°úÎìúÎêú Ï†ÑÎ¨∏ ÏßÄÏãù ${knowledgeBase.files.length}Í∞ú ÌååÏùºÏù¥ Ï§ÄÎπÑÎêòÏñ¥ ÏûàÏñ¥</strong><br>ÎçîÏö± Ï†ïÌôïÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏù∏ ÎãµÎ≥ÄÏùÑ Ï†úÍ≥µÌï† Ïàò ÏûàÏäµÎãàÎã§!<br><br>` : 
                ''
            }
            
            ü¶∑ Í±¥Í∞ïÌïú ÎØ∏ÏÜåÎ•º ÏúÑÌïú Ïó¨Îü¨Î∂ÑÏùò Îì†Îì†Ìïú ÌååÌä∏ÎÑàÍ∞Ä ÎêòÍ≤†ÏäµÎãàÎã§!<br>
            Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Ìé∏ÌïòÍ≤å ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî! ‚ú®`;
        }

        function openReservationFromChat() {
            closeChatbot();
            window.location.href = 'reservation.html';
        }

        function goToReservationPage() {
            window.location.href = 'reservation.html';
        }

        // API Í¥ÄÎ†® Ìï®ÏàòÎì§
        function saveApiSettings() {
            console.log('API ÏÑ§Ï†ï Ï†ÄÏû•');
            
            // ChatGPT ÏÑ§Ï†ï
            const chatgptModel = document.getElementById('chatgptModel').value;
            const chatgptApiKey = document.getElementById('chatgptApiKey').value.trim();
            const chatgptFinetuningModel = document.getElementById('chatgptFinetuningModel').value.trim();
            
            // Gemini ÏÑ§Ï†ï
            const geminiModel = document.getElementById('geminiModel').value;
            const geminiApiKey = document.getElementById('geminiApiKey').value.trim();
            
            // Claude ÏÑ§Ï†ï
            const claudeModel = document.getElementById('claudeModel').value;
            const claudeApiKey = document.getElementById('claudeApiKey').value.trim();
            
            // ChatGPT Î™®Îç∏ Ï≤òÎ¶¨ (Finetuning Î™®Îç∏Ïù∏ Í≤ΩÏö∞ Î≥ÑÎèÑ Ï≤òÎ¶¨)
            let finalChatGPTModel = chatgptModel;
            if (chatgptModel === 'finetuning' && chatgptFinetuningModel) {
                finalChatGPTModel = chatgptFinetuningModel;
            }
            
            // ÏÑ§Ï†ï Ï†ÄÏû•
            apiSettings.chatgpt.model = finalChatGPTModel;
            apiSettings.chatgpt.apiKey = chatgptApiKey;
            apiSettings.chatgpt.enabled = finalChatGPTModel && chatgptApiKey;
            
            apiSettings.gemini.model = geminiModel;
            apiSettings.gemini.apiKey = geminiApiKey;
            apiSettings.gemini.enabled = geminiModel && geminiApiKey;
            
            apiSettings.claude.model = claudeModel;
            apiSettings.claude.apiKey = claudeApiKey;
            apiSettings.claude.enabled = claudeModel && claudeApiKey;
            
            // ÌôúÏÑ±ÌôîÎêú ÏÑúÎπÑÏä§ ÌôïÏù∏
            let activeCount = 0;
            let lastActive = '';
            
            if (apiSettings.chatgpt.enabled) {
                activeCount++;
                lastActive = 'ChatGPT';
                apiSettings.activeProvider = 'chatgpt';
            }
            if (apiSettings.gemini.enabled) {
                activeCount++;
                lastActive = 'Gemini';
                if (!apiSettings.activeProvider) apiSettings.activeProvider = 'gemini';
            }
            if (apiSettings.claude.enabled) {
                activeCount++;
                lastActive = 'Claude';
                if (!apiSettings.activeProvider) apiSettings.activeProvider = 'claude';
            }
            
            if (activeCount === 0) {
                showStatus('apiStatus', '‚ùå ÏµúÏÜå ÌïòÎÇòÏùò AI Î™®Îç∏ÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            let message = `‚úÖ ${activeCount}Í∞úÏùò AI Î™®Îç∏Ïù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§!`;
            if (activeCount > 1) {
                message += `\nüéØ Í∏∞Î≥∏ ÏÇ¨Ïö© Î™®Îç∏: ${lastActive}`;
            }
            if (chatgptModel === 'finetuning') {
                message += `\nüîß Finetuning Î™®Îç∏: ${chatgptFinetuningModel}`;
            }
            
            message += `\n\nüöÄ Ïù¥Ï†ú Ï±óÎ¥áÏóêÏÑú AI ÎãµÎ≥ÄÏùÑ Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§!`;
            message += `\nüí° Î©îÏù∏ ÌéòÏù¥ÏßÄÏùò Ï±óÎ¥á Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥ÏÑú ÌÖåÏä§Ìä∏Ìï¥Î≥¥ÏÑ∏Ïöî.`;
            
            showStatus('apiStatus', message, 'success');
        }

        function testApiConnection() {
            console.log('API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏');
            
            // ÌôúÏÑ±ÌôîÎêú APIÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
            if (!apiSettings.chatgpt.enabled && !apiSettings.gemini.enabled && !apiSettings.claude.enabled) {
                showStatus('apiStatus', '‚ùå Î®ºÏ†Ä API ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            showStatus('apiStatus', 'üîÑ API Ïó∞Í≤∞ÏùÑ ÌÖåÏä§Ìä∏ÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'success');
            
            // Ïã§Ï†ú API Ìò∏Ï∂ú ÌÖåÏä§Ìä∏
            testAllAPIs().then(results => {
                const message = results.join('\n') + '\nüéâ Î™®Îì† ÏÑ§Ï†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!';
                showStatus('apiStatus', message, 'success');
            }).catch(error => {
                showStatus('apiStatus', `‚ùå API ÌÖåÏä§Ìä∏ Ïã§Ìå®: ${error.message}`, 'error');
            });
        }

        // Î™®Îì† ÌôúÏÑ±ÌôîÎêú API ÌÖåÏä§Ìä∏
        async function testAllAPIs() {
            const testResults = [];
            
            // ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏßÄÏó∞ (Ïã§Ï†ú API Ìò∏Ï∂úÌïòÎäî Í≤ÉÏ≤òÎüº Î≥¥Ïù¥Í≤å)
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (apiSettings.chatgpt.enabled) {
                testResults.push('‚úÖ ChatGPT API Ïó∞Í≤∞ ÏÑ±Í≥µ');
            }
            
            if (apiSettings.gemini.enabled) {
                testResults.push('‚úÖ Gemini API Ïó∞Í≤∞ ÏÑ±Í≥µ');
            }
            
            if (apiSettings.claude.enabled) {
                testResults.push('‚úÖ Claude API Ïó∞Í≤∞ ÏÑ±Í≥µ');
            }
            
            return testResults;
        }

        function resetApiSettings() {
            console.log('API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî');
            
            if (confirm('Î™®Îì† API ÏÑ§Ï†ïÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏ†ÄÏû•Îêú API ÌÇ§ÏôÄ Î™®Îç∏ ÏÑ†ÌÉùÏù¥ Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                // Ìèº Ï¥àÍ∏∞Ìôî
                document.getElementById('chatgptModel').value = '';
                document.getElementById('chatgptApiKey').value = '';
                document.getElementById('chatgptFinetuningModel').value = '';
                document.getElementById('chatgptFinetuningGroup').style.display = 'none';
                document.getElementById('geminiModel').value = '';
                document.getElementById('geminiApiKey').value = '';
                document.getElementById('claudeModel').value = '';
                document.getElementById('claudeApiKey').value = '';
                
                // ÏÑ§Ï†ï Í∞ùÏ≤¥ Ï¥àÍ∏∞Ìôî
                apiSettings = {
                    chatgpt: { apiKey: '', model: '', enabled: false },
                    gemini: { apiKey: '', model: '', enabled: false },
                    claude: { apiKey: '', model: '', enabled: false },
                    activeProvider: ''
                };
                
                showStatus('apiStatus', 'üîÑ Î™®Îì† API ÏÑ§Ï†ïÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
        }

        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄÎäî Îçî Ïò§Îûò ÌëúÏãú (5Ï¥à), Ïò§Î•ò Î©îÏãúÏßÄÎäî Í∏∞Î≥∏ ÏãúÍ∞Ñ (3Ï¥à)
            const displayTime = type === 'success' ? 5000 : 3000;
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, displayTime);
        }

        // Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅ Ïó∞ÎèÑ Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateDentalCheckupYear(birthYear) {
            const currentYear = new Date().getFullYear();
            const isOddBirth = birthYear % 2 === 1;
            const isCurrentYearOdd = currentYear % 2 === 1;
            
            if (isOddBirth) {
                // ÌôÄÏàòÎÖÑ Ï∂úÏÉùÏûê - ÌôÄÏàòÎÖÑÏóê Í≤ÄÏßÑ
                return isCurrentYearOdd ? currentYear : currentYear + 1;
            } else {
                // ÏßùÏàòÎÖÑ Ï∂úÏÉùÏûê - ÏßùÏàòÎÖÑÏóê Í≤ÄÏßÑ
                return isCurrentYearOdd ? currentYear + 1 : currentYear;
            }
        }

        // ÎÇòÏù¥ Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateAge(birthYear) {
            const currentYear = new Date().getFullYear();
            return currentYear - birthYear;
        }

        // Ïã§Ï†ú ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (localStorageÏóêÏÑú)
        function getReservationData() {
            try {
                const storedReservations = JSON.parse(localStorage.getItem('phoenixDentalReservations') || '[]');
                
                // Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
                if (storedReservations.length === 0) {
                    return getSampleReservationData();
                }
                
                return storedReservations;
                
            } catch (error) {
                console.error('ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                return getSampleReservationData();
            }
        }

        // ÏÉòÌîå ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ (Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞Ïö©)
        function getSampleReservationData() {
            const currentYear = new Date().getFullYear();
            return [
                {
                    id: 1,
                    name: 'ÍπÄÏ≤†Ïàò',
                    birth: '850315',
                    phone: '010-1234-5678',
                    date: '2025-06-15',
                    time: '10:00',
                    consult: 'ÏûÑÌîåÎûÄÌä∏ ÏÉÅÎã¥',
                    createdAt: '2025-06-12T09:30:00.000Z',
                    reservationHistory: ['2025-06-15 10:00']
                },
                {
                    id: 2,
                    name: 'Ïù¥ÏòÅÌù¨',
                    birth: '920722',
                    phone: '010-9876-5432',
                    date: '2025-06-16',
                    time: '14:30',
                    consult: 'ÏπòÏïÑ ÍµêÏ†ï',
                    createdAt: '2025-06-12T11:15:00.000Z',
                    reservationHistory: ['2025-06-16 14:30']
                },
                {
                    id: 3,
                    name: 'Î∞ïÎØºÏàò',
                    birth: '780904',
                    phone: '010-5555-7777',
                    date: '2025-06-12',
                    time: '16:00',
                    consult: 'Ïä§ÏºÄÏùºÎßÅ',
                    createdAt: '2025-06-11T14:20:00.000Z',
                    reservationHistory: ['2025-06-12 16:00']
                }
            ];
        }

        // Ï§ëÎ≥µ Í≥†Í∞ù ÌÜµÌï© Ï≤òÎ¶¨
        function consolidateCustomers(reservations) {
            const customerMap = new Map();
            
            reservations.forEach(reservation => {
                const key = `${reservation.name}_${reservation.birth}`;
                
                if (customerMap.has(key)) {
                    // Í∏∞Ï°¥ Í≥†Í∞ùÏùò ÏòàÏïΩ Ïù¥Î†• Ï∂îÍ∞Ä
                    const existingCustomer = customerMap.get(key);
                    existingCustomer.reservationHistory.push(`${reservation.date} ${reservation.time}`);
                    
                    // Í∞ÄÏû• ÏµúÍ∑º ÏòàÏïΩ Ï†ïÎ≥¥Î°ú ÏóÖÎç∞Ïù¥Ìä∏
                    if (new Date(reservation.createdAt) > new Date(existingCustomer.createdAt)) {
                        existingCustomer.date = reservation.date;
                        existingCustomer.time = reservation.time;
                        existingCustomer.consult = reservation.consult;
                        existingCustomer.createdAt = reservation.createdAt;
                    }
                } else {
                    // ÏÉàÎ°úÏö¥ Í≥†Í∞ù Ï∂îÍ∞Ä
                    customerMap.set(key, {
                        ...reservation,
                        reservationHistory: [`${reservation.date} ${reservation.time}`]
                    });
                }
            });
            
            return Array.from(customerMap.values());
        }

        // ÏÉùÎÖÑÏõîÏùº 6ÏûêÎ¶¨ÏóêÏÑú Ï∂úÏÉùÏó∞ÎèÑ Í≥ÑÏÇ∞
        function getBirthYear(birth) {
            const yearPrefix = birth.substr(0, 2);
            const year = parseInt(yearPrefix);
            
            // Í∏∞Ï§ÄÏ†ê: 30 Ïù¥ÏÉÅÏù¥Î©¥ 19XXÎÖÑ, 30 ÎØ∏ÎßåÏù¥Î©¥ 20XXÎÖÑ
            // Ïòà: 85 ‚Üí 1985ÎÖÑ, 05 ‚Üí 2005ÎÖÑ, 25 ‚Üí 2025ÎÖÑ
            if (year >= 30) {
                return 1900 + year;
            } else {
                return 2000 + year;
            }
        }

        // ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Ïóê Íµ¨Í∞ïÍ≤ÄÏßÑ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
        function addDentalCheckupInfo(reservations) {
            return reservations.map(reservation => {
                const birthYear = getBirthYear(reservation.birth);
                const age = calculateAge(birthYear);
                const dentalCheckupYear = calculateDentalCheckupYear(birthYear);
                const dentalCheckupInfo = `ÎÇòÏù¥(${age}ÏÑ∏), ${dentalCheckupYear}ÎÖÑ Íµ≠Í∞Ä Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅ`;
                
                return {
                    ...reservation,
                    age,
                    dentalCheckupYear,
                    dentalCheckupInfo
                };
            });
        }

        // CSV ÌååÏùº Îã§Ïö¥Î°úÎìú Ìï®Ïàò
        function downloadCSV(data, filename) {
            const csvContent = data.map(row => row.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú Ìï®Ïàò (SheetJS ÏÇ¨Ïö©)
        function downloadExcel(data, filename) {
            try {
                // ÏõåÌÅ¨Î∂Å ÏÉùÏÑ±
                const wb = XLSX.utils.book_new();
                
                // ÏõåÌÅ¨ÏãúÌä∏ ÏÉùÏÑ±
                const ws = XLSX.utils.aoa_to_sheet(data);
                
                // Ïó¥ ÎÑàÎπÑ ÏûêÎèô Ï°∞Ï†ï
                const colWidths = [];
                data.forEach(row => {
                    row.forEach((cell, index) => {
                        const cellLength = cell ? cell.toString().length : 0;
                        colWidths[index] = Math.max(colWidths[index] || 0, cellLength);
                    });
                });
                
                // Ïó¥ ÎÑàÎπÑ ÏÑ§Ï†ï (ÏµúÏÜå 10, ÏµúÎåÄ 30)
                ws['!cols'] = colWidths.map(width => ({ 
                    wch: Math.min(Math.max(width, 10), 30) 
                }));
                
                // Ìó§Îçî Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
                const headerRange = XLSX.utils.decode_range(ws['!ref']);
                for (let col = headerRange.s.c; col <= headerRange.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                    if (ws[cellAddress]) {
                        ws[cellAddress].s = {
                            font: { bold: true },
                            fill: { fgColor: { rgb: "FFCCCCCC" } },
                            alignment: { horizontal: "center" }
                        };
                    }
                }
                
                // ÏõåÌÅ¨ÏãúÌä∏Î•º ÏõåÌÅ¨Î∂ÅÏóê Ï∂îÍ∞Ä
                XLSX.utils.book_append_sheet(wb, ws, "Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûê");
                
                // ÏóëÏÖÄ ÌååÏùº ÏÉùÏÑ± Î∞è Îã§Ïö¥Î°úÎìú
                XLSX.writeFile(wb, filename);
                
                console.log('‚úÖ ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú ÏôÑÎ£å:', filename);
                
            } catch (error) {
                console.error('‚ùå ÏóëÏÖÄ ÌååÏùº ÏÉùÏÑ± Ïò§Î•ò:', error);
                alert('ÏóëÏÖÄ ÌååÏùº ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\n' + error.message);
            }
        }

        // Ï†ÑÏ≤¥ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú
        function downloadAllReservations() {
            console.log('Ï†ÑÏ≤¥ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú');
            
            const rawData = getReservationData();
            const consolidatedData = consolidateCustomers(rawData);
            const dataWithDentalInfo = addDentalCheckupInfo(consolidatedData);
            
            // ÏóëÏÖÄ Ìó§Îçî
            const headers = [
                'ÏàúÎ≤à', 'ÏòàÏïΩÏûêÎ™Ö', 'ÏÉùÎÖÑÏõîÏùº', 'Ï†ÑÌôîÎ≤àÌò∏', 'ÏµúÍ∑ºÏòàÏïΩÎÇ†Ïßú', 'ÏµúÍ∑ºÏòàÏïΩÏãúÍ∞Ñ', 
                'ÏÉÅÎã¥ÎÇ¥Ïö©', 'Íµ¨Í∞ïÍ≤ÄÏßÑÏ†ïÎ≥¥', 'ÏòàÏïΩÏù¥Î†•', 'ÏµúÏ¥àÏòàÏïΩÏùºÏãú'
            ];
            
            // ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const excelData = [headers];
            dataWithDentalInfo.forEach((customer, index) => {
                excelData.push([
                    index + 1,
                    customer.name,
                    customer.birth,
                    customer.phone,
                    customer.date,
                    customer.time,
                    customer.consult || 'ÏóÜÏùå',
                    customer.dentalCheckupInfo,
                    customer.reservationHistory.join(' / '),
                    customer.createdAt
                ]);
            });
            
            const today = new Date().toISOString().split('T')[0];
            downloadExcel(excelData, `ÌîºÎãâÏä§ÏπòÍ≥º_Ï†ÑÏ≤¥ÏòàÏïΩÎ™ÖÎã®_${today}.xlsx`);
            
            alert(`Ï†ÑÏ≤¥ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Í∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\nÏ¥ù ${dataWithDentalInfo.length}Î™ÖÏùò Í≥†Í∞ù Ï†ïÎ≥¥Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`);
        }

        // Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÎßå ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú
        function downloadDentalCheckupExcel() {
            console.log('Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûê ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú');
            
            const rawData = getReservationData();
            const consolidatedData = consolidateCustomers(rawData);
            const dataWithDentalInfo = addDentalCheckupInfo(consolidatedData);
            
            // ÌòÑÏû¨ Ïó∞ÎèÑ Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÎßå ÌïÑÌÑ∞ÎßÅ
            const currentYear = new Date().getFullYear();
            const currentYearCheckupCustomers = dataWithDentalInfo.filter(customer => 
                customer.dentalCheckupYear === currentYear
            );
            
            if (currentYearCheckupCustomers.length === 0) {
                alert(`${currentYear}ÎÖÑ Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.`);
                return;
            }
            
            // ÏóëÏÖÄ Ìó§Îçî
            const headers = [
                'ÏàúÎ≤à', 'ÏòàÏïΩÏûêÎ™Ö', 'ÏÉùÎÖÑÏõîÏùº', 'Ï†ÑÌôîÎ≤àÌò∏', 'ÎÇòÏù¥', 'Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ', 
                'ÏµúÍ∑ºÏòàÏïΩÎÇ†Ïßú', 'ÏµúÍ∑ºÏòàÏïΩÏãúÍ∞Ñ', 'ÏÉÅÎã¥ÎÇ¥Ïö©', 'ÏòàÏïΩÏù¥Î†•', 'ÏµúÏ¥àÏòàÏïΩÏùºÏãú'
            ];
            
            // ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const excelData = [headers];
            currentYearCheckupCustomers.forEach((customer, index) => {
                excelData.push([
                    index + 1,
                    customer.name,
                    customer.birth,
                    customer.phone,
                    customer.age,
                    customer.dentalCheckupYear,
                    customer.date,
                    customer.time,
                    customer.consult || 'ÏóÜÏùå',
                    customer.reservationHistory.join(' / '),
                    customer.createdAt
                ]);
            });
            
            const today = new Date().toISOString().split('T')[0];
            downloadExcel(excelData, `ÌîºÎãâÏä§ÏπòÍ≥º_${currentYear}ÎÖÑ_Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏûê_${today}.xlsx`);
            
            alert(`${currentYear}ÎÖÑ Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûê Îç∞Ïù¥ÌÑ∞Í∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\nÏ¥ù ${currentYearCheckupCustomers.length}Î™ÖÏùò Í≥†Í∞ù Ï†ïÎ≥¥Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`);
        }

        // Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÏóêÍ≤å Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞
        function sendMessageToDentalTargets() {
            console.log('Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÏóêÍ≤å Î©îÏãúÏßÄ Î≥¥ÎÇ¥Í∏∞');
            
            const rawData = getReservationData();
            const consolidatedData = consolidateCustomers(rawData);
            const dataWithDentalInfo = addDentalCheckupInfo(consolidatedData);
            
            // ÌòÑÏû¨ Ïó∞ÎèÑ Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÎßå ÌïÑÌÑ∞ÎßÅ
            const currentYear = new Date().getFullYear();
            const currentYearCheckupCustomers = dataWithDentalInfo.filter(customer => 
                customer.dentalCheckupYear === currentYear
            );
            
            if (currentYearCheckupCustomers.length === 0) {
                alert(`${currentYear}ÎÖÑ Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.`);
                return;
            }
            
            // Î©îÏãúÏßÄ Î∞úÏÜ° ÏòµÏÖò ÌåùÏóÖ Ïó¥Í∏∞
            showMessageSendingOptions(currentYearCheckupCustomers);
        }

        // Î©îÏãúÏßÄ Î∞úÏÜ° ÏòµÏÖò ÌåùÏóÖ ÌëúÏãú
        function showMessageSendingOptions(customers) {
            const popup = document.getElementById('messageSendingPopup');
            const customerCount = document.getElementById('messageCustomerCount');
            
            customerCount.textContent = customers.length;
            popup.style.display = 'flex';
            
            // Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞Î•º Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû• (ÌÉ≠ÏóêÏÑú ÏÇ¨Ïö©)
            window.messageTargetCustomers = customers;
        }

        // Î©îÏãúÏßÄ Î∞úÏÜ° ÌåùÏóÖ Îã´Í∏∞
        function closeMessageSendingPopup() {
            document.getElementById('messageSendingPopup').style.display = 'none';
            
            // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
            document.getElementById('smsFileInput').value = '';
            document.getElementById('kakaoFileInput').value = '';
            document.getElementById('smsFileName').style.display = 'none';
            document.getElementById('kakaoFileName').style.display = 'none';
            
            // Ï≤´ Î≤àÏß∏ ÌÉ≠ÏúºÎ°ú Î¶¨ÏÖã
            switchMessageTab('sms');
        }

        // ÌÉ≠ Ï†ÑÌôò
        function switchMessageTab(tabName) {
            // Î™®Îì† ÌÉ≠ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Î™®Îì† ÌÉ≠ ÏΩòÌÖêÏ∏† Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            document.querySelector(`[onclick="switchMessageTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // SMS ÌååÏùº ÏóÖÎ°úÎìú
        function uploadSmsFile(event) {
            const file = event.target.files[0];
            const fileName = document.getElementById('smsFileName');
            
            if (file) {
                fileName.textContent = `‚úÖ ${file.name}`;
                fileName.style.display = 'block';
                console.log('SMS ÌååÏùº ÏóÖÎ°úÎìú:', file.name);
            } else {
                fileName.textContent = 'ÏÑ†ÌÉùÎêú ÌååÏùº ÏóÜÏùå';
                fileName.style.display = 'none';
            }
        }

        // Ïπ¥Ïπ¥Ïò§ ÌååÏùº ÏóÖÎ°úÎìú
        function uploadKakaoFile(event) {
            const file = event.target.files[0];
            const fileName = document.getElementById('kakaoFileName');
            
            if (file) {
                fileName.textContent = `‚úÖ ${file.name}`;
                fileName.style.display = 'block';
                console.log('Ïπ¥Ïπ¥Ïò§ ÌååÏùº ÏóÖÎ°úÎìú:', file.name);
            } else {
                fileName.textContent = 'ÏÑ†ÌÉùÎêú ÌååÏùº ÏóÜÏùå';
                fileName.style.display = 'none';
            }
        }

        // SMS Î∞úÏÜ° (ÏÜîÎùºÌîº API Ïó∞Îèô)
        async function sendSmsMessage() {
            const customers = window.messageTargetCustomers;
            const fileInput = document.getElementById('smsFileInput');
            
            if (fileInput.files.length === 0) {
                alert('‚ö†Ô∏è ÏóëÏÖÄ ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const confirmed = confirm(`üì± SMS Î¨∏Ïûê Î©îÏãúÏßÄ Î∞úÏÜ°\n\nüéØ Î∞úÏÜ° ÎåÄÏÉÅ: ${customers.length}Î™Ö\nüìÅ ÏóÖÎ°úÎìú ÌååÏùº: ${fileInput.files[0].name}\n\nÏ†ïÎßê Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
            
            if (!confirmed) return;
            
            try {
                // Î∞úÏÜ° ÏãúÏûë ÏïàÎÇ¥
                const loadingModal = showLoadingModal('üì± SMS Î∞úÏÜ° Ï§ë...', 'Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî');
                
                // ÏóëÏÖÄ ÌååÏùº ÌååÏã±
                const excelData = await parseExcelFile(fileInput.files[0]);
                console.log('ÌååÏã±Îêú ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞:', excelData);
                
                // Î∞úÏÜ° Í≤∞Í≥º Ï∂îÏ†Å
                const sendResults = [];
                let successCount = 0;
                let failCount = 0;
                
                // Í∞Å Í≥†Í∞ùÏóêÍ≤å Í∞úÎ≥Ñ Î∞úÏÜ°
                for (let i = 0; i < excelData.length; i++) {
                    const customer = excelData[i];
                    
                    // Î°úÎî© ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
                    updateLoadingProgress(loadingModal, i + 1, excelData.length);
                    
                    try {
                        // ÎîîÎ≤ÑÍπÖ: Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ Î°úÍ∑∏
                        console.log('üìã Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞:', customer);
                        
                        // Í∞úÏù∏ÌôîÎêú Î©îÏãúÏßÄ ÏÉùÏÑ±
                        const personalizedMessage = createPersonalizedMessage(customer);
                        
                        // Ï†ÑÌôîÎ≤àÌò∏ ÌïÑÎìú ÌôïÏù∏ Î∞è ÏàòÏ†ï (Îçî Ìè¨Í¥ÑÏ†ÅÏù∏ Í≤ÄÏÉâ)
                        const phoneNumber = customer.Ï†ÑÌôîÎ≤àÌò∏ || 
                                          customer.phone || 
                                          customer.Phone || 
                                          customer.PHONE || 
                                          customer['Ï†ÑÌôîÎ≤àÌò∏'] || 
                                          customer['Phone Number'] || 
                                          customer['phone'] || 
                                          customer['Phone'] || 
                                          customer['PHONE'] ||
                                          customer['Ïó∞ÎùΩÏ≤ò'] ||
                                          customer['Ï†ÑÌôî'] ||
                                          customer['Ìú¥ÎåÄÌè∞'] ||
                                          customer['Ìú¥ÎåÄÏ†ÑÌôî'] ||
                                          customer['Î™®Î∞îÏùº'] ||
                                          customer['Mobile'] ||
                                          customer['mobile'] ||
                                          '';
                        
                        console.log('üì± Ï†ÑÌôîÎ≤àÌò∏ ÌôïÏù∏:', phoneNumber);
                        console.log('üì± Í≥†Í∞ù Í∞ùÏ≤¥Ïùò Î™®Îì† ÌÇ§:', Object.keys(customer));
                        
                        if (!phoneNumber) {
                            console.error('‚ùå Ï†ÑÌôîÎ≤àÌò∏ ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', customer);
                            failCount++;
                            // Ïù¥Î¶Ñ ÌïÑÎìúÎèÑ Îçî Ìè¨Í¥ÑÏ†ÅÏúºÎ°ú Í≤ÄÏÉâ
                            const customerName = customer.ÏòàÏïΩÏûêÎ™Ö || 
                                               customer.name || 
                                               customer.Name || 
                                               customer.NAME || 
                                               customer['ÏòàÏïΩÏûêÎ™Ö'] || 
                                               customer['Name'] || 
                                               customer['name'] || 
                                               customer['Ïù¥Î¶Ñ'] || 
                                               customer['Í≥†Í∞ùÎ™Ö'] || 
                                               customer['ÏÑ±Î™Ö'] || 
                                               'Ïïå Ïàò ÏóÜÏùå';
                            
                            sendResults.push({
                                name: customerName,
                                phone: 'Ï†ÑÌôîÎ≤àÌò∏ ÏóÜÏùå',
                                status: 'Ïã§Ìå®',
                                error: 'Ï†ÑÌôîÎ≤àÌò∏ ÌïÑÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÌïÑÎìú: ' + Object.keys(customer).join(', ')
                            });
                            continue;
                        }
                        
                        // ÏÜîÎùºÌîº API Ìò∏Ï∂ú
                        const result = await sendSingleSMS(phoneNumber, personalizedMessage);
                        
                        if (result.success) {
                            successCount++;
                            sendResults.push({
                                name: customer.ÏòàÏïΩÏûêÎ™Ö,
                                phone: customer.Ï†ÑÌôîÎ≤àÌò∏,
                                status: 'ÏÑ±Í≥µ',
                                messageId: result.messageId,
                                messagePreview: personalizedMessage.substring(0, 100) + '...'
                            });
                        } else {
                            failCount++;
                            sendResults.push({
                                name: customer.ÏòàÏïΩÏûêÎ™Ö,
                                phone: customer.Ï†ÑÌôîÎ≤àÌò∏,
                                status: 'Ïã§Ìå®',
                                error: result.error,
                                originalMessage: personalizedMessage
                            });
                        }
                        
                        // API Ìò∏Ï∂ú Í∞ÑÍ≤© (ÏÜîÎùºÌîº Í∂åÏû•: Ï¥àÎãπ ÏµúÎåÄ 10Í±¥)
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        failCount++;
                        sendResults.push({
                            name: customer.ÏòàÏïΩÏûêÎ™Ö,
                            phone: customer.Ï†ÑÌôîÎ≤àÌò∏,
                            status: 'Ïã§Ìå®',
                            error: error.message
                        });
                        console.error('SMS Î∞úÏÜ° Ïã§Ìå®:', customer.ÏòàÏïΩÏûêÎ™Ö, error);
                    }
                }
                
                // Î°úÎî© Î™®Îã¨ Îã´Í∏∞
                hideLoadingModal(loadingModal);
                
                // Î∞úÏÜ° Í≤∞Í≥º ÌëúÏãú
                showSendResults(sendResults, successCount, failCount);
                
                // ÌåùÏóÖ Îã´Í∏∞
                closeMessageSendingPopup();
                
            } catch (error) {
                console.error('SMS Î∞úÏÜ° ÌîÑÎ°úÏÑ∏Ïä§ Ïò§Î•ò:', error);
                alert(`‚ùå SMS Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:\n${error.message}`);
            }
        }

        // ÏÜîÎùºÌîº APIÎ•º ÌÜµÌïú Í∞úÎ≥Ñ SMS Î∞úÏÜ° (Ïã§Ï†ú Î∞úÏÜ° Î™®Îìú)
        async function sendSingleSMS(phoneNumber, message) {
            try {
                // Ï†ÑÌôîÎ≤àÌò∏ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Í∞ïÌôî
                if (!phoneNumber || typeof phoneNumber !== 'string') {
                    console.error('‚ùå Ï†ÑÌôîÎ≤àÌò∏Í∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§:', phoneNumber);
                    return {
                        success: false,
                        error: 'Ï†ÑÌôîÎ≤àÌò∏Í∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§: ' + phoneNumber
                    };
                }
                
                console.log('üì± Ïã§Ï†ú SMS Î∞úÏÜ° ÏãúÎèÑ:', {
                    to: phoneNumber,
                    message: message ? message.substring(0, 50) + '...' : 'Î©îÏãúÏßÄ ÏóÜÏùå',
                    timestamp: new Date().toLocaleString()
                });
                
                // Ï†ÑÌôîÎ≤àÌò∏ Ï†ïÎ¶¨
                const cleanPhone = phoneNumber.replace(/[^0-9]/g, '');
                if (cleanPhone.length < 10 || cleanPhone.length > 11) {
                    return {
                        success: false,
                        error: 'Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ï†ÑÌôîÎ≤àÌò∏ ÌòïÏãù: ' + phoneNumber
                    };
                }
                
                // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏
                const adminToken = sessionStorage.getItem('adminToken');
                if (!adminToken) {
                    console.error('‚ùå Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§');
                    return {
                        success: false,
                        error: 'Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. Î®ºÏ†Ä Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÏóêÏÑú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.'
                    };
                }
                
                // Netlify FunctionsÎ•º ÌÜµÌïú Ïã§Ï†ú SMS Î∞úÏÜ°
                const response = await fetch('/.netlify/functions/send-message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({
                        phone: cleanPhone,
                        message: message
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.error || `HTTP ${response.status}: ${response.statusText}`;
                    
                    console.error('‚ùå SMS API Ìò∏Ï∂ú Ïã§Ìå®:', {
                        status: response.status,
                        error: errorMessage
                    });
                    
                    return {
                        success: false,
                        error: errorMessage,
                        statusCode: response.status.toString()
                    };
                }
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('‚úÖ SMS Î∞úÏÜ° ÏÑ±Í≥µ:', {
                        messageId: result.messageId,
                        to: phoneNumber,
                        status: 'Î∞úÏÜ°ÏôÑÎ£å'
                    });
                    
                    return {
                        success: true,
                        messageId: result.messageId,
                        statusCode: '2000'
                    };
                } else {
                    console.error('‚ùå SMS Î∞úÏÜ° Ïã§Ìå®:', {
                        to: phoneNumber,
                        error: result.error
                    });
                    
                    return {
                        success: false,
                        error: result.error,
                        statusCode: result.statusCode || '4000'
                    };
                }
                
            } catch (error) {
                console.error('‚ùå SMS Î∞úÏÜ° ÏãúÏä§ÌÖú Ïò§Î•ò:', error);
                return {
                    success: false,
                    error: 'ÏãúÏä§ÌÖú Ïò§Î•ò: ' + error.message
                };
            }
        }

        // ‚úÖ SMS Î∞úÏÜ° ÏãúÏä§ÌÖú ÏôÑÏÑ± ÏôÑÎ£å
        // Ïù¥Ï†ú Ïã§Ï†ú Solapi APIÎ•º ÌÜµÌï¥ SMSÍ∞Ä Î∞úÏÜ°Îê©ÎãàÎã§.
        // Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌïòÎ©∞, Netlify FunctionsÎ•º ÌÜµÌï¥ ÏïàÏ†ÑÌïòÍ≤å Ï≤òÎ¶¨Îê©ÎãàÎã§.

        // Í∞úÏù∏ÌôîÎêú Î©îÏãúÏßÄ ÏÉùÏÑ±
        function createPersonalizedMessage(customer) {
            const template = `[ÌîºÎãâÏä§ÏπòÍ≥º] ÏïàÎÖïÌïòÏÑ∏Ïöî #{Ïù¥Î¶Ñ}Îãò!

#{Í≤ÄÏßÑÏó∞ÎèÑ}ÎÖÑ Íµ≠Í∞Ä Î¨¥Î£å Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÎ°ú ÌôïÏù∏ÎêòÏñ¥ ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§.

ü¶∑ Î¨¥Î£å Í≤ÄÏßÑ ÌòúÌÉù:
- Íµ¨Í∞ïÍ≤ÄÏßÑ (Ï∂©Ïπò, ÏûáÎ™∏ÏßàÌôò Îì±)
- Ï†ÑÎ¨∏Ïùò ÏÉÅÎã¥
- ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω

üìÖ Ïò®ÎùºÏù∏ ÏòàÏïΩÌïòÍ∏∞:
https://phoenixai-agent.site/reservation.html

üìû Ï†ÑÌôî ÏòàÏïΩ: 02-1234-5678
üïò ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00
üìç ÏúÑÏπò: Í∞ïÎÇ®Ïó≠ 3Î≤àÏ∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ

Í±¥Í∞ïÌïú ÏπòÏïÑ Í¥ÄÎ¶¨Ïùò Ï≤´Í±∏ÏùåÏùÑ Ìï®ÍªòÌïòÏÑ∏Ïöî!

- ÌîºÎãâÏä§ÏπòÍ≥º -`;
            
            // Îã§ÏñëÌïú ÌïÑÎìúÎ™Ö ÏßÄÏõê
            const name = customer.ÏòàÏïΩÏûêÎ™Ö || customer.name || customer.Name || customer.NAME || customer['ÏòàÏïΩÏûêÎ™Ö'] || customer['Name'] || 'Í≥†Í∞ù';
            const age = customer.ÎÇòÏù¥ || customer.age || customer.Age || customer.AGE || customer['ÎÇòÏù¥'] || customer['Age'] || '';
            const checkupYear = customer.Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ || customer.checkupYear || customer.CheckupYear || customer['Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ'] || customer['Checkup Year'] || new Date().getFullYear();
            
            return template
                .replace(/#{Ïù¥Î¶Ñ}/g, name)
                .replace(/#{ÎÇòÏù¥}/g, age)
                .replace(/#{Í≤ÄÏßÑÏó∞ÎèÑ}/g, checkupYear);
        }

        // ÏóëÏÖÄ ÌååÏùº ÌååÏã± (Excel Î∞è CSV ÌòïÏãù ÏßÄÏõê)
        async function parseExcelFile(file) {
            return new Promise((resolve, reject) => {
                // ÌååÏùº ÌôïÏû•Ïûê ÌôïÏù∏
                const fileName = file.name.toLowerCase();
                const isExcel = fileName.endsWith('.xlsx') || fileName.endsWith('.xls');
                
                if (isExcel) {
                    // Excel ÌååÏùºÏù∏ Í≤ΩÏö∞ CSVÎ°ú Î≥ÄÌôò ÏïàÎÇ¥
                    reject(new Error('Excel ÌååÏùº(.xlsx/.xls)ÏùÄ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§. CSV ÌòïÏãùÏúºÎ°ú Ï†ÄÏû• ÌõÑ Îã§Ïãú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.\n\nÎ≥ÄÌôò Î∞©Î≤ï:\n1. ExcelÏóêÏÑú ÌååÏùº Ïó¥Í∏∞\n2. "Îã§Î•∏ Ïù¥Î¶ÑÏúºÎ°ú Ï†ÄÏû•" ÏÑ†ÌÉù\n3. ÌååÏùº ÌòïÏãùÏùÑ "CSV UTF-8 (ÏâºÌëúÎ°ú Î∂ÑÎ¶¨)" ÏÑ†ÌÉù\n4. Ï†ÄÏû• ÌõÑ ÏóÖÎ°úÎìú'));
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csvData = e.target.result;
                        
                        // ÌååÏùº ÎÇ¥Ïö©Ïù¥ Excel ÌòïÏãùÏù∏ÏßÄ ÌôïÏù∏
                        if (csvData.includes('PK') && csvData.includes('[Content_Types].xml')) {
                            reject(new Error('Excel ÌååÏùºÏù¥ Í∞êÏßÄÎêòÏóàÏäµÎãàÎã§. CSV ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò ÌõÑ Îã§Ïãú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.\n\nÎ≥ÄÌôò Î∞©Î≤ï:\n1. ExcelÏóêÏÑú ÌååÏùº Ïó¥Í∏∞\n2. "Îã§Î•∏ Ïù¥Î¶ÑÏúºÎ°ú Ï†ÄÏû•" ÏÑ†ÌÉù\n3. ÌååÏùº ÌòïÏãùÏùÑ "CSV UTF-8 (ÏâºÌëúÎ°ú Î∂ÑÎ¶¨)" ÏÑ†ÌÉù\n4. Ï†ÄÏû• ÌõÑ ÏóÖÎ°úÎìú'));
                            return;
                        }
                        
                        const lines = csvData.split('\n');
                        
                        // Îçî Ï†ïÌôïÌïú CSV ÌååÏã± (ÏâºÌëúÍ∞Ä Ìè¨Ìï®Îêú ÌïÑÎìú Ï≤òÎ¶¨)
                        function parseCSVLine(line) {
                            const result = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let i = 0; i < line.length; i++) {
                                const char = line[i];
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    result.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            result.push(current.trim());
                            return result;
                        }
                        
                        const headers = parseCSVLine(lines[0]);
                        
                        // ÎîîÎ≤ÑÍπÖ: Ìó§Îçî Ï†ïÎ≥¥ Î°úÍ∑∏
                        console.log('üìã CSV ÌååÏùº Ìó§Îçî:', headers);
                        
                        const data = [];
                        for (let i = 1; i < lines.length; i++) {
                            if (lines[i].trim()) {
                                const values = parseCSVLine(lines[i]);
                                const row = {};
                                headers.forEach((header, index) => {
                                    row[header] = values[index] || '';
                                });
                                data.push(row);
                            }
                        }
                        
                        // ÎîîÎ≤ÑÍπÖ: Ï≤´ Î≤àÏß∏ Ìñâ Îç∞Ïù¥ÌÑ∞ Î°úÍ∑∏
                        if (data.length > 0) {
                            console.log('üìã Ï≤´ Î≤àÏß∏ Ìñâ Îç∞Ïù¥ÌÑ∞:', data[0]);
                        }
                        
                        resolve(data);
                    } catch (error) {
                        reject(new Error('CSV ÌååÏùº ÌååÏã± Ïã§Ìå®: ' + error.message));
                    }
                };
                reader.onerror = () => reject(new Error('ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®'));
                reader.readAsText(file, 'UTF-8');
            });
        }

        // Î°úÎî© Î™®Îã¨ ÌëúÏãú
        function showLoadingModal(title, message) {
            const modal = document.createElement('div');
            modal.className = 'loading-modal';
            modal.innerHTML = `
                <div class="loading-content">
                    <h3>${title}</h3>
                    <p>${message}</p>
                    <div class="loading-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">0 / 0</div>
                    </div>
                    <div class="loading-spinner">‚è≥</div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }

        // Î°úÎî© ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
        function updateLoadingProgress(modal, current, total) {
            const progressFill = modal.querySelector('.progress-fill');
            const progressText = modal.querySelector('.progress-text');
            
            const percentage = (current / total) * 100;
            progressFill.style.width = percentage + '%';
            progressText.textContent = `${current} / ${total}`;
        }

        // Î°úÎî© Î™®Îã¨ Ïà®Í∏∞Í∏∞
        function hideLoadingModal(modal) {
            document.body.removeChild(modal);
        }

        // Î∞úÏÜ° Í≤∞Í≥º ÌëúÏãú
        function showSendResults(results, successCount, failCount) {
            const resultModal = document.createElement('div');
            resultModal.className = 'result-modal';
            
            const successList = results.filter(r => r.status === 'ÏÑ±Í≥µ');
            const failList = results.filter(r => r.status === 'Ïã§Ìå®');
            
            // Î∞úÏÜ° ÏôÑÎ£å ÏãúÍ∞Ñ
            const completedAt = new Date().toLocaleString('ko-KR');
            
            // Î∞úÏÜ° ÎπÑÏö© Í≥ÑÏÇ∞ (Ïû•Î¨∏ LMS Í∏∞Ï§Ä 50Ïõê)
            const totalCost = successCount * 50;
            
            resultModal.innerHTML = `
                <div class="result-content">
                    <h3>üì± SMS Î∞úÏÜ° ÏôÑÎ£å</h3>
                    
                    <div class="result-summary">
                        <div class="success-count">‚úÖ ÏÑ±Í≥µ: ${successCount}Í±¥</div>
                        <div class="fail-count">‚ùå Ïã§Ìå®: ${failCount}Í±¥</div>
                        <div class="cost-info">üí∞ Î∞úÏÜ° ÎπÑÏö©: ${totalCost.toLocaleString()}Ïõê</div>
                    </div>
                    
                    <div class="send-info">
                        <div class="info-item">‚è∞ Î∞úÏÜ° ÏôÑÎ£å: ${completedAt}</div>
                        <div class="info-item">üìß Î∞úÏÜ° Ïú†Ìòï: Ïû•Î¨∏ LMS</div>
                        <div class="info-item">üìû Î∞úÏã†Î≤àÌò∏: 010-2965-7510</div>
                    </div>
                    
                    ${successCount > 0 ? `
                        <div class="result-section">
                            <h4>‚úÖ Î∞úÏÜ° ÏÑ±Í≥µ Î™©Î°ù</h4>
                            <div class="result-list">
                                ${successList.map(r => `
                                    <div class="result-item success">
                                        <div class="result-header">
                                            <strong>${r.name}</strong> 
                                            <span class="phone">${r.phone}</span>
                                        </div>
                                        <div class="result-details">
                                            <small>Î©îÏãúÏßÄID: ${r.messageId}</small>
                                            <small>Î∞úÏÜ°ÏãúÍ∞Ñ: ${new Date().toLocaleTimeString()}</small>
                                        </div>
                                        ${r.messagePreview ? `
                                            <div class="message-preview">
                                                <details>
                                                    <summary>üìù Î∞úÏÜ°Îêú Î©îÏãúÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞</summary>
                                                    <div class="message-content">${r.messagePreview}</div>
                                                </details>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${failCount > 0 ? `
                        <div class="result-section">
                            <h4>‚ùå Î∞úÏÜ° Ïã§Ìå® Î™©Î°ù</h4>
                            <div class="result-list">
                                ${failList.map(r => `
                                    <div class="result-item fail">
                                        <div class="result-header">
                                            <strong>${r.name}</strong> 
                                            <span class="phone">${r.phone}</span>
                                        </div>
                                        <div class="result-details">
                                            <small>‚ùå Ïã§Ìå® ÏÇ¨Ïú†: ${r.error}</small>
                                            <small>Î∞úÏÉùÏãúÍ∞Ñ: ${new Date().toLocaleTimeString()}</small>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="result-actions">
                        ${failCount > 0 ? `
                            <button class="btn btn-warning" onclick="retryFailedMessages()">
                                üîÑ Ïã§Ìå® Í±¥ Ïû¨Î∞úÏÜ°
                            </button>
                        ` : ''}
                        <button class="btn btn-success" onclick="downloadSendReport()">
                            üìä Î∞úÏÜ° Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú
                        </button>
                        <button class="btn btn-primary" onclick="closeResultModal()">
                            ÌôïÏù∏
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(resultModal);
            window.currentResultModal = resultModal;
            window.lastSendResults = results; // Ïû¨Î∞úÏÜ°ÏùÑ ÏúÑÌï¥ Ï†ÄÏû•
        }

        // Í≤∞Í≥º Î™®Îã¨ Îã´Í∏∞
        function closeResultModal() {
            if (window.currentResultModal) {
                document.body.removeChild(window.currentResultModal);
                window.currentResultModal = null;
            }
        }

        // Ïã§Ìå® Í±¥ Ïû¨Î∞úÏÜ°
        async function retryFailedMessages() {
            if (!window.lastSendResults) return;
            
            const failedResults = window.lastSendResults.filter(r => r.status === 'Ïã§Ìå®');
            if (failedResults.length === 0) {
                alert('Ïû¨Î∞úÏÜ°Ìï† Ïã§Ìå® Í±¥Ïù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const confirmed = confirm(`‚ùå Ïã§Ìå®Ìïú ${failedResults.length}Í±¥ÏùÑ Ïû¨Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
            if (!confirmed) return;
            
            // ÌòÑÏû¨ Î™®Îã¨ Îã´Í∏∞
            closeResultModal();
            
            // Ïû¨Î∞úÏÜ° ÌîÑÎ°úÏÑ∏Ïä§ ÏãúÏûë
            const loadingModal = showLoadingModal('üîÑ Ïû¨Î∞úÏÜ° Ï§ë...', 'Ïã§Ìå®Ìïú Î©îÏãúÏßÄÎ•º Îã§Ïãú Î∞úÏÜ°ÌïòÍ≥† ÏûàÏäµÎãàÎã§');
            
            const retryResults = [];
            let retrySuccessCount = 0;
            let retryFailCount = 0;
            
            for (let i = 0; i < failedResults.length; i++) {
                const failedItem = failedResults[i];
                updateLoadingProgress(loadingModal, i + 1, failedResults.length);
                
                try {
                    const result = await sendSingleSMS(failedItem.phone, failedItem.originalMessage);
                    
                    if (result.success) {
                        retrySuccessCount++;
                        retryResults.push({
                            name: failedItem.name,
                            phone: failedItem.phone,
                            status: 'ÏÑ±Í≥µ',
                            messageId: result.messageId,
                            messagePreview: failedItem.originalMessage.substring(0, 100) + '...'
                        });
                    } else {
                        retryFailCount++;
                        retryResults.push({
                            name: failedItem.name,
                            phone: failedItem.phone,
                            status: 'Ïã§Ìå®',
                            error: result.error,
                            originalMessage: failedItem.originalMessage
                        });
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    retryFailCount++;
                    retryResults.push({
                        name: failedItem.name,
                        phone: failedItem.phone,
                        status: 'Ïã§Ìå®',
                        error: error.message,
                        originalMessage: failedItem.originalMessage
                    });
                }
            }
            
            hideLoadingModal(loadingModal);
            showSendResults(retryResults, retrySuccessCount, retryFailCount);
        }

        // Î∞úÏÜ° Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú
        function downloadSendReport() {
            if (!window.lastSendResults) return;
            
            const results = window.lastSendResults;
            const currentTime = new Date();
            const timestamp = currentTime.toISOString().split('T')[0];
            
            // CSV Ìó§Îçî
            const csvHeader = ['ÏàúÎ≤à', 'Ïù¥Î¶Ñ', 'Ï†ÑÌôîÎ≤àÌò∏', 'Î∞úÏÜ°ÏÉÅÌÉú', 'Î©îÏãúÏßÄID', 'Ïò§Î•òÎÇ¥Ïö©', 'Î∞úÏÜ°ÏãúÍ∞Ñ'];
            
            // CSV Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const csvData = [csvHeader];
            results.forEach((result, index) => {
                csvData.push([
                    index + 1,
                    result.name,
                    result.phone,
                    result.status,
                    result.messageId || '',
                    result.error || '',
                    currentTime.toLocaleString('ko-KR')
                ]);
            });
            
            // CSV Îã§Ïö¥Î°úÎìú
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `ÌîºÎãâÏä§ÏπòÍ≥º_SMSÎ∞úÏÜ°Î¶¨Ìè¨Ìä∏_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`üìä Î∞úÏÜ° Î¶¨Ìè¨Ìä∏Í∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\nÌååÏùºÎ™Ö: ÌîºÎãâÏä§ÏπòÍ≥º_SMSÎ∞úÏÜ°Î¶¨Ìè¨Ìä∏_${timestamp}.csv`);
        }

        // Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ°
        async function sendKakaoMessage() {
            const customers = window.messageTargetCustomers;
            const fileInput = document.getElementById('kakaoFileInput');
            
            if (fileInput.files.length === 0) {
                alert('‚ö†Ô∏è ÏóëÏÖÄ ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const confirmed = confirm(`üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ°\n\nüéØ Î∞úÏÜ° ÎåÄÏÉÅ: ${customers.length}Î™Ö\nüìÅ ÏóÖÎ°úÎìú ÌååÏùº: ${fileInput.files[0].name}\n\nÏ†ïÎßê Î∞úÏÜ°ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
            
            if (!confirmed) return;
            
            // Î°úÎî© Î™®Îã¨ ÌëúÏãú
            const loadingModal = showLoadingModal('üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ï§ë...', 'Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî');
            
            try {
                const results = [];
                const total = customers.length;
                let success = 0;
                let failed = 0;
                
                for (let i = 0; i < customers.length; i++) {
                    const customer = customers[i];
                    updateLoadingProgress(loadingModal, i, total, `${customer.ÏòàÏïΩÏûêÎ™Ö}ÎãòÏóêÍ≤å ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ï§ë...`);
                    
                    try {
                        const result = await sendKakaoToCustomer(customer);
                        results.push({
                            ...customer,
                            status: 'success',
                            message: 'Î∞úÏÜ° ÏÑ±Í≥µ',
                            sendTime: new Date().toLocaleString('ko-KR')
                        });
                        success++;
                        console.log('‚úÖ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÏÑ±Í≥µ:', customer.ÏòàÏïΩÏûêÎ™Ö);
                        
                    } catch (error) {
                        results.push({
                            ...customer,
                            status: 'failed', 
                            message: error.message || 'Î∞úÏÜ° Ïã§Ìå®',
                            sendTime: new Date().toLocaleString('ko-KR')
                        });
                        failed++;
                        console.error('‚ùå Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ïã§Ìå®:', customer.ÏòàÏïΩÏûêÎ™Ö, error);
                    }
                    
                    // Î∞úÏÜ° Í∞ÑÍ≤© (API Ï†úÌïú Î∞©ÏßÄ)
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Í≤∞Í≥º Î™®Îã¨ ÌëúÏãú
                const successRate = ((success / total) * 100).toFixed(1);
                showKakaoResultModal(results, {
                    total,
                    success, 
                    failed,
                    successRate
                });
                
            } catch (error) {
                console.error('Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÌîÑÎ°úÏÑ∏Ïä§ Ïò§Î•ò:', error);
                alert(`‚ùå Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:\n${error.message}`);
            } finally {
                hideLoadingModal(loadingModal);
                closeMessageSendingPopup();
            }
        }

        // ÏÜîÎùºÌîº APIÎ•º ÌÜµÌïú Í∞úÎ≥Ñ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° (Ïã§Ï†ú Î∞úÏÜ° Î™®Îìú)
        async function sendKakaoToCustomer(customer) {
            // Firebase Functions ÏóîÎìúÌè¨Ïù∏Ìä∏ (Ï±ïÌÑ∞2ÏóêÏÑú Íµ¨Ï∂ï ÏòàÏ†ï)
            const FIREBASE_FUNCTION_URL = 'https://your-project.cloudfunctions.net/sendKakaoMessage';
            
            console.log('üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÏãúÎèÑ:', {
                name: customer.ÏòàÏïΩÏûêÎ™Ö,
                phone: customer.Ï†ÑÌôîÎ≤àÌò∏,
                checkupYear: customer.Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ
            });
            
            // Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î©îÏãúÏßÄ ÌÖúÌîåÎ¶ø
            const messageTemplate = `[ÌîºÎãâÏä§ÏπòÍ≥º] ÏïàÎÖïÌïòÏÑ∏Ïöî ${customer.ÏòàÏïΩÏûêÎ™Ö}Îãò!

${customer.Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ}ÎÖÑ Íµ≠Í∞Ä Î¨¥Î£å Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅÏûêÎ°ú ÌôïÏù∏ÎêòÏñ¥ ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§.

ü¶∑ Î¨¥Î£å Í≤ÄÏßÑ ÌòúÌÉù:
‚úì Íµ¨Í∞ïÍ≤ÄÏßÑ (Ï∂©Ïπò, ÏûáÎ™∏ÏßàÌôò Îì±)
‚úì Ï†ÑÎ¨∏Ïùò ÏÉÅÎã¥  
‚úì ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω

üìÖ Ïò®ÎùºÏù∏ ÏòàÏïΩÌïòÍ∏∞:
https://phoenixai-agent.site/reservation.html

üìû Ï†ÑÌôî ÏòàÏïΩ: 02-1234-5678
üïò ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00  
üìç ÏúÑÏπò: Í∞ïÎÇ®Ïó≠ 3Î≤àÏ∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ

Í±¥Í∞ïÌïú ÏπòÏïÑ Í¥ÄÎ¶¨Ïùò Ï≤´Í±∏ÏùåÏùÑ Ìï®ÍªòÌïòÏÑ∏Ïöî!

- ÌîºÎãâÏä§ÏπòÍ≥º -`;

            // ÌòÑÏû¨Îäî ÏãúÎÆ¨Î†àÏù¥ÏÖò Î™®Îìú (Firebase Functions Íµ¨Ï∂ï ÌõÑ Ïã§Ï†ú API Ìò∏Ï∂ú)
            const isSimulation = true;
            
            if (isSimulation) {
                // ÏãúÎÆ¨Î†àÏù¥ÏÖò: 95% ÏÑ±Í≥µÎ•†
                await new Promise(resolve => setTimeout(resolve, 200 + Math.random() * 300));
                
                if (Math.random() > 0.05) {
                    console.log('‚úÖ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÏÑ±Í≥µ:', {
                        to: customer.Ï†ÑÌôîÎ≤àÌò∏,
                        name: customer.ÏòàÏïΩÏûêÎ™Ö,
                        template: 'Íµ¨Í∞ïÍ≤ÄÏßÑ_ÏïàÎÇ¥',
                        status: 'SUCCESS'
                    });
                    return { success: true, messageId: 'kakao_' + Date.now() };
                } else {
                    throw new Error('Î∞úÏÜ° Ïã§Ìå® (ÏãúÎÆ¨Î†àÏù¥ÏÖò)');
                }
            } else {
                // Ïã§Ï†ú Firebase Functions Ìò∏Ï∂ú (Ï±ïÌÑ∞2ÏóêÏÑú ÌôúÏÑ±Ìôî)
                const response = await fetch(FIREBASE_FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        to: customer.Ï†ÑÌôîÎ≤àÌò∏,
                        templateCode: 'dental_checkup_notice',
                        templateData: {
                            name: customer.ÏòàÏïΩÏûêÎ™Ö,
                            checkupYear: customer.Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ,
                            clinicName: 'ÌîºÎãâÏä§ÏπòÍ≥º',
                            phone: '02-1234-5678',
                            reservationUrl: 'https://phoenixai-agent.site/reservation.html'
                        }
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Ïã§Ìå®');
                }
                
                const result = await response.json();
                console.log('‚úÖ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÏÑ±Í≥µ:', {
                    to: customer.Ï†ÑÌôîÎ≤àÌò∏,
                    messageId: result.messageId,
                    status: result.status
                });
                
                return result;
            }
        }

        // Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Í≤∞Í≥º Î™®Îã¨ ÌëúÏãú
        function showKakaoResultModal(results, summary) {
            const modal = document.createElement('div');
            modal.className = 'loading-modal';
            modal.innerHTML = `
                <div class="loading-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h3>üí¨ Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÏôÑÎ£å</h3>
                        <div style="display: flex; justify-content: space-around; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #2ecc71;">${summary.success}</div>
                                <div style="color: #666;">Î∞úÏÜ° ÏÑ±Í≥µ</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">${summary.failed}</div>
                                <div style="color: #666;">Î∞úÏÜ° Ïã§Ìå®</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #3498db;">${summary.successRate}%</div>
                                <div style="color: #666;">ÏÑ±Í≥µÎ•†</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>üìä Î∞úÏÜ° Í≤∞Í≥º ÏÉÅÏÑ∏</h4>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                <thead style="background: #f1f2f6; position: sticky; top: 0;">
                                    <tr>
                                        <th style="padding: 8px; border: 1px solid #ddd;">ÏàúÎ≤à</th>
                                        <th style="padding: 8px; border: 1px solid #ddd;">Ïù¥Î¶Ñ</th>
                                        <th style="padding: 8px; border: 1px solid #ddd;">Ï†ÑÌôîÎ≤àÌò∏</th>
                                        <th style="padding: 8px; border: 1px solid #ddd;">Í≤ÄÏßÑÏó∞ÎèÑ</th>
                                        <th style="padding: 8px; border: 1px solid #ddd;">Î∞úÏÜ°ÏÉÅÌÉú</th>
                                        <th style="padding: 8px; border: 1px solid #ddd;">Î∞úÏÜ°ÏãúÍ∞Ñ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${results.map((result, index) => `
                                        <tr style="background: ${result.status === 'success' ? '#e8f5e8' : '#ffeaa7'};">
                                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${index + 1}</td>
                                            <td style="padding: 6px; border: 1px solid #ddd;">${result.ÏòàÏïΩÏûêÎ™Ö}</td>
                                            <td style="padding: 6px; border: 1px solid #ddd;">${result.Ï†ÑÌôîÎ≤àÌò∏}</td>
                                            <td style="padding: 6px; border: 1px solid #ddd;">${result.Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ}ÎÖÑ</td>
                                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">
                                                ${result.status === 'success' ? '‚úÖ ÏÑ±Í≥µ' : '‚ùå Ïã§Ìå®'}
                                            </td>
                                            <td style="padding: 6px; border: 1px solid #ddd; font-size: 11px;">${result.sendTime}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="downloadKakaoReport()" style="background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 5px; margin-right: 10px; cursor: pointer;">
                            üìä Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú
                        </button>
                        <button onclick="this.closest('.loading-modal').remove()" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer;">
                            Îã´Í∏∞
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Ï†ÑÏó≠ Î≥ÄÏàòÏóê Í≤∞Í≥º Ï†ÄÏû• (Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìúÏö©)
            window.kakaoSendResults = results;
        }

        // Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú
        function downloadKakaoReport() {
            if (!window.kakaoSendResults) {
                alert('Îã§Ïö¥Î°úÎìúÌï† Î¶¨Ìè¨Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const results = window.kakaoSendResults;
            const timestamp = new Date().toISOString().slice(0, 16).replace('T', '_').replace(/:/g, '');
            
            // CSV Ìó§Îçî
            const headers = [
                'ÏàúÎ≤à', 'ÏòàÏïΩÏûêÎ™Ö', 'ÏÉùÎÖÑÏõîÏùº', 'Ï†ÑÌôîÎ≤àÌò∏', 'ÎÇòÏù¥', 'Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ', 
                'Î∞úÏÜ°ÏÉÅÌÉú', 'Î∞úÏÜ°Í≤∞Í≥º', 'Î∞úÏÜ°ÏãúÍ∞Ñ', 'ÎπÑÍ≥†'
            ];
            
            // CSV Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const csvData = [headers];
            results.forEach((result, index) => {
                csvData.push([
                    index + 1,
                    result.ÏòàÏïΩÏûêÎ™Ö,
                    result.ÏÉùÎÖÑÏõîÏùº,
                    result.Ï†ÑÌôîÎ≤àÌò∏,
                    result.ÎÇòÏù¥,
                    result.Íµ¨Í∞ïÍ≤ÄÏßÑÎåÄÏÉÅÏó∞ÎèÑ,
                    result.status === 'success' ? 'ÏÑ±Í≥µ' : 'Ïã§Ìå®',
                    result.message,
                    result.sendTime,
                    result.status === 'success' ? 'Ïπ¥Ïπ¥Ïò§ ÏïåÎ¶ºÌÜ° Î∞úÏÜ° ÏôÑÎ£å' : 'Î∞úÏÜ° Ïã§Ìå®'
                ]);
            });
            
            // CSV ÌååÏùº Îã§Ïö¥Î°úÎìú
            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `ÌîºÎãâÏä§ÏπòÍ≥º_Ïπ¥Ïπ¥Ïò§ÏïåÎ¶ºÌÜ°Î∞úÏÜ°Î¶¨Ìè¨Ìä∏_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`üìä Î∞úÏÜ° Î¶¨Ìè¨Ìä∏Í∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\nÌååÏùºÎ™Ö: ÌîºÎãâÏä§ÏπòÍ≥º_Ïπ¥Ïπ¥Ïò§ÏïåÎ¶ºÌÜ°Î∞úÏÜ°Î¶¨Ìè¨Ìä∏_${timestamp}.csv`);
        }

        // Í≥†Í∞ù ÌÖåÏù¥Î∏î ÏóÖÎç∞Ïù¥Ìä∏
        function updateCustomerTable() {
            const rawData = getReservationData();
            const consolidatedData = consolidateCustomers(rawData);
            const dataWithDentalInfo = addDentalCheckupInfo(consolidatedData);
            
            const tableBody = document.getElementById('customerTableBody');
            if (!tableBody) return;
            
            // ÌÖåÏù¥Î∏î ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî
            tableBody.innerHTML = '';
            
            // ÏÉà Îç∞Ïù¥ÌÑ∞Î°ú ÌÖåÏù¥Î∏î ÏÉùÏÑ±
            dataWithDentalInfo.forEach((customer, index) => {
                const row = document.createElement('tr');
                
                // Íµ¨Í∞ïÍ≤ÄÏßÑ ÎåÄÏÉÅ Ïó∞ÎèÑÏóê Îî∞Î•∏ Î∞∞Í≤ΩÏÉâ ÏÑ§Ï†ï
                const currentYear = new Date().getFullYear();
                const bgColor = customer.dentalCheckupYear === currentYear ? '#e8f5e8' : '#ffeaa7';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${customer.name}</td>
                    <td>${customer.birth}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.date}</td>
                    <td>${customer.time}</td>
                    <td style="background: ${bgColor};">${customer.dentalCheckupInfo}</td>
                    <td>${new Date(customer.createdAt).toLocaleString('ko-KR')}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStatistics() {
            const rawData = getReservationData();
            const consolidatedData = consolidateCustomers(rawData);
            
            const today = new Date().toISOString().split('T')[0];
            const thisWeekStart = new Date();
            thisWeekStart.setDate(thisWeekStart.getDate() - thisWeekStart.getDay());
            const thisWeekStartStr = thisWeekStart.toISOString().split('T')[0];
            
            // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            const totalReservations = consolidatedData.length;
            const todayReservations = consolidatedData.filter(customer => 
                customer.date === today
            ).length;
            const thisWeekReservations = consolidatedData.filter(customer => 
                customer.date >= thisWeekStartStr
            ).length;
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            const totalElement = document.getElementById('totalReservations');
            const todayElement = document.getElementById('todayReservations');
            const weekElement = document.getElementById('thisWeekReservations');
            
            if (totalElement) totalElement.textContent = totalReservations;
            if (todayElement) todayElement.textContent = todayReservations;
            if (weekElement) weekElement.textContent = thisWeekReservations;
        }

        // Finetuning Î™®Îç∏ ÏûÖÎ†• ÌïÑÎìú ÌÜ†Í∏Ä
        function toggleFinetuningInput(provider) {
            const selectElement = document.getElementById(`${provider}Model`);
            const finetuningGroup = document.getElementById(`${provider}FinetuningGroup`);
            
            if (selectElement.value === 'finetuning') {
                finetuningGroup.style.display = 'block';
            } else {
                finetuningGroup.style.display = 'none';
            }
        }

        // ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•
        function saveKnowledgeSettings() {
            console.log('ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•');
            
            if (knowledgeBase.files.length === 0) {
                showStatus('knowledgeSettingsStatus', '‚ùå ÏóÖÎ°úÎìúÎêú ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            if (knowledgeBase.parsedData.length === 0) {
                showStatus('knowledgeSettingsStatus', '‚ùå ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌååÏùº ÌòïÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            // ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÌôúÏÑ±Ìôî
            knowledgeBase.enabled = true;
            
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû• (ÏÑ†ÌÉùÏÇ¨Ìï≠)
            try {
                const knowledgeData = {
                    files: knowledgeBase.files.map(f => ({
                        name: f.name,
                        size: f.size,
                        uploadTime: f.uploadTime,
                        content: f.content
                    })),
                    parsedData: knowledgeBase.parsedData,
                    enabled: knowledgeBase.enabled,
                    lastSaved: new Date().toISOString()
                };
                
                // Ïã§Ï†ú ÌôòÍ≤ΩÏóêÏÑúÎäî ÏÑúÎ≤ÑÏóê Ï†ÄÏû•ÌïòÍ±∞ÎÇò Îã§Î•∏ Ï†ÄÏû•ÏÜå ÏÇ¨Ïö©
                console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Îê®:', knowledgeData);
                
                showStatus('knowledgeSettingsStatus', 
                    `‚úÖ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\nüìö Ï¥ù ${knowledgeBase.files.length}Í∞ú ÌååÏùº, ${knowledgeBase.parsedData.length}Í∞ú Q&A\nü§ñ Ïù¥Ï†ú Ï±óÎ¥áÏù¥ ÏóÖÎ°úÎìúÎêú ÏßÄÏãùÏùÑ Ïö∞ÏÑ†Ï†ÅÏúºÎ°ú ÌôúÏö©Ìï©ÎãàÎã§.`, 
                    'success');
                
                updateKnowledgeStatus();
                
            } catch (error) {
                console.error('ÏßÄÏãù ÌååÏùº Ï†ÄÏû• Ïò§Î•ò:', error);
                showStatus('knowledgeSettingsStatus', '‚ùå Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ ÌÖåÏä§Ìä∏
        function testKnowledgeBase() {
            console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ ÌÖåÏä§Ìä∏');
            
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                showStatus('knowledgeSettingsStatus', '‚ùå ÌôúÏÑ±ÌôîÎêú ÏßÄÏãù ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const testQueries = ['ÏßÑÎ£åÏãúÍ∞Ñ', 'ÏòàÏïΩ', 'ÎπÑÏö©', 'ÏúÑÏπò', 'ÏπòÎ£å'];
            let testResults = [];
            
            testQueries.forEach(query => {
                const result = searchInKnowledgeBase(query);
                if (result) {
                    testResults.push(`‚úÖ "${query}" - ÎãµÎ≥Ä Î∞úÍ≤¨`);
                } else {
                    testResults.push(`‚ùå "${query}" - ÎãµÎ≥Ä ÏóÜÏùå`);
                }
            });
            
            const successCount = testResults.filter(r => r.includes('‚úÖ')).length;
            const message = `üîç Í≤ÄÏÉâ ÌÖåÏä§Ìä∏ Í≤∞Í≥º (${successCount}/${testQueries.length})\n${testResults.join('\n')}`;
            
            showStatus('knowledgeSettingsStatus', message, successCount > 0 ? 'success' : 'error');
        }

        // Î™®Îì† ÏßÄÏãù Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
        function clearAllKnowledge() {
            if (confirm('Î™®Îì† ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùºÍ≥º Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                knowledgeBase = {
                    files: [],
                    content: '',
                    parsedData: [],
                    enabled: false
                };
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                document.getElementById('fileList').innerHTML = '';
                document.getElementById('parsedDataView').style.display = 'none';
                updateKnowledgeStatus();
                
                showStatus('knowledgeSettingsStatus', 'üóëÔ∏è Î™®Îì† ÏßÄÏãù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
                console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            }
        }

        // ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞ Î≥¥Í∏∞
        function showParsedData() {
            console.log('ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞ ÌëúÏãú');
            const viewElement = document.getElementById('parsedDataView');
            const contentElement = document.getElementById('parsedDataContent');
            
            if (knowledgeBase.parsedData.length === 0) {
                contentElement.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.<br>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥† ÌååÏã±ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>';
            } else {
                let html = '';
                knowledgeBase.parsedData.forEach((qa, index) => {
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
                            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: #495057; font-size: 14px;">#${index + 1} | Ï∂úÏ≤ò: ${qa.source}</strong>
                                <small style="color: #6c757d;">ÎùºÏù∏: ${qa.lineNumber}</small>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #28a745;">Q:</strong> ${qa.question}
                            </div>
                            <div>
                                <strong style="color: #007bff;">A:</strong> ${qa.answer.length > 100 ? qa.answer.substring(0, 100) + '...' : qa.answer}
                            </div>
                        </div>
                    `;
                });
                contentElement.innerHTML = html;
            }
            
            // ÌÜ†Í∏Ä ÌëúÏãú
            if (viewElement.style.display === 'none') {
                viewElement.style.display = 'block';
            } else {
                viewElement.style.display = 'none';
            }
        }

        // Í∞ïÌôîÎêú ÎãµÎ≥Ä ÏÉùÏÑ± (ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ìè¨Ìï®)
        function generateAIResponse(userMessage) {
            console.log('ü§ñ AI ÏùëÎãµ ÏÉùÏÑ± ÏãúÏûë:', userMessage);
            console.log('üìä ÌòÑÏû¨ ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÏÉÅÌÉú - enabled:', knowledgeBase.enabled, '| Îç∞Ïù¥ÌÑ∞ Ïàò:', knowledgeBase.parsedData.length);
            
            // 1Ï∞®: ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùºÏóêÏÑú ÎãµÎ≥Ä Í≤ÄÏÉâ (ÏµúÏö∞ÏÑ†)
            const knowledgeAnswer = searchInKnowledgeBase(userMessage);
            if (knowledgeAnswer) {
                console.log('‚úÖ ÏßÄÏãùÎ≤†Ïù¥Ïä§ÏóêÏÑú ÎãµÎ≥Ä Î∞úÍ≤¨ - 1Ï∞® ÎãµÎ≥Ä Ï±ÑÌÉù');
                return Promise.resolve(knowledgeAnswer);
            }
            
            console.log('‚û°Ô∏è ÏßÄÏãùÎ≤†Ïù¥Ïä§ÏóêÏÑú ÎãµÎ≥ÄÏùÑ Ï∞æÏßÄ Î™ªÌï® - 2Ï∞® API Ìò∏Ï∂ú ÏãúÎèÑ');
            
            // 2Ï∞®: APIÍ∞Ä ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ AI API Ìò∏Ï∂ú
            if (apiSettings.activeProvider && apiSettings[apiSettings.activeProvider].enabled) {
                console.log('üîó API Ìò∏Ï∂úÎ°ú ÎãµÎ≥Ä ÏÉùÏÑ±:', apiSettings.activeProvider);
                return callAIAPIWithContext(userMessage);
            }
            
            console.log('üí° API ÏÑ§Ï†ï ÏóÜÏùå - 3Ï∞® Í∏∞Î≥∏ FAQ ÏùëÎãµ ÏÇ¨Ïö©');
            
            // 3Ï∞®: Í∏∞Î≥∏ FAQ ÏùëÎãµ (API ÏÑ§Ï†ïÏù¥ ÏóÜÎäî Í≤ΩÏö∞)
            return Promise.resolve(getDefaultResponse(userMessage));
        }
        function toggleFinetuningInput(provider) {
            const selectElement = document.getElementById(`${provider}Model`);
            const finetuningGroup = document.getElementById(`${provider}FinetuningGroup`);
            
            if (selectElement.value === 'finetuning') {
                finetuningGroup.style.display = 'block';
            } else {
                finetuningGroup.style.display = 'none';
            }
        }

        // ÌååÏùº ÏóÖÎ°úÎìú Í¥ÄÎ†® Ìï®ÏàòÎì§
        function handleFileUpload(event) {
            const files = event.target.files;
            processUploadedFiles(files);
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            processUploadedFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
        }

        function processUploadedFiles(files) {
            console.log('ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ ÏãúÏûë:', files.length, 'Í∞ú');
            showStatus('knowledgeSettingsStatus', 'üìÅ ÌååÏùºÏùÑ Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'success');
            
            let processedCount = 0;
            const totalFiles = files.length;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                console.log('ÌååÏùº Ï≤òÎ¶¨ Ï§ë:', file.name, file.type, file.size);
                
                const fileData = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    uploadTime: new Date(),
                    content: ''
                };
                
                // ÌååÏùº ÌôïÏû•Ïûê ÌôïÏù∏
                const fileExtension = file.name.toLowerCase().split('.').pop();
                
                // PDF ÌååÏùº Í≤ΩÍ≥†
                if (fileExtension === 'pdf' || file.type === 'application/pdf') {
                    console.warn('PDF ÌååÏùº Í∞êÏßÄ:', file.name);
                    processedCount++;
                    
                    if (processedCount === totalFiles) {
                        showStatus('knowledgeSettingsStatus', 
                            `‚ùå PDF ÌååÏùºÏùÄ ÌòÑÏû¨ ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§.\nPDF ÎÇ¥Ïö©ÏùÑ ÌÖçÏä§Ìä∏ ÌååÏùº(.txt)Î°ú Î≥µÏÇ¨Ìï¥ÏÑú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.\n\nüí° PDF ‚Üí ÌÖçÏä§Ìä∏ Î≥ÄÌôò Î∞©Î≤ï:\n1. PDFÎ•º Ïó¥Í≥† ÎÇ¥Ïö©ÏùÑ Î≥µÏÇ¨\n2. Î©îÎ™®Ïû•Ïóê Î∂ôÏó¨ÎÑ£Í∏∞\n3. .txt ÌååÏùºÎ°ú Ï†ÄÏû• ÌõÑ ÏóÖÎ°úÎìú`, 
                            'error');
                    }
                    continue;
                }
                
                // ÏßÄÏõêÎêòÎäî ÌååÏùº ÌòïÏãù Ï≤òÎ¶¨
                if (fileExtension === 'txt' || file.type === 'text/plain' || file.type === '') {
                    // ÌÖçÏä§Ìä∏ ÌååÏùº Ï≤òÎ¶¨
                    processTextFileWithEncoding(file, fileData, () => {
                        processedCount++;
                        checkAllFilesProcessed();
                    });

                } else if (fileExtension === 'jsonl' || file.type === 'application/jsonl' || file.type === 'text/plain') {
                    // JSONL ÌååÏùº Ï≤òÎ¶¨
                    processJsonlFile(file, fileData, () => {
                        processedCount++;
                        checkAllFilesProcessed();
                    });
                } else {
                    // ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãù
                    console.warn('ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãù:', file.name, file.type);
                    processedCount++;
                    
                    if (processedCount === totalFiles) {
                        showStatus('knowledgeSettingsStatus', 
                            `‚ùå ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§: ${file.name}\n\nüìÅ ÌòÑÏû¨ ÏßÄÏõêÎêòÎäî ÌååÏùº ÌòïÏãù:\n‚Ä¢ ÌÖçÏä§Ìä∏ ÌååÏùº (.txt)\n‚Ä¢ JSONL ÌååÏùº (.jsonl)\n\nüí° PDFÎÇò Îã§Î•∏ ÌòïÏãùÏùÄ ÌÖçÏä§Ìä∏ ÌååÏùºÎ°ú Î≥ÄÌôòÌï¥ÏÑú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.`, 
                            'error');
                    }
                    checkAllFilesProcessed();
                }
            }
            
            // Î™®Îì† ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å ÌôïÏù∏ Ìï®Ïàò
            function checkAllFilesProcessed() {
                if (processedCount === totalFiles) {
                    console.log('Ï†ÑÏ≤¥ ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å');
                    
                    // ‚úÖ ÌååÏùº ÏóÖÎ°úÎìú Ï¶âÏãú ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÏûêÎèô ÌôúÏÑ±Ìôî
                    knowledgeBase.enabled = knowledgeBase.parsedData.length > 0;
                    
                    updateFileList();
                    updateKnowledgeStatus();
                    
                    if (knowledgeBase.parsedData.length > 0) {
                        const message = `‚úÖ ${totalFiles}Í∞ú ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å!\nüìö Ï¥ù ${knowledgeBase.parsedData.length}Í∞úÏùò Q&AÍ∞Ä ÌååÏã±ÎêòÏóàÏäµÎãàÎã§.\nü§ñ ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä ÏûêÎèôÏúºÎ°ú ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!`;
                        showStatus('knowledgeSettingsStatus', message, 'success');
                        
                        // Ï¶âÏãú ÌÖåÏä§Ìä∏ Ïã§Ìñâ
                        setTimeout(() => {
                            testKnowledgeBaseAuto();
                        }, 1000);
                    } else {
                        showStatus('knowledgeSettingsStatus', 
                            `‚ö†Ô∏è ÌååÏùºÏùÄ ÏùΩÏóàÏßÄÎßå Q&A Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.\n\nüìù Ïò¨Î∞îÎ•∏ ÌòïÏãù ÏòàÏãú:\nQ: ÏßÑÎ£åÏãúÍ∞ÑÏù¥ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?\nA: ÌèâÏùº 09:00-18:00ÏûÖÎãàÎã§.\n\nÎòêÎäî\n\n1. ÏòàÏïΩÏùÄ Ïñ¥ÎñªÍ≤å ÌïòÎÇòÏöî?\nÏò®ÎùºÏù∏Ïù¥ÎÇò Ï†ÑÌôîÎ°ú Í∞ÄÎä•Ìï©ÎãàÎã§.`, 
                            'error');
                    }
                }
            }
        }



        // JSONL ÌååÏùº Ï≤òÎ¶¨ Ìï®Ïàò
        function processJsonlFile(file, fileData, callback) {
            console.log('üìÑ JSONL ÌååÏùº Ï≤òÎ¶¨ ÏãúÏûë:', file.name);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    fileData.content = content;
                    knowledgeBase.files.push(fileData);
                    parseJsonlContent(fileData);
                    callback();
                    
                } catch (error) {
                    console.error('JSONL ÌååÏùº Ï≤òÎ¶¨ Ïò§Î•ò:', error);
                    showStatus('knowledgeSettingsStatus', 
                        `‚ùå JSONL ÌååÏùº Ï≤òÎ¶¨ Ïã§Ìå®: ${file.name}\n\nüí° JSONL ÌååÏùº ÌòïÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.`, 
                        'error');
                    callback();
                }
            };
            
            reader.onerror = function() {
                console.error('JSONL ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò');
                showStatus('knowledgeSettingsStatus', 
                    `‚ùå JSONL ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®: ${file.name}`, 
                    'error');
                callback();
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        // JSONL ÎÇ¥Ïö© ÌååÏã±
        function parseJsonlContent(fileData) {
            console.log('üìÑ JSONL ÎÇ¥Ïö© ÌååÏã±:', fileData.name);
            
            if (!fileData.content || fileData.content.trim().length === 0) {
                console.log('JSONL ÎÇ¥Ïö©Ïù¥ ÎπÑÏñ¥ÏûàÏùå:', fileData.name);
                return;
            }
            
            const content = fileData.content;
            const lines = content.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
            console.log('JSONL ÌååÏã±Ìï† ÎùºÏù∏ Ïàò:', lines.length);
            
            const parsedQA = [];
            
            // Í∞Å ÎùºÏù∏ÏùÑ JSONÏúºÎ°ú ÌååÏã±
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                try {
                    const jsonData = JSON.parse(line);
                    
                    // Îã§ÏñëÌïú JSON Íµ¨Ï°∞ ÏßÄÏõê
                    let question = '';
                    let answer = '';
                    
                    if (jsonData.question && jsonData.answer) {
                        question = jsonData.question;
                        answer = jsonData.answer;
                    } else if (jsonData.q && jsonData.a) {
                        question = jsonData.q;
                        answer = jsonData.a;
                    } else if (jsonData.ÏßàÎ¨∏ && jsonData.ÎãµÎ≥Ä) {
                        question = jsonData.ÏßàÎ¨∏;
                        answer = jsonData.ÎãµÎ≥Ä;
                    } else if (jsonData.text && jsonData.response) {
                        question = jsonData.text;
                        answer = jsonData.response;
                    } else if (jsonData.prompt && jsonData.completion) {
                        question = jsonData.prompt;
                        answer = jsonData.completion;
                    } else if (jsonData.input && jsonData.output) {
                        question = jsonData.input;
                        answer = jsonData.output;
                    }
                    
                    if (question && answer && question.length > 2 && answer.length > 3) {
                        const qaItem = {
                            question: question,
                            answer: answer,
                            source: fileData.name,
                            lineNumber: i + 1,
                            pattern: 'JSONL'
                        };
                        
                        parsedQA.push(qaItem);
                        console.log('JSONL Q&A Ï∂îÍ∞Ä:', question.substring(0, 30) + '...');
                    }
                    
                } catch (error) {
                    console.warn(`JSONL ÎùºÏù∏ ${i + 1} ÌååÏã± Ïã§Ìå®:`, error);
                    continue;
                }
            }
            
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä (Ï§ëÎ≥µ Ï†úÍ±∞)
            parsedQA.forEach(newQA => {
                const isDuplicate = knowledgeBase.parsedData.some(existingQA => 
                    existingQA.question === newQA.question && existingQA.source === newQA.source
                );
                
                if (!isDuplicate) {
                    knowledgeBase.parsedData.push(newQA);
                }
            });
            
            console.log(`${fileData.name}ÏóêÏÑú ÏÉàÎ°ú ÌååÏã±Îêú Q&A:`, parsedQA.length, 'Í∞ú');
        }

        // ÌÖçÏä§Ìä∏ ÌååÏùºÏùÑ Îã§ÏñëÌïú Ïù∏ÏΩîÎî©ÏúºÎ°ú ÏùΩÍ∏∞ ÏãúÎèÑ
        function processTextFileWithEncoding(file, fileData, callback) {
            console.log('üî§ ÌÖçÏä§Ìä∏ ÌååÏùº Ïù∏ÏΩîÎî© Ï≤òÎ¶¨:', file.name);
            
            // UTF-8Î°ú Î®ºÏ†Ä ÏãúÎèÑ
            const reader1 = new FileReader();
            reader1.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    // ÌïúÍ∏ÄÏù¥ Ï†úÎåÄÎ°ú ÏùΩÌòîÎäîÏßÄ ÌôïÏù∏
                    const hasKorean = /[Í∞Ä-Ìû£]/.test(content);
                    const hasBrokenChars = /[‚óÜÔøΩ]/.test(content) || content.includes('ÔøΩ');
                    
                    if (hasKorean && !hasBrokenChars) {
                        console.log('‚úÖ UTF-8 Ïù∏ÏΩîÎî© ÏÑ±Í≥µ:', file.name);
                        fileData.content = content;
                        knowledgeBase.files.push(fileData);
                        parseFileContentImproved(fileData);
                        callback();
                        return;
                    }
                    
                    console.log('‚ùå UTF-8 Ïã§Ìå®, EUC-KR ÏãúÎèÑ');
                    // EUC-KRÎ°ú Ïû¨ÏãúÎèÑ
                    tryEucKrEncoding();
                    
                } catch (error) {
                    console.error('UTF-8 ÏùΩÍ∏∞ Ïò§Î•ò:', error);
                    tryEucKrEncoding();
                }
            };
            
            reader1.onerror = function() {
                console.error('UTF-8 ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò');
                tryEucKrEncoding();
            };
            
            // EUC-KR ÏãúÎèÑ Ìï®Ïàò
            function tryEucKrEncoding() {
                const reader2 = new FileReader();
                reader2.onload = function(e) {
                    try {
                        const content = e.target.result;
                        const hasKorean = /[Í∞Ä-Ìû£]/.test(content);
                        const hasBrokenChars = /[‚óÜÔøΩ]/.test(content) || content.includes('ÔøΩ');
                        
                        if (hasKorean && !hasBrokenChars) {
                            console.log('‚úÖ EUC-KR Ïù∏ÏΩîÎî© ÏÑ±Í≥µ:', file.name);
                            fileData.content = content;
                            knowledgeBase.files.push(fileData);
                            parseFileContentImproved(fileData);
                            callback();
                            return;
                        }
                        
                        // Îëò Îã§ Ïã§Ìå®Ìïú Í≤ΩÏö∞ UTF-8 Í≤∞Í≥º ÏÇ¨Ïö© (ÏòÅÏñ¥ÎÇò Ïà´ÏûêÎßå ÏûàÏùÑ Ïàò ÏûàÏùå)
                        console.log('‚ö†Ô∏è ÌïúÍ∏Ä Í∞êÏßÄ Ïã§Ìå®, UTF-8 Í≤∞Í≥º ÏÇ¨Ïö©:', file.name);
                        reader1.readAsText(file, 'UTF-8'); // Îã§Ïãú UTF-8Î°ú ÏùΩÏñ¥ÏÑú ÏÇ¨Ïö©
                        
                    } catch (error) {
                        console.error('EUC-KR ÏùΩÍ∏∞ Ïò§Î•ò:', error);
                        // ÎßàÏßÄÎßâ ÏàòÎã®ÏúºÎ°ú UTF-8 ÏÇ¨Ïö©
                        fileData.content = reader1.result || '';
                        knowledgeBase.files.push(fileData);
                        parseFileContentImproved(fileData);
                        callback();
                    }
                };
                
                reader2.onerror = function() {
                    console.error('EUC-KR ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò');
                    // UTF-8 Í≤∞Í≥ºÎùºÎèÑ ÏÇ¨Ïö©
                    fileData.content = reader1.result || '';
                    knowledgeBase.files.push(fileData);
                    parseFileContentImproved(fileData);
                    callback();
                };
                
                reader2.readAsText(file, 'EUC-KR');
            }
            
            // UTF-8Î∂ÄÌÑ∞ ÏãúÏûë
            reader1.readAsText(file, 'UTF-8');
        }

        // Í∞úÏÑ†Îêú ÌååÏùº ÎÇ¥Ïö© ÌååÏã±
        function parseFileContentImproved(fileData) {
            console.log('Í∞úÏÑ†Îêú ÌååÏùº ÌååÏã± ÏãúÏûë:', fileData.name);
            
            if (!fileData.content || fileData.content.trim().length === 0) {
                console.log('ÌååÏùº ÎÇ¥Ïö©Ïù¥ ÎπÑÏñ¥ÏûàÏùå:', fileData.name);
                return;
            }
            
            const content = fileData.content;
            const lines = content.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
            console.log('ÌååÏã±Ìï† ÎùºÏù∏ Ïàò:', lines.length);
            
            const parsedQA = [];
            
            // Ìå®ÌÑ¥Î≥Ñ ÌååÏã± ÏãúÎèÑ
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let question = '';
                let answer = '';
                
                // Ìå®ÌÑ¥ 1: Q: ÏßàÎ¨∏, A: ÎãµÎ≥Ä
                if (line.match(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]\s*(.+)$/i)) {
                    question = line.replace(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]\s*/i, '').trim();
                    
                    // Îã§Ïùå Ï§ÑÏóêÏÑú ÎãµÎ≥Ä Ï∞æÍ∏∞
                    for (let j = i + 1; j < lines.length && j < i + 5; j++) {
                        const nextLine = lines[j];
                        if (nextLine.match(/^[AaAnswÎãµÎ≥ÄÎãµÏùëÎãµ]\s*[:Ôºö]\s*(.+)$/i)) {
                            answer = nextLine.replace(/^[AaAnswÎãµÎ≥ÄÎãµÏùëÎãµ]\s*[:Ôºö]\s*/i, '').trim();
                            i = j; // Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
                            break;
                        } else if (!nextLine.match(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]/i)) {
                            // Q:Í∞Ä ÏïÑÎãàÎ©¥ ÎãµÎ≥ÄÏúºÎ°ú Í∞ÑÏ£º
                            answer = nextLine;
                            i = j;
                            break;
                        }
                    }
                }
                
                // Ìå®ÌÑ¥ 2: Ïà´Ïûê. ÏßàÎ¨∏?
                else if (line.match(/^\d+\.\s*(.+[?Ôºü])\s*$/)) {
                    question = line.replace(/^\d+\.\s*/, '').trim();
                    if (i + 1 < lines.length && !lines[i + 1].match(/^\d+\./)) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                
                // Ìå®ÌÑ¥ 3: - ÏßàÎ¨∏?
                else if (line.match(/^[-‚Ä¢*]\s*(.+[?Ôºü])\s*$/)) {
                    question = line.replace(/^[-‚Ä¢*]\s*/, '').trim();
                    if (i + 1 < lines.length && !lines[i + 1].match(/^[-‚Ä¢*]/)) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                
                // Ìå®ÌÑ¥ 4: ÏßàÎ¨∏ ÌÇ§ÏõåÎìú Ìè¨Ìï®
                else if (line.length > 5 && 
                         (line.includes('?') || line.includes('Ôºü') ||
                          line.match(/(Ïñ¥ÎñªÍ≤å|Ïñ∏Ï†ú|Ïñ¥ÎîîÏÑú|Ïôú|Î¨¥Ïóá|ÎàÑÍ∞Ä|ÏñºÎßà|Î™áÏãú|Ïñ¥Îñ§|Î≠îÍ∞Ä|Ïñ¥Îîî|Î™á|Ïñ∏Ï†úÍπåÏßÄ)/))) {
                    question = line;
                    
                    // Îã§Ïùå Î™á Ï§ÑÏùÑ ÎãµÎ≥ÄÏúºÎ°ú ÏàòÏßë
                    const answerLines = [];
                    for (let j = i + 1; j < Math.min(i + 4, lines.length); j++) {
                        const nextLine = lines[j];
                        // Îã§Ïùå ÏßàÎ¨∏Ïù¥ ÎÇòÏò§Î©¥ Ï§ëÎã®
                        if (nextLine.match(/(Ïñ¥ÎñªÍ≤å|Ïñ∏Ï†ú|Ïñ¥ÎîîÏÑú|Ïôú|Î¨¥Ïóá|ÎàÑÍ∞Ä|ÏñºÎßà|Î™áÏãú|Ïñ¥Îñ§)[?Ôºü]/) ||
                            nextLine.match(/^[\d\-‚Ä¢*Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]/)) {
                            break;
                        }
                        answerLines.push(nextLine);
                        if (answerLines.join(' ').length > 200) break; // ÎÑàÎ¨¥ Í∏∏Î©¥ Ï§ëÎã®
                    }
                    
                    if (answerLines.length > 0) {
                        answer = answerLines.join(' ').trim();
                        i += answerLines.length;
                    }
                }
                
                // Ìå®ÌÑ¥ 5: Ï†úÎ™©: ÎÇ¥Ïö©
                else if (line.match(/^([^:Ôºö]{2,20})[:Ôºö]\s*(.{5,})$/)) {
                    const matches = line.match(/^([^:Ôºö]{2,20})[:Ôºö]\s*(.{5,})$/);
                    if (matches) {
                        question = matches[1].trim();
                        answer = matches[2].trim();
                    }
                }
                
                // Ïú†Ìö®Ìïú Q&A Ïåç Ï†ÄÏû•
                if (question && answer && question.length > 2 && answer.length > 3) {
                    const qaItem = {
                        question: question,
                        answer: answer,
                        source: fileData.name,
                        lineNumber: i + 1,
                        pattern: 'ÏûêÎèôÍ∞êÏßÄ'
                    };
                    
                    parsedQA.push(qaItem);
                    console.log('Q&A Ï∂îÍ∞Ä:', question.substring(0, 30) + '...');
                }
            }
            
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä (Ï§ëÎ≥µ Ï†úÍ±∞)
            parsedQA.forEach(newQA => {
                const isDuplicate = knowledgeBase.parsedData.some(existingQA => 
                    existingQA.question === newQA.question && existingQA.source === newQA.source
                );
                
                if (!isDuplicate) {
                    knowledgeBase.parsedData.push(newQA);
                }
            });
            
            console.log(`${fileData.name}ÏóêÏÑú ÏÉàÎ°ú ÌååÏã±Îêú Q&A:`, parsedQA.length, 'Í∞ú');
            console.log('Ï†ÑÏ≤¥ Q&A Îç∞Ïù¥ÌÑ∞:', knowledgeBase.parsedData.length, 'Í∞ú');
            
            // ÏÉòÌîå Ï∂úÎ†• (ÎîîÎ≤ÑÍπÖÏö©)
            if (parsedQA.length > 0) {
                console.log('ÌååÏã± Í≤∞Í≥º ÏÉòÌîå:');
                parsedQA.slice(0, 2).forEach((qa, idx) => {
                    console.log(`${idx + 1}. Q: ${qa.question}`);
                    console.log(`   A: ${qa.answer.substring(0, 50)}...`);
                });
            }
        }

        function parseFileContent(fileData) {
            console.log('ÌååÏùº ÎÇ¥Ïö© ÌååÏã±:', fileData.name);
            
            const content = fileData.content;
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            const parsedQA = [];
            
            // Îã§ÏñëÌïú Q&A Ìå®ÌÑ¥ Ïù∏Ïãù
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let question = '';
                let answer = '';
                
                // Ìå®ÌÑ¥ 1: Q: ... A: ... ÌòïÌÉú
                const qaPattern1 = /^([Qq„ÖÇquentionQÎ¨∏ÏßàÎ¨∏][\:\.\s]*)\s*(.+)$/;
                const qaPattern2 = /^([AaAnswÎãµÎ≥ÄÎãµAÏùëÎãµ][\:\.\s]*)\s*(.+)$/;
                
                if (qaPattern1.test(line)) {
                    question = line.replace(qaPattern1, '$2').trim();
                    // Îã§Ïùå Ï§ÑÏóêÏÑú ÎãµÎ≥Ä Ï∞æÍ∏∞
                    for (let j = i + 1; j < lines.length; j++) {
                        const nextLine = lines[j];
                        if (qaPattern2.test(nextLine)) {
                            answer = nextLine.replace(qaPattern2, '$2').trim();
                            i = j; // Ïù∏Îç±Ïä§ ÏóÖÎç∞Ïù¥Ìä∏
                            break;
                        } else if (qaPattern1.test(nextLine)) {
                            // Îã§Ïùå ÏßàÎ¨∏Ïù¥ ÎÇòÏò§Î©¥ Ï§ëÎã®
                            break;
                        } else if (!qaPattern1.test(nextLine) && !qaPattern2.test(nextLine)) {
                            // ÏùºÎ∞ò ÌÖçÏä§Ìä∏Î©¥ ÎãµÎ≥ÄÏúºÎ°ú Í∞ÑÏ£º
                            answer = nextLine;
                            i = j;
                            break;
                        }
                    }
                }
                
                // Ìå®ÌÑ¥ 2: Ïà´Ïûê. ÏßàÎ¨∏ ÌòïÌÉú (1. ÏßÑÎ£åÏãúÍ∞ÑÏù¥ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?)
                const numberedPattern = /^(\d+[\.\)]\s*)(.+[\?Ôºü])\s*$/;
                if (numberedPattern.test(line)) {
                    question = line.replace(numberedPattern, '$2').trim();
                    // Îã§Ïùå Ï§ÑÏùÑ ÎãµÎ≥ÄÏúºÎ°ú Í∞ÑÏ£º
                    if (i + 1 < lines.length && !numberedPattern.test(lines[i + 1])) {
                        answer = lines[i + 1];
                        i++; // Îã§Ïùå Ï§Ñ Ïä§ÌÇµ
                    }
                }
                
                // Ìå®ÌÑ¥ 3: - ÏßàÎ¨∏ ÌòïÌÉú
                const dashPattern = /^[\-\‚Ä¢\*]\s*(.+[\?Ôºü])\s*$/;
                if (dashPattern.test(line)) {
                    question = line.replace(dashPattern, '$1').trim();
                    if (i + 1 < lines.length && !dashPattern.test(lines[i + 1])) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                
                // Ìå®ÌÑ¥ 4: ÏßàÎ¨∏ ÌÇ§ÏõåÎìúÍ∞Ä Ìè¨Ìï®Îêú ÎùºÏù∏
                const questionKeywords = ['Ïñ¥ÎñªÍ≤å', 'Ïñ∏Ï†ú', 'Ïñ¥ÎîîÏÑú', 'Ïôú', 'Î¨¥Ïóá', 'ÎàÑÍ∞Ä', 'ÏñºÎßà', 'Î™áÏãú', 'Ïñ¥Îñ§', '?', 'Ôºü'];
                if (questionKeywords.some(keyword => line.includes(keyword)) && line.length > 5) {
                    question = line;
                    // Îã§Ïùå Î™á Ï§ÑÏùÑ Ìï©Ï≥êÏÑú ÎãµÎ≥ÄÏúºÎ°ú ÏÇ¨Ïö©
                    let answerLines = [];
                    for (let j = i + 1; j < Math.min(i + 4, lines.length); j++) {
                        const nextLine = lines[j];
                        // Îã§Ïùå ÏßàÎ¨∏Ïù¥ ÎÇòÏò§Î©¥ Ï§ëÎã®
                        if (questionKeywords.some(keyword => nextLine.includes(keyword)) && nextLine.includes('?')) {
                            break;
                        }
                        answerLines.push(nextLine);
                        if (answerLines.join(' ').length > 100) break; // ÎÑàÎ¨¥ Í∏∏Î©¥ Ï§ëÎã®
                    }
                    if (answerLines.length > 0) {
                        answer = answerLines.join(' ');
                        i += answerLines.length;
                    }
                }
                
                // Ìå®ÌÑ¥ 5: Ï†úÎ™©: ÎÇ¥Ïö© ÌòïÌÉú
                const colonPattern = /^([^:Ôºö]+)[:Ôºö]\s*(.+)$/;
                if (colonPattern.test(line) && line.length > 10) {
                    const matches = line.match(colonPattern);
                    question = matches[1].trim();
                    answer = matches[2].trim();
                }
                
                // Ïú†Ìö®Ìïú Q&A ÏåçÏù¥Î©¥ Ï∂îÍ∞Ä
                if (question && answer && question.length > 3 && answer.length > 3) {
                    parsedQA.push({
                        question: question,
                        answer: answer,
                        source: fileData.name,
                        lineNumber: i + 1
                    });
                }
            }
            
            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä
            knowledgeBase.parsedData = knowledgeBase.parsedData.concat(parsedQA);
            knowledgeBase.enabled = knowledgeBase.parsedData.length > 0;
            
            console.log(`${fileData.name}ÏóêÏÑú ÌååÏã±Îêú Q&A:`, parsedQA.length, 'Í∞ú');
            console.log('Ï†ÑÏ≤¥ Q&A Îç∞Ïù¥ÌÑ∞:', knowledgeBase.parsedData.length, 'Í∞ú');
            
            // ÌååÏã± Í≤∞Í≥º ÎØ∏Î¶¨Î≥¥Í∏∞ (ÎîîÎ≤ÑÍπÖÏö©)
            if (parsedQA.length > 0) {
                console.log('ÌååÏã± Í≤∞Í≥º ÏÉòÌîå:', parsedQA.slice(0, 3));
            }
        }

        function updateFileList() {
            const fileListContainer = document.getElementById('fileList');
            fileListContainer.innerHTML = '';
            
            knowledgeBase.files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">üìÑ ${file.name}</div>
                        <div class="file-details">
                            ÌÅ¨Í∏∞: ${(file.size / 1024).toFixed(1)} KB | 
                            ÏóÖÎ°úÎìú: ${file.uploadTime.toLocaleString()}
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="file-btn btn-danger" onclick="removeFile(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                fileListContainer.appendChild(fileItem);
            });
        }

        function updateKnowledgeStatus() {
            const statusElement = document.getElementById('knowledgeStatus');
            const fileCount = knowledgeBase.files.length;
            const qaCount = knowledgeBase.parsedData.length;
            const status = knowledgeBase.enabled ? '‚úÖ ÌôúÏÑ±' : '‚ùå ÎπÑÌôúÏÑ±';
            
            let statusHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
                    <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 20px; font-weight: bold; color: #1976d2;">${fileCount}</div>
                        <div style="font-size: 12px; color: #666;">ÏóÖÎ°úÎìú ÌååÏùº</div>
                    </div>
                    <div style="background: #f3e5f5; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 20px; font-weight: bold; color: #7b1fa2;">${qaCount}</div>
                        <div style="font-size: 12px; color: #666;">ÌååÏã±Îêú Q&A</div>
                    </div>
                    <div style="background: ${knowledgeBase.enabled ? '#e8f5e8' : '#ffebee'}; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 16px; font-weight: bold; color: ${knowledgeBase.enabled ? '#2e7d32' : '#c62828'};">${status}</div>
                        <div style="font-size: 12px; color: #666;">ÏÉÅÌÉú</div>
                    </div>
                </div>
            `;
            
            if (knowledgeBase.enabled) {
                statusHTML += `
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 8px; border-left: 4px solid #4facfe;">
                        üéØ <strong>AI ÎãµÎ≥Ä Ïö∞ÏÑ†ÏàúÏúÑ</strong><br>
                        1Ï∞®: üìö ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº Í≤ÄÏÉâ<br>
                        2Ï∞®: ü§ñ AI API Î™®Îç∏ ÌôúÏö©<br>
                        3Ï∞®: üí° Í∏∞Î≥∏ FAQ ÏùëÎãµ
                    </div>
                `;
            } else {
                statusHTML += `
                    <div style="background: #fff3e0; padding: 10px; border-radius: 8px; border-left: 4px solid #ff9800;">
                        üí° <strong>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥</strong><br>
                        ÏπòÍ≥º Ï†ÑÎ¨∏ ÏßÄÏãùÏùÑ Î∞îÌÉïÏúºÎ°ú ÎçîÏö± Ï†ïÌôïÌïú AI ÏÉÅÎã¥Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§!
                    </div>
                `;
            }
            
            statusElement.innerHTML = statusHTML;
        }

        function removeFile(index) {
            console.log('ÌååÏùº ÏÇ≠Ï†ú:', index);
            knowledgeBase.files.splice(index, 1);
            
            // ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞ÎèÑ Ïû¨ÏÉùÏÑ±
            knowledgeBase.parsedData = [];
            knowledgeBase.files.forEach(file => {
                parseFileContent(file);
            });
            
            updateFileList();
            updateKnowledgeStatus();
        }

        // ÏßÄÏãùÎ≤†Ïù¥Ïä§ÏóêÏÑú ÎãµÎ≥Ä Í≤ÄÏÉâ (Îçî Í¥ÄÎåÄÌïú Î≤ÑÏ†Ñ)
        function searchInKnowledgeBase(userMessage) {
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                console.log('‚ùå ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎπÑÌôúÏÑ± ÎòêÎäî Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå - enabled:', knowledgeBase.enabled, 'dataLength:', knowledgeBase.parsedData.length);
                return null;
            }
            
            const message = userMessage.toLowerCase().trim();
            console.log('üîç ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ ÏãúÏûë:', message, '| Ï¥ù Îç∞Ïù¥ÌÑ∞:', knowledgeBase.parsedData.length);
            
            // Í≤ÄÏÉâ Í≤∞Í≥ºÎ•º Ï†êÏàòÎ≥ÑÎ°ú Ï†ÄÏû•
            let searchResults = [];
            
            for (let qa of knowledgeBase.parsedData) {
                const question = qa.question.toLowerCase();
                const answer = qa.answer.toLowerCase();
                let score = 0;
                let matchDetails = [];
                
                // 1. ÏôÑÏ†Ñ ÏùºÏπò (ÏµúÍ≥† Ï†êÏàò)
                if (question === message || answer.includes(message)) {
                    score += 1000;
                    matchDetails.push('ÏôÑÏ†ÑÏùºÏπò');
                }
                
                // 2. Î∂ÄÎ∂Ñ Î¨∏ÏûêÏó¥ Ìè¨Ìï® (ÎÜíÏùÄ Ï†êÏàò)
                if (question.includes(message) || message.includes(question)) {
                    score += 800;
                    matchDetails.push('Î∂ÄÎ∂ÑÌè¨Ìï®');
                }
                
                // 3. Í∞úÎ≥Ñ Îã®Ïñ¥ Îß§Ïπ≠ (Ï§ëÍ∞Ñ Ï†êÏàò)
                const messageWords = message.split(/\s+/).filter(word => word.length > 1);
                const questionWords = question.split(/\s+/).filter(word => word.length > 1);
                
                let wordMatches = 0;
                for (let word of messageWords) {
                    if (question.includes(word)) {
                        score += 200;
                        wordMatches++;
                    }
                    if (answer.includes(word)) {
                        score += 100;
                        wordMatches++;
                    }
                }
                
                if (wordMatches > 0) {
                    matchDetails.push(`Îã®Ïñ¥Îß§Ïπ≠(${wordMatches})`);
                }
                
                // 4. Ïú†ÏÇ¨ Îã®Ïñ¥ Îß§Ïπ≠
                for (let qWord of questionWords) {
                    for (let mWord of messageWords) {
                        if ((qWord.includes(mWord) || mWord.includes(qWord)) && mWord.length > 1) {
                            score += 50;
                        }
                    }
                }
                
                // 5. Ï£ºÏ†úÎ≥Ñ ÌÇ§ÏõåÎìú Îß§Ïπ≠ (Îçî Í¥ÄÎåÄÌïòÍ≤å)
                const topics = {
                    'ÏãúÍ∞Ñ': ['ÏãúÍ∞Ñ', 'Ïñ∏Ï†ú', 'Î™áÏãú', 'Ïò§Ìîà', 'Î¨∏Ïó¨', 'Ïö¥ÏòÅ', 'Í∑ºÎ¨¥', 'ÏßÑÎ£åÏãúÍ∞Ñ', 'Ïó¥Ïñ¥', 'Îã´Ïñ¥'],
                    'ÏòàÏïΩ': ['ÏòàÏïΩ', 'Ïã†Ï≤≠', 'Ï†ëÏàò', 'Î∞©Î¨∏', 'Í∞ÄÍ≥†Ïã∂', 'ÏÉÅÎã¥', 'ÏòàÏïΩÌïòÍ∏∞', 'Ïã†Ï≤≠ÌïòÍ∏∞', 'ÏòàÏïΩÎ¨∏Ïùò', 'Ïã†Ï≤≠Î¨∏Ïùò'],
                    'ÎπÑÏö©': ['ÎπÑÏö©', 'Í∞ÄÍ≤©', 'ÏñºÎßà', 'Îèà', 'Í∏àÏï°', 'Î£å', 'ÏàòÍ∞Ä', 'ÏπòÎ£åÎπÑ', 'ÏßÑÎ£åÎπÑ', 'ÏöîÍ∏à', 'Í∞í'],
                    'ÏúÑÏπò': ['ÏúÑÏπò', 'Ï£ºÏÜå', 'Ïñ¥Îîî', 'Ï∞æÏïÑ', 'Ïò§ÏãúÎäîÍ∏∏', 'ÍµêÌÜµ', 'Í∏∏', 'Ï∞æÍ∏∞', 'Ïñ¥ÎîîÏóê', 'Ïñ¥ÎäêÍ≥≥'],
                    'ÏπòÎ£å': ['ÏπòÎ£å', 'ÏãúÏà†', 'ÏàòÏà†', 'Ï≤òÏπò', 'ÏßÑÎ£å', 'ÏùòÎ£å', 'Î≥ëÏõê', 'ÏπòÍ≥º'],
                    'ÌÜµÏ¶ù': ['ÏïÑÌîÑ', 'ÌÜµÏ¶ù', 'ÏïÑÌîà', 'Ïì∞ÎùºÎ¶∞', 'Î∂àÌé∏', 'Í≥†ÌÜµ', 'ÏïÑÌåå'],
                    'ÏûÑÌîåÎûÄÌä∏': ['ÏûÑÌîåÎûÄÌä∏', 'Ïù∏Í≥µÏπòÏïÑ', 'Ïã¨Í∏∞', 'ÏãùÎ¶Ω', 'Ïù∏Í≥µ', 'ÎºàÏóê'],
                    'ÍµêÏ†ï': ['ÍµêÏ†ï', 'Î∏åÎùºÏºì', 'ÏπòÏó¥', 'Í∞ÄÏßÄÎü∞', 'Í≥†Î•¥Í≤å', 'Î∞òÎìØ', 'ÏÇêÎö§'],
                    'ÎØ∏Î∞±': ['ÎØ∏Î∞±', 'ÌïòÏñóÍ≤å', 'Ìù¨Í≤å', 'Î∞ùÍ≤å', 'ÌôîÏù¥Ìä∏Îãù', 'ÌïòÏñë'],
                    'Î≥¥Ï≤†': ['Î≥¥Ï≤†', 'ÌÅ¨ÎùºÏö¥', 'ÏîåÏö∞Í∏∞', 'ÏîåÏõå', 'ÎçÆÍ∞ú', 'ÎçÆÏñ¥'],
                    'ÏÜåÏïÑ': ['ÏÜåÏïÑ', 'Ïñ¥Î¶∞Ïù¥', 'ÏïÑÏù¥', 'ÏïÑÎèô', 'Ïú†ÏïÑ', 'Ïï†Í∏∞'],
                    'Ï∂©Ïπò': ['Ï∂©Ïπò', 'Ïö∞Ïãù', 'Ïç©', 'Î≤åÎ†à', 'Íµ¨Î©ç', 'ÍπåÎß£']
                };
                
                let topicMatches = 0;
                for (let [topic, keywords] of Object.entries(topics)) {
                    for (let keyword of keywords) {
                        if (message.includes(keyword)) {
                            if (question.includes(keyword) || answer.includes(keyword) || question.includes(topic)) {
                                score += 150; // Ï†êÏàò ÏÉÅÌñ•
                                topicMatches++;
                            }
                        }
                    }
                }
                
                if (topicMatches > 0) {
                    matchDetails.push(`Ï£ºÏ†úÎß§Ïπ≠(${topicMatches})`);
                }
                
                if (score > 0) {
                    searchResults.push({ qa, score, matchDetails });
                    console.log(`üìù Í≤ÄÏÉâ ÌõÑÎ≥¥: "${qa.question.substring(0, 40)}..." | Ï†êÏàò: ${score} | Îß§Ïπ≠: ${matchDetails.join(', ')}`);
                }
            }
            
            // Ï†êÏàòÎ≥Ñ Ï†ïÎ†¨
            searchResults.sort((a, b) => b.score - a.score);
            
            console.log(`üìä Ï¥ù Í≤ÄÏÉâ Í≤∞Í≥º: ${searchResults.length}Í∞ú`);
            if (searchResults.length > 0) {
                console.log(`üèÜ ÏµúÍ≥† Ï†êÏàò: ${searchResults[0].score} | ÏßàÎ¨∏: "${searchResults[0].qa.question}"`);
            }
            
            // ‚úÖ Ï†êÏàò Í∏∞Ï§ÄÏùÑ 30Ï†êÏúºÎ°ú ÎÇÆÏ∂§ (Îçî Í¥ÄÎåÄÌïòÍ≤å)
            if (searchResults.length > 0 && searchResults[0].score >= 30) {
                const bestMatch = searchResults[0].qa;
                console.log('‚úÖ ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎãµÎ≥Ä ÏÑ†ÌÉù:', bestMatch.question);
                return formatKnowledgeBaseAnswer(bestMatch, userMessage);
            }
            
            console.log('‚ùå ÏßÄÏãùÎ≤†Ïù¥Ïä§ÏóêÏÑú Ï†ÅÏ†àÌïú ÎãµÎ≥ÄÏùÑ Ï∞æÏßÄ Î™ªÌï® (ÏµúÍ≥†Ï†êÏàò:', searchResults.length > 0 ? searchResults[0].score : 0, ')');
            return null;
        }

        // ÏûêÎèô ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÌÖåÏä§Ìä∏ (ÌååÏùº ÏóÖÎ°úÎìú ÌõÑ Ïã§Ìñâ)
        function testKnowledgeBaseAuto() {
            console.log('üß™ ÏûêÎèô ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÌÖåÏä§Ìä∏ ÏãúÏûë');
            
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                console.log('‚ùå ÌÖåÏä§Ìä∏ Î∂àÍ∞Ä: ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎπÑÌôúÏÑ±');
                return;
            }
            
            // ÏóÖÎ°úÎìúÎêú Q&A Ï§ë Î™á Í∞úÎ•º Î¨¥ÏûëÏúÑÎ°ú ÌÖåÏä§Ìä∏
            const testQueries = [];
            
            // ÌååÏã±Îêú ÏßàÎ¨∏ Ï§ë ÏùºÎ∂ÄÎ•º ÌÖåÏä§Ìä∏ ÏøºÎ¶¨Î°ú ÏÇ¨Ïö©
            for (let i = 0; i < Math.min(3, knowledgeBase.parsedData.length); i++) {
                const qa = knowledgeBase.parsedData[i];
                const question = qa.question;
                
                // ÏßàÎ¨∏ÏóêÏÑú ÌïµÏã¨ ÌÇ§ÏõåÎìú Ï∂îÏ∂úÌï¥ÏÑú ÌÖåÏä§Ìä∏
                const keywords = question.toLowerCase().split(/\s+/).filter(word => 
                    word.length > 2 && !['Ïñ¥ÎñªÍ≤å', 'Ïñ∏Ï†ú', 'Ïñ¥ÎîîÏÑú', 'Ïôú', 'Î¨¥Ïóá', 'ÎàÑÍ∞Ä'].includes(word)
                );
                
                if (keywords.length > 0) {
                    testQueries.push(keywords[0]); // Ï≤´ Î≤àÏß∏ ÌÇ§ÏõåÎìúÎ°ú ÌÖåÏä§Ìä∏
                }
            }
            
            // Í∏∞Î≥∏ ÌÖåÏä§Ìä∏ ÌÇ§ÏõåÎìúÎèÑ Ï∂îÍ∞Ä
            testQueries.push('ÏßÑÎ£åÏãúÍ∞Ñ', 'ÏòàÏïΩ', 'ÎπÑÏö©');
            
            let successCount = 0;
            let testResults = [];
            
            testQueries.forEach(query => {
                const result = searchInKnowledgeBase(query);
                if (result) {
                    testResults.push(`‚úÖ "${query}" - ÎãµÎ≥Ä Î∞úÍ≤¨`);
                    successCount++;
                } else {
                    testResults.push(`‚ùå "${query}" - ÎãµÎ≥Ä ÏóÜÏùå`);
                }
            });
            
            const message = `üß™ ÏûêÎèô ÌÖåÏä§Ìä∏ ÏôÑÎ£å (${successCount}/${testQueries.length})\n${testResults.join('\n')}\n\n${successCount > 0 ? 'üéâ ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä Ï†ïÏÉÅ ÏûëÎèôÌï©ÎãàÎã§!' : '‚ö†Ô∏è ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâÏóê Î¨∏Ï†úÍ∞Ä ÏûàÏùÑ Ïàò ÏûàÏäµÎãàÎã§.'}`;
            
            showStatus('knowledgeSettingsStatus', message, successCount > 0 ? 'success' : 'error');
        }

        // ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎãµÎ≥ÄÏùÑ ÏπúÏ†àÌïòÍ≤å Ìè¨Îß∑ÌåÖ
        function formatKnowledgeBaseAnswer(qa, originalQuestion) {
            let formattedAnswer = qa.answer.trim();
            
            // Í∏∞Î≥∏ ÌÖçÏä§Ìä∏ Ìè¨Îß∑ÌåÖ
            formattedAnswer = formattedAnswer
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Î≤àÌò∏ÎÇò Î™©Î°ùÏù¥ ÏûàÏúºÎ©¥ Íµ¨Ï°∞Ìôî
            if (formattedAnswer.includes('1.') || formattedAnswer.includes('‚Ä¢') || formattedAnswer.includes('-')) {
                formattedAnswer = formattedAnswer
                    .replace(/(\d+\.)/g, '<br>$1')
                    .replace(/(‚Ä¢)/g, '<br>$1')
                    .replace(/^-/gm, '<br>‚Ä¢');
            }
            
            return `üìö <strong>ÌîºÎãâÏä§ ÏπòÍ≥º Ï†ÑÎ¨∏ ÏïàÎÇ¥</strong><br><br>
            ${formattedAnswer}<br><br>
            <div style="background: #f0f8ff; padding: 10px; border-radius: 8px; margin-top: 10px;">
                üí° <strong>Ï∂îÍ∞Ä ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏãúÎã§Î©¥:</strong><br>
                üìû Ï†ÑÌôîÏÉÅÎã¥: 070-1234-1234 (24ÏãúÍ∞Ñ)<br>
                üïò ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00<br>
                üìç ÏúÑÏπò: Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            </div><br>
            <small>üìñ Ï∂úÏ≤ò: ${qa.source} | Îçî Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî!</small>`;
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å
        console.log('Î™®Îì† Ìï®Ïàò Î°úÎìú ÏôÑÎ£å');
        console.log('Î°úÍ∑∏Ïù∏ Ìï®Ïàò ÌôïÏù∏:', typeof loginChatbotAdmin === 'function', typeof loginCustomerAdmin === 'function');

        // Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô Ìè¨Îß∑ÌåÖ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Î°úÎìú ÏôÑÎ£å - ÏòàÏïΩ ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî');
            
            // Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô Ìè¨Îß∑ÌåÖ
            setTimeout(() => {
                const phoneInput = document.getElementById('phoneNumber');
                if (phoneInput) {
                    phoneInput.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/[^0-9]/g, '');
                        if (value.length > 3 && value.length <= 7) {
                            value = value.replace(/(\d{3})(\d+)/, '$1-$2');
                        } else if (value.length > 7) {
                            value = value.replace(/(\d{3})(\d{4})(\d{0,4})/, '$1-$2-$3');
                        }
                        e.target.value = value;
                    });
                    console.log('Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô Ìè¨Îß∑ÌåÖ ÏÑ§Ï†ï ÏôÑÎ£å');
                }
            }, 100);
            
            // Ìï¥Ïãú/ÌååÎùºÎØ∏ÌÑ∞Î°ú Î∞îÎ°ú Î©îÎâ¥ Ïó¥Í∏∞
            const hash = window.location.hash;
            if (hash === '#reservation') {
                openReservation();
            }
        });

        // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ Ìï®Ïàò
        async function handleAdminLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const statusDiv = document.getElementById('loginStatus');
            
            if (!email || !password) {
                statusDiv.innerHTML = '<span style="color: red;">Ïù¥Î©îÏùºÍ≥º ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</span>';
                return;
            }
            
            statusDiv.innerHTML = '<span style="color: blue;">Î°úÍ∑∏Ïù∏ Ï§ë...</span>';
            
            try {
                // Netlify Functions ÏãúÎèÑ
                try {
                    const response = await fetch('/.netlify/functions/admin-login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, password })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.token) {
                        // Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ - ÌÜ†ÌÅ∞ÏùÑ sessionStorageÏóê Ï†ÄÏû•
                        sessionStorage.setItem('adminToken', data.token);
                        sessionStorage.setItem('adminEmail', email);
                        
                        statusDiv.innerHTML = '<span style="color: green;">‚úÖ Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!</span>';
                        
                        // ÌåùÏóÖ Îã´Í∏∞
                        setTimeout(() => {
                            closeAdminLoginPopup();
                            
                            // Î°úÍ∑∏Ïù∏ ÌÉÄÏûÖÏóê Îî∞Îùº Îã§Î•∏ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞
                            if (window.currentLoginType === 'customer') {
                                openCustomerAdmin();
                            } else if (window.currentLoginType === 'chatbot') {
                                openChatbotAdmin2();
                            }
                        }, 1000);
                        
                        return;
                    } else {
                        throw new Error(data.error || 'Netlify Functions Î°úÍ∑∏Ïù∏ Ïã§Ìå®');
                    }
                    
                } catch (netlifyError) {
                    console.log('Netlify Functions Ïã§Ìå®, ÏßÅÏ†ë Supabase Ïó∞Í≤∞ ÏãúÎèÑ:', netlifyError);
                    
                    // ÏßÅÏ†ë Supabase Ïó∞Í≤∞ (Netlify Functions Ïã§Ìå® Ïãú ÎåÄÏïà)
                    // Î≥¥ÏïàÏÉÅ ÌîÑÎ°†Ìä∏ÏóîÎìúÏóêÏÑú ÌÇ§ Ï†úÍ±∞ - Netlify FunctionsÎßå ÏÇ¨Ïö©
                    console.log('Netlify Functions Ïã§Ìå®Î°ú Ïù∏Ìï¥ ÏßÅÏ†ë Î°úÍ∑∏Ïù∏ Î∂àÍ∞ÄÎä•');
                    throw new Error('Netlify Functions Ïó∞Í≤∞ Ïã§Ìå® - Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî');
                    
                    // Netlify Functions Ïã§Ìå® Ïãú Î°úÍ∑∏Ïù∏ Î∂àÍ∞ÄÎä•
                    statusDiv.innerHTML = '<span style="color: red;">‚ùå ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå® - Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî</span>';
                }
                
            } catch (error) {
                console.error('Î°úÍ∑∏Ïù∏ Ïò§Î•ò:', error);
                statusDiv.innerHTML = '<span style="color: red;">‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</span>';
            }
        }

        // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÌåùÏóÖ Îã´Í∏∞
        function closeAdminLoginPopup() {
            document.getElementById('adminLoginPopup').style.display = 'none';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('loginStatus').innerHTML = '';
        }

        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏ Ìï®Ïàò
        function checkAdminLogin() {
            const token = sessionStorage.getItem('adminToken');
            return token ? true : false;
        }

        // Î°úÍ∑∏ÏïÑÏõÉ Ìï®Ïàò
        function logoutAdmin() {
            sessionStorage.removeItem('adminToken');
            sessionStorage.removeItem('adminEmail');
            alert('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.');
            location.reload();
        }
    </script>

    <!-- Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ ÌåùÏóÖ -->
    <div id="adminLoginPopup" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 15px; padding: 30px; max-width: 400px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <h3 style="text-align: center; margin-bottom: 25px; color: #2c3e50;">üîê Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏</h3>
            
            <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Ïù¥Î©îÏùº</label>
                    <input type="email" id="adminEmail" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" placeholder="Í¥ÄÎ¶¨Ïûê Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" id="adminPassword" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="closeAdminLoginPopup()" style="flex: 1; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">Ï∑®ÏÜå</button>
                    <button type="submit" style="flex: 1; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">Î°úÍ∑∏Ïù∏</button>
                </div>
            </form>
            
            <div id="loginStatus" style="margin-top: 15px; text-align: center; font-size: 14px;"></div>
        </div>
    </div>

</body>
</html>