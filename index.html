<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        /* Î∞∞ÎÑà Ïä§ÌÉÄÏùº */
        .top-banner, .bottom-banner {
            position: fixed;
            left: 0;
            right: 0;
            background: #ffd700;
            color: #333;
            padding: 15px 20px;
            text-align: center;
            z-index: 1000;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: bold;
            font-size: 18px;
        }

        .top-banner {
            top: 0;
            animation: pulse 2s infinite;
        }

        .bottom-banner {
            bottom: 0;
        }

        .top-banner:hover, .bottom-banner:hover {
            background: #ffed4e;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Î©îÏù∏ Ïª®ÌÖêÏ∏† */
        .container {
            max-width: 800px;
            margin: 70px auto 80px;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
        }

        .hospital-name {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }

        .hospital-description {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: left;
        }

        .hospital-description p {
            margin: 8px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .info-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .info-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .info-title::before {
            content: "üìã";
            margin-right: 10px;
        }

        .info-item {
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .time-info {
            color: #27ae60;
            font-weight: bold;
        }

        .location-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .address-text p {
            margin: 10px 0;
            font-size: 14px;
        }

        .map-container {
            min-height: 200px;
        }

        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .service-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .service-item:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .service-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .contact-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }

        .phone {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .address {
            opacity: 0.9;
        }

        /* Î°úÍ∑∏Ïù∏ Î≤ÑÌäº */
        .admin-buttons {
            text-align: center;
            margin-top: 30px;
        }

        .admin-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: #3d8bfe;
            transform: translateY(-2px);
        }

        .admin-btn.customer {
            background: #666;
        }

        .admin-btn.customer:hover {
            background: #555;
        }

        /* ÌåùÏóÖ ÌéòÏù¥ÏßÄ Í≥µÌÜµ Ïä§ÌÉÄÏùº */
        .popup-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }

        .popup-header {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .popup-content {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* ÏòàÏïΩ ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº */
        .reservation-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .reservation-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        /* Ï∫òÎ¶∞Îçî Ïä§ÌÉÄÏùº */
        .calendar-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            color: #666;
        }

        .calendar-nav button:hover {
            background: #f8f9fa;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0;
        }

        .calendar-day-header {
            text-align: center;
            padding: 10px 0;
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }

        .calendar-day-header:first-child {
            color: #e74c3c;
        }

        .calendar-day-header:last-child {
            color: #3498db;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #eee;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .calendar-day:hover:not(.disabled):not(.selected) {
            background: #f8f9fa;
        }

        .calendar-day.disabled {
            color: #ccc;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background: #4facfe;
            color: white;
            font-weight: bold;
        }

        .calendar-day.sunday {
            color: #e74c3c;
        }

        .calendar-day.saturday {
            color: #3498db;
        }

        /* ÏãúÍ∞Ñ ÏÑ†ÌÉù Ïä§ÌÉÄÏùº */
        .time-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .time-header {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .time-header::before {
            content: "üïê";
            margin-right: 8px;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .time-slot {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .time-slot:hover:not(.disabled):not(.selected) {
            border-color: #4facfe;
            background: #f0f8ff;
        }

        .time-slot.selected {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .time-slot.disabled {
            background: #f8f9fa;
            color: #ccc;
            cursor: not-allowed;
        }

        /* ÏòàÏïΩÏûê Ï†ïÎ≥¥ Ïä§ÌÉÄÏùº */
        .info-form-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .form-header {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .form-header::before {
            content: "üë§";
            margin-right: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .form-label .required {
            color: #e74c3c;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .form-input::placeholder {
            color: #999;
        }

        /* ÏòàÏïΩÌïòÍ∏∞ Î≤ÑÌäº */
        .reservation-submit {
            width: 100%;
            padding: 15px;
            background: #00aa82;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reservation-submit:hover {
            background: #008866;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 170, 130, 0.3);
        }

        .reservation-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÏòàÏïΩ ÌôïÏù∏ ÌåùÏóÖ */
        .confirmation-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .confirmation-content {
            background: white;
            border-radius: 20px;
            padding: 32px 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .confirmation-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .confirmation-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .confirmation-message {
            font-size: 16px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 30px;
        }

        .confirmation-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: left;
            margin-bottom: 30px;
        }

        .confirmation-details p {
            margin: 8px 0;
            font-size: 14px;
            color: #333;
        }

        .confirmation-details strong {
            color: #2c3e50;
        }

        .confirmation-note {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 30px;
            padding: 15px;
            background: #fffbeb;
            border-radius: 8px;
        }

        .confirmation-button {
            padding: 15px 40px;
            background: #00aa82;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirmation-button:hover {
            background: #008866;
            transform: translateY(-2px);
        }

        /* Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïä§ÌÉÄÏùº */
        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #2980b9;
        }

        .nav-btn.logout {
            background: #e74c3c;
        }

        .nav-btn.logout:hover {
            background: #c0392b;
        }

        .admin-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 20px;
        }

        /* API ÏÑ§Ï†ï Ïä§ÌÉÄÏùº */
        .api-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover {
            background: #3d8bfe;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
            white-space: pre-line;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ÌååÏùº ÏóÖÎ°úÎìú Ïä§ÌÉÄÏùº */
        .upload-area {
            border: 2px dashed #4facfe;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #3d8bfe;
            background: #f0f8ff;
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #f8fff8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-types {
            font-size: 12px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .file-details {
            font-size: 12px;
            color: #666;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .file-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        /* Ï±óÎ¥á Ïä§ÌÉÄÏùº */
        .chatbot-button {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(79, 172, 254, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            z-index: 1500;
            transition: all 0.3s;
            animation: chatbot-pulse 2s infinite;
        }

        .chatbot-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(79, 172, 254, 0.6);
        }

        @keyframes chatbot-pulse {
            0% { box-shadow: 0 4px 20px rgba(79, 172, 254, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(79, 172, 254, 0.8); }
            100% { box-shadow: 0 4px 20px rgba(79, 172, 254, 0.4); }
        }

        .chatbot-popup {
            position: fixed;
            bottom: 170px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 1600;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chatbot-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .chatbot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #e9ecef;
            color: #495057;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            font-size: 14px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 6px;
        }

        .message.user .message-content {
            background: #4facfe;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .chatbot-input {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .chatbot-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
        }

        .chatbot-input input:focus {
            border-color: #4facfe;
        }

        .chatbot-send {
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .chatbot-send:hover {
            background: #3d8bfe;
        }

        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-button {
            background: #f0f8ff;
            color: #4facfe;
            border: 1px solid #4facfe;
            border-radius: 15px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-button:hover {
            background: #4facfe;
            color: white;
        }

        .reservation-link-btn {
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
            transition: all 0.2s;
        }

        .reservation-link-btn:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .container {
                margin: 60px 10px 70px;
                padding: 10px;
            }
            
            .hospital-name {
                font-size: 24px;
            }
            
            .services {
                grid-template-columns: repeat(2, 1fr);
            }

            .location-info {
                grid-template-columns: 1fr;
            }
            
            .admin-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .admin-btn {
                width: 200px;
                margin: 5px 0;
            }

            .chatbot-popup {
                bottom: 170px;
                right: 10px;
                width: calc(100vw - 20px);
                max-width: 350px;
            }
            
            .chatbot-button {
                bottom: 90px;
                right: 15px;
            }

            .time-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .confirmation-content {
                padding: 24px 20px;
                max-width: 315px;
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- ÏÉÅÎã® ÏòàÏïΩ Î∞∞ÎÑà -->
    <div class="top-banner" onclick="openReservation()">
        üìÖ ÏßÄÍ∏à ÏòàÏïΩÌïòÍ∏∞
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="logo">ü¶∑</div>
            <h1 class="hospital-name">ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê</h1>
            <p class="subtitle">Í±¥Í∞ïÌïú ÎØ∏ÏÜå, Î∞ùÏùÄ ÎÇ¥ÏùºÏùÑ ÏúÑÌïú ÏπòÍ≥º</p>
            <div class="hospital-description">
                <p>üèÜ <strong>25ÎÖÑ Í≤ΩÎ†•Ïùò ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏ ÌôçÍ∏∏Îèô ÏõêÏû•ÎãòÏù¥ ÏßÅÏ†ë ÏßÑÎ£åÌï©ÎãàÎã§</strong></p>
                <p>‚ú® ÏµúÏã† Ïû•ÎπÑÏôÄ Î¨¥Í∑† ÏãúÏÑ§Î°ú ÏïàÏ†ÑÌïòÍ≥† Ï†ïÌôïÌïú ÏπòÎ£å</p>
                <p>üíù ÌôòÏûê Ï§ëÏã¨Ïùò ÎßûÏ∂§Ìòï ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω</p>
                <p>üéØ ÌÜµÏ¶ù ÏóÜÎäî ÏπòÎ£åÎ•º ÏúÑÌïú ÎîîÏßÄÌÑ∏ ÎßàÏ∑® ÏãúÏä§ÌÖú</p>
                <p>üìû <strong>24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä• (070-1234-1234)</strong></p>
            </div>
        </div>

        <!-- ÏúÑÏπò ÏïàÎÇ¥ -->
        <div class="info-section">
            <h2 class="info-title">Ï∞æÏïÑÏò§ÏãúÎäî Í∏∏</h2>
            <div class="location-info">
                <div class="address-text">
                    <p><strong>üìç Ï£ºÏÜå:</strong> ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏</p>
                    <p><strong>üöá ÏßÄÌïòÏ≤†:</strong> 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ</p>
                    <p><strong>üöå Î≤ÑÏä§:</strong> Í∞ïÎÇ®Ïó≠ Ï†ïÎ•òÏû• ÌïòÏ∞® ÌõÑ ÎèÑÎ≥¥ 3Î∂Ñ</p>
                    <p><strong>üöó Ï£ºÏ∞®:</strong> Í±¥Î¨º ÏßÄÌïò 1~3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)</p>
                </div>
                <div class="map-container">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3165.4823!2d127.0276!3d37.4979!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMzfCsDI5JzUyLjQiTiAxMjfCsDA2JzI3LjQiRQ!5e0!3m2!1sko!2skr!4v1234567890"
                        width="100%" 
                        height="200" 
                        style="border:0; border-radius: 10px;" 
                        allowfullscreen="" 
                        loading="lazy">
                    </iframe>
                </div>
            </div>
        </div>

        <!-- ÏßÑÎ£å ÏïàÎÇ¥ -->
        <div class="info-section">
            <h2 class="info-title">ÏßÑÎ£å ÏïàÎÇ¥</h2>
            <div class="info-item">
                <strong>ÌèâÏùº:</strong> <span class="time-info">09:00 ~ 18:00</span>
            </div>
            <div class="info-item">
                <strong>ÌÜ†ÏöîÏùº:</strong> <span class="time-info">09:00 ~ 15:00</span>
            </div>
            <div class="info-item">
                <strong>Ï†êÏã¨ÏãúÍ∞Ñ:</strong> 12:30 ~ 13:30
            </div>
            <div class="info-item">
                <strong>Ìú¥ÏßÑ:</strong> ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            </div>
        </div>

        <!-- ÏßÑÎ£å Í≥ºÎ™© -->
        <div class="info-section">
            <h2 class="info-title">ÏßÑÎ£å Í≥ºÎ™©</h2>
            <p style="color: #666; margin-bottom: 15px; font-size: 14px;">Í∞Å Ìï≠Î™©ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
            <div class="services">
                <div class="service-item" onclick="showServiceDetail('general')">
                    <div class="service-icon">ü¶∑</div>
                    <div>ÏùºÎ∞òÏßÑÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('whitening')">
                    <div class="service-icon">‚ú®</div>
                    <div>ÎØ∏Î∞±ÏπòÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('orthodontics')">
                    <div class="service-icon">üîß</div>
                    <div>ÍµêÏ†ïÏπòÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('implant')">
                    <div class="service-icon">ü¶¥</div>
                    <div>ÏûÑÌîåÎûÄÌä∏</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('prosthetic')">
                    <div class="service-icon">üëë</div>
                    <div>Î≥¥Ï≤†ÏπòÎ£å</div>
                </div>
                <div class="service-item" onclick="showServiceDetail('pediatric')">
                    <div class="service-icon">üßí</div>
                    <div>ÏÜåÏïÑÏπòÍ≥º</div>
                </div>
            </div>
        </div>

        <!-- Ïó∞ÎùΩÏ≤ò -->
        <div class="contact-info">
            <div class="phone">üìû 070-1234-1234</div>
            <div class="address">üìç ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏</div>
        </div>

        <!-- Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏ Î≤ÑÌäº -->
        <div class="admin-buttons">
            <button class="admin-btn" onclick="loginChatbotAdmin()">ü§ñ AIÏ±óÎ¥á Í¥ÄÎ¶¨ Î°úÍ∑∏Ïù∏</button>
            <button class="admin-btn customer" onclick="loginCustomerAdmin()">üë• Í≥†Í∞ù Í¥ÄÎ¶¨ Î°úÍ∑∏Ïù∏</button>
        </div>
    </div>

    <!-- ÌïòÎã® ÏòàÏïΩ Î∞∞ÎÑà -->
    <div class="bottom-banner" onclick="openReservation()">
        üìÖ ÏßÄÍ∏à ÏòàÏïΩÌïòÍ∏∞
    </div>

    <!-- AI Ï±óÎ¥á Î≤ÑÌäº -->
    <button class="chatbot-button" onclick="toggleChatbot()">
        ü§ñ
    </button>

    <!-- AI Ï±óÎ¥á ÌåùÏóÖ -->
    <div class="chatbot-popup" id="chatbotPopup">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <span>ü§ñ</span>
                <span>ÌîºÎãâÏä§ AI ÏÉÅÎã¥ÏÇ¨</span>
            </div>
            <button class="chatbot-close" onclick="closeChatbot()">‚úï</button>
        </div>
        
        <div class="chatbot-messages" id="chatbotMessages">
            <!-- Ï¥àÍ∏∞ ÌôòÏòÅ Î©îÏãúÏßÄ -->
            <div class="message bot">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    ÏïàÎÖïÌïòÏÑ∏Ïöî! ÌîºÎãâÏä§ ÏπòÍ≥º AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. üòä<br>
                    ÏπòÍ≥º Í¥ÄÎ†® Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî!
                    <div class="quick-buttons">
                        <button class="quick-button" onclick="sendQuickMessage('ÏßÑÎ£åÏãúÍ∞Ñ ÏïåÎ†§Ï£ºÏÑ∏Ïöî')">ÏßÑÎ£åÏãúÍ∞Ñ</button>
                        <button class="quick-button" onclick="sendQuickMessage('ÏòàÏïΩÌïòÍ≥† Ïã∂Ïñ¥Ïöî')">ÏòàÏïΩÎ¨∏Ïùò</button>
                        <button class="quick-button" onclick="sendQuickMessage('ÏπòÎ£åÎπÑÏö© Í∂ÅÍ∏àÌï¥Ïöî')">ÏπòÎ£åÎπÑÏö©</button>
                        <button class="quick-button" onclick="sendQuickMessage('ÏúÑÏπò ÏïåÎ†§Ï£ºÏÑ∏Ïöî')">Ïò§ÏãúÎäîÍ∏∏</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="chatbot-input">
            <textarea id="chatbotInput" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Shift+Enter: Ï†ÑÏÜ°)" onkeypress="handleChatKeyPress(event)" style="flex: 1; padding: 12px 15px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 14px; resize: none; min-height: 45px; max-height: 120px; font-family: inherit;"></textarea>
            <button class="chatbot-send" onclick="sendMessage()" style="min-width: 80px; border-radius: 25px; font-size: 14px;">
                Ï±ÑÌåÖ ÏûÖÎ†•
            </button>
        </div>
    </div>

    <!-- ÏòàÏïΩ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="reservationPage">
        <div class="popup-header">
            <h2>üìÖ ÏòàÏïΩ Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</h2>
            <button class="close-btn" onclick="closeReservation()">‚úï</button>
        </div>
        <div class="popup-content">
            <div class="reservation-container">
                <!-- Ï∫òÎ¶∞Îçî ÏÑπÏÖò -->
                <div class="calendar-section">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="previousMonth()">‚óÄ</button>
                        <div class="calendar-title" id="calendarTitle">2025ÎÖÑ 7Ïõî</div>
                        <button class="calendar-nav" onclick="nextMonth()">‚ñ∂</button>
                    </div>
                    <div class="calendar-grid">
                        <!-- ÏöîÏùº Ìó§Îçî -->
                        <div class="calendar-day-header">Ïùº</div>
                        <div class="calendar-day-header">Ïõî</div>
                        <div class="calendar-day-header">Ìôî</div>
                        <div class="calendar-day-header">Ïàò</div>
                        <div class="calendar-day-header">Î™©</div>
                        <div class="calendar-day-header">Í∏à</div>
                        <div class="calendar-day-header">ÌÜ†</div>
                        <!-- ÎÇ†ÏßúÎì§ÏùÄ JavaScriptÎ°ú ÏÉùÏÑ± -->
                    </div>
                </div>

                <!-- ÏãúÍ∞Ñ ÏÑ†ÌÉù ÏÑπÏÖò -->
                <div class="time-section" id="timeSection">
                    <div class="time-header">ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                    <div class="time-grid">
                        <div class="time-slot" onclick="selectTime(this, '09:00')">09:00</div>
                        <div class="time-slot" onclick="selectTime(this, '09:30')">09:30</div>
                        <div class="time-slot" onclick="selectTime(this, '10:00')">10:00</div>
                        <div class="time-slot" onclick="selectTime(this, '10:30')">10:30</div>
                        <div class="time-slot" onclick="selectTime(this, '11:00')">11:00</div>
                        <div class="time-slot" onclick="selectTime(this, '11:30')">11:30</div>
                        <div class="time-slot disabled">12:00</div>
                        <div class="time-slot disabled">12:30</div>
                        <div class="time-slot" onclick="selectTime(this, '13:30')">13:30</div>
                        <div class="time-slot" onclick="selectTime(this, '14:00')">14:00</div>
                        <div class="time-slot" onclick="selectTime(this, '14:30')">14:30</div>
                        <div class="time-slot" onclick="selectTime(this, '15:00')">15:00</div>
                        <div class="time-slot" onclick="selectTime(this, '15:30')">15:30</div>
                        <div class="time-slot" onclick="selectTime(this, '16:00')">16:00</div>
                        <div class="time-slot" onclick="selectTime(this, '16:30')">16:30</div>
                        <div class="time-slot" onclick="selectTime(this, '17:00')">17:00</div>
                        <div class="time-slot" onclick="selectTime(this, '17:30')">17:30</div>
                    </div>
                </div>

                <!-- ÏòàÏïΩÏûê Ï†ïÎ≥¥ ÏûÖÎ†• -->
                <div class="info-form-section" id="infoFormSection">
                    <div class="form-header">ÏòàÏïΩÏûê Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</div>
                    <form id="reservationForm" onsubmit="event.preventDefault(); submitReservation();">
                        <div class="form-group">
                            <label class="form-label">Ïù¥Î¶Ñ <span class="required">*</span></label>
                            <input type="text" class="form-input" id="userName" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÏÉùÎÖÑÏõîÏùº <span class="required">*</span></label>
                            <input type="text" class="form-input" id="birthDate" placeholder="Ïòà: 850101" maxlength="6" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ï†ÑÌôîÎ≤àÌò∏ <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="phoneNumber" placeholder="Ïòà: 010-1234-5678" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÏÉÅÎã¥ ÎÇ¥Ïö©</label>
                            <textarea class="form-input" id="consultContent" placeholder="ÏÉÅÎã¥ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" rows="3" style="resize:vertical;"></textarea>
                        </div>
                        <button class="reservation-submit" type="submit">ÏòàÏïΩÌïòÍ∏∞</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏòàÏïΩ ÌôïÏù∏ ÌåùÏóÖ -->
    <div class="confirmation-popup" id="confirmationPopup">
        <div class="confirmation-content">
            <div class="confirmation-icon">‚úÖ</div>
            <div class="confirmation-title">ÏòàÏïΩÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!</div>
            <div class="confirmation-message">
                Í≥†Í∞ùÎãòÏùò ÏòàÏïΩÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.<br>
                ÏïÑÎûò ÏòàÏïΩ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.
            </div>
            <div class="confirmation-details" id="confirmationDetails">
                <!-- ÏòàÏïΩ ÏÉÅÏÑ∏ Ï†ïÎ≥¥Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
            </div>
            <div class="confirmation-note">
                ÌîºÎãâÏä§ÏπòÍ≥º Ïó∞ÎùΩÏ≤ò 070-1234-1234<br>
                Î∞©Î¨∏Ï†ÑÍπåÏßÄ ÌôïÏù∏ Î∞è Ïó∞ÎùΩÏùÑ Ï∑®ÌïòÍ≤†ÏäµÎãàÎã§!<br>
                Í∑∏ Î∞ñÏùò Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ï±óÎ¥áÏùÑ Ïù¥Ïö©Ìï¥Ï£ºÏÑ∏Ïöî!
            </div>
            <button class="confirmation-button" onclick="closeConfirmation()">ÌôïÏù∏</button>
        </div>
    </div>

    <!-- ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="serviceDetailPage">
        <div class="popup-header">
            <h2 id="serviceDetailTitle">ÏßÑÎ£å Í≥ºÎ™© ÏÉÅÏÑ∏</h2>
            <button class="close-btn" onclick="closeServiceDetail()">‚úï</button>
        </div>
        <div class="popup-content" id="serviceDetailContent">
            <!-- ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
        </div>
    </div>

    <!-- AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="chatbotAdminPage">
        <div class="admin-header">
            <div class="admin-title">ü§ñ AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeChatbotAdmin()">üè† Î©îÏù∏ÏúºÎ°ú</button>
                <button class="nav-btn logout" onclick="closeChatbotAdmin()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- AI Î™®Îç∏ API ÏÑ§Ï†ï -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ü§ñ Ï±óÎ¥á AI Î™®Îç∏ Ïó∞Í≤∞ÌïòÍ∏∞</h3>
                </div>
                
                <div class="api-form">
                    <!-- ChatGPT ÏÑ§Ï†ï -->
                    <div class="form-group">
                        <label for="chatgptApiKey">ChatGPT API Key</label>
                        <input type="password" id="chatgptApiKey" placeholder="sk-proj-...">
                    </div>
                    <div class="form-group">
                        <label for="chatgptModel">ChatGPT Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="chatgptModel" onchange="toggleFinetuningInput('chatgpt')">
                            <option value="">-- ChatGPT Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="gpt-4o">GPT-4o (ÏµúÏã† Î©ÄÌã∞Î™®Îã¨)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (Í≤ΩÏ†úÏ†Å)</option>
                            <option value="finetuning">Finetuning Model (Ïª§Ïä§ÌÖÄ Î™®Îç∏)</option>
                        </select>
                    </div>
                    <div class="form-group" id="chatgptFinetuningGroup" style="display: none;">
                        <label for="chatgptFinetuningModel">Finetuning Î™®Îç∏Î™Ö ÏûÖÎ†•</label>
                        <input type="text" id="chatgptFinetuningModel" placeholder="ft:gpt-4o-mini-2024-07-18:...">
                    </div>

                    <!-- Gemini ÏÑ§Ï†ï -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="geminiApiKey">Gemini Î™®Îç∏ API Key</label>
                        <input type="password" id="geminiApiKey" placeholder="AIza...">
                    </div>
                    <div class="form-group">
                        <label for="geminiModel">Gemini Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="geminiModel">
                            <option value="">-- Gemini Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (Îπ†Î•∏ ÏùëÎãµ)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (Í≥†ÏÑ±Îä•)</option>
                            <option value="gemini-1.0-pro">Gemini 1.0 Pro (ÏïàÏ†ïÏÑ±)</option>
                        </select>
                    </div>

                    <!-- Claude ÏÑ§Ï†ï -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="claudeApiKey">Claude Î™®Îç∏ API Key</label>
                        <input type="password" id="claudeApiKey" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label for="claudeModel">Claude Î™®Îç∏ÏÑ†ÌÉù</label>
                        <select id="claudeModel">
                            <option value="">-- Claude Î™®Îç∏ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
                            <option value="claude-3-haiku">Claude 3 Haiku (Îπ†Î•¥Í≥† Ìö®Ïú®Ï†Å)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (Í∑†ÌòïÏ†Å ÏÑ±Îä•)</option>
                            <option value="claude-3-opus">Claude 3 Opus (ÏµúÍ≥† ÏÑ±Îä•)</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet (ÏµúÏã† Î™®Îç∏)</option>
                        </select>
                    </div>

                    <div class="btn-group" style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="saveApiSettings()">üíæ ÏÑ§Ï†ï Ï†ÄÏû•</button>
                        <button class="btn btn-success" onclick="testApiConnection()">üîó Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</button>
                        <button class="btn btn-danger" onclick="resetApiSettings()">üîÑ ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî</button>
                    </div>
                    <div id="apiStatus" class="status-message"></div>
                </div>
            </div>

            <!-- AI ÏßÄÏãù ÌååÏùº ÏóÖÎ°úÎìú -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>üìö AI ÏßÄÏãù ÌååÏùº ÏóÖÎ°úÎìú</h3>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ Ïó¨Í∏∞Î°ú ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</div>
                    <div class="upload-types">üí° <strong>ÏßÄÏõê ÌòïÏãù: ÌÖçÏä§Ìä∏ ÌååÏùº(.txt)</strong><br>
                    <small style="color: #666;">‚Äª PDF, Excel ÌååÏùºÏùÄ ÎÇ¥Ïö©ÏùÑ Î≥µÏÇ¨Ìï¥ÏÑú ÌÖçÏä§Ìä∏ ÌååÏùºÎ°ú Ï†ÄÏû• ÌõÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî</small></div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".txt" multiple onchange="handleFileUpload(event)">
                
                <div class="file-list" id="fileList">
                    <!-- ÏóÖÎ°úÎìúÎêú ÌååÏùºÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
                
                <div id="knowledgeStatus" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                    üìñ ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº: 0Í∞ú | ÏÉÅÌÉú: ÎπÑÌôúÏÑ±
                </div>
                
                <!-- ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû• Î≤ÑÌäº -->
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveKnowledgeSettings()">üíæ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•</button>
                    <button class="btn btn-primary" onclick="testKnowledgeBase()">üîç ÏßÄÏãù Í≤ÄÏÉâ ÌÖåÏä§Ìä∏</button>
                    <button class="btn" style="background: #17a2b8; color: white;" onclick="showParsedData()">üìã ÌååÏã±Îêú Q&A Î≥¥Í∏∞</button>
                    <button class="btn btn-danger" onclick="clearAllKnowledge()">üóëÔ∏è Î™®Îì† ÏßÄÏãù ÏÇ≠Ï†ú</button>
                </div>
                <div id="knowledgeSettingsStatus" class="status-message"></div>
                
                <!-- ÌååÏã±Îêú Q&A ÌëúÏãú ÏòÅÏó≠ -->
                <div id="parsedDataView" style="display: none; margin-top: 20px; background: white; border-radius: 10px; padding: 20px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">üìã ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞</h4>
                    <div id="parsedDataContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Í≥†Í∞ù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
    <div class="popup-page" id="customerAdminPage">
        <div class="admin-header">
            <div class="admin-title">üë• ÌîºÎãâÏä§ÏπòÍ≥º Í≥†Í∞ù Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeCustomerAdmin()">üè† Î©îÏù∏ÏúºÎ°ú</button>
                <button class="nav-btn logout" onclick="closeCustomerAdmin()">Î°úÍ∑∏ÏïÑÏõÉ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalReservations">0</div>
                    <div class="stat-label">Ï¥ù ÏòàÏïΩ Ïàò</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayReservations">0</div>
                    <div class="stat-label">Ïò§Îäò ÏòàÏïΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="thisWeekReservations">0</div>
                    <div class="stat-label">Ïù¥Î≤àÏ£º ÏòàÏïΩ</div>
                </div>
            </div>

            <!-- ÏòàÏïΩ Î™ÖÎã® -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>üìã ÏòàÏïΩ Î™ÖÎã®</h3>
                    <button class="btn btn-success" onclick="downloadExcel()">
                        üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú
                    </button>
                </div>
                
                <table class="data-table" id="reservationTable">
                    <thead>
                        <tr>
                            <th>ÏàúÎ≤à</th>
                            <th>ÏòàÏïΩÏûêÎ™Ö</th>
                            <th>ÏÉùÎÖÑÏõîÏùº</th>
                            <th>Ï†ÑÌôîÎ≤àÌò∏</th>
                            <th>ÏòàÏïΩÎÇ†Ïßú</th>
                            <th>ÏòàÏïΩÏãúÍ∞Ñ</th>
                            <th>ÏÉÅÎã¥ÎÇ¥Ïö©</th>
                            <th>ÏòàÏïΩÏùºÏãú</th>
                        </tr>
                    </thead>
                    <tbody id="reservationTableBody">
                        <!-- ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Î∞îÎ°úÍ∞ÄÍ∏∞ ÎßÅÌÅ¨ ÏïàÎÇ¥ -->
    <div style="background: #f0f8ff; padding: 12px 0; text-align: center; font-size: 15px;">
        <strong>Î∞îÎ°úÍ∞ÄÍ∏∞ ÎßÅÌÅ¨:</strong>
        <a href="#reservation" style="margin: 0 10px; color: #007bff; text-decoration: underline;">ÏòàÏïΩÌïòÍ∏∞ Î∞îÎ°úÍ∞ÄÍ∏∞</a>
        |
        <a href="#chatbot" style="margin: 0 10px; color: #007bff; text-decoration: underline;">AIÏ±óÎ¥á Î∞îÎ°úÍ∞ÄÍ∏∞</a>
    </div>

    <script>
        console.log('ÌéòÏù¥ÏßÄ Î°úÎìú ÏãúÏûë');

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let chatbotOpen = false;
        let currentYear = 2025;
        let currentMonth = 6; // 7Ïõî (0Î∂ÄÌÑ∞ ÏãúÏûë)
        let selectedDate = null;
        let selectedTime = null;
        let reservations = [];
        
        // API ÏÑ§Ï†ï Í¥ÄÎ†® Î≥ÄÏàòÎì§
        let apiSettings = {
            chatgpt: {
                apiKey: '',
                model: '',
                enabled: false
            },
            gemini: {
                apiKey: '',
                model: '',
                enabled: false
            },
            claude: {
                apiKey: '',
                model: '',
                enabled: false
            },
            activeProvider: ''
        };
        let knowledgeBase = {
            files: [],
            content: '',
            parsedData: [],
            enabled: false
        };

        // Î°úÍ∑∏Ïù∏ Ìï®ÏàòÎì§
        function loginChatbotAdmin() {
            console.log('AI Ï±óÎ¥á Í¥ÄÎ¶¨ Î°úÍ∑∏Ïù∏ ÌÅ¥Î¶≠Îê®');
            const username = prompt("AI Ï±óÎ¥á Í¥ÄÎ¶¨Ïûê ÏïÑÏù¥ÎîîÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
            if (username === "phoenix") {
                const password = prompt("ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
                if (password === "phoenix") {
                    openChatbotAdmin();
                } else {
                    alert("ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.");
                }
            } else if (username !== null) {
                alert("ÏïÑÏù¥ÎîîÍ∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.");
            }
        }

        function loginCustomerAdmin() {
            console.log('Í≥†Í∞ù Í¥ÄÎ¶¨ Î°úÍ∑∏Ïù∏ ÌÅ¥Î¶≠Îê®');
            const username = prompt("Í≥†Í∞ù Í¥ÄÎ¶¨Ïûê ÏïÑÏù¥ÎîîÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
            if (username === "phoenix") {
                const password = prompt("ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
                if (password === "phoenix") {
                    openCustomerAdmin();
                    updateReservationStats();
                    displayReservations();
                } else {
                    alert("ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.");
                }
            } else if (username !== null) {
                alert("ÏïÑÏù¥ÎîîÍ∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.");
            }
        }

        // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ Ïó¥Í∏∞/Îã´Í∏∞
        function openChatbotAdmin() {
            console.log('AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞');
            document.getElementById('chatbotAdminPage').style.display = 'block';
        }

        function closeChatbotAdmin() {
            console.log('AI Ï±óÎ¥á Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Îã´Í∏∞');
            document.getElementById('chatbotAdminPage').style.display = 'none';
        }

        function openCustomerAdmin() {
            console.log('Í≥†Í∞ù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞');
            document.getElementById('customerAdminPage').style.display = 'block';
        }

        function closeCustomerAdmin() {
            console.log('Í≥†Í∞ù Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ Îã´Í∏∞');
            document.getElementById('customerAdminPage').style.display = 'none';
        }

        // ÏòàÏïΩ ÌéòÏù¥ÏßÄ
        function openReservation() {
            console.log('ÏòàÏïΩ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞');
            document.getElementById('reservationPage').style.display = 'block';
            renderCalendar();
        }

        function closeReservation() {
            console.log('ÏòàÏïΩ ÌéòÏù¥ÏßÄ Îã´Í∏∞');
            document.getElementById('reservationPage').style.display = 'none';
            resetReservationForm();
        }

        // ÏòàÏïΩ Ìèº Ï¥àÍ∏∞Ìôî
        function resetReservationForm() {
            selectedDate = null;
            selectedTime = null;
            document.getElementById('userName').value = '';
            document.getElementById('birthDate').value = '';
            document.getElementById('phoneNumber').value = '';
            document.getElementById('consultContent').value = '';
            document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.time-slot.selected').forEach(el => el.classList.remove('selected'));
        }

        // Ï∫òÎ¶∞Îçî Î†åÎçîÎßÅ
        function renderCalendar() {
            const calendarGrid = document.querySelector('.calendar-grid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            // ÏöîÏùº Ìó§Îçî Ïú†ÏßÄÌïòÍ≥† ÎÇ†ÏßúÎßå Ï†úÍ±∞
            const dayHeaders = calendarGrid.querySelectorAll('.calendar-day-header');
            calendarGrid.innerHTML = '';
            dayHeaders.forEach(header => calendarGrid.appendChild(header));
            
            // ÌòÑÏû¨ ÎÇ†Ïßú
            const today = new Date();
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const firstDayOfWeek = firstDay.getDay();
            
            // Ï∫òÎ¶∞Îçî Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            calendarTitle.textContent = `${currentYear}ÎÖÑ ${currentMonth + 1}Ïõî`;
            
            // Îπà Ïπ∏ Ï±ÑÏö∞Í∏∞
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'calendar-day disabled';
                calendarGrid.appendChild(emptyDiv);
            }
            
            // ÎÇ†Ïßú Ï±ÑÏö∞Í∏∞
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;
                
                const date = new Date(currentYear, currentMonth, day);
                const dayOfWeek = date.getDay();
                
                // ÏöîÏùºÏóê Îî∞Î•∏ ÏÉâÏÉÅ
                if (dayOfWeek === 0) dayDiv.classList.add('sunday');
                if (dayOfWeek === 6) dayDiv.classList.add('saturday');
                
                // Í≥ºÍ±∞ ÎÇ†Ïßú, ÏùºÏöîÏùº ÎπÑÌôúÏÑ±Ìôî
                if (date < today || dayOfWeek === 0) {
                    dayDiv.classList.add('disabled');
                } else {
                    dayDiv.onclick = () => selectDate(day);
                }
                
                calendarGrid.appendChild(dayDiv);
            }
        }

        // ÎÇ†Ïßú ÏÑ†ÌÉù
        function selectDate(day) {
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ï†úÍ±∞
            document.querySelectorAll('.calendar-day.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // ÏÉàÎ°úÏö¥ ÏÑ†ÌÉù
            event.target.classList.add('selected');
            selectedDate = new Date(currentYear, currentMonth, day);
            
            // ÏãúÍ∞Ñ ÏÑ†ÌÉù ÏÑπÏÖò ÌëúÏãú
            document.getElementById('timeSection').style.display = 'block';
            document.querySelector('.popup-header h2').textContent = 'üïê ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
            
            // ÌÜ†ÏöîÏùºÏù∏ Í≤ΩÏö∞ Ïò§ÌõÑ ÏãúÍ∞Ñ ÎπÑÌôúÏÑ±Ìôî
            updateTimeSlots();
        }

        // ÏãúÍ∞ÑÎåÄ ÏóÖÎç∞Ïù¥Ìä∏
        function updateTimeSlots() {
            const timeSlots = document.querySelectorAll('.time-slot');
            const isSaturday = selectedDate.getDay() === 6;
            
            timeSlots.forEach(slot => {
                const time = slot.textContent;
                const hour = parseInt(time.split(':')[0]);
                
                // ÌÜ†ÏöîÏùº 15Ïãú Ïù¥ÌõÑ ÎπÑÌôúÏÑ±Ìôî
                if (isSaturday && hour >= 15) {
                    slot.classList.add('disabled');
                    slot.onclick = null;
                } else if (!time.includes('12:')) { // Ï†êÏã¨ÏãúÍ∞ÑÏù¥ ÏïÑÎãå Í≤ΩÏö∞
                    slot.classList.remove('disabled');
                    slot.onclick = function() { selectTime(this, time); };
                }
            });
        }

        // ÏãúÍ∞Ñ ÏÑ†ÌÉù
        function selectTime(element, time) {
            document.querySelectorAll('.time-slot.selected').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedTime = time;
        }

        // Ïù¥Ï†Ñ/Îã§Ïùå Îã¨
        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        // ÏòàÏïΩ Ï†úÏ∂ú
        function submitReservation() {
            const userName = document.getElementById('userName').value.trim();
            const birthDate = document.getElementById('birthDate').value.trim();
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const consultContent = document.getElementById('consultContent').value.trim();
            if (!userName || !birthDate || !phoneNumber) {
                alert('Î™®Îì† Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            if (birthDate.length !== 6 || isNaN(birthDate)) {
                alert('ÏÉùÎÖÑÏõîÏùºÏùÄ 6ÏûêÎ¶¨ Ïà´ÏûêÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (Ïòà: 850101)');
                return;
            }
            const phoneRegex = /^010-\d{4}-\d{4}$/;
            if (!phoneRegex.test(phoneNumber)) {
                alert('Ï†ÑÌôîÎ≤àÌò∏Îäî 010-0000-0000 ÌòïÏãùÏúºÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            const reservation = {
                id: reservations.length + 1,
                name: userName,
                birthDate: birthDate,
                phone: phoneNumber,
                date: selectedDate,
                time: selectedTime,
                consult: consultContent,
                createdAt: new Date()
            };
            reservations.push(reservation);
            showConfirmation(reservation);
        }

        // ÏòàÏïΩ ÌôïÏù∏ ÌåùÏóÖ ÌëúÏãú
        function showConfirmation(reservation) {
            const details = document.getElementById('confirmationDetails');
            const dateStr = `${reservation.date.getFullYear()}. ${reservation.date.getMonth() + 1}. ${reservation.date.getDate()}.`;
            details.innerHTML = `
                <p><strong>ÏòàÏïΩÏûê:</strong> ${reservation.name}</p>
                <p><strong>ÏÉùÎÖÑÏõîÏùº:</strong> ${reservation.birthDate}</p>
                <p><strong>Ï†ÑÌôîÎ≤àÌò∏:</strong> ${reservation.phone}</p>
                <p><strong>ÏòàÏïΩ ÎÇ†Ïßú:</strong> ${dateStr}</p>
                <p><strong>ÏòàÏïΩ ÏãúÍ∞Ñ:</strong> ${reservation.time}</p>
                <p><strong>ÏÉÅÎã¥ ÎÇ¥Ïö©:</strong> ${reservation.consult ? reservation.consult.replace(/\n/g, '<br>') : ''}</p>
            `;
            document.querySelector('.confirmation-title').textContent = 'Í≥†Í∞ùÎãòÏùò ÏòàÏïΩÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.';
            document.querySelector('.confirmation-message').innerHTML = 'ÏïÑÎûò ÏòàÏïΩ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.<br><br>';
            document.querySelector('.confirmation-note').innerHTML = `ÌîºÎãâÏä§ÏπòÍ≥º Ïó∞ÎùΩÏ≤ò 070-1234-1234<br>Î∞©Î¨∏ ÌïòÏãúÍ∏∞ Ï†Ñ Ïù¥ÎùºÎèÑ Ïñ∏Ï†úÎì† Ïó∞ÎùΩÏ£ºÏÑ∏Ïöî <br>Ï£ºÎßêÏù¥ÎÇò ÌèâÏùº ÏóÖÎ¨¥ÏãúÍ∞Ñ Ïù¥ÌõÑÏóêÎäî AIÏ±óÎ¥áÏùÑ Ïù¥Ïö©Ìï¥Ï£ºÏÑ∏Ïöî!`;
            document.getElementById('confirmationPopup').style.display = 'flex';
            closeReservation();
        }

        // ÏòàÏïΩ ÌôïÏù∏ ÌåùÏóÖ Îã´Í∏∞
        function closeConfirmation() {
            document.getElementById('confirmationPopup').style.display = 'none';
            updateReservationStats();
        }

        // ÏòàÏïΩ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateReservationStats() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const thisWeekStart = new Date(today);
            thisWeekStart.setDate(today.getDate() - today.getDay());
            
            const todayReservations = reservations.filter(r => {
                const rDate = new Date(r.date);
                rDate.setHours(0, 0, 0, 0);
                return rDate.getTime() === today.getTime();
            });
            
            const thisWeekReservations = reservations.filter(r => {
                const rDate = new Date(r.date);
                return rDate >= thisWeekStart;
            });
            
            document.getElementById('totalReservations').textContent = reservations.length;
            document.getElementById('todayReservations').textContent = todayReservations.length;
            document.getElementById('thisWeekReservations').textContent = thisWeekReservations.length;
        }

        // ÏòàÏïΩ Î™©Î°ù ÌëúÏãú
        function displayReservations() {
            const tbody = document.getElementById('reservationTableBody');
            tbody.innerHTML = '';
            
            reservations.forEach(reservation => {
                const row = document.createElement('tr');
                const dateStr = `${reservation.date.getFullYear()}-${String(reservation.date.getMonth() + 1).padStart(2, '0')}-${String(reservation.date.getDate()).padStart(2, '0')}`;
                const createdStr = `${reservation.createdAt.getFullYear()}-${String(reservation.createdAt.getMonth() + 1).padStart(2, '0')}-${String(reservation.createdAt.getDate()).padStart(2, '0')} ${String(reservation.createdAt.getHours()).padStart(2, '0')}:${String(reservation.createdAt.getMinutes()).padStart(2, '0')}`;
                
                row.innerHTML = `
                    <td>${reservation.id}</td>
                    <td>${reservation.name}</td>
                    <td>${reservation.birthDate}</td>
                    <td>${reservation.phone}</td>
                    <td>${dateStr}</td>
                    <td>${reservation.time}</td>
                    <td>${reservation.consult ? reservation.consult.replace(/\n/g, '<br>') : ''}</td>
                    <td>${createdStr}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ
        function showServiceDetail(serviceType) {
            console.log('ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïó¥Í∏∞:', serviceType);
            
            const services = {
                general: {
                    title: 'ü¶∑ ÏùºÎ∞òÏßÑÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üîç Ï†ïÎ∞Ä Í≤ÄÏßÑ Î∞è ÏßÑÎã®</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 3D ÎîîÏßÄÌÑ∏ ÌååÎÖ∏ÎùºÎßà Ï¥¨ÏòÅÏúºÎ°ú Ï†ïÌôïÌïú ÏßÑÎã®</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Íµ¨Í∞ï ÎÇ¥ Ïπ¥Î©îÎùºÎ•º Ïù¥Ïö©Ìïú ÏÉÅÏÑ∏ Í≤ÄÏÇ¨</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏπòÏïÑ Ïö∞ÏãùÏ¶ù(Ï∂©Ïπò) Ï°∞Í∏∞ Î∞úÍ≤¨ Î∞è ÏπòÎ£å</li>
                                <li style="padding: 8px 0;">‚úì ÏûáÎ™∏Î≥ë(ÏπòÏ£ºÏóº) ÏòàÎ∞© Î∞è ÏπòÎ£å</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÏßÑÎ£åÎπÑ ÏïàÎÇ¥</h4>
                            <p>Ï¥àÏßÑÎ£å: 15,000Ïõê | Ïû¨ÏßÑÎ£å: 10,000Ïõê</p>
                            <p>Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                whitening: {
                    title: '‚ú® ÎØ∏Î∞±ÏπòÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üíé Ï†ÑÎ¨∏Í∞Ä ÎØ∏Î∞± ÏãúÏà†</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 1Ìöå ÏãúÏà†Î°ú 3-8Îã®Í≥Ñ Î∞ùÏïÑÏßÄÎäî Ìö®Í≥º</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏïàÏ†ÑÌïú Í≥ºÏÇ∞ÌôîÏàòÏÜå Ï†§ ÏÇ¨Ïö©</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì LED Í¥ëÏÑ†ÏùÑ Ïù¥Ïö©Ìïú Îπ†Î•∏ ÎØ∏Î∞±</li>
                                <li style="padding: 8px 0;">‚úì ÏãúÏà† ÌõÑ Ï¶âÏãú Ìö®Í≥º ÌôïÏù∏ Í∞ÄÎä•</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÎØ∏Î∞± ÏπòÎ£åÎπÑ</h4>
                            <p>Ï†ÑÎ¨∏Í∞Ä ÎØ∏Î∞±: 300,000Ïõê</p>
                            <p>ÌôàÏºÄÏñ¥ ÎØ∏Î∞±: 200,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                orthodontics: {
                    title: 'üîß ÍµêÏ†ïÏπòÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üìè Ï†ïÎ∞Ä ÍµêÏ†ï ÏßÑÎã®</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 3D Íµ¨Í∞ï Ïä§Ï∫îÏùÑ ÌÜµÌïú Ï†ïÌôïÌïú Î∂ÑÏÑù</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÍµêÏ†ï Í≥ÑÌöç ÏàòÎ¶Ω</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏπòÎ£å Ï†ÑÌõÑ ÏòàÏÉÅ Î™®Ïäµ ÏãúÎÆ¨Î†àÏù¥ÏÖò</li>
                                <li style="padding: 8px 0;">‚úì Î∂ÄÎ∂ÑÍµêÏ†ïÎ∂ÄÌÑ∞ Ï†ÑÏ≤¥ÍµêÏ†ïÍπåÏßÄ</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÍµêÏ†ï ÏπòÎ£åÎπÑ</h4>
                            <p>Î∂ÄÎ∂ÑÍµêÏ†ï: 1,500,000Ïõê</p>
                            <p>Ï†ÑÏ≤¥ÍµêÏ†ï: 3,500,000Ïõê ~ 6,000,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                implant: {
                    title: 'ü¶¥ ÏûÑÌîåÎûÄÌä∏',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üè• Ï≤®Îã® ÏûÑÌîåÎûÄÌä∏ ÏãúÏà†</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì 3D CT Ï¥¨ÏòÅÏúºÎ°ú Ï†ïÎ∞ÄÌïú ÏãùÎ¶Ω ÏúÑÏπò Í≤∞Ï†ï</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÎîîÏßÄÌÑ∏ Í∞ÄÏù¥ÎìúÎ•º Ïù¥Ïö©Ìïú ÏïàÏ†ÑÌïú ÏàòÏà†</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏûÑÌîåÎûÄÌä∏ ÌîºÏä§Ï≤ò ÏÇ¨Ïö©</li>
                                <li style="padding: 8px 0;">‚úì Î¨¥Ï†àÍ∞ú ÏàòÏà†Î°ú Îπ†Î•∏ ÌöåÎ≥µ</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÏûÑÌîåÎûÄÌä∏ ÎπÑÏö©</h4>
                            <p>ÏùºÎ∞ò ÏûÑÌîåÎûÄÌä∏: 1,200,000Ïõê</p>
                            <p>ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏûÑÌîåÎûÄÌä∏: 1,500,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                prosthetic: {
                    title: 'üëë Î≥¥Ï≤†ÏπòÎ£å',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üëë Ï†ïÎ∞Ä Î≥¥Ï≤† Ï†úÏûë</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÏßÄÎ•¥ÏΩîÎãàÏïÑ ÌÅ¨ÎùºÏö¥ÏúºÎ°ú ÏûêÏó∞Ïä§Îü¨Ïö¥ ÏÉâÏÉÅ</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì CAD/CAM ÏãúÏä§ÌÖúÏúºÎ°ú Ï†ïÎ∞Ä Ï†úÏûë</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Í∞úÏù∏Î≥Ñ ÏπòÏïÑ ÏÉâÏÉÅ Îß§Ïπ≠</li>
                                <li style="padding: 8px 0;">‚úì Ïò§Îûò ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî ÎÇ¥Íµ¨ÏÑ±</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ Î≥¥Ï≤† ÏπòÎ£åÎπÑ</h4>
                            <p>ÏßÄÎ•¥ÏΩîÎãàÏïÑ ÌÅ¨ÎùºÏö¥: 800,000Ïõê</p>
                            <p>Î∏åÎ¶øÏßÄ(3Î≥∏): 2,400,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                },
                pediatric: {
                    title: 'üßí ÏÜåÏïÑÏπòÍ≥º',
                    content: `
                        <div style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">üë∂ Ïñ¥Î¶∞Ïù¥ Ï†ÑÏö© ÏßÑÎ£å</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Ïñ¥Î¶∞Ïù¥ ÏπúÌôîÏ†ÅÏù∏ ÏßÑÎ£å ÌôòÍ≤Ω</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì ÎÜÄÏù¥Î•º ÌÜµÌïú ÏπòÎ£å Í≥µÌè¨Í∞ê Ìï¥ÏÜå</li>
                                <li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;">‚úì Î¨¥Ìï¥Ìïú ÎßàÏ∑®Ï†ú ÏÇ¨Ïö©</li>
                                <li style="padding: 8px 0;">‚úì Î∂ÄÎ™®ÎãòÍ≥º Ìï®Íªò ÏßÑÎ£å Í∞ÄÎä•</li>
                            </ul>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center;">
                            <h4 style="margin-bottom: 15px;">üí∞ ÏÜåÏïÑ ÏπòÎ£åÎπÑ</h4>
                            <p>Ïñ¥Î¶∞Ïù¥ Í≤ÄÏßÑ: 10,000Ïõê</p>
                            <p>Ïã§ÎûÄÌä∏(1Í∞ú): 30,000Ïõê</p>
                        </div>
                        <button class="btn btn-primary" onclick="closeServiceDetail()" style="width: 100%; margin-top: 20px; padding: 15px;">üè† Î©îÏù∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                    `
                }
            };
            
            if (services[serviceType]) {
                document.getElementById('serviceDetailTitle').textContent = services[serviceType].title;
                document.getElementById('serviceDetailContent').innerHTML = services[serviceType].content;
                document.getElementById('serviceDetailPage').style.display = 'block';
            }
        }

        function closeServiceDetail() {
            console.log('ÏÑúÎπÑÏä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Îã´Í∏∞');
            document.getElementById('serviceDetailPage').style.display = 'none';
        }

        // Ï±óÎ¥á Ìï®ÏàòÎì§
        function toggleChatbot() {
            console.log('Ï±óÎ¥á ÌÜ†Í∏Ä');
            const popup = document.getElementById('chatbotPopup');
            if (chatbotOpen) {
                closeChatbot();
            } else {
                popup.style.display = 'flex';
                chatbotOpen = true;
                document.getElementById('chatbotInput').focus();
                updateChatbotWelcomeMessage();
            }
        }

        function updateChatbotWelcomeMessage() {
            const messagesContainer = document.getElementById('chatbotMessages');
            const firstMessage = messagesContainer.querySelector('.message.bot');
            
            if (firstMessage) {
                const messageContent = firstMessage.querySelector('.message-content');
                let welcomeText = `ÏïàÎÖïÌïòÏÑ∏Ïöî! ÌîºÎãâÏä§ ÏπòÍ≥º AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. üòä<br>
                ÏπòÍ≥º Í¥ÄÎ†® Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî!`;
                
                const hasAPI = apiSettings.chatgpt.enabled || apiSettings.gemini.enabled || apiSettings.claude.enabled;
                
                if (hasAPI) {
                    welcomeText += `<br><br>ü§ñ <strong>AI Î™®Îç∏ Ïó∞Í≤∞Îê®!</strong> ÎçîÏö± Ï†ïÌôïÌïú ÎãµÎ≥ÄÏùÑ Ï†úÍ≥µÌï† Ïàò ÏûàÏäµÎãàÎã§.`;
                    
                    if (apiSettings.activeProvider) {
                        const providerName = apiSettings.activeProvider.toUpperCase();
                        welcomeText += `<br>ÌòÑÏû¨ ÌôúÏÑ± Î™®Îç∏: ${providerName}`;
                    }
                }
                
                if (knowledgeBase.enabled) {
                    welcomeText += `<br>üìö ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº ${knowledgeBase.files.length}Í∞úÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.`;
                }
                
                welcomeText += `<div class="quick-buttons">
                    <button class="quick-button" onclick="sendQuickMessage('ÏßÑÎ£åÏãúÍ∞Ñ ÏïåÎ†§Ï£ºÏÑ∏Ïöî')">ÏßÑÎ£åÏãúÍ∞Ñ</button>
                    <button class="quick-button" onclick="sendQuickMessage('ÏòàÏïΩÌïòÍ≥† Ïã∂Ïñ¥Ïöî')">ÏòàÏïΩÎ¨∏Ïùò</button>
                    <button class="quick-button" onclick="sendQuickMessage('ÏπòÎ£åÎπÑÏö© Í∂ÅÍ∏àÌï¥Ïöî')">ÏπòÎ£åÎπÑÏö©</button>
                    <button class="quick-button" onclick="sendQuickMessage('ÏúÑÏπò ÏïåÎ†§Ï£ºÏÑ∏Ïöî')">Ïò§ÏãúÎäîÍ∏∏</button>
                </div>`;
                
                messageContent.innerHTML = welcomeText;
            }
        }

        function closeChatbot() {
            console.log('Ï±óÎ¥á Îã´Í∏∞');
            document.getElementById('chatbotPopup').style.display = 'none';
            chatbotOpen = false;
        }

        function sendMessage() {
            console.log('Î©îÏãúÏßÄ Ï†ÑÏÜ°');
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (message) {
                addUserMessage(message);
                input.value = '';
                input.style.height = '45px';
                
                const loadingMessage = addBotMessage('ü§î ÏÉùÍ∞ÅÌïòÍ≥† ÏûàÏäµÎãàÎã§...');
                
                generateAIResponse(message).then(response => {
                    loadingMessage.remove();
                    addBotMessage(response);
                }).catch(error => {
                    console.error('AI ÏùëÎãµ Ïò§Î•ò:', error);
                    loadingMessage.remove();
                    addBotMessage('‚ùå Ï£ÑÏÜ°Ìï©ÎãàÎã§. ÏùºÏãúÏ†ÅÏù∏ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                });
            }
        }

        function sendQuickMessage(message) {
            console.log('Îπ†Î•∏ Î©îÏãúÏßÄ:', message);
            addUserMessage(message);
            
            const loadingMessage = addBotMessage('ü§î ÏÉùÍ∞ÅÌïòÍ≥† ÏûàÏäµÎãàÎã§...');
            
            generateAIResponse(message).then(response => {
                loadingMessage.remove();
                addBotMessage(response);
            }).catch(error => {
                console.error('AI ÏùëÎãµ Ïò§Î•ò:', error);
                loadingMessage.remove();
                addBotMessage('‚ùå Ï£ÑÏÜ°Ìï©ÎãàÎã§. ÏùºÏãúÏ†ÅÏù∏ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            });
        }

        function handleChatKeyPress(event) {
            const textarea = event.target;
            
            if (event.key === 'Enter' && event.shiftKey) {
                event.preventDefault();
                sendMessage();
                return;
            }
            
            if (event.key === 'Enter') {
                setTimeout(() => {
                    autoResizeTextarea(textarea);
                }, 0);
            }
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = '45px';
            const scrollHeight = textarea.scrollHeight;
            const maxHeight = 120;
            
            if (scrollHeight > 45) {
                textarea.style.height = Math.min(scrollHeight, maxHeight) + 'px';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatbotInput');
            if (chatInput) {
                chatInput.addEventListener('input', function() {
                    autoResizeTextarea(this);
                });
            }
        });

        function addUserMessage(message) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">üë§</div>
                <div class="message-content">${message}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addBotMessage(message) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">${message}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            return messageDiv;
        }

        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatbotMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            console.log('AI ÏùëÎãµ ÏÉùÏÑ± ÏãúÏûë:', userMessage);
            
            const knowledgeAnswer = searchInKnowledgeBase(userMessage);
            if (knowledgeAnswer) {
                console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ÏóêÏÑú ÎãµÎ≥Ä Î∞úÍ≤¨');
                return Promise.resolve(knowledgeAnswer);
            }
            
            if (apiSettings.activeProvider && apiSettings[apiSettings.activeProvider].enabled) {
                console.log('API Ìò∏Ï∂úÎ°ú ÎãµÎ≥Ä ÏÉùÏÑ±:', apiSettings.activeProvider);
                return callAIAPIWithContext(userMessage);
            }
            
            console.log('Í∏∞Î≥∏ FAQ ÏùëÎãµ ÏÇ¨Ïö©');
            return Promise.resolve(getDefaultResponse(userMessage));
        }

        async function callAIAPIWithContext(userMessage) {
            const provider = apiSettings.activeProvider;
            const settings = apiSettings[provider];
            
            try {
                let response;
                let contextInfo = getContextFromKnowledgeBase();
                
                switch (provider) {
                    case 'chatgpt':
                        response = await callChatGPTAPIWithContext(userMessage, settings, contextInfo);
                        break;
                    case 'gemini':
                        response = await callGeminiAPIWithContext(userMessage, settings, contextInfo);
                        break;
                    case 'claude':
                        response = await callClaudeAPIWithContext(userMessage, settings, contextInfo);
                        break;
                    default:
                        return getDefaultResponse(userMessage);
                }
                
                return formatFriendlyResponse(response, provider);
                
            } catch (error) {
                console.error('AI API Ìò∏Ï∂ú Ïò§Î•ò:', error);
                return `‚ùå <strong>ÏùºÏãúÏ†ÅÏù∏ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</strong><br><br>
                Ï£ÑÏÜ°Ìï©ÎãàÎã§. AI ÏÑúÎπÑÏä§ Ïó∞Í≤∞Ïóê Î¨∏Ï†úÍ∞Ä ÏûàÏñ¥ Ïû†Ïãú Í∏∞Î≥∏ ÏïàÎÇ¥Î°ú ÎèÑÏõÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.<br><br>
                ${getDefaultResponse(userMessage)}<br><br>
                <small>üí° Ïò§Î•ò ÎÇ¥Ïö©: ${error.message}</small>`;
            }
        }

        function getContextFromKnowledgeBase() {
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                return '';
            }
            
            let context = '\n\n=== Î≥ëÏõê Ï†ÑÎ¨∏ ÏßÄÏãù Ï†ïÎ≥¥ ===\n';
            knowledgeBase.parsedData.forEach((qa, index) => {
                context += `${index + 1}. Q: ${qa.question}\n   A: ${qa.answer}\n`;
            });
            
            return context;
        }

        function formatFriendlyResponse(response, provider) {
            let formattedResponse = response.trim();
            
            formattedResponse = formattedResponse
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            const providerIcon = {
                'chatgpt': 'üß†',
                'gemini': 'üíé', 
                'claude': 'ü§ñ'
            };
            
            const providerName = {
                'chatgpt': 'ChatGPT',
                'gemini': 'Gemini',
                'claude': 'Claude'
            };
            
            return `${providerIcon[provider]} <strong>ÌîºÎãâÏä§ ÏπòÍ≥º AI ÏÉÅÎã¥ÏÇ¨ (${providerName[provider]})</strong><br><br>
            ${formattedResponse}<br><br>
            <small>üí° Ï∂îÍ∞Ä Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî!</small>`;
        }

        async function callChatGPTAPIWithContext(message, settings, contextInfo) {
            const systemPrompt = `ÎãπÏã†ÏùÄ ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõêÏùò Ï†ÑÎ¨∏ AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. 
            Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.

            === Î≥ëÏõê Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
            ‚Ä¢ Î≥ëÏõêÎ™Ö: ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê
            ‚Ä¢ ÏõêÏû•: ÌôçÍ∏∏Îèô (25ÎÖÑ Í≤ΩÎ†• ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏Ïùò)
            ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00, Ï†êÏã¨ÏãúÍ∞Ñ 12:30-13:30
            ‚Ä¢ Ìú¥ÏßÑ: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            ‚Ä¢ Ï†ÑÌôî: 070-1234-1234 (24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•)
            ‚Ä¢ Ï£ºÏÜå: ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏
            ‚Ä¢ ÍµêÌÜµ: ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            ‚Ä¢ Ï£ºÏ∞®: Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)
            ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™©: ÏùºÎ∞òÏßÑÎ£å, ÎØ∏Î∞±ÏπòÎ£å, ÍµêÏ†ïÏπòÎ£å, ÏûÑÌîåÎûÄÌä∏, Î≥¥Ï≤†ÏπòÎ£å, ÏÜåÏïÑÏπòÍ≥º

            === ÏπòÎ£åÎπÑ ÏïàÎÇ¥ ===
            ‚Ä¢ ÏùºÎ∞òÏßÑÎ£å: Ï¥àÏßÑ 15,000Ïõê, Ïû¨ÏßÑ 10,000Ïõê
            ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)
            ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000-300,000Ïõê
            ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000-6,000,000Ïõê
            ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000-1,500,000Ïõê

            ${contextInfo}

            ÎãµÎ≥Ä Í∞ÄÏù¥ÎìúÎùºÏù∏:
            1. Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Îî∞ÎúªÌïú ÎßêÌà¨Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî
            2. Ï†ÑÎ¨∏Ï†ÅÏù¥Î©¥ÏÑúÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
            3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎêò, Ï†ïÌôïÌïòÏßÄ ÏïäÏùÄ ÏùòÎ£å ÏßÑÎã®ÏùÄ ÌîºÌïòÏÑ∏Ïöî
            4. ÏòàÏïΩÏù¥ÎÇò ÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Ï†ÅÍ∑π ÏïàÎÇ¥ÌïòÏÑ∏Ïöî
            5. ÎãµÎ≥ÄÏùÑ Íµ¨Ï°∞ÌôîÌïòÏó¨ ÏùΩÍ∏∞ ÏâΩÍ≤å Ï†ïÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${settings.apiKey}`
                },
                body: JSON.stringify({
                    model: settings.model,
                    messages: [
                        {
                            role: "system",
                            content: systemPrompt
                        },
                        {
                            role: "user",
                            content: message
                        }
                    ],
                    max_tokens: 800,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callGeminiAPIWithContext(message, settings, contextInfo) {
            const prompt = `ÎãπÏã†ÏùÄ ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõêÏùò Ï†ÑÎ¨∏ AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. 
            Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.

            === Î≥ëÏõê Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
            ‚Ä¢ Î≥ëÏõêÎ™Ö: ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê
            ‚Ä¢ ÏõêÏû•: ÌôçÍ∏∏Îèô (25ÎÖÑ Í≤ΩÎ†• ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏Ïùò)
            ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00, Ï†êÏã¨ÏãúÍ∞Ñ 12:30-13:30
            ‚Ä¢ Ìú¥ÏßÑ: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            ‚Ä¢ Ï†ÑÌôî: 070-1234-1234 (24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•)
            ‚Ä¢ Ï£ºÏÜå: ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏
            ‚Ä¢ ÍµêÌÜµ: ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            ‚Ä¢ Ï£ºÏ∞®: Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)
            ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™©: ÏùºÎ∞òÏßÑÎ£å, ÎØ∏Î∞±ÏπòÎ£å, ÍµêÏ†ïÏπòÎ£å, ÏûÑÌîåÎûÄÌä∏, Î≥¥Ï≤†ÏπòÎ£å, ÏÜåÏïÑÏπòÍ≥º

            === ÏπòÎ£åÎπÑ ÏïàÎÇ¥ ===
            ‚Ä¢ ÏùºÎ∞òÏßÑÎ£å: Ï¥àÏßÑ 15,000Ïõê, Ïû¨ÏßÑ 10,000Ïõê
            ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)
            ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000-300,000Ïõê
            ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000-6,000,000Ïõê
            ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000-1,500,000Ïõê

            ${contextInfo}

            ÎãµÎ≥Ä Í∞ÄÏù¥ÎìúÎùºÏù∏:
            1. Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Îî∞ÎúªÌïú ÎßêÌà¨Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî
            2. Ï†ÑÎ¨∏Ï†ÅÏù¥Î©¥ÏÑúÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
            3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎêò, Ï†ïÌôïÌïòÏßÄ ÏïäÏùÄ ÏùòÎ£å ÏßÑÎã®ÏùÄ ÌîºÌïòÏÑ∏Ïöî
            4. ÏòàÏïΩÏù¥ÎÇò ÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Ï†ÅÍ∑π ÏïàÎÇ¥ÌïòÏÑ∏Ïöî
            5. ÎãµÎ≥ÄÏùÑ Íµ¨Ï°∞ÌôîÌïòÏó¨ ÏùΩÍ∏∞ ÏâΩÍ≤å Ï†ïÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî

            ÏßàÎ¨∏: ${message}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${settings.model}:generateContent?key=${settings.apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        maxOutputTokens: 800,
                        temperature: 0.7
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        async function callClaudeAPIWithContext(message, settings, contextInfo) {
            const prompt = `ÎãπÏã†ÏùÄ ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõêÏùò Ï†ÑÎ¨∏ AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§. 
            Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏúºÎ°ú ÎãµÎ≥ÄÌï¥Ï£ºÏÑ∏Ïöî.

            === Î≥ëÏõê Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
            ‚Ä¢ Î≥ëÏõêÎ™Ö: ÌîºÎãâÏä§ ÏπòÍ≥º Î≥ëÏõê
            ‚Ä¢ ÏõêÏû•: ÌôçÍ∏∏Îèô (25ÎÖÑ Í≤ΩÎ†• ÏπòÏ£ºÏßàÌôò Ï†ÑÎ¨∏Ïùò)
            ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00, Ï†êÏã¨ÏãúÍ∞Ñ 12:30-13:30
            ‚Ä¢ Ìú¥ÏßÑ: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
            ‚Ä¢ Ï†ÑÌôî: 070-1234-1234 (24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•)
            ‚Ä¢ Ï£ºÏÜå: ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏
            ‚Ä¢ ÍµêÌÜµ: ÏßÄÌïòÏ≤† 2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            ‚Ä¢ Ï£ºÏ∞®: Í±¥Î¨º ÏßÄÌïò 1-3Ï∏µ Î¨¥Î£å Ï£ºÏ∞® (3ÏãúÍ∞Ñ)
            ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™©: ÏùºÎ∞òÏßÑÎ£å, ÎØ∏Î∞±ÏπòÎ£å, ÍµêÏ†ïÏπòÎ£å, ÏûÑÌîåÎûÄÌä∏, Î≥¥Ï≤†ÏπòÎ£å, ÏÜåÏïÑÏπòÍ≥º

            === ÏπòÎ£åÎπÑ ÏïàÎÇ¥ ===
            ‚Ä¢ ÏùºÎ∞òÏßÑÎ£å: Ï¥àÏßÑ 15,000Ïõê, Ïû¨ÏßÑ 10,000Ïõê
            ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ïãú Ïó∞ 1Ìöå Î¨¥Î£å)
            ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000-300,000Ïõê
            ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000-6,000,000Ïõê
            ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000-1,500,000Ïõê

            ${contextInfo}

            ÎãµÎ≥Ä Í∞ÄÏù¥ÎìúÎùºÏù∏:
            1. Îß§Ïö∞ ÏπúÏ†àÌïòÍ≥† Îî∞ÎúªÌïú ÎßêÌà¨Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî
            2. Ï†ÑÎ¨∏Ï†ÅÏù¥Î©¥ÏÑúÎèÑ Ïù¥Ìï¥ÌïòÍ∏∞ ÏâΩÍ≤å ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
            3. Íµ¨Ï≤¥Ï†ÅÏù∏ Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÎêò, Ï†ïÌôïÌïòÏßÄ ÏïäÏùÄ ÏùòÎ£å ÏßÑÎã®ÏùÄ ÌîºÌïòÏÑ∏Ïöî
            4. ÏòàÏïΩÏù¥ÎÇò ÏÉÅÎã¥Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Ï†ÅÍ∑π ÏïàÎÇ¥ÌïòÏÑ∏Ïöî
            5. ÎãµÎ≥ÄÏùÑ Íµ¨Ï°∞ÌôîÌïòÏó¨ ÏùΩÍ∏∞ ÏâΩÍ≤å Ï†ïÎ¶¨Ìï¥Ï£ºÏÑ∏Ïöî

            ÏßàÎ¨∏: ${message}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': settings.apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: settings.model,
                    max_tokens: 800,
                    messages: [{
                        role: "user",
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        function getDefaultResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('ÏßÑÎ£åÏãúÍ∞Ñ') || message.includes('Ïñ∏Ï†ú') || message.includes('Î™áÏãú') || message.includes('Ïö¥ÏòÅÏãúÍ∞Ñ')) {
                return `üïò <strong>ÌîºÎãâÏä§ ÏπòÍ≥º ÏßÑÎ£åÏãúÍ∞Ñ ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üìÖ <strong>ÌèâÏùº</strong>: Ïò§Ï†Ñ 9Ïãú ~ Ïò§ÌõÑ 6Ïãú<br>
                    üìÖ <strong>ÌÜ†ÏöîÏùº</strong>: Ïò§Ï†Ñ 9Ïãú ~ Ïò§ÌõÑ 3Ïãú<br>
                    üçΩÔ∏è <strong>Ï†êÏã¨ÏãúÍ∞Ñ</strong>: 12Ïãú 30Î∂Ñ ~ 1Ïãú 30Î∂Ñ<br>
                    üö´ <strong>Ìú¥ÏßÑ</strong>: ÏùºÏöîÏùº, Í≥µÌú¥Ïùº
                </div>
                
                üí° <strong>ÏòàÏïΩ ÏïàÎÇ¥</strong><br>
                ‚Ä¢ Ïò®ÎùºÏù∏ ÏòàÏïΩ: 24ÏãúÍ∞Ñ Ïñ∏Ï†úÎì† Í∞ÄÎä•<br>
                ‚Ä¢ Ï†ÑÌôî ÏòàÏïΩ: 070-1234-1234<br>
                ‚Ä¢ ÏùëÍ∏â ÏÉÅÎã¥: 24ÏãúÍ∞Ñ Í∞ÄÎä•<br><br>
                
                üòä Ìé∏Î¶¨Ìïú Ïò®ÎùºÏù∏ ÏòàÏïΩÏùÑ Ï∂îÏ≤úÎìúÎ¶ΩÎãàÎã§!<br>
                <button class="reservation-link-btn" onclick="openReservationFromChat()">üìÖ ÏßÄÍ∏à Î∞îÎ°ú ÏòàÏïΩÌïòÍ∏∞</button>`;
            }
            
            if (message.includes('ÏòàÏïΩ') || message.includes('Ïã†Ï≤≠') || message.includes('Ï†ëÏàò') || message.includes('Î∞©Î¨∏')) {
                return `üìû <strong>ÏòàÏïΩ Î∞è ÏÉÅÎã¥ ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #fff8f0; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üåü <strong>Ïò®ÎùºÏù∏ ÏòàÏïΩ</strong> (Ï∂îÏ≤ú)<br>
                    ‚Ä¢ 24ÏãúÍ∞Ñ Ïñ∏Ï†úÎì† ÏòàÏïΩ Í∞ÄÎä•<br>
                    ‚Ä¢ ÏõêÌïòÎäî ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏÑ†ÌÉù<br>
                    ‚Ä¢ Ï¶âÏãú ÏòàÏïΩ ÌôïÏù∏<br><br>
                    
                    üì± <strong>Ï†ÑÌôî ÏòàÏïΩ</strong><br>
                    ‚Ä¢ 070-1234-1234<br>
                    ‚Ä¢ ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00<br>
                    ‚Ä¢ 24ÏãúÍ∞Ñ ÏùëÍ∏âÏÉÅÎã¥ Í∞ÄÎä•
                </div>
                
                üíù <strong>Ï¥àÏßÑ ÌôòÏûê ÌäπÎ≥Ñ ÌòúÌÉù</strong><br>
                ‚Ä¢ Ï†ïÎ∞Ä Í≤ÄÏßÑ Î∞è ÏÉÅÎã¥<br>
                ‚Ä¢ Í∞úÏù∏Î≥Ñ ÎßûÏ∂§ ÏπòÎ£å Í≥ÑÌöç ÏàòÎ¶Ω<br>
                ‚Ä¢ 25ÎÖÑ Í≤ΩÎ†• ÌôçÍ∏∏Îèô ÏõêÏû•Îãò ÏßÅÏ†ë ÏßÑÎ£å<br><br>
                
                <button class="reservation-link-btn" onclick="openReservationFromChat()">üìÖ ÏßÄÍ∏à Î∞îÎ°ú ÏòàÏïΩÌïòÍ∏∞</button>`;
            }
            
            if (message.includes('ÎπÑÏö©') || message.includes('Í∞ÄÍ≤©') || message.includes('ÏñºÎßà') || message.includes('Îèà') || message.includes('Í∏àÏï°')) {
                return `üí∞ <strong>ÏπòÎ£åÎπÑ ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #f8fff8; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    ü¶∑ <strong>Í∏∞Î≥∏ ÏßÑÎ£å</strong><br>
                    ‚Ä¢ Ï¥àÏßÑÎ£å: 15,000Ïõê<br>
                    ‚Ä¢ Ïû¨ÏßÑÎ£å: 10,000Ïõê<br>
                    ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ: 50,000Ïõê (Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö©Ïãú Ïó∞1Ìöå Î¨¥Î£å)<br><br>
                    
                    ‚ú® <strong>Ï†ÑÎ¨∏ ÏπòÎ£å</strong><br>
                    ‚Ä¢ ÎØ∏Î∞±ÏπòÎ£å: 200,000 ~ 300,000Ïõê<br>
                    ‚Ä¢ ÍµêÏ†ïÏπòÎ£å: 1,500,000 ~ 6,000,000Ïõê<br>
                    ‚Ä¢ ÏûÑÌîåÎûÄÌä∏: 1,200,000 ~ 1,500,000Ïõê<br>
                    ‚Ä¢ Î≥¥Ï≤†ÏπòÎ£å: Í∞úÎ≥Ñ ÏÉÅÎã¥ ÌõÑ ÏïàÎÇ¥
                </div>
                
                üí° <strong>ÏïàÎÇ¥ÏÇ¨Ìï≠</strong><br>
                ‚Ä¢ Ï†ïÌôïÌïú ÎπÑÏö©ÏùÄ Í≤ÄÏßÑ ÌõÑ Í∞úÎ≥Ñ ÏïàÎÇ¥ÎìúÎ¶ΩÎãàÎã§<br>
                ‚Ä¢ Î∂ÑÌï† Í≤∞Ï†ú Î∞è Ïπ¥Îìú Í≤∞Ï†ú Í∞ÄÎä•<br>
                ‚Ä¢ Í±¥Í∞ïÎ≥¥Ìóò Ï†ÅÏö© Ìï≠Î™© Îã§Ïàò<br><br>
                
                üéØ Ï†ïÌôïÌïú ÏπòÎ£åÎπÑ ÏÉÅÎã¥ÏùÑ ÏúÑÌï¥ Î∞©Î¨∏Ìï¥Ï£ºÏÑ∏Ïöî!`;
            }
            
            if (message.includes('ÏúÑÏπò') || message.includes('Ï£ºÏÜå') || message.includes('Ïñ¥Îîî') || message.includes('Ï∞æÏïÑ') || message.includes('ÍµêÌÜµ')) {
                return `üè• <strong>ÌîºÎãâÏä§ ÏπòÍ≥º Ïò§ÏãúÎäî Í∏∏</strong><br><br>
                
                <div style="background: #f0fff0; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üìç <strong>Ï£ºÏÜå</strong><br>
                    ÌîºÎãâÏä§Ïãú ÌîºÎãâÏä§Î°ú 11Í∏∏ 11, ÌîºÎãâÏä§ÌÉÄÏõå 11Ï∏µ 11Ìò∏<br><br>
                    
                    üöá <strong>ÏßÄÌïòÏ≤†</strong><br>
                    2Ìò∏ÏÑ† Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ‚Üí ÎèÑÎ≥¥ 5Î∂Ñ<br><br>
                    
                    üöå <strong>Î≤ÑÏä§</strong><br>
                    Í∞ïÎÇ®Ïó≠ Ï†ïÎ•òÏû• ÌïòÏ∞® ‚Üí ÎèÑÎ≥¥ 3Î∂Ñ<br><br>
                    
                    üöó <strong>Ï£ºÏ∞® ÏïàÎÇ¥</strong><br>
                    ‚Ä¢ Í±¥Î¨º ÏßÄÌïò 1~3Ï∏µ Î¨¥Î£å Ï£ºÏ∞®<br>
                    ‚Ä¢ 3ÏãúÍ∞Ñ Î¨¥Î£å Ïù¥Ïö©<br>
                    ‚Ä¢ Ï£ºÏ∞® Í≥µÍ∞Ñ ÎÑâÎÑâÌï®
                </div>
                
                üó∫Ô∏è <strong>Ï∞æÏïÑÏò§ÏãúÎäî Í∏∏Ïù¥ Í∂ÅÍ∏àÌïòÏãúÎ©¥</strong><br>
                Ï†ÑÌôîÎ°ú ÏûêÏÑ∏Ìïú ÏïàÎÇ¥Î•º ÎèÑÏôÄÎìúÎ¶¨Í≤†ÏäµÎãàÎã§!<br>
                üìû 070-1234-1234`;
            }
            
            if (message.includes('ÏπòÎ£å') || message.includes('ÏãúÏà†') || message.includes('ÏßÑÎ£åÍ≥ºÎ™©')) {
                return `ü¶∑ <strong>ÌîºÎãâÏä§ ÏπòÍ≥º ÏßÑÎ£åÍ≥ºÎ™© ÏïàÎÇ¥</strong><br><br>
                
                <div style="background: #fff0f8; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    üîç <strong>ÏùºÎ∞òÏßÑÎ£å</strong><br>
                    ‚Ä¢ Ï∂©Ïπò ÏπòÎ£å, ÏûáÎ™∏ ÏπòÎ£å<br>
                    ‚Ä¢ Ïä§ÏºÄÏùºÎßÅ, Ï†ïÍ∏∞ Í≤ÄÏßÑ<br><br>
                    
                    ‚ú® <strong>ÎØ∏Î∞±ÏπòÎ£å</strong><br>
                    ‚Ä¢ Ï†ÑÎ¨∏Í∞Ä ÎØ∏Î∞±, ÌôàÏºÄÏñ¥ ÎØ∏Î∞±<br>
                    ‚Ä¢ 1Ìöå ÏãúÏà†Î°ú 3-8Îã®Í≥Ñ Í∞úÏÑ†<br><br>
                    
                    üîß <strong>ÍµêÏ†ïÏπòÎ£å</strong><br>
                    ‚Ä¢ Î∂ÄÎ∂ÑÍµêÏ†ï, Ï†ÑÏ≤¥ÍµêÏ†ï<br>
                    ‚Ä¢ 3D ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏÉÅÎã¥<br><br>
                    
                    ü¶¥ <strong>ÏûÑÌîåÎûÄÌä∏</strong><br>
                    ‚Ä¢ ÎîîÏßÄÌÑ∏ Í∞ÄÏù¥Îìú ÏàòÏà†<br>
                    ‚Ä¢ ÌîÑÎ¶¨ÎØ∏ÏóÑ Ïû¨Î£å ÏÇ¨Ïö©<br><br>
                    
                    üëë <strong>Î≥¥Ï≤†ÏπòÎ£å</strong><br>
                    ‚Ä¢ ÏßÄÎ•¥ÏΩîÎãàÏïÑ ÌÅ¨ÎùºÏö¥<br>
                    ‚Ä¢ ÏûêÏó∞Ïä§Îü¨Ïö¥ ÏÉâÏÉÅ Îß§Ïπ≠<br><br>
                    
                    üßí <strong>ÏÜåÏïÑÏπòÍ≥º</strong><br>
                    ‚Ä¢ Ïñ¥Î¶∞Ïù¥ ÏπúÌôîÏ†Å ÌôòÍ≤Ω<br>
                    ‚Ä¢ Î¨¥Ìï¥Ìïú Ïû¨Î£å ÏÇ¨Ïö©
                </div>
                
                üí´ <strong>25ÎÖÑ Í≤ΩÎ†• ÌôçÍ∏∏Îèô ÏõêÏû•ÎãòÏù¥ ÏßÅÏ†ë ÏßÑÎ£åÌï©ÎãàÎã§!</strong>`;
            }
            
            return `üòä <strong>ÏïàÎÖïÌïòÏÑ∏Ïöî! ÌîºÎãâÏä§ ÏπòÍ≥º AI ÏÉÅÎã¥ÏÇ¨ÏûÖÎãàÎã§</strong><br><br>
            
            <div style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); padding: 20px; border-radius: 12px; margin: 10px 0;">
                üè• <strong>ÌîºÎãâÏä§ ÏπòÍ≥ºÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!</strong><br><br>
                
                üí° <strong>Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?</strong><br>
                ‚Ä¢ ÏßÑÎ£åÏãúÍ∞Ñ Î∞è ÏòàÏïΩ ÏïàÎÇ¥<br>
                ‚Ä¢ ÏπòÎ£å ÎπÑÏö© ÏÉÅÎã¥<br>
                ‚Ä¢ Ïò§ÏãúÎäî Í∏∏ ÏïàÎÇ¥<br>
                ‚Ä¢ ÏßÑÎ£åÍ≥ºÎ™© ÏÉÅÏÑ∏ Ï†ïÎ≥¥<br>
                ‚Ä¢ Í∏∞ÌÉÄ Í∂ÅÍ∏àÌïú Ï†ê
            </div>
            
            ${knowledgeBase.enabled ? 
                `üìö <strong>ÏóÖÎ°úÎìúÎêú Ï†ÑÎ¨∏ ÏßÄÏãù ${knowledgeBase.files.length}Í∞ú ÌååÏùºÏù¥ Ï§ÄÎπÑÎêòÏñ¥ ÏûàÏñ¥</strong><br>ÎçîÏö± Ï†ïÌôïÌïòÍ≥† Ï†ÑÎ¨∏Ï†ÅÏù∏ ÎãµÎ≥ÄÏùÑ Ï†úÍ≥µÌï† Ïàò ÏûàÏäµÎãàÎã§!<br><br>` : 
                ''
            }
            
            ü¶∑ Í±¥Í∞ïÌïú ÎØ∏ÏÜåÎ•º ÏúÑÌïú Ïó¨Îü¨Î∂ÑÏùò Îì†Îì†Ìïú ÌååÌä∏ÎÑàÍ∞Ä ÎêòÍ≤†ÏäµÎãàÎã§!<br>
            Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Ìé∏ÌïòÍ≤å ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî! ‚ú®`;
        }

        function openReservationFromChat() {
            closeChatbot();
            openReservation();
        }

        // API Í¥ÄÎ†® Ìï®ÏàòÎì§
        function saveApiSettings() {
            console.log('API ÏÑ§Ï†ï Ï†ÄÏû•');
            
            const chatgptModel = document.getElementById('chatgptModel').value;
            const chatgptApiKey = document.getElementById('chatgptApiKey').value.trim();
            const chatgptFinetuningModel = document.getElementById('chatgptFinetuningModel').value.trim();
            
            const geminiModel = document.getElementById('geminiModel').value;
            const geminiApiKey = document.getElementById('geminiApiKey').value.trim();
            
            const claudeModel = document.getElementById('claudeModel').value;
            const claudeApiKey = document.getElementById('claudeApiKey').value.trim();
            
            let finalChatGPTModel = chatgptModel;
            if (chatgptModel === 'finetuning' && chatgptFinetuningModel) {
                finalChatGPTModel = chatgptFinetuningModel;
            }
            
            apiSettings.chatgpt.model = finalChatGPTModel;
            apiSettings.chatgpt.apiKey = chatgptApiKey;
            apiSettings.chatgpt.enabled = finalChatGPTModel && chatgptApiKey;
            
            apiSettings.gemini.model = geminiModel;
            apiSettings.gemini.apiKey = geminiApiKey;
            apiSettings.gemini.enabled = geminiModel && geminiApiKey;
            
            apiSettings.claude.model = claudeModel;
            apiSettings.claude.apiKey = claudeApiKey;
            apiSettings.claude.enabled = claudeModel && claudeApiKey;
            
            let activeCount = 0;
            let lastActive = '';
            
            if (apiSettings.chatgpt.enabled) {
                activeCount++;
                lastActive = 'ChatGPT';
                apiSettings.activeProvider = 'chatgpt';
            }
            if (apiSettings.gemini.enabled) {
                activeCount++;
                lastActive = 'Gemini';
                if (!apiSettings.activeProvider) apiSettings.activeProvider = 'gemini';
            }
            if (apiSettings.claude.enabled) {
                activeCount++;
                lastActive = 'Claude';
                if (!apiSettings.activeProvider) apiSettings.activeProvider = 'claude';
            }
            
            if (activeCount === 0) {
                showStatus('apiStatus', '‚ùå ÏµúÏÜå ÌïòÎÇòÏùò AI Î™®Îç∏ÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            let message = `‚úÖ ${activeCount}Í∞úÏùò AI Î™®Îç∏Ïù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§!`;
            if (activeCount > 1) {
                message += `\nüéØ Í∏∞Î≥∏ ÏÇ¨Ïö© Î™®Îç∏: ${lastActive}`;
            }
            if (chatgptModel === 'finetuning') {
                message += `\nüîß Finetuning Î™®Îç∏: ${chatgptFinetuningModel}`;
            }
            
            message += `\n\nüöÄ Ïù¥Ï†ú Ï±óÎ¥áÏóêÏÑú AI ÎãµÎ≥ÄÏùÑ Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§!`;
            message += `\nüí° Î©îÏù∏ ÌéòÏù¥ÏßÄÏùò Ï±óÎ¥á Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï¥ÏÑú ÌÖåÏä§Ìä∏Ìï¥Î≥¥ÏÑ∏Ïöî.`;
            
            showStatus('apiStatus', message, 'success');
        }

        function testApiConnection() {
            console.log('API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏');
            
            if (!apiSettings.chatgpt.enabled && !apiSettings.gemini.enabled && !apiSettings.claude.enabled) {
                showStatus('apiStatus', '‚ùå Î®ºÏ†Ä API ÏÑ§Ï†ïÏùÑ Ï†ÄÏû•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            showStatus('apiStatus', 'üîÑ API Ïó∞Í≤∞ÏùÑ ÌÖåÏä§Ìä∏ÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'success');
            
            testAllAPIs().then(results => {
                const message = results.join('\n') + '\nüéâ Î™®Îì† ÏÑ§Ï†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!';
                showStatus('apiStatus', message, 'success');
            }).catch(error => {
                showStatus('apiStatus', `‚ùå API ÌÖåÏä§Ìä∏ Ïã§Ìå®: ${error.message}`, 'error');
            });
        }

        async function testAllAPIs() {
            const testResults = [];
            const testMessage = "ÏïàÎÖïÌïòÏÑ∏Ïöî. API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ÏûÖÎãàÎã§.";
            
            if (apiSettings.chatgpt.enabled) {
                try {
                    await callChatGPTAPI(testMessage, apiSettings.chatgpt);
                    testResults.push('‚úÖ ChatGPT API Ïó∞Í≤∞ ÏÑ±Í≥µ');
                } catch (error) {
                    testResults.push(`‚ùå ChatGPT API Ïò§Î•ò: ${error.message}`);
                }
            }
            
            if (apiSettings.gemini.enabled) {
                try {
                    await callGeminiAPI(testMessage, apiSettings.gemini);
                    testResults.push('‚úÖ Gemini API Ïó∞Í≤∞ ÏÑ±Í≥µ');
                } catch (error) {
                    testResults.push(`‚ùå Gemini API Ïò§Î•ò: ${error.message}`);
                }
            }
            
            if (apiSettings.claude.enabled) {
                try {
                    await callClaudeAPI(testMessage, apiSettings.claude);
                    testResults.push('‚úÖ Claude API Ïó∞Í≤∞ ÏÑ±Í≥µ');
                } catch (error) {
                    testResults.push(`‚ùå Claude API Ïò§Î•ò: ${error.message}`);
                }
            }
            
            return testResults;
        }

        async function callChatGPTAPI(message, settings) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${settings.apiKey}`
                },
                body: JSON.stringify({
                    model: settings.model,
                    messages: [{
                        role: "user",
                        content: message
                    }],
                    max_tokens: 100
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callGeminiAPI(message, settings) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${settings.model}:generateContent?key=${settings.apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: message
                        }]
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        async function callClaudeAPI(message, settings) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': settings.apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: settings.model,
                    max_tokens: 100,
                    messages: [{
                        role: "user",
                        content: message
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        function resetApiSettings() {
            console.log('API ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî');
            
            if (confirm('Î™®Îì† API ÏÑ§Ï†ïÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏ†ÄÏû•Îêú API ÌÇ§ÏôÄ Î™®Îç∏ ÏÑ†ÌÉùÏù¥ Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                document.getElementById('chatgptModel').value = '';
                document.getElementById('chatgptApiKey').value = '';
                document.getElementById('chatgptFinetuningModel').value = '';
                document.getElementById('chatgptFinetuningGroup').style.display = 'none';
                document.getElementById('geminiModel').value = '';
                document.getElementById('geminiApiKey').value = '';
                document.getElementById('claudeModel').value = '';
                document.getElementById('claudeApiKey').value = '';
                
                apiSettings = {
                    chatgpt: { apiKey: '', model: '', enabled: false },
                    gemini: { apiKey: '', model: '', enabled: false },
                    claude: { apiKey: '', model: '', enabled: false },
                    activeProvider: ''
                };
                
                showStatus('apiStatus', 'üîÑ Î™®Îì† API ÏÑ§Ï†ïÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
        }

        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
            
            const displayTime = type === 'success' ? 5000 : 3000;
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, displayTime);
        }

        function downloadExcel() {
            alert('Í≥†Í∞ù ÏòàÏïΩ ÎÇ¥Ïó≠Ïù¥ Îã§Ïö¥Î°úÎìú Îê©ÎãàÎã§!');
            // Excel Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const header = ['ÏàúÎ≤à','ÏòàÏïΩÏûêÎ™Ö','ÏÉùÎÖÑÏõîÏùº','Ï†ÑÌôîÎ≤àÌò∏','ÏòàÏïΩÎÇ†Ïßú','ÏòàÏïΩÏãúÍ∞Ñ','ÏÉÅÎã¥ÎÇ¥Ïö©','ÏòàÏïΩÏùºÏãú'];
            const data = reservations.map(reservation => {
                const dateStr = `${reservation.date.getFullYear()}-${String(reservation.date.getMonth() + 1).padStart(2, '0')}-${String(reservation.date.getDate()).padStart(2, '0')}`;
                const createdStr = `${reservation.createdAt.getFullYear()}-${String(reservation.createdAt.getMonth() + 1).padStart(2, '0')}-${String(reservation.createdAt.getDate()).padStart(2, '0')} ${String(reservation.createdAt.getHours()).padStart(2, '0')}:${String(reservation.createdAt.getMinutes()).padStart(2, '0')}`;
                return {
                    'ÏàúÎ≤à': reservation.id,
                    'ÏòàÏïΩÏûêÎ™Ö': reservation.name,
                    'ÏÉùÎÖÑÏõîÏùº': reservation.birthDate,
                    'Ï†ÑÌôîÎ≤àÌò∏': reservation.phone,
                    'ÏòàÏïΩÎÇ†Ïßú': dateStr,
                    'ÏòàÏïΩÏãúÍ∞Ñ': reservation.time,
                    'ÏÉÅÎã¥ÎÇ¥Ïö©': reservation.consult ? reservation.consult : '',
                    'ÏòàÏïΩÏùºÏãú': createdStr
                };
            });
            // SheetJS ÏÇ¨Ïö©
            const ws = XLSX.utils.json_to_sheet(data, {header: header});
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ÏòàÏïΩÎÇ¥Ïó≠');
            XLSX.writeFile(wb, 'reservation_list.xlsx');
        }

        function toggleFinetuningInput(provider) {
            const selectElement = document.getElementById(`${provider}Model`);
            const finetuningGroup = document.getElementById(`${provider}FinetuningGroup`);
            
            if (selectElement.value === 'finetuning') {
                finetuningGroup.style.display = 'block';
            } else {
                finetuningGroup.style.display = 'none';
            }
        }

        // ÌååÏùº ÏóÖÎ°úÎìú Í¥ÄÎ†® Ìï®ÏàòÎì§
        function handleFileUpload(event) {
            const files = event.target.files;
            processUploadedFiles(files);
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            processUploadedFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
        }

        function processUploadedFiles(files) {
            console.log('ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨ ÏãúÏûë:', files.length, 'Í∞ú');
            showStatus('knowledgeSettingsStatus', 'üìÅ ÌååÏùºÏùÑ Ï≤òÎ¶¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'success');
            
            let processedCount = 0;
            const totalFiles = files.length;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                console.log('ÌååÏùº Ï≤òÎ¶¨ Ï§ë:', file.name, file.type, file.size);
                
                const fileData = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    uploadTime: new Date(),
                    content: ''
                };
                
                const fileExtension = file.name.toLowerCase().split('.').pop();
                
                if (fileExtension === 'pdf' || file.type === 'application/pdf') {
                    console.warn('PDF ÌååÏùº Í∞êÏßÄ:', file.name);
                    processedCount++;
                    
                    if (processedCount === totalFiles) {
                        showStatus('knowledgeSettingsStatus', 
                            `‚ùå PDF ÌååÏùºÏùÄ ÌòÑÏû¨ ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§.\nPDF ÎÇ¥Ïö©ÏùÑ ÌÖçÏä§Ìä∏ ÌååÏùº(.txt)Î°ú Î≥µÏÇ¨Ìï¥ÏÑú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.\n\nüí° PDF ‚Üí ÌÖçÏä§Ìä∏ Î≥ÄÌôò Î∞©Î≤ï:\n1. PDFÎ•º Ïó¥Í≥† ÎÇ¥Ïö©ÏùÑ Î≥µÏÇ¨\n2. Î©îÎ™®Ïû•Ïóê Î∂ôÏó¨ÎÑ£Í∏∞\n3. .txt ÌååÏùºÎ°ú Ï†ÄÏû• ÌõÑ ÏóÖÎ°úÎìú`, 
                            'error');
                    }
                    continue;
                }
                
                if (fileExtension === 'txt' || file.type === 'text/plain' || file.type === '') {
                    processTextFileWithEncoding(file, fileData, () => {
                        processedCount++;
                        
                        if (processedCount === totalFiles) {
                            console.log('Ï†ÑÏ≤¥ ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å');
                            
                            knowledgeBase.enabled = knowledgeBase.parsedData.length > 0;
                            
                            updateFileList();
                            updateKnowledgeStatus();
                            
                            if (knowledgeBase.parsedData.length > 0) {
                                const message = `‚úÖ ${totalFiles}Í∞ú ÌååÏùº Ï≤òÎ¶¨ ÏôÑÎ£å!\nüìö Ï¥ù ${knowledgeBase.parsedData.length}Í∞úÏùò Q&AÍ∞Ä ÌååÏã±ÎêòÏóàÏäµÎãàÎã§.\nü§ñ ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä ÏûêÎèôÏúºÎ°ú ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§!`;
                                showStatus('knowledgeSettingsStatus', message, 'success');
                                
                                setTimeout(() => {
                                    testKnowledgeBaseAuto();
                                }, 1000);
                            } else {
                                showStatus('knowledgeSettingsStatus', 
                                    `‚ö†Ô∏è ÌååÏùºÏùÄ ÏùΩÏóàÏßÄÎßå Q&A Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.\n\nüìù Ïò¨Î∞îÎ•∏ ÌòïÏãù ÏòàÏãú:\nQ: ÏßÑÎ£åÏãúÍ∞ÑÏù¥ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?\nA: ÌèâÏùº 09:00-18:00ÏûÖÎãàÎã§.\n\nÎòêÎäî\n\n1. ÏòàÏïΩÏùÄ Ïñ¥ÎñªÍ≤å ÌïòÎÇòÏöî?\nÏò®ÎùºÏù∏Ïù¥ÎÇò Ï†ÑÌôîÎ°ú Í∞ÄÎä•Ìï©ÎãàÎã§.`, 
                                    'error');
                            }
                        }
                    });
                } else {
                    console.warn('ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãù:', file.name, file.type);
                    processedCount++;
                    
                    if (processedCount === totalFiles) {
                        showStatus('knowledgeSettingsStatus', 
                            `‚ùå ÏßÄÏõêÎêòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.\nÌòÑÏû¨ ÌÖçÏä§Ìä∏ ÌååÏùº(.txt)Îßå ÏßÄÏõêÎê©ÎãàÎã§.\n\nüí° ExcelÏù¥ÎÇò PDF ÎÇ¥Ïö©ÏùÑ ÌÖçÏä§Ìä∏ ÌååÏùºÎ°ú Î≥ÄÌôòÌï¥ÏÑú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.`, 
                            'error');
                    }
                }
            }
        }

        function processTextFileWithEncoding(file, fileData, callback) {
            console.log('üî§ ÌÖçÏä§Ìä∏ ÌååÏùº Ïù∏ÏΩîÎî© Ï≤òÎ¶¨:', file.name);
            
            const reader1 = new FileReader();
            reader1.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    const hasKorean = /[Í∞Ä-Ìû£]/.test(content);
                    const hasBrokenChars = /[‚óÜÔøΩ]/.test(content) || content.includes('ÔøΩ');
                    
                    if (hasKorean && !hasBrokenChars) {
                        console.log('‚úÖ UTF-8 Ïù∏ÏΩîÎî© ÏÑ±Í≥µ:', file.name);
                        fileData.content = content;
                        knowledgeBase.files.push(fileData);
                        parseFileContentImproved(fileData);
                        callback();
                        return;
                    }
                    
                    console.log('‚ùå UTF-8 Ïã§Ìå®, EUC-KR ÏãúÎèÑ');
                    tryEucKrEncoding();
                    
                } catch (error) {
                    console.error('UTF-8 ÏùΩÍ∏∞ Ïò§Î•ò:', error);
                    tryEucKrEncoding();
                }
            };
            
            reader1.onerror = function() {
                console.error('UTF-8 ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò');
                tryEucKrEncoding();
            };
            
            function tryEucKrEncoding() {
                const reader2 = new FileReader();
                reader2.onload = function(e) {
                    try {
                        const content = e.target.result;
                        const hasKorean = /[Í∞Ä-Ìû£]/.test(content);
                        const hasBrokenChars = /[‚óÜÔøΩ]/.test(content) || content.includes('ÔøΩ');
                        
                        if (hasKorean && !hasBrokenChars) {
                            console.log('‚úÖ EUC-KR Ïù∏ÏΩîÎî© ÏÑ±Í≥µ:', file.name);
                            fileData.content = content;
                            knowledgeBase.files.push(fileData);
                            parseFileContentImproved(fileData);
                            callback();
                            return;
                        }
                        
                        console.log('‚ö†Ô∏è ÌïúÍ∏Ä Í∞êÏßÄ Ïã§Ìå®, UTF-8 Í≤∞Í≥º ÏÇ¨Ïö©:', file.name);
                        reader1.readAsText(file, 'UTF-8');
                        
                    } catch (error) {
                        console.error('EUC-KR ÏùΩÍ∏∞ Ïò§Î•ò:', error);
                        fileData.content = reader1.result || '';
                        knowledgeBase.files.push(fileData);
                        parseFileContentImproved(fileData);
                        callback();
                    }
                };
                
                reader2.onerror = function() {
                    console.error('EUC-KR ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò');
                    fileData.content = reader1.result || '';
                    knowledgeBase.files.push(fileData);
                    parseFileContentImproved(fileData);
                    callback();
                };
                
                reader2.readAsText(file, 'EUC-KR');
            }
            
            reader1.readAsText(file, 'UTF-8');
        }

        function parseFileContentImproved(fileData) {
            console.log('Í∞úÏÑ†Îêú ÌååÏùº ÌååÏã± ÏãúÏûë:', fileData.name);
            
            if (!fileData.content || fileData.content.trim().length === 0) {
                console.log('ÌååÏùº ÎÇ¥Ïö©Ïù¥ ÎπÑÏñ¥ÏûàÏùå:', fileData.name);
                return;
            }
            
            const content = fileData.content;
            const lines = content.split(/\r?\n/).map(line => line.trim()).filter(line => line.length > 0);
            console.log('ÌååÏã±Ìï† ÎùºÏù∏ Ïàò:', lines.length);
            
            const parsedQA = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let question = '';
                let answer = '';
                
                if (line.match(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]\s*(.+)$/i)) {
                    question = line.replace(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]\s*/i, '').trim();
                    
                    for (let j = i + 1; j < lines.length && j < i + 5; j++) {
                        const nextLine = lines[j];
                        if (nextLine.match(/^[AaAnswÎãµÎ≥ÄÎãµÏùëÎãµ]\s*[:Ôºö]\s*(.+)$/i)) {
                            answer = nextLine.replace(/^[AaAnswÎãµÎ≥ÄÎãµÏùëÎãµ]\s*[:Ôºö]\s*/i, '').trim();
                            i = j;
                            break;
                        } else if (!nextLine.match(/^[Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]\s*[:Ôºö]/i)) {
                            answer = nextLine;
                            i = j;
                            break;
                        }
                    }
                }
                else if (line.match(/^\d+\.\s*(.+[?Ôºü])\s*$/)) {
                    question = line.replace(/^\d+\.\s*/, '').trim();
                    if (i + 1 < lines.length && !lines[i + 1].match(/^\d+\./)) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                else if (line.match(/^[-‚Ä¢*]\s*(.+[?Ôºü])\s*$/)) {
                    question = line.replace(/^[-‚Ä¢*]\s*/, '').trim();
                    if (i + 1 < lines.length && !lines[i + 1].match(/^[-‚Ä¢*]/)) {
                        answer = lines[i + 1];
                        i++;
                    }
                }
                else if (line.length > 5 && 
                         (line.includes('?') || line.includes('Ôºü') ||
                          line.match(/(Ïñ¥ÎñªÍ≤å|Ïñ∏Ï†ú|Ïñ¥ÎîîÏÑú|Ïôú|Î¨¥Ïóá|ÎàÑÍ∞Ä|ÏñºÎßà|Î™áÏãú|Ïñ¥Îñ§|Î≠îÍ∞Ä|Ïñ¥Îîî|Î™á|Ïñ∏Ï†úÍπåÏßÄ)/))) {
                    question = line;
                    
                    const answerLines = [];
                    for (let j = i + 1; j < Math.min(i + 4, lines.length); j++) {
                        const nextLine = lines[j];
                        if (nextLine.match(/(Ïñ¥ÎñªÍ≤å|Ïñ∏Ï†ú|Ïñ¥ÎîîÏÑú|Ïôú|Î¨¥Ïóá|ÎàÑÍ∞Ä|ÏñºÎßà|Î™áÏãú|Ïñ¥Îñ§)[?Ôºü]/) ||
                            nextLine.match(/^[\d\-‚Ä¢*Qq„ÖÅ„ÖÇ„Öä„Ñ∑„Ñπ„ÖÅ„ÖèqQuestionÎ¨∏ÏßàÏùòÏßàÎ¨∏]/)) {
                            break;
                        }
                        answerLines.push(nextLine);
                        if (answerLines.join(' ').length > 200) break;
                    }
                    
                    if (answerLines.length > 0) {
                        answer = answerLines.join(' ').trim();
                        i += answerLines.length;
                    }
                }
                else if (line.match(/^([^:Ôºö]{2,20})[:Ôºö]\s*(.{5,})$/)) {
                    const matches = line.match(/^([^:Ôºö]{2,20})[:Ôºö]\s*(.{5,})$/);
                    if (matches) {
                        question = matches[1].trim();
                        answer = matches[2].trim();
                    }
                }
                
                if (question && answer && question.length > 2 && answer.length > 3) {
                    const qaItem = {
                        question: question,
                        answer: answer,
                        source: fileData.name,
                        lineNumber: i + 1,
                        pattern: 'ÏûêÎèôÍ∞êÏßÄ'
                    };
                    
                    parsedQA.push(qaItem);
                    console.log('Q&A Ï∂îÍ∞Ä:', question.substring(0, 30) + '...');
                }
            }
            
            parsedQA.forEach(newQA => {
                const isDuplicate = knowledgeBase.parsedData.some(existingQA => 
                    existingQA.question === newQA.question && existingQA.source === newQA.source
                );
                
                if (!isDuplicate) {
                    knowledgeBase.parsedData.push(newQA);
                }
            });
            
            console.log(`${fileData.name}ÏóêÏÑú ÏÉàÎ°ú ÌååÏã±Îêú Q&A:`, parsedQA.length, 'Í∞ú');
            console.log('Ï†ÑÏ≤¥ Q&A Îç∞Ïù¥ÌÑ∞:', knowledgeBase.parsedData.length, 'Í∞ú');
            
            if (parsedQA.length > 0) {
                console.log('ÌååÏã± Í≤∞Í≥º ÏÉòÌîå:');
                parsedQA.slice(0, 2).forEach((qa, idx) => {
                    console.log(`${idx + 1}. Q: ${qa.question}`);
                    console.log(`   A: ${qa.answer.substring(0, 50)}...`);
                });
            }
        }

        function updateFileList() {
            const fileListContainer = document.getElementById('fileList');
            fileListContainer.innerHTML = '';
            
            knowledgeBase.files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">üìÑ ${file.name}</div>
                        <div class="file-details">
                            ÌÅ¨Í∏∞: ${(file.size / 1024).toFixed(1)} KB | 
                            ÏóÖÎ°úÎìú: ${file.uploadTime.toLocaleString()}
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="file-btn btn-danger" onclick="removeFile(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                fileListContainer.appendChild(fileItem);
            });
        }

        function updateKnowledgeStatus() {
            const statusElement = document.getElementById('knowledgeStatus');
            const fileCount = knowledgeBase.files.length;
            const qaCount = knowledgeBase.parsedData.length;
            const status = knowledgeBase.enabled ? '‚úÖ ÌôúÏÑ±' : '‚ùå ÎπÑÌôúÏÑ±';
            
            let statusHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
                    <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 20px; font-weight: bold; color: #1976d2;">${fileCount}</div>
                        <div style="font-size: 12px; color: #666;">ÏóÖÎ°úÎìú ÌååÏùº</div>
                    </div>
                    <div style="background: #f3e5f5; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 20px; font-weight: bold; color: #7b1fa2;">${qaCount}</div>
                        <div style="font-size: 12px; color: #666;">ÌååÏã±Îêú Q&A</div>
                    </div>
                    <div style="background: ${knowledgeBase.enabled ? '#e8f5e8' : '#ffebee'}; padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 16px; font-weight: bold; color: ${knowledgeBase.enabled ? '#2e7d32' : '#c62828'};">${status}</div>
                        <div style="font-size: 12px; color: #666;">ÏÉÅÌÉú</div>
                    </div>
                </div>
            `;
            
            if (knowledgeBase.enabled) {
                statusHTML += `
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 8px; border-left: 4px solid #4facfe;">
                        üéØ <strong>AI ÎãµÎ≥Ä Ïö∞ÏÑ†ÏàúÏúÑ</strong><br>
                        1Ï∞®: üìö ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùº Í≤ÄÏÉâ<br>
                        2Ï∞®: ü§ñ AI API Î™®Îç∏ ÌôúÏö©<br>
                        3Ï∞®: üí° Í∏∞Î≥∏ FAQ ÏùëÎãµ
                    </div>
                `;
            } else {
                statusHTML += `
                    <div style="background: #fff3e0; padding: 10px; border-radius: 8px; border-left: 4px solid #ff9800;">
                        üí° <strong>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥</strong><br>
                        ÏπòÍ≥º Ï†ÑÎ¨∏ ÏßÄÏãùÏùÑ Î∞îÌÉïÏúºÎ°ú ÎçîÏö± Ï†ïÌôïÌïú AI ÏÉÅÎã¥Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§!
                    </div>
                `;
            }
            
            statusElement.innerHTML = statusHTML;
        }

        function removeFile(index) {
            console.log('ÌååÏùº ÏÇ≠Ï†ú:', index);
            knowledgeBase.files.splice(index, 1);
            
            knowledgeBase.parsedData = [];
            knowledgeBase.files.forEach(file => {
                parseFileContentImproved(file);
            });
            
            updateFileList();
            updateKnowledgeStatus();
        }

        function saveKnowledgeSettings() {
            console.log('ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ï Ï†ÄÏû•');
            
            if (knowledgeBase.files.length === 0) {
                showStatus('knowledgeSettingsStatus', '‚ùå ÏóÖÎ°úÎìúÎêú ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            if (knowledgeBase.parsedData.length === 0) {
                showStatus('knowledgeSettingsStatus', '‚ùå ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. ÌååÏùº ÌòïÏãùÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            knowledgeBase.enabled = true;
            
            try {
                const knowledgeData = {
                    files: knowledgeBase.files.map(f => ({
                        name: f.name,
                        size: f.size,
                        uploadTime: f.uploadTime,
                        content: f.content
                    })),
                    parsedData: knowledgeBase.parsedData,
                    enabled: knowledgeBase.enabled,
                    lastSaved: new Date().toISOString()
                };
                
                console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Îê®:', knowledgeData);
                
                showStatus('knowledgeSettingsStatus', 
                    `‚úÖ ÏßÄÏãù ÌååÏùº ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!\nüìö Ï¥ù ${knowledgeBase.files.length}Í∞ú ÌååÏùº, ${knowledgeBase.parsedData.length}Í∞ú Q&A\nü§ñ Ïù¥Ï†ú Ï±óÎ¥áÏù¥ ÏóÖÎ°úÎìúÎêú ÏßÄÏãùÏùÑ Ïö∞ÏÑ†Ï†ÅÏúºÎ°ú ÌôúÏö©Ìï©ÎãàÎã§.`, 
                    'success');
                
                updateKnowledgeStatus();
                
            } catch (error) {
                console.error('ÏßÄÏãù ÌååÏùº Ï†ÄÏû• Ïò§Î•ò:', error);
                showStatus('knowledgeSettingsStatus', '‚ùå Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        function testKnowledgeBase() {
            console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ ÌÖåÏä§Ìä∏');
            
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                showStatus('knowledgeSettingsStatus', '‚ùå ÌôúÏÑ±ÌôîÎêú ÏßÄÏãù ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const testQueries = ['ÏßÑÎ£åÏãúÍ∞Ñ', 'ÏòàÏïΩ', 'ÎπÑÏö©', 'ÏúÑÏπò', 'ÏπòÎ£å'];
            let testResults = [];
            
            testQueries.forEach(query => {
                const result = searchInKnowledgeBase(query);
                if (result) {
                    testResults.push(`‚úÖ "${query}" - ÎãµÎ≥Ä Î∞úÍ≤¨`);
                } else {
                    testResults.push(`‚ùå "${query}" - ÎãµÎ≥Ä ÏóÜÏùå`);
                }
            });
            
            const successCount = testResults.filter(r => r.includes('‚úÖ')).length;
            const message = `üîç Í≤ÄÏÉâ ÌÖåÏä§Ìä∏ Í≤∞Í≥º (${successCount}/${testQueries.length})\n${testResults.join('\n')}`;
            
            showStatus('knowledgeSettingsStatus', message, successCount > 0 ? 'success' : 'error');
        }

        function clearAllKnowledge() {
            if (confirm('Î™®Îì† ÏóÖÎ°úÎìúÎêú ÏßÄÏãù ÌååÏùºÍ≥º Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                knowledgeBase = {
                    files: [],
                    content: '',
                    parsedData: [],
                    enabled: false
                };
                
                document.getElementById('fileList').innerHTML = '';
                document.getElementById('parsedDataView').style.display = 'none';
                updateKnowledgeStatus();
                
                showStatus('knowledgeSettingsStatus', 'üóëÔ∏è Î™®Îì† ÏßÄÏãù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
                console.log('ÏßÄÏãùÎ≤†Ïù¥Ïä§ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
            }
        }

        function showParsedData() {
            console.log('ÌååÏã±Îêú Q&A Îç∞Ïù¥ÌÑ∞ ÌëúÏãú');
            const viewElement = document.getElementById('parsedDataView');
            const contentElement = document.getElementById('parsedDataContent');
            
            if (knowledgeBase.parsedData.length === 0) {
                contentElement.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ÌååÏã±Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.<br>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥† ÌååÏã±ÏùÑ Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</p>';
            } else {
                let html = '';
                knowledgeBase.parsedData.forEach((qa, index) => {
                    html += `
                        <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
                            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                                <strong style="color: #495057; font-size: 14px;">#${index + 1} | Ï∂úÏ≤ò: ${qa.source}</strong>
                                <small style="color: #6c757d;">ÎùºÏù∏: ${qa.lineNumber}</small>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #28a745;">Q:</strong> ${qa.question}
                            </div>
                            <div>
                                <strong style="color: #007bff;">A:</strong> ${qa.answer.length > 100 ? qa.answer.substring(0, 100) + '...' : qa.answer}
                            </div>
                        </div>
                    `;
                });
                contentElement.innerHTML = html;
            }
            
            if (viewElement.style.display === 'none') {
                viewElement.style.display = 'block';
            } else {
                viewElement.style.display = 'none';
            }
        }

        function searchInKnowledgeBase(userMessage) {
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                console.log('‚ùå ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎπÑÌôúÏÑ± ÎòêÎäî Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
                return null;
            }
            
            const message = userMessage.toLowerCase().trim();
            console.log('üîç ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâ ÏãúÏûë:', message);
            
            let searchResults = [];
            
            for (let qa of knowledgeBase.parsedData) {
                const question = qa.question.toLowerCase();
                const answer = qa.answer.toLowerCase();
                let score = 0;
                let matchDetails = [];
                
                if (question === message || answer.includes(message)) {
                    score += 1000;
                    matchDetails.push('ÏôÑÏ†ÑÏùºÏπò');
                }
                
                if (question.includes(message) || message.includes(question)) {
                    score += 800;
                    matchDetails.push('Î∂ÄÎ∂ÑÌè¨Ìï®');
                }
                
                const messageWords = message.split(/\s+/).filter(word => word.length > 1);
                const questionWords = question.split(/\s+/).filter(word => word.length > 1);
                
                let wordMatches = 0;
                for (let word of messageWords) {
                    if (question.includes(word)) {
                        score += 200;
                        wordMatches++;
                    }
                    if (answer.includes(word)) {
                        score += 100;
                        wordMatches++;
                    }
                }
                
                if (wordMatches > 0) {
                    matchDetails.push(`Îã®Ïñ¥Îß§Ïπ≠(${wordMatches})`);
                }
                
                for (let qWord of questionWords) {
                    for (let mWord of messageWords) {
                        if ((qWord.includes(mWord) || mWord.includes(qWord)) && mWord.length > 1) {
                            score += 50;
                        }
                    }
                }
                
                const topics = {
                    'ÏãúÍ∞Ñ': ['ÏãúÍ∞Ñ', 'Ïñ∏Ï†ú', 'Î™áÏãú', 'Ïò§Ìîà', 'Î¨∏Ïó¨', 'Ïö¥ÏòÅ', 'Í∑ºÎ¨¥', 'ÏßÑÎ£åÏãúÍ∞Ñ', 'Ïó¥Ïñ¥', 'Îã´Ïñ¥'],
                    'ÏòàÏïΩ': ['ÏòàÏïΩ', 'Ïã†Ï≤≠', 'Ï†ëÏàò', 'Î∞©Î¨∏', 'Í∞ÄÍ≥†Ïã∂', 'ÏÉÅÎã¥', 'ÏòàÏïΩÌïòÍ∏∞', 'Ïã†Ï≤≠ÌïòÍ∏∞', 'ÏòàÏïΩÎ¨∏Ïùò', 'Ïã†Ï≤≠Î¨∏Ïùò'],
                    'ÎπÑÏö©': ['ÎπÑÏö©', 'Í∞ÄÍ≤©', 'ÏñºÎßà', 'Îèà', 'Í∏àÏï°', 'Î£å', 'ÏàòÍ∞Ä', 'ÏπòÎ£åÎπÑ', 'ÏßÑÎ£åÎπÑ', 'ÏöîÍ∏à', 'Í∞í'],
                    'ÏúÑÏπò': ['ÏúÑÏπò', 'Ï£ºÏÜå', 'Ïñ¥Îîî', 'Ï∞æÏïÑ', 'Ïò§ÏãúÎäîÍ∏∏', 'ÍµêÌÜµ', 'Í∏∏', 'Ï∞æÍ∏∞', 'Ïñ¥ÎîîÏóê', 'Ïñ¥ÎäêÍ≥≥'],
                    'ÏπòÎ£å': ['ÏπòÎ£å', 'ÏãúÏà†', 'ÏàòÏà†', 'Ï≤òÏπò', 'ÏßÑÎ£å', 'ÏùòÎ£å', 'Î≥ëÏõê', 'ÏπòÍ≥º'],
                    'ÌÜµÏ¶ù': ['ÏïÑÌîÑ', 'ÌÜµÏ¶ù', 'ÏïÑÌîà', 'Ïì∞ÎùºÎ¶∞', 'Î∂àÌé∏', 'Í≥†ÌÜµ', 'ÏïÑÌåå'],
                    'ÏûÑÌîåÎûÄÌä∏': ['ÏûÑÌîåÎûÄÌä∏', 'Ïù∏Í≥µÏπòÏïÑ', 'Ïã¨Í∏∞', 'ÏãùÎ¶Ω', 'Ïù∏Í≥µ', 'ÎºàÏóê'],
                    'ÍµêÏ†ï': ['ÍµêÏ†ï', 'Î∏åÎùºÏºì', 'ÏπòÏó¥', 'Í∞ÄÏßÄÎü∞', 'Í≥†Î•¥Í≤å', 'Î∞òÎìØ', 'ÏÇêÎö§'],
                    'ÎØ∏Î∞±': ['ÎØ∏Î∞±', 'ÌïòÏñóÍ≤å', 'Ìù¨Í≤å', 'Î∞ùÍ≤å', 'ÌôîÏù¥Ìä∏Îãù', 'ÌïòÏñë'],
                    'Î≥¥Ï≤†': ['Î≥¥Ï≤†', 'ÌÅ¨ÎùºÏö¥', 'ÏîåÏö∞Í∏∞', 'ÏîåÏõå', 'ÎçÆÍ∞ú', 'ÎçÆÏñ¥'],
                    'ÏÜåÏïÑ': ['ÏÜåÏïÑ', 'Ïñ¥Î¶∞Ïù¥', 'ÏïÑÏù¥', 'ÏïÑÎèô', 'Ïú†ÏïÑ', 'Ïï†Í∏∞'],
                    'Ï∂©Ïπò': ['Ï∂©Ïπò', 'Ïö∞Ïãù', 'Ïç©', 'Î≤åÎ†à', 'Íµ¨Î©ç', 'ÍπåÎß£']
                };
                
                let topicMatches = 0;
                for (let [topic, keywords] of Object.entries(topics)) {
                    for (let keyword of keywords) {
                        if (message.includes(keyword)) {
                            if (question.includes(keyword) || answer.includes(keyword) || question.includes(topic)) {
                                score += 150;
                                topicMatches++;
                            }
                        }
                    }
                }
                
                if (topicMatches > 0) {
                    matchDetails.push(`Ï£ºÏ†úÎß§Ïπ≠(${topicMatches})`);
                }
                
                if (score > 0) {
                    searchResults.push({ qa, score, matchDetails });
                    console.log(`üìù Í≤ÄÏÉâ ÌõÑÎ≥¥: "${qa.question.substring(0, 40)}..." | Ï†êÏàò: ${score}`);
                }
            }
            
            searchResults.sort((a, b) => b.score - a.score);
            
            if (searchResults.length > 0 && searchResults[0].score >= 30) {
                const bestMatch = searchResults[0].qa;
                console.log('‚úÖ ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎãµÎ≥Ä ÏÑ†ÌÉù:', bestMatch.question);
                return formatKnowledgeBaseAnswer(bestMatch, userMessage);
            }
            
            console.log('‚ùå ÏßÄÏãùÎ≤†Ïù¥Ïä§ÏóêÏÑú Ï†ÅÏ†àÌïú ÎãµÎ≥ÄÏùÑ Ï∞æÏßÄ Î™ªÌï®');
            return null;
        }

        function testKnowledgeBaseAuto() {
            console.log('üß™ ÏûêÎèô ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÌÖåÏä§Ìä∏ ÏãúÏûë');
            
            if (!knowledgeBase.enabled || knowledgeBase.parsedData.length === 0) {
                console.log('‚ùå ÌÖåÏä§Ìä∏ Î∂àÍ∞Ä: ÏßÄÏãùÎ≤†Ïù¥Ïä§ ÎπÑÌôúÏÑ±');
                return;
            }
            
            const testQueries = [];
            
            for (let i = 0; i < Math.min(3, knowledgeBase.parsedData.length); i++) {
                const qa = knowledgeBase.parsedData[i];
                const question = qa.question;
                
                const keywords = question.toLowerCase().split(/\s+/).filter(word => 
                    word.length > 2 && !['Ïñ¥ÎñªÍ≤å', 'Ïñ∏Ï†ú', 'Ïñ¥ÎîîÏÑú', 'Ïôú', 'Î¨¥Ïóá', 'ÎàÑÍ∞Ä'].includes(word)
                );
                
                if (keywords.length > 0) {
                    testQueries.push(keywords[0]);
                }
            }
            
            testQueries.push('ÏßÑÎ£åÏãúÍ∞Ñ', 'ÏòàÏïΩ', 'ÎπÑÏö©');
            
            let successCount = 0;
            let testResults = [];
            
            testQueries.forEach(query => {
                const result = searchInKnowledgeBase(query);
                if (result) {
                    testResults.push(`‚úÖ "${query}" - ÎãµÎ≥Ä Î∞úÍ≤¨`);
                    successCount++;
                } else {
                    testResults.push(`‚ùå "${query}" - ÎãµÎ≥Ä ÏóÜÏùå`);
                }
            });
            
            const message = `üß™ ÏûêÎèô ÌÖåÏä§Ìä∏ ÏôÑÎ£å (${successCount}/${testQueries.length})\n${testResults.join('\n')}\n\n${successCount > 0 ? 'üéâ ÏßÄÏãùÎ≤†Ïù¥Ïä§Í∞Ä Ï†ïÏÉÅ ÏûëÎèôÌï©ÎãàÎã§!' : '‚ö†Ô∏è ÏßÄÏãùÎ≤†Ïù¥Ïä§ Í≤ÄÏÉâÏóê Î¨∏Ï†úÍ∞Ä ÏûàÏùÑ Ïàò ÏûàÏäµÎãàÎã§.'}`;
            
            showStatus('knowledgeSettingsStatus', message, successCount > 0 ? 'success' : 'error');
        }

        function formatKnowledgeBaseAnswer(qa, originalQuestion) {
            let formattedAnswer = qa.answer.trim();
            
            formattedAnswer = formattedAnswer
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            if (formattedAnswer.includes('1.') || formattedAnswer.includes('‚Ä¢') || formattedAnswer.includes('-')) {
                formattedAnswer = formattedAnswer
                    .replace(/(\d+\.)/g, '<br>$1')
                    .replace(/(‚Ä¢)/g, '<br>$1')
                    .replace(/^-/gm, '<br>‚Ä¢');
            }
            
            return `üìö <strong>ÌîºÎãâÏä§ ÏπòÍ≥º Ï†ÑÎ¨∏ ÏïàÎÇ¥</strong><br><br>
            ${formattedAnswer}<br><br>
            <div style="background: #f0f8ff; padding: 10px; border-radius: 8px; margin-top: 10px;">
                üí° <strong>Ï∂îÍ∞Ä ÎèÑÏõÄÏù¥ ÌïÑÏöîÌïòÏãúÎã§Î©¥:</strong><br>
                üìû Ï†ÑÌôîÏÉÅÎã¥: 070-1234-1234 (24ÏãúÍ∞Ñ)<br>
                üïò ÏßÑÎ£åÏãúÍ∞Ñ: ÌèâÏùº 09:00-18:00, ÌÜ†ÏöîÏùº 09:00-15:00<br>
                üìç ÏúÑÏπò: Í∞ïÎÇ®Ïó≠ 3Î≤à Ï∂úÍµ¨ ÎèÑÎ≥¥ 5Î∂Ñ
            </div><br>
            <small>üìñ Ï∂úÏ≤ò: ${qa.source} | Îçî Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ Ïñ∏Ï†úÎì† Î¨∏ÏùòÌï¥Ï£ºÏÑ∏Ïöî!</small>`;
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å
        console.log('Î™®Îì† Ìï®Ïàò Î°úÎìú ÏôÑÎ£å');
        console.log('Î°úÍ∑∏Ïù∏ Ìï®Ïàò ÌôïÏù∏:', typeof loginChatbotAdmin === 'function', typeof loginCustomerAdmin === 'function');

        // Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô Ìè¨Îß∑ÌåÖ
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInput = document.getElementById('phoneNumber');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    if (value.length > 3 && value.length <= 7) {
                        value = value.replace(/(\d{3})(\d+)/, '$1-$2');
                    } else if (value.length > 7) {
                        value = value.replace(/(\d{3})(\d{4})(\d{0,4})/, '$1-$2-$3');
                    }
                    e.target.value = value;
                });
            }
        });

        // Ìï¥Ïãú/ÌååÎùºÎØ∏ÌÑ∞Î°ú Î∞îÎ°ú Î©îÎâ¥ Ïó¥Í∏∞
        document.addEventListener('DOMContentLoaded', function() {
            const hash = window.location.hash;
            if (hash === '#reservation') {
                openReservation();
            }
            if (hash === '#chatbot') {
                toggleChatbot();
            }
        });
    </script>
    <!-- SheetJS (xlsx) for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</body>
</html>