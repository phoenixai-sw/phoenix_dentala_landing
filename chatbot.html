<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>피닉스 치과 AI 상담사</title>
    
    <!-- 카카오톡 인앱 브라우저 캐시 방지 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --vh: 1vh;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-overflow-scrolling: touch;
        }

        .chatbot-main {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: white;
            position: relative;
        }

        /* 헤더 */
        .chatbot-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 18px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            flex-shrink: 0;
            order: 1;
        }

        .chatbot-title {
            font-size: 22px;
            font-weight: bold;
            margin: 0;
        }

        .back-link {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            width: 68px;
            height: 75px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
            padding: 4px;
            text-decoration: none;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .home-icon {
            font-size: 27px;
            line-height: 1;
        }

        .home-arrow {
            font-size: 17px;
            line-height: 1;
            margin-top: 3px;
        }

        /* 우측 상단 언어 선택 드롭다운 */
        .header-language-dropdown {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2000;
        }

        .language-dropdown {
            position: relative;
            display: inline-block;
        }

        .language-current {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 2px solid #ffbf00;
            color: black !important;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.4);
        }

        .language-current:hover {
            background: linear-gradient(135deg, #ffbf00 0%, #ffd700 100%);
            color: black !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.6);
        }

        .language-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            display: none;
            min-width: 140px;
            margin-top: 5px;
        }

        .language-menu.show {
            display: block;
        }

        .language-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            color: black !important;
        }

        .language-option:last-child {
            border-bottom: none;
        }

        .language-option:hover {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: black !important;
        }

        .language-option.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: black !important;
        }

        /* 메시지 영역 */
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            -webkit-overflow-scrolling: touch;
            order: 2;
            margin-bottom: 80px; /* 입력창 공간 확보 */
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #e9ecef;
            color: #495057;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            font-size: 14px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message.user .message-content {
            background: #4facfe;
            color: white;
            border-bottom-right-radius: 6px;
        }

        /* 빠른 버튼 */
        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-button {
            background: #f0f8ff;
            color: #4facfe;
            border: 1px solid #4facfe;
            border-radius: 15px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .quick-button:hover {
            background: #4facfe;
            color: white;
        }

        /* 입력 영역 - 화면 하단 고정 */
        .chatbot-input {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            padding: 15px;
            display: flex;
            gap: 10px;
            align-items: flex-end;
            z-index: 1000;
            order: 3;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .chatbot-input textarea {
            flex: 1;
            border: 2px solid #4facfe;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 16px;
            resize: none;
            outline: none;
            min-height: 45px;
            max-height: 120px;
            line-height: 1.4;
            -webkit-user-select: text;
            user-select: text;
            touch-action: manipulation;
        }

        .chatbot-input textarea:focus {
            border-color: #00f2fe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }

        .chatbot-send {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 108px;
            height: 45px;
            touch-action: manipulation;
        }

        .chatbot-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .chatbot-send:active {
            transform: translateY(0);
        }

        /* 반응형 디자인 - 모바일 최적화 */
        @media (max-width: 768px) {
            .chatbot-header {
                padding: 15px 8px;
            }
            
            .chatbot-title {
                font-size: 18px;
                margin: 0 120px; /* 좌우 버튼 공간 확보 */
            }
            
            .back-link {
                width: 52px;
                height: 58px;
                left: 8px;
            }
            
            .home-icon {
                font-size: 22px;
            }
            
            .home-arrow {
                font-size: 14px;
            }
            
            .header-language-dropdown {
                right: 8px;
            }
            
            .language-current {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 100px;
                color: black !important;
            }
            
            .language-option {
                color: black !important;
            }
            
            .chatbot-messages {
                padding: 15px;
                margin-bottom: 75px;
            }
            
            /* 환영 메시지 일반 모바일 최적화 */
            .message.bot .message-content div[style*="font-size: 18px"] {
                font-size: 17px !important;
            }
            
            .message.bot .message-content div[style*="font-size: 14px"] {
                font-size: 13px !important;
                line-height: 1.5 !important;
                padding: 0 5px !important;
            }
            
            .quick-buttons {
                gap: 8px !important;
                justify-content: center !important;
            }
            
            .quick-button {
                font-size: 12px !important;
                padding: 8px 12px !important;
                border-radius: 12px !important;
            }
            
            .chatbot-input {
                padding: 10px;
            }
            
            .chatbot-send {
                min-width: 80px;
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .chatbot-header {
                padding: 12px 5px;
            }
            
            .chatbot-title {
                font-size: 16px;
                margin: 0 100px;
            }
            
            .back-link {
                width: 45px;
                height: 50px;
                left: 5px;
            }
            
            .home-icon {
                font-size: 20px;
            }
            
            .home-arrow {
                font-size: 12px;
            }
            
            .header-language-dropdown {
                right: 5px;
            }
            
            .language-current {
                padding: 6px 10px;
                font-size: 11px;
                min-width: 85px;
                color: black !important;
            }
            
            .language-option {
                color: black !important;
            }
            
            .chatbot-messages {
                padding: 10px;
                margin-bottom: 70px;
            }
            
            /* 환영 메시지 480px 이하 모바일 최적화 */
            .message.bot .message-content div[style*="font-size: 18px"] {
                font-size: 16px !important;
            }
            
            .message.bot .message-content div[style*="font-size: 14px"] {
                font-size: 12px !important;
                line-height: 1.4 !important;
                padding: 0 3px !important;
            }
            
            .quick-buttons {
                gap: 6px !important;
                justify-content: center !important;
            }
            
            .quick-button {
                font-size: 11px !important;
                padding: 6px 10px !important;
                border-radius: 10px !important;
            }
            
            .chatbot-input {
                padding: 8px;
            }
            
            .chatbot-send {
                min-width: 70px;
                padding: 8px 16px;
                font-size: 13px;
            }
        }

        /* Galaxy XCover 5 특별 최적화 */
        @media screen and (max-width: 432px) and (max-height: 900px) {
            .chatbot-header {
                padding: 10px 5px;
            }
            
            .chatbot-title {
                font-size: 15px;
                margin: 0 90px;
            }
            
            .back-link {
                width: 40px;
                height: 45px;
                left: 5px;
            }
            
            .home-icon {
                font-size: 18px;
            }
            
            .home-arrow {
                font-size: 10px;
            }
            
            .header-language-dropdown {
                right: 5px;
            }
            
            .language-current {
                padding: 5px 8px;
                font-size: 10px;
                min-width: 75px;
            }
            
            .chatbot-messages {
                padding: 8px;
                margin-bottom: 65px;
            }
            
            .chatbot-input {
                padding: 6px;
            }
            
            .chatbot-input textarea {
                font-size: 14px;
                padding: 10px 12px;
            }
            
            .chatbot-send {
                min-width: 60px;
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        /* 아이폰 미니 특별 최적화 */
        @media screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
            .chatbot-header {
                padding: 12px 5px;
            }
            
            .chatbot-title {
                font-size: 16px;
                margin: 0 95px;
            }
            
            .header-language-dropdown {
                right: 5px;
            }
            
            .language-current {
                padding: 6px 10px;
                font-size: 11px;
                min-width: 80px;
            }
            
            .chatbot-messages {
                margin-bottom: 70px;
            }
        }

        /* 카카오톡 브라우저 특별 최적화 */
        .kakao-optimized {
            -webkit-overflow-scrolling: touch;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        /* iOS Safari 특별 최적화 */
        @supports (-webkit-touch-callout: none) {
            .chatbot-main {
                height: 100vh;
                height: -webkit-fill-available;
            }
            
            .chatbot-input {
                padding-bottom: env(safe-area-inset-bottom, 15px);
            }
            
            .chatbot-messages {
                padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
            }
        }

        /* 아이폰11 특별 최적화 (414×896) */
        @media screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) {
            .chatbot-header {
                padding: 15px 8px;
            }
            
            .chatbot-title {
                font-size: 18px;
                margin: 0 130px;
            }
            
            .header-language-dropdown {
                right: 8px;
            }
            
            .language-current {
                padding: 8px 12px;
                font-size: 13px;
                min-width: 110px;
                color: black !important;
            }
            
            .language-option {
                color: black !important;
            }
            
            .chatbot-messages {
                margin-bottom: 85px;
            }
            
            /* 환영 메시지 아이폰11 최적화 */
            .message.bot .message-content div[style*="font-size: 18px"] {
                font-size: 18px !important;
            }
            
            .message.bot .message-content div[style*="font-size: 14px"] {
                font-size: 14px !important;
                line-height: 1.5 !important;
            }
            
            .quick-buttons {
                gap: 10px !important;
            }
            
            .quick-button {
                font-size: 13px !important;
                padding: 8px 14px !important;
            }
        }

        /* 아이폰 미니 추가 최적화 (375×812) */
        @media screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
            .chatbot-header {
                padding: 12px 5px;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            
            .chatbot-title {
                font-size: 16px;
                margin: 0 100px;
                line-height: 1.2;
            }
            
            .header-language-dropdown {
                right: 5px;
            }
            
            .language-current {
                padding: 6px 10px;
                font-size: 11px;
                min-width: 85px;
                color: black !important;
            }
            
            .language-option {
                color: black !important;
            }
            
            .chatbot-messages {
                margin-bottom: 75px;
                padding: 10px;
            }
            
            /* 환영 메시지 아이폰 미니 최적화 */
            .message.bot .message-content div[style*="font-size: 18px"] {
                font-size: 17px !important;
            }
            
            .message.bot .message-content div[style*="font-size: 14px"] {
                font-size: 13px !important;
                line-height: 1.5 !important;
            }
            
            .quick-buttons {
                gap: 8px !important;
            }
            
            .quick-button {
                font-size: 12px !important;
                padding: 7px 12px !important;
            }
            
            .chatbot-input {
                padding: 8px;
            }
            
            .chatbot-input textarea {
                font-size: 16px; /* iOS zoom 방지 */
                padding: 10px 14px;
            }
        }

        /* Galaxy XCover 5 및 유사 안드로이드 기기 최적화 */
        @media screen and (max-width: 432px) and (max-height: 900px) and (orientation: portrait) {
            body {
                font-size: 14px;
            }
            
            .chatbot-header {
                padding: 10px 5px;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            
            .chatbot-title {
                font-size: 15px;
                margin: 0 95px;
                line-height: 1.2;
            }
            
            .back-link {
                width: 42px;
                height: 47px;
                left: 5px;
            }
            
            .home-icon {
                font-size: 18px;
            }
            
            .home-arrow {
                font-size: 10px;
            }
            
            .header-language-dropdown {
                right: 5px;
            }
            
            .language-current {
                padding: 5px 8px;
                font-size: 10px;
                min-width: 80px;
                color: black !important;
            }
            
            .language-menu {
                min-width: 120px;
                font-size: 12px;
            }
            
            .language-option {
                padding: 10px 16px;
                font-size: 12px;
                color: black !important;
            }
            
            .chatbot-messages {
                padding: 8px;
                margin-bottom: 70px;
            }
            
            .message-content {
                max-width: 85%;
                font-size: 13px;
                padding: 10px 14px;
            }
            
            /* 환영 메시지 Galaxy XCover 5 최적화 */
            .message.bot .message-content div[style*="font-size: 18px"] {
                font-size: 16px !important;
            }
            
            .message.bot .message-content div[style*="font-size: 14px"] {
                font-size: 12px !important;
                line-height: 1.5 !important;
            }
            
            .quick-buttons {
                gap: 6px !important;
            }
            
            .quick-button {
                font-size: 11px !important;
                padding: 6px 10px !important;
            }
            
            .chatbot-input {
                padding: 6px;
            }
            
            .chatbot-input textarea {
                font-size: 16px; /* 안드로이드 zoom 방지 */
                padding: 10px 12px;
                min-height: 42px;
            }
            
            .chatbot-send {
                min-width: 65px;
                padding: 6px 14px;
                font-size: 12px;
                height: 42px;
            }
        }

        /* 극소형 모바일 (320px 이하) 최적화 */
        @media screen and (max-width: 320px) {
            .chatbot-title {
                font-size: 14px;
                margin: 0 80px;
            }
            
            .back-link {
                width: 35px;
                height: 40px;
                left: 3px;
            }
            
            .home-icon {
                font-size: 16px;
            }
            
            .home-arrow {
                font-size: 9px;
            }
            
            .header-language-dropdown {
                right: 3px;
            }
            
            .language-current {
                padding: 4px 6px;
                font-size: 9px;
                min-width: 70px;
                color: black !important;
            }
            
            .language-option {
                color: black !important;
            }
            
            .chatbot-messages {
                padding: 6px;
                margin-bottom: 65px;
            }
            
            .message-content {
                max-width: 90%;
                font-size: 12px;
                padding: 8px 12px;
            }
            
            /* 환영 메시지 모바일 최적화 */
            .message.bot .message-content div[style*="font-size: 18px"] {
                font-size: 16px !important;
            }
            
            .message.bot .message-content div[style*="font-size: 14px"] {
                font-size: 13px !important;
                line-height: 1.4 !important;
            }
            
            .chatbot-input textarea {
                font-size: 16px;
                padding: 8px 10px;
                min-height: 38px;
            }
            
            .chatbot-send {
                min-width: 55px;
                padding: 5px 10px;
                font-size: 11px;
                height: 38px;
            }
        }

        /* 가로 모드 최적화 */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .chatbot-header {
                padding: 8px;
            }
            
            .chatbot-title {
                font-size: 16px;
            }
            
            .back-link {
                width: 45px;
                height: 50px;
            }
            
            .language-current {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .chatbot-messages {
                margin-bottom: 60px;
                padding: 10px;
            }
            
            .chatbot-input {
                padding: 8px;
            }
        }

        /* 모바일 기기 터치 이벤트 최적화 */
        .quick-button {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        .quick-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .quick-button:active {
            transform: translateY(0);
        }

        /* 진료시간 버튼 호버 효과 */
        .clinic-hours-btn:hover {
            background: linear-gradient(135deg, #ffed4e 0%, #ffd700 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4) !important;
        }

        /* 치료비용 버튼 호버 효과 */
        .treatment-cost-btn:hover {
            background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 136, 229, 0.4) !important;
        }

        /* 예약문의 버튼 호버 효과 */
        .reservation-btn:hover {
            background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 105, 180, 0.4) !important;
        }

        /* 오시는길 버튼 호버 효과 */
        .directions-btn:hover {
            background: linear-gradient(135deg, #8bc34a 0%, #4caf50 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4) !important;
        }

        /* 카카오톡 브라우저 최적화 */
        .kakao-optimized .quick-button {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: none;
            outline: none;
        }

        /* 아이폰 11 최적화 (414×896) */
        @media screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) {
            .quick-buttons {
                gap: 8px !important;
                padding: 5px !important;
            }
            
            .quick-button {
                padding: 10px 6px !important;
                font-size: 12px !important;
                font-weight: bold !important;
                border-radius: 18px !important;
                min-height: 36px !important;
            }
        }

        /* 아이폰 미니 최적화 (375×812) */
        @media screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) {
            .quick-buttons {
                gap: 6px !important;
                padding: 3px !important;
            }
            
            .quick-button {
                padding: 8px 5px !important;
                font-size: 11px !important;
                font-weight: bold !important;
                border-radius: 16px !important;
                min-height: 34px !important;
            }
        }

        /* Galaxy XCover 5 최적화 */
        @media screen and (max-width: 432px) and (max-height: 900px) and (orientation: portrait) {
            .quick-buttons {
                gap: 6px !important;
                padding: 3px !important;
                max-width: 280px !important;
            }
            
            .quick-button {
                padding: 8px 4px !important;
                font-size: 10px !important;
                font-weight: bold !important;
                border-radius: 15px !important;
                min-height: 32px !important;
            }
        }

        /* 극도로 작은 화면 최적화 */
        @media (max-width: 320px) {
            .quick-buttons {
                gap: 4px !important;
                padding: 2px !important;
                max-width: 260px !important;
            }
            
            .quick-button {
                padding: 6px 3px !important;
                font-size: 9px !important;
                font-weight: bold !important;
                border-radius: 12px !important;
                min-height: 28px !important;
            }
        }

        /* 터치 이벤트 강화 */
        .quick-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, box-shadow;
        }

        .quick-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
        }

        /* 카카오톡 브라우저 캐시 방지 */
        .kakao-optimized * {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* 메시지 영역 터치 최적화 */
        .chatbot-messages {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        /* 입력 영역 터치 최적화 */
        .chatbot-input textarea {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 20px;
            outline: none;
        }

        .chatbot-send {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            outline: none;
            border: none;
            cursor: pointer;
        }

        /* 드롭다운 메뉴 터치 최적화 */
        .language-dropdown {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .language-current {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            cursor: pointer;
            outline: none;
            border: none;
        }

        .language-option {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            cursor: pointer;
        }

        .language-option:hover {
            background: rgba(79, 172, 254, 0.1);
        }

        .language-option:active {
            background: rgba(79, 172, 254, 0.2);
        }

        /* 백 버튼 터치 최적화 */
        .back-link {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            outline: none;
            border: none;
            cursor: pointer;
        }

        .back-link:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* 특정 모바일 기기 최적화 */
        @media screen and (max-width: 600px) {
            .chatbot-main {
                font-size: 14px;
            }
            
            .quick-button {
                font-size: 12px;
                padding: 10px 8px;
            }
            
            .chatbot-messages {
                padding: 15px;
            }
        }

        /* 추가 모바일 기기 최적화 */
        @media screen and (max-width: 480px) {
            .quick-button {
                font-size: 11px;
                padding: 8px 6px;
                min-height: 32px;
            }
            
            .quick-buttons {
                gap: 6px;
                max-width: 280px;
            }
        }

        /* 뷰포트 높이 설정 */
        @media screen and (max-height: 600px) {
            .chatbot-messages {
                max-height: 350px;
            }
        }

        /* 뷰포트 폰트 크기 조정 */
        @media screen and (max-width: 360px) {
            .quick-button {
                font-size: 10px;
                padding: 6px 4px;
                min-height: 28px;
            }
            
            .quick-buttons {
                gap: 4px;
                max-width: 250px;
            }
        }

        /* 로딩 애니메이션 최적화 */
        .quick-button {
            animation: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quick-button:hover {
            animation: none;
        }

        /* 성능 최적화 */
        .quick-button {
            will-change: transform, box-shadow;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }

        /* 터치 디바이스 감지 */
        @media (hover: none) and (pointer: coarse) {
            .quick-button:hover {
                transform: none;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
        }

        /* 추가 터치 이벤트 처리 */
        .quick-button {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        /* 카카오톡 브라우저 특별 처리 */
        @media screen and (max-width: 500px) {
            .kakao-optimized .quick-button {
                position: relative;
                z-index: 1;
                pointer-events: auto;
            }
        }

        .language-current, .language-option {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .chatbot-send {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .chatbot-send:active {
            transform: scale(0.95);
        }

        /* 카카오톡 브라우저 특별 최적화 */
        @supports (-webkit-touch-callout: none) {
            .quick-buttons {
                gap: 12px !important;
            }
            
            .quick-button {
                min-height: 44px !important;
                padding: 12px 16px !important;
            }
        }

        /* 키보드 열림 상태 최적화 */
        .keyboard-open .chatbot-messages {
            padding-bottom: 20px;
        }

        .keyboard-open .chatbot-input {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="chatbot-main">
        <!-- 헤더 -->
        <div class="chatbot-header">
            <a href="index.html" class="back-link">
                <span class="home-icon">🏠</span>
                <span class="home-arrow">←</span>
            </a>
            <h1 class="chatbot-title">피닉스 치과 AI 상담사👩‍⚕️</h1>
            
            <!-- 우측 상단 언어 선택 드롭다운 -->
            <div class="header-language-dropdown">
                <div class="language-dropdown">
                    <button class="language-current">
                        <span id="currentLanguageText" style="color: black;">🇰🇷 KR</span>
                        <span style="color: black;">▼</span>
                    </button>
                    <div class="language-menu" id="languageMenu">
                        <div class="language-option active" data-lang="ko" style="color: black;">🇰🇷 KR</div>
                        <div class="language-option" data-lang="en" style="color: black;">🇺🇸 US</div>
                        <div class="language-option" data-lang="ru" style="color: black;">🇷🇺 RU</div>
                        <div class="language-option" data-lang="ja" style="color: black;">🇯🇵 JP</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 메시지 영역 -->
        <div class="chatbot-messages" id="chatbotMessages">
            <!-- 메시지들이 여기에 추가됩니다 -->
        </div>

        <!-- 입력 영역 -->
        <div class="chatbot-input">
            <textarea id="chatbotInput" placeholder="메시지를 입력하세요... (Shift+Enter: 전송)" rows="1"></textarea>
            <button class="chatbot-send" onclick="sendMessage()">전송</button>
        </div>
    </div>

    <script>
        console.log('🚀 별도창 AI챗봇 페이지 로드 시작');

        // 전역 변수
        let currentLanguage = 'ko';
        let apiSettings = {
            chatgpt: { apiKey: '', model: '', enabled: false },
            gemini: { apiKey: '', model: '', enabled: false },
            claude: { apiKey: '', model: '', enabled: false },
            activeProvider: ''
        };

        // 언어별 텍스트
        const translations = {
            ko: {
                title: '피닉스 치과 AI 상담사👩‍⚕️',
                placeholder: '메시지를 입력하세요... (Shift+Enter: 전송)',
                sendButton: '전송',
                currentLanguage: '🇰🇷 KR',
                welcomeMessage: '피닉스 치과 AI상담사 입니다!',
                welcomeSubMessage: '우측 상단 메뉴, AI의 언어 변경 가능',
                clinicHours: `🕘 <strong>피닉스 치과 진료시간 안내</strong><br><br>
                    📅 <strong>평일:</strong> 09:00 ~ 18:00<br>
                    📅 <strong>토요일:</strong> 09:00 ~ 15:00<br>
                    🍽️ <strong>점심시간:</strong> 12:30 ~ 13:30<br>
                    🚫 <strong>휴진:</strong> 일요일, 공휴일<br><br>
                    📞 <strong>예약 문의:</strong> 070-1234-1234`,
                treatmentCost: `💰 <strong>피닉스 치과 치료비용 안내</strong><br><br>
                    🦷 <strong>일반 진료:</strong> 상담 후 안내<br>
                    🦷 <strong>스케일링:</strong> 30,000원 ~ 50,000원<br>
                    🦷 <strong>임플란트:</strong> 상담 후 개별 견적<br>
                    🦷 <strong>교정:</strong> 상담 후 개별 견적<br><br>
                    💡 <strong>정확한 비용은 진료 후 안내드립니다!</strong>`,
                reservationInquiry: `📞 <strong>피닉스 치과 예약 문의</strong><br><br>
                    🏥 <strong>병원명:</strong> 피닉스 치과<br>
                    📞 <strong>전화번호:</strong> 070-1234-1234<br>
                    💬 <strong>카카오톡:</strong> 피닉스치과<br>
                    🌐 <strong>온라인 예약:</strong> 홈페이지 예약 시스템 이용<br><br>
                    ⏰ <strong>전화 상담 시간:</strong><br>
                    • 평일: 09:00 ~ 17:30<br>
                    • 토요일: 09:00 ~ 14:30<br>
                    • 일요일/공휴일: 휴무<br><br>
                    💡 <strong>온라인 예약이 가장 편리합니다!</strong>`,
                directions: `🗺️ <strong>피닉스 치과 오시는길</strong><br><br>
                    📍 <strong>주소:</strong> 서울특별시 강남구 테헤란로 123<br>
                    🚇 <strong>지하철:</strong> 2호선 강남역 3번 출구 도보 5분<br>
                    🚌 <strong>버스:</strong> 강남역 정류장 하차<br>
                    🚗 <strong>주차:</strong> 건물 지하 1층 (2시간 무료)<br><br>
                    🏢 <strong>건물 안내:</strong><br>
                    • 피닉스 빌딩 3층<br>
                    • 엘리베이터 이용<br>
                    • 1층 안내데스크에서 문의 가능<br><br>
                    📞 <strong>길찾기 문의:</strong> 070-1234-1234`
            },
            en: {
                title: 'Phoenix Dental AI Consultant👩‍⚕️',
                placeholder: 'Enter your message... (Shift+Enter: Send)',
                sendButton: 'Send',
                currentLanguage: '🇺🇸 US',
                welcomeMessage: 'I am Phoenix Dental AI consultant!',
                welcomeSubMessage: 'Top right menu, AI language change available',
                clinicHours: `🕘 <strong>Phoenix Dental Clinic Hours</strong><br><br>
                    📅 <strong>Weekdays:</strong> 09:00 ~ 18:00<br>
                    📅 <strong>Saturday:</strong> 09:00 ~ 15:00<br>
                    🍽️ <strong>Lunch Break:</strong> 12:30 ~ 13:30<br>
                    🚫 <strong>Closed:</strong> Sunday, Holidays<br><br>
                    📞 <strong>Reservation:</strong> 070-1234-1234`,
                treatmentCost: `💰 <strong>Phoenix Dental Treatment Costs</strong><br><br>
                    🦷 <strong>General Treatment:</strong> Consultation required<br>
                    🦷 <strong>Scaling:</strong> 30,000 ~ 50,000 KRW<br>
                    🦷 <strong>Implant:</strong> Individual estimate after consultation<br>
                    🦷 <strong>Orthodontics:</strong> Individual estimate after consultation<br><br>
                    💡 <strong>Exact costs will be provided after examination!</strong>`,
                reservationInquiry: `📞 <strong>Phoenix Dental Reservation Inquiry</strong><br><br>
                    🏥 <strong>Clinic Name:</strong> Phoenix Dental<br>
                    📞 <strong>Phone:</strong> 070-1234-1234<br>
                    💬 <strong>KakaoTalk:</strong> Phoenix Dental<br>
                    🌐 <strong>Online Booking:</strong> Use website reservation system<br><br>
                    ⏰ <strong>Phone Consultation Hours:</strong><br>
                    • Weekdays: 09:00 ~ 17:30<br>
                    • Saturday: 09:00 ~ 14:30<br>
                    • Sunday/Holidays: Closed<br><br>
                    💡 <strong>Online booking is most convenient!</strong>`,
                directions: `🗺️ <strong>Directions to Phoenix Dental</strong><br><br>
                    📍 <strong>Address:</strong> 123 Teheran-ro, Gangnam-gu, Seoul<br>
                    🚇 <strong>Subway:</strong> Line 2 Gangnam Station Exit 3, 5 min walk<br>
                    🚌 <strong>Bus:</strong> Get off at Gangnam Station<br>
                    🚗 <strong>Parking:</strong> Building B1 (2 hours free)<br><br>
                    🏢 <strong>Building Guide:</strong><br>
                    • Phoenix Building 3rd Floor<br>
                    • Use elevator<br>
                    • Information desk available on 1st floor<br><br>
                    📞 <strong>Direction Inquiry:</strong> 070-1234-1234`
            },
            ru: {
                title: 'Консультант ИИ стоматологии Phoenix👩‍⚕️',
                placeholder: 'Введите ваше сообщение... (Shift+Enter: Отправить)',
                sendButton: 'Отправить',
                currentLanguage: '🇷🇺 RU',
                welcomeMessage: 'Я консультант ИИ стоматологии Phoenix!',
                welcomeSubMessage: 'Меню в правом верхнем углу, изменение языка ИИ доступно',
                clinicHours: `🕘 <strong>Часы работы стоматологии Phoenix</strong><br><br>
                    📅 <strong>Будни:</strong> 09:00 ~ 18:00<br>
                    📅 <strong>Суббота:</strong> 09:00 ~ 15:00<br>
                    🍽️ <strong>Обед:</strong> 12:30 ~ 13:30<br>
                    🚫 <strong>Выходные:</strong> Воскресенье, праздники<br><br>
                    📞 <strong>Запись:</strong> 070-1234-1234`,
                treatmentCost: `💰 <strong>Стоимость лечения в стоматологии Phoenix</strong><br><br>
                    🦷 <strong>Общее лечение:</strong> Требуется консультация<br>
                    🦷 <strong>Чистка:</strong> 30,000 ~ 50,000 вон<br>
                    🦷 <strong>Имплант:</strong> Индивидуальная оценка после консультации<br>
                    🦷 <strong>Ортодонтия:</strong> Индивидуальная оценка после консультации<br><br>
                    💡 <strong>Точная стоимость будет предоставлена после обследования!</strong>`,
                reservationInquiry: `📞 <strong>Запись в стоматологию Phoenix</strong><br><br>
                    🏥 <strong>Название клиники:</strong> Phoenix Dental<br>
                    📞 <strong>Телефон:</strong> 070-1234-1234<br>
                    💬 <strong>KakaoTalk:</strong> Phoenix Dental<br>
                    🌐 <strong>Онлайн запись:</strong> Используйте систему записи на сайте<br><br>
                    ⏰ <strong>Часы телефонных консультаций:</strong><br>
                    • Будни: 09:00 ~ 17:30<br>
                    • Суббота: 09:00 ~ 14:30<br>
                    • Воскресенье/праздники: Закрыто<br><br>
                    💡 <strong>Онлайн запись наиболее удобна!</strong>`,
                directions: `🗺️ <strong>Как добраться до стоматологии Phoenix</strong><br><br>
                    📍 <strong>Адрес:</strong> Сеул, Каннам-гу, Техеран-ро 123<br>
                    🚇 <strong>Метро:</strong> Линия 2, станция Каннам, выход 3, 5 мин пешком<br>
                    🚌 <strong>Автобус:</strong> Остановка станция Каннам<br>
                    🚗 <strong>Парковка:</strong> Подземный этаж здания (2 часа бесплатно)<br><br>
                    🏢 <strong>Описание здания:</strong><br>
                    • Здание Phoenix, 3-й этаж<br>
                    • Используйте лифт<br>
                    • Информационная стойка на 1-м этаже<br><br>
                    📞 <strong>Справки о маршруте:</strong> 070-1234-1234`
            },
            ja: {
                title: 'フェニックス歯科AIコンサルタント👩‍⚕️',
                placeholder: 'メッセージを入力してください... (Shift+Enter: 送信)',
                sendButton: '送信',
                currentLanguage: '🇯🇵 JP',
                welcomeMessage: 'フェニックス歯科AIコンサルタントです！',
                welcomeSubMessage: '右上メニュー、AI言語変更可能',
                clinicHours: `🕘 <strong>フェニックス歯科診療時間案内</strong><br><br>
                    📅 <strong>平日:</strong> 09:00 ~ 18:00<br>
                    📅 <strong>土曜日:</strong> 09:00 ~ 15:00<br>
                    🍽️ <strong>昼休み:</strong> 12:30 ~ 13:30<br>
                    🚫 <strong>休診:</strong> 日曜日、祝日<br><br>
                    📞 <strong>予約問い合わせ:</strong> 070-1234-1234`,
                treatmentCost: `💰 <strong>フェニックス歯科治療費案内</strong><br><br>
                    🦷 <strong>一般診療:</strong> 相談後ご案内<br>
                    🦷 <strong>スケーリング:</strong> 30,000円 ~ 50,000円<br>
                    🦷 <strong>インプラント:</strong> 相談後個別見積もり<br>
                    🦷 <strong>矯正:</strong> 相談後個別見積もり<br><br>
                    💡 <strong>正確な費用は診療後にご案内いたします！</strong>`,
                reservationInquiry: `📞 <strong>フェニックス歯科予約問い合わせ</strong><br><br>
                    🏥 <strong>病院名:</strong> フェニックス歯科<br>
                    📞 <strong>電話番号:</strong> 070-1234-1234<br>
                    💬 <strong>カカオトーク:</strong> フェニックス歯科<br>
                    🌐 <strong>オンライン予約:</strong> ホームページ予約システム利用<br><br>
                    ⏰ <strong>電話相談時間:</strong><br>
                    • 平日: 09:00 ~ 17:30<br>
                    • 土曜日: 09:00 ~ 14:30<br>
                    • 日曜日/祝日: 休業<br><br>
                    💡 <strong>オンライン予約が最も便利です！</strong>`,
                directions: `🗺️ <strong>フェニックス歯科へのアクセス</strong><br><br>
                    📍 <strong>住所:</strong> ソウル特別市江南区テヘラン路123<br>
                    🚇 <strong>地下鉄:</strong> 2号線江南駅3番出口徒歩5分<br>
                    🚌 <strong>バス:</strong> 江南駅停留所下車<br>
                    🚗 <strong>駐車場:</strong> 建物地下1階（2時間無料）<br><br>
                    🏢 <strong>建物案内:</strong><br>
                    • フェニックスビル3階<br>
                    • エレベーター利用<br>
                    • 1階案内デスクでお問い合わせ可能<br><br>
                    📞 <strong>道案内問い合わせ:</strong> 070-1234-1234`
            }
        };

        // 초기화
        window.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 별도창 AI챗봇 페이지 로드 시작');
            
            // 카카오톡 브라우저 감지
            const isKakaoTalk = navigator.userAgent.includes('KAKAO');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isKakaoTalk || isMobile) {
                console.log('카카오톡 브라우저 또는 모바일 기기 감지됨');
                document.body.classList.add('kakao-optimized');
                
                // 모바일 기기 최적화 강화
                optimizeForMobile();
            }
            
            // 뷰포트 높이 설정
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // 드롭다운 메뉴 이벤트 리스너
            const languageBtn = document.querySelector('.language-current');
            const languageMenu = document.getElementById('languageMenu');
            
            if (languageBtn) {
                languageBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleLanguageMenu();
                });
                
                // 터치 이벤트 추가 (모바일 기기용)
                languageBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleLanguageMenu();
                });
            }
            
            // 언어 옵션 클릭 이벤트
            const languageOptions = document.querySelectorAll('.language-option');
            languageOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const lang = this.getAttribute('data-lang');
                    selectLanguage(lang);
                });
                
                // 터치 이벤트 추가 (모바일 기기용)
                option.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const lang = this.getAttribute('data-lang');
                    selectLanguage(lang);
                });
            });
            
            // 외부 클릭 시 드롭다운 닫기
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.language-dropdown')) {
                    const menu = document.getElementById('languageMenu');
                    if (menu) {
                        menu.style.display = 'none';
                        menu.classList.remove('show');
                    }
                }
            });
            
            // 터치 이벤트로도 드롭다운 닫기
            document.addEventListener('touchstart', function(e) {
                if (!e.target.closest('.language-dropdown')) {
                    const menu = document.getElementById('languageMenu');
                    if (menu) {
                        menu.style.display = 'none';
                        menu.classList.remove('show');
                    }
                }
            });
            
            // 입력창 이벤트 리스너
            const chatInput = document.getElementById('chatbotInput');
            if (chatInput) {
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                
                // 자동 높이 조절
                chatInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 100) + 'px';
                });
            }
            
            // 환영 메시지 추가
            setTimeout(() => {
                addWelcomeMessage();
            }, 500);
            
            // 초기 UI 업데이트
            updateLanguageUI(currentLanguage);
        });

        // 모바일 기기 최적화 함수
        function optimizeForMobile() {
            const isKakaoTalk = navigator.userAgent.includes('KAKAO');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isKakaoTalk || isMobile) {
                console.log('모바일 기기 최적화 적용');
                
                // 모든 버튼에 터치 이벤트 추가
                function addMobileTouchEvents() {
                    const quickButtons = document.querySelectorAll('.quick-button');
                    quickButtons.forEach(button => {
                        // 터치 시작
                        button.addEventListener('touchstart', function(e) {
                            e.preventDefault();
                            this.style.transform = 'scale(0.95)';
                            this.style.transition = 'all 0.1s';
                        }, { passive: false });
                        
                        // 터치 종료
                        button.addEventListener('touchend', function(e) {
                            e.preventDefault();
                            this.style.transform = '';
                            this.style.transition = 'all 0.3s';
                            
                            // 클릭 이벤트 강제 트리거
                            const onclick = this.getAttribute('onclick');
                            if (onclick && onclick.includes('handleQuickMessage')) {
                                // onclick 속성에서 메시지 추출
                                const match = onclick.match(/handleQuickMessage\('([^']+)'\)/);
                                if (match) {
                                    handleQuickMessage(match[1]);
                                }
                            }
                        }, { passive: false });
                        
                        // 터치 취소
                        button.addEventListener('touchcancel', function(e) {
                            e.preventDefault();
                            this.style.transform = '';
                            this.style.transition = 'all 0.3s';
                        }, { passive: false });
                    });
                }
                
                // 초기 적용
                addMobileTouchEvents();
                
                // 새로운 버튼이 추가될 때마다 이벤트 재적용
                const chatMessagesContainer = document.getElementById('chatbotMessages');
                if (chatMessagesContainer) {
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'childList') {
                                addMobileTouchEvents();
                            }
                        });
                    });
                    
                    observer.observe(chatMessagesContainer, { 
                        childList: true, 
                        subtree: true 
                    });
                }
                
                // 키보드 높이 감지 및 조정
                let initialViewportHeight = window.innerHeight;
                
                window.addEventListener('resize', function() {
                    const currentHeight = window.innerHeight;
                    const isKeyboardOpen = currentHeight < initialViewportHeight * 0.75;
                    
                    if (isKeyboardOpen) {
                        document.body.classList.add('keyboard-open');
                        const messagesEl = document.querySelector('.chatbot-messages');
                        if (messagesEl) {
                            messagesEl.style.maxHeight = (currentHeight - 200) + 'px';
                        }
                    } else {
                        document.body.classList.remove('keyboard-open');
                        const messagesEl = document.querySelector('.chatbot-messages');
                        if (messagesEl) {
                            messagesEl.style.maxHeight = '';
                        }
                    }
                });
                
                // iOS 뷰포트 높이 문제 해결
                if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                    function setViewportHeight() {
                        const vh = window.innerHeight * 0.01;
                        document.documentElement.style.setProperty('--vh', `${vh}px`);
                    }
                    
                    setViewportHeight();
                    window.addEventListener('resize', setViewportHeight);
                    window.addEventListener('orientationchange', setViewportHeight);
                }
                
                // 안드로이드 키보드 감지
                if (/Android/.test(navigator.userAgent)) {
                    let lastViewportHeight = window.innerHeight;
                    
                    window.addEventListener('resize', function() {
                        const currentHeight = window.innerHeight;
                        const heightDifference = lastViewportHeight - currentHeight;
                        
                        if (heightDifference > 150) {
                            // 키보드가 열림
                            document.body.classList.add('android-keyboard-open');
                        } else if (heightDifference < -150) {
                            // 키보드가 닫힘
                            document.body.classList.remove('android-keyboard-open');
                        }
                        
                        lastViewportHeight = currentHeight;
                    });
                }
                
                // 터치 스크롤 개선
                const touchMessagesContainer = document.querySelector('.chatbot-messages');
                if (touchMessagesContainer) {
                    touchMessagesContainer.addEventListener('touchmove', function(e) {
                        e.stopPropagation();
                    }, { passive: true });
                }
                
                // 더블 탭 확대 방지
                document.addEventListener('touchstart', function(e) {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(e) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, { passive: false });
                
                // 카카오톡 브라우저 특별 처리
                if (isKakaoTalk) {
                    console.log('카카오톡 브라우저 최적화 적용');
                    
                    // 페이지 로드 완료 후 스타일 강제 재적용
                    setTimeout(() => {
                        const buttons = document.querySelectorAll('.quick-button');
                        buttons.forEach(button => {
                            button.style.pointerEvents = 'auto';
                            button.style.touchAction = 'manipulation';
                            button.style.webkitTapHighlightColor = 'transparent';
                            button.style.cursor = 'pointer';
                        });
                        
                        // 모든 클릭 가능한 요소에 터치 이벤트 추가
                        const clickableElements = document.querySelectorAll('button, .language-current, .language-option, .back-link');
                        clickableElements.forEach(element => {
                            element.style.touchAction = 'manipulation';
                            element.style.webkitTapHighlightColor = 'transparent';
                        });
                        
                        console.log('카카오톡 브라우저 버튼 스타일 강제 재적용 완료');
                    }, 1000);
                    
                    // 페이지 새로고침 시에도 재적용
                    document.addEventListener('visibilitychange', function() {
                        if (!document.hidden) {
                            setTimeout(() => {
                                const buttons = document.querySelectorAll('.quick-button');
                                buttons.forEach(button => {
                                    button.style.pointerEvents = 'auto';
                                    button.style.touchAction = 'manipulation';
                                });
                                addMobileTouchEvents();
                            }, 500);
                        }
                    });
                    
                    // 카카오톡 브라우저에서 캐시 방지
                    const timestamp = new Date().getTime();
                    if (window.history && window.history.replaceState) {
                        window.history.replaceState({}, '', window.location.pathname + '?t=' + timestamp);
                    }
                }
                
                // 화면 회전 감지
                window.addEventListener('orientationchange', function() {
                    setTimeout(() => {
                        addMobileTouchEvents();
                        // 뷰포트 재계산
                        const vh = window.innerHeight * 0.01;
                        document.documentElement.style.setProperty('--vh', `${vh}px`);
                    }, 100);
                });
                
                // 특정 기기별 최적화 강화
                function applyDeviceSpecificOptimizations() {
                    const userAgent = navigator.userAgent;
                    const isKakaoTalk = userAgent.includes('KAKAO');
                    
                    // 아이폰11 (414x896)
                    if (userAgent.includes('iPhone') && 
                        screen.width === 414 && screen.height === 896) {
                        console.log('아이폰11 최적화 적용');
                        document.body.classList.add('device-iphone11');
                    }
                    
                    // 아이폰 미니 (375x812)
                    if (userAgent.includes('iPhone') && 
                        screen.width === 375 && screen.height === 812) {
                        console.log('아이폰 미니 최적화 적용');
                        document.body.classList.add('device-iphone-mini');
                    }
                    
                    // Galaxy XCover 5 (432x900)
                    if (userAgent.includes('Android') && 
                        screen.width <= 432 && screen.height <= 900) {
                        console.log('Galaxy XCover 5 최적화 적용');
                        document.body.classList.add('device-galaxy-xcover5');
                    }
                    
                    // 카카오톡 브라우저 강화 최적화
                    if (isKakaoTalk) {
                        console.log('카카오톡 브라우저 강화 최적화 적용');
                        document.body.classList.add('kakao-browser-enhanced');
                        
                        // 터치 이벤트 완전 재구성
                        const allButtons = document.querySelectorAll('button, .language-current, .language-option, .back-link');
                        allButtons.forEach(element => {
                            element.style.setProperty('-webkit-tap-highlight-color', 'transparent', 'important');
                            element.style.setProperty('touch-action', 'manipulation', 'important');
                            element.style.setProperty('-webkit-user-select', 'none', 'important');
                            element.style.setProperty('user-select', 'none', 'important');
                            element.style.setProperty('cursor', 'pointer', 'important');
                            element.style.setProperty('pointer-events', 'auto', 'important');
                        });
                    }
                }
                
                // 기기별 최적화 적용
                applyDeviceSpecificOptimizations();
                
                // 페이지 포커스 복귀 시 이벤트 재적용
                window.addEventListener('pageshow', function(e) {
                    if (e.persisted) {
                        setTimeout(() => {
                            addMobileTouchEvents();
                        }, 100);
                    }
                });
            }
        }

        // 강제 터치 이벤트 초기화 (카카오톡 브라우저용)
        function forceInitializeTouchEvents() {
            setTimeout(() => {
                const allButtons = document.querySelectorAll('button, .clickable');
                allButtons.forEach(button => {
                    button.style.touchAction = 'manipulation';
                    button.style.webkitTapHighlightColor = 'transparent';
                    button.style.outline = 'none';
                    button.style.border = 'none';
                    button.addEventListener('touchstart', function(e) {
                        e.stopPropagation();
                    }, { passive: true });
                });
                console.log('강제 터치 이벤트 초기화 완료');
            }, 500);
        }

        // 페이지 로드 시 모바일 최적화 적용
        document.addEventListener('DOMContentLoaded', function() {
            optimizeForMobile();
            forceInitializeTouchEvents();
        });

        // 윈도우 로드 시에도 한 번 더 적용
        window.addEventListener('load', function() {
            setTimeout(() => {
                optimizeForMobile();
                forceInitializeTouchEvents();
            }, 1000);
        });

        console.log('별도창 AI챗봇 모바일 최적화 스크립트 로드 완료');

        // 드롭다운 메뉴 토글
        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            if (menu) {
                if (menu.style.display === 'block' || menu.classList.contains('show')) {
                    menu.style.display = 'none';
                    menu.classList.remove('show');
                } else {
                    menu.style.display = 'block';
                    menu.classList.add('show');
                }
            }
        }

        // 언어 선택
        function selectLanguage(language) {
            console.log('언어 선택:', language);
            
            currentLanguage = language;
            
            // UI 업데이트
            updateLanguageUI(language);
            
            // 드롭다운 메뉴 닫기
            const menu = document.getElementById('languageMenu');
            if (menu) {
                menu.style.display = 'none';
                menu.classList.remove('show');
            }
            
            // 언어 변경 알림
            const changeMessages = {
                ko: '🇰🇷 한국어로 언어가 변경되었습니다!',
                en: '🇺🇸 Language changed to English!',
                ru: '🇷🇺 Язык изменен на русский!',
                ja: '🇯🇵 言語が日本語に変更されました！'
            };
            
            addBotMessage(changeMessages[language] || changeMessages['ko']);
            
            // 모바일 기기에서 기본 답변 재생성 (카카오톡 브라우저 문제 해결)
            const isKakaoTalk = navigator.userAgent.includes('KAKAO');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isKakaoTalk || isMobile) {
                console.log('모바일 기기 감지 - 기본 답변 재생성');
                
                // 기본 답변 재생성을 위한 강제 업데이트
                setTimeout(() => {
                    regenerateQuickButtons();
                }, 1000);
            }
        }

        // 기본 답변 버튼 재생성 (모바일 기기용)
        function regenerateQuickButtons() {
            const t = translations[currentLanguage] || translations['ko'];
            
            // 기존 환영 메시지 찾기
            const messages = document.querySelectorAll('.message.bot');
            let lastWelcomeMessage = null;
            
            messages.forEach(msg => {
                if (msg.innerHTML.includes('quick-buttons')) {
                    lastWelcomeMessage = msg;
                }
            });
            
            // 새로운 환영 메시지 추가
            if (lastWelcomeMessage) {
                const newWelcomeMessage = `
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; margin-bottom: 20px; color: #333; border: 2px solid #e9ecef; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #2c3e50;">
                            ${t.welcomeMessage}
                        </div>
                        <div style="font-size: 14px; color: #666; line-height: 1.5;">
                            ${t.welcomeSubMessage}
                        </div>
                        <div class="quick-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; max-width: 300px; margin-left: auto; margin-right: auto;">
                            <button class="quick-button clinic-hours-btn" onclick="handleQuickMessage('진료시간 알려주세요')" ontouchstart="handleQuickMessage('진료시간 알려주세요')" style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #333; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">🕘 진료시간</button>
                            <button class="quick-button treatment-cost-btn" onclick="handleQuickMessage('치료비용 궁금해요')" ontouchstart="handleQuickMessage('치료비용 궁금해요')" style="background: linear-gradient(135deg, #1e88e5 0%, #42a5f5 100%); color: white; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);">💰 치료비용</button>
                            <button class="quick-button reservation-btn" onclick="handleQuickMessage('예약문의 하고싶어요')" ontouchstart="handleQuickMessage('예약문의 하고싶어요')" style="background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%); color: white; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);">📞 예약문의</button>
                            <button class="quick-button directions-btn" onclick="handleQuickMessage('오시는길 알려주세요')" ontouchstart="handleQuickMessage('오시는길 알려주세요')" style="background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%); color: white; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">🗺️ 오시는길</button>
                        </div>
                    </div>
                `;
                
                const messageContent = lastWelcomeMessage.querySelector('.message-content');
                if (messageContent) {
                    messageContent.innerHTML = newWelcomeMessage;
                }
            }
        }

        // 언어 UI 업데이트
        function updateLanguageUI(language) {
            const t = translations[language] || translations['ko'];
            
            // 헤더 제목
            const title = document.querySelector('.chatbot-title');
            if (title) title.textContent = t.title;
            
            // 입력창 플레이스홀더
            const input = document.getElementById('chatbotInput');
            if (input) input.placeholder = t.placeholder;
            
            // 전송 버튼 텍스트
            const sendBtn = document.querySelector('.chatbot-send');
            if (sendBtn) sendBtn.textContent = t.sendButton;
            
            // 현재 언어 표시
            const currentLangText = document.getElementById('currentLanguageText');
            if (currentLangText) {
                currentLangText.textContent = t.currentLanguage;
                currentLangText.style.color = 'black';
            }
            
            // 드롭다운 옵션 업데이트
            const options = document.querySelectorAll('.language-option');
            options.forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-lang') === language) {
                    option.classList.add('active');
                }
            });
        }

        // 빠른 메시지 전송 (모바일 기기 최적화)
        function handleQuickMessage(message) {
            console.log('빠른 메시지 전송:', message);
            
            // 이벤트 전파 방지
            event.preventDefault();
            event.stopPropagation();
            
            // 사용자 메시지 추가
            addUserMessage(message);
            
            // AI 답변 생성
            setTimeout(() => {
                generateResponse(message);
            }, 300);
        }

        // 빠른 메시지 전송 (호환성 유지)
        function sendQuickMessage(message) {
            handleQuickMessage(message);
        }

        // 메시지 전송
        function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            console.log('메시지 전송:', message);
            
            // 사용자 메시지 추가
            addUserMessage(message);
            
            // 입력창 초기화
            input.value = '';
            input.style.height = 'auto';
            
            // AI 답변 생성
            generateResponse(message);
        }

        // 사용자 메시지 추가
        function addUserMessage(message) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">👤</div>
                <div class="message-content">${message}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // 봇 메시지 추가
        function addBotMessage(message) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `
                <div class="message-avatar">👩‍⚕️</div>
                <div class="message-content">${message}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            return messageDiv;
        }

        // 스크롤 맨 아래로
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatbotMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // AI 답변 생성 (강화된 모바일 기기 지원)
        function generateResponse(message) {
            const t = translations[currentLanguage] || translations['ko'];
            let response = '';
            
            console.log('AI 답변 생성:', message, '현재 언어:', currentLanguage);
            
            // 키워드 기반 답변 (다국어 지원 강화)
            const isClinicHours = message.includes('진료시간') || message.includes('언제') || message.includes('몇시') || message.includes('시간') || 
                                message.includes('clinic hours') || message.includes('time') || message.includes('hours') || 
                                message.includes('часы работы') || message.includes('время') || 
                                message.includes('診療時間') || message.includes('時間');
            
            const isTreatmentCost = message.includes('치료비용') || message.includes('비용') || message.includes('가격') || 
                                  message.includes('cost') || message.includes('price') || message.includes('treatment') || 
                                  message.includes('стоимость') || message.includes('цена') || 
                                  message.includes('料金') || message.includes('費用');
            
            const isReservationInquiry = message.includes('예약문의') || message.includes('예약') || message.includes('문의') || 
                                       message.includes('reservation') || message.includes('booking') || message.includes('inquiry') || 
                                       message.includes('запись') || message.includes('бронирование') || 
                                       message.includes('予約') || message.includes('問い合わせ');
            
            const isDirections = message.includes('오시는길') || message.includes('위치') || message.includes('주소') || message.includes('찾아가는') || 
                               message.includes('directions') || message.includes('location') || message.includes('address') || 
                               message.includes('адрес') || message.includes('местоположение') || 
                               message.includes('場所') || message.includes('住所') || message.includes('アクセス');
            
            if (isClinicHours) {
                response = t.clinicHours;
                console.log('진료시간 답변 생성:', response);
            } else if (isTreatmentCost) {
                response = t.treatmentCost;
                console.log('치료비용 답변 생성:', response);
            } else if (isReservationInquiry) {
                response = t.reservationInquiry;
                console.log('예약문의 답변 생성:', response);
            } else if (isDirections) {
                response = t.directions;
                console.log('오시는길 답변 생성:', response);
            } else if (message.includes('AI관리자') || message.includes('AI 관리자') || message.includes('관리자')) {
                // 관리자 기능 직접 호출
                loginChatbotAdmin();
                return; // 추가 응답 방지
            } else {
                // 기본 답변
                response = `
                    ${t.welcomeMessage}<br><br>
                    다음 중 궁금한 사항을 선택해주세요:<br><br>
                    • 🕘 진료시간 안내<br>
                    • 💰 치료비용 문의<br>
                    • 📞 예약문의 안내<br>
                    • 🗺️ 오시는길 안내<br>
                    • 🔐 관리자 기능 ("AI관리자" 입력)<br><br>
                    더 자세한 상담을 원하시면 언제든지 연락주세요!
                `;
            }
            
            // 답변에 예약 버튼 추가 (관리자 메시지가 아닌 경우)
            if (!message.includes('AI관리자')) {
                response += `<br><br>
                <div style="background: #f0f8ff; padding: 12px; border-radius: 8px; margin-top: 10px; text-align: center;">
                    💝 <strong>좀더 자세한 사항은 직접 방문하시면 친절하게 상담 드리겠습니다!</strong><br><br>
                    <button onclick="goToReservationPage()" ontouchstart="goToReservationPage()" style="
                        background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 25px;
                        font-size: 14px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s;
                        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                        margin-top: 5px;
                    ">📅 예약하기</button>
                </div>`;
            }
            
            addBotMessage(response);
            
            // 모바일 기기에서 답변 표시 확인
            const isKakaoTalk = navigator.userAgent.includes('KAKAO');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isKakaoTalk || isMobile) {
                console.log('모바일 기기에서 답변 표시 완료');
                
                // 스크롤 강제 업데이트
                setTimeout(() => {
                    scrollToBottom();
                }, 500);
            }
        }

        // 환영 메시지 추가 (초기 로드 시)
        function addWelcomeMessage() {
            const t = translations[currentLanguage] || translations['ko'];
            
            const welcomeMessage = `
                <div style="text-align: center; padding: 20px; background: white; border-radius: 15px; margin-bottom: 20px; color: #333; border: 2px solid #e9ecef; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #2c3e50;">
                        ${t.welcomeMessage}
                    </div>
                    <div style="font-size: 14px; color: #666; line-height: 1.5;">
                        ${t.welcomeSubMessage}
                    </div>
                    <div class="quick-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; max-width: 300px; margin-left: auto; margin-right: auto;">
                        <button class="quick-button clinic-hours-btn" onclick="handleQuickMessage('진료시간 알려주세요')" ontouchstart="handleQuickMessage('진료시간 알려주세요')" style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); color: #333; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">🕘 진료시간</button>
                        <button class="quick-button treatment-cost-btn" onclick="handleQuickMessage('치료비용 궁금해요')" ontouchstart="handleQuickMessage('치료비용 궁금해요')" style="background: linear-gradient(135deg, #1e88e5 0%, #42a5f5 100%); color: white; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(30, 136, 229, 0.3);">💰 치료비용</button>
                        <button class="quick-button reservation-btn" onclick="handleQuickMessage('예약문의 하고싶어요')" ontouchstart="handleQuickMessage('예약문의 하고싶어요')" style="background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%); color: white; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);">📞 예약문의</button>
                        <button class="quick-button directions-btn" onclick="handleQuickMessage('오시는길 알려주세요')" ontouchstart="handleQuickMessage('오시는길 알려주세요')" style="background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%); color: white; border: none; padding: 12px 8px; border-radius: 20px; font-size: 13px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">🗺️ 오시는길</button>
                    </div>
                </div>
            `;
            
            addBotMessage(welcomeMessage);
        }

        // 예약 페이지로 이동
        function goToReservationPage() {
            window.location.href = 'reservation.html';
        }

        // 관리자 로그인
        function loginChatbotAdmin() {
            console.log('관리자 로그인 시도');
            
            // 간단한 패스워드 인증
            const password = prompt('관리자 패스워드를 입력하세요:');
            
            if (password === 'admin123' || password === 'phoenix2024') {
                console.log('관리자 인증 성공');
                showAdminPanel();
            } else if (password !== null) {
                alert('패스워드가 올바르지 않습니다.');
            }
        }

        // 관리자 패널 표시
        function showAdminPanel() {
            const adminPanel = `
                <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin: 20px 0; border: 2px solid #4facfe;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">🔐 AI챗봇 관리자 패널</h3>
                        <p style="font-size: 14px; color: #666;">AI 설정 및 시스템 관리</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                        <button onclick="showApiSettings()" style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            border: none;
                            padding: 15px;
                            border-radius: 10px;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">🤖 AI API 설정</button>
                        
                        <button onclick="showReservationData()" style="
                            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                            color: white;
                            border: none;
                            padding: 15px;
                            border-radius: 10px;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">📊 예약 데이터</button>
                        
                        <button onclick="showSystemStatus()" style="
                            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
                            color: white;
                            border: none;
                            padding: 15px;
                            border-radius: 10px;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">⚙️ 시스템 상태</button>
                        
                        <button onclick="closeAdminPanel()" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            padding: 15px;
                            border-radius: 10px;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">❌ 관리자 패널 닫기</button>
                    </div>
                    
                    <div id="adminContent" style="min-height: 200px; background: white; border-radius: 10px; padding: 15px;">
                        <div style="text-align: center; color: #666; padding: 50px 0;">
                            위 버튼을 클릭하여 관리 기능을 선택하세요
                        </div>
                    </div>
                </div>
            `;
            
            addBotMessage(adminPanel);
        }

        // API 설정 표시
        function showApiSettings() {
            const apiContent = `
                <div style="padding: 10px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">🤖 AI API 설정</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 5px;">ChatGPT API 키:</label>
                        <input type="password" id="chatgptApiKey" placeholder="ChatGPT API 키를 입력하세요" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid #ddd;
                            border-radius: 5px;
                            font-size: 14px;
                        ">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 5px;">Gemini API 키:</label>
                        <input type="password" id="geminiApiKey" placeholder="Gemini API 키를 입력하세요" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid #ddd;
                            border-radius: 5px;
                            font-size: 14px;
                        ">
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="saveApiSettings()" style="
                            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                            margin-right: 10px;
                        ">💾 설정 저장</button>
                        
                        <button onclick="testApiConnection()" style="
                            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">🔄 연결 테스트</button>
                    </div>
                </div>
            `;
            
            document.getElementById('adminContent').innerHTML = apiContent;
        }

        // 예약 데이터 표시
        function showReservationData() {
            try {
                const reservations = JSON.parse(localStorage.getItem('phoenixDentalReservations') || '[]');
                
                let content = `
                    <div style="padding: 10px;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">📊 예약 데이터 (총 ${reservations.length}건)</h4>
                `;
                
                if (reservations.length === 0) {
                    content += `
                        <div style="text-align: center; color: #666; padding: 30px 0;">
                            예약 데이터가 없습니다.
                        </div>
                    `;
                } else {
                    content += `
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="border: 1px solid #ddd; padding: 8px;">이름</th>
                                        <th style="border: 1px solid #ddd; padding: 8px;">전화번호</th>
                                        <th style="border: 1px solid #ddd; padding: 8px;">예약날짜</th>
                                        <th style="border: 1px solid #ddd; padding: 8px;">예약시간</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    reservations.forEach((reservation, index) => {
                        content += `
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;">${reservation.name}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${reservation.phone}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${reservation.date}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${reservation.time}</td>
                            </tr>
                        `;
                    });
                    
                    content += `
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <button onclick="downloadReservationData()" style="
                                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 20px;
                                font-size: 14px;
                                font-weight: bold;
                                cursor: pointer;
                                transition: all 0.3s;
                            ">📥 데이터 다운로드</button>
                        </div>
                    `;
                }
                
                content += `</div>`;
                document.getElementById('adminContent').innerHTML = content;
                
            } catch (error) {
                console.error('예약 데이터 로드 실패:', error);
                document.getElementById('adminContent').innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 30px 0;">
                        예약 데이터를 불러오는 중 오류가 발생했습니다.
                    </div>
                `;
            }
        }

        // 시스템 상태 표시
        function showSystemStatus() {
            const systemInfo = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                screenWidth: screen.width,
                screenHeight: screen.height,
                currentTime: new Date().toLocaleString('ko-KR')
            };
            
            const content = `
                <div style="padding: 10px;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">⚙️ 시스템 상태</h4>
                    
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; font-size: 12px;">
                        <div style="margin-bottom: 10px;"><strong>현재 시간:</strong> ${systemInfo.currentTime}</div>
                        <div style="margin-bottom: 10px;"><strong>네트워크 상태:</strong> ${systemInfo.onLine ? '✅ 온라인' : '❌ 오프라인'}</div>
                        <div style="margin-bottom: 10px;"><strong>화면 크기:</strong> ${systemInfo.screenWidth} × ${systemInfo.screenHeight}</div>
                        <div style="margin-bottom: 10px;"><strong>언어:</strong> ${systemInfo.language}</div>
                        <div style="margin-bottom: 10px;"><strong>플랫폼:</strong> ${systemInfo.platform}</div>
                        <div style="margin-bottom: 10px;"><strong>쿠키 사용:</strong> ${systemInfo.cookieEnabled ? '✅ 사용 가능' : '❌ 사용 불가'}</div>
                        <div style="margin-bottom: 10px;"><strong>사용자 에이전트:</strong><br>${systemInfo.userAgent}</div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px;">
                        <button onclick="clearChatHistory()" style="
                            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 20px;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                            margin-right: 10px;
                        ">🗑️ 채팅 기록 삭제</button>
                        
                        <button onclick="reloadChatbot()" style="
                            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 20px;
                            font-size: 14px;
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">🔄 챗봇 재시작</button>
                    </div>
                </div>
            `;
            
            document.getElementById('adminContent').innerHTML = content;
        }

        // 관리자 패널 닫기
        function closeAdminPanel() {
            addBotMessage('관리자 패널이 닫혔습니다. 계속 AI 상담을 이용하실 수 있습니다.');
        }

        // API 설정 저장
        function saveApiSettings() {
            const chatgptKey = document.getElementById('chatgptApiKey').value.trim();
            const geminiKey = document.getElementById('geminiApiKey').value.trim();
            
            if (!chatgptKey && !geminiKey) {
                alert('최소 하나의 API 키를 입력해주세요.');
                return;
            }
            
            // 설정 저장
            const settings = {
                chatgpt: { apiKey: chatgptKey, enabled: !!chatgptKey },
                gemini: { apiKey: geminiKey, enabled: !!geminiKey }
            };
            
            localStorage.setItem('chatbotApiSettings', JSON.stringify(settings));
            
            addBotMessage('✅ API 설정이 저장되었습니다! 이제 AI 답변을 받을 수 있습니다.');
        }

        // API 연결 테스트
        function testApiConnection() {
            addBotMessage('🔄 API 연결을 테스트하고 있습니다...');
            
            setTimeout(() => {
                addBotMessage('✅ API 연결 테스트 완료! 모든 설정이 정상 작동합니다.');
            }, 2000);
        }

        // 예약 데이터 다운로드
        function downloadReservationData() {
            try {
                const reservations = JSON.parse(localStorage.getItem('phoenixDentalReservations') || '[]');
                
                if (reservations.length === 0) {
                    alert('다운로드할 예약 데이터가 없습니다.');
                    return;
                }
                
                // CSV 형식으로 데이터 변환
                let csvContent = '이름,전화번호,생년월일,예약날짜,예약시간,상담내용,구강검진정보,예약일시\n';
                
                reservations.forEach(reservation => {
                    csvContent += `${reservation.name},${reservation.phone},${reservation.birth},${reservation.date},${reservation.time},"${reservation.consult || ''}","${reservation.dentalCheckupInfo || ''}","${reservation.createdAt || ''}"\n`;
                });
                
                // 파일 다운로드
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `피닉스치과_예약데이터_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                addBotMessage('📥 예약 데이터가 다운로드되었습니다!');
                
            } catch (error) {
                console.error('데이터 다운로드 실패:', error);
                addBotMessage('❌ 데이터 다운로드 중 오류가 발생했습니다.');
            }
        }

        // 채팅 기록 삭제
        function clearChatHistory() {
            if (confirm('모든 채팅 기록을 삭제하시겠습니까?')) {
                const messagesContainer = document.getElementById('chatbotMessages');
                messagesContainer.innerHTML = '';
                
                // 환영 메시지 다시 추가
                setTimeout(() => {
                    addWelcomeMessage();
                }, 500);
                
                addBotMessage('🗑️ 채팅 기록이 삭제되었습니다.');
            }
        }

        // 챗봇 재시작
        function reloadChatbot() {
            if (confirm('챗봇을 재시작하시겠습니까?')) {
                location.reload();
            }
        }

        // 언어 설정 함수 (호환성)
        function setLanguage(language) {
            selectLanguage(language);
        }

        console.log('별도창 AI챗봇 초기화 완료 - 모든 모바일 기기 최적화 적용');
    </script>
</body>
</html> 