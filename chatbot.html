<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì› - AI ì±—ë´‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-link:hover {
            opacity: 0.8;
        }

        .admin-login-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .admin-login-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* ì±—ë´‡ ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .chatbot-main {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            height: 70vh;
            display: flex;
            flex-direction: column;
        }

        /* ì±—ë´‡ í—¤ë” */
        .chatbot-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chatbot-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: bold;
            font-size: 18px;
        }

        /* ì±—ë´‡ ë©”ì‹œì§€ ì˜ì—­ */
        .chatbot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #e9ecef;
            color: #495057;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            font-size: 14px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message.user .message-content {
            background: #4facfe;
            color: white;
            border-bottom-right-radius: 6px;
        }

        /* ë¹ ë¥¸ ë²„íŠ¼ */
        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-button {
            background: #f0f8ff;
            color: #4facfe;
            border: 1px solid #4facfe;
            border-radius: 15px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-button:hover {
            background: #4facfe;
            color: white;
        }

        .reservation-link-btn {
            background: #ffd700;
            color: #333;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
            transition: all 0.2s;
        }

        .reservation-link-btn:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        /* ì±—ë´‡ ì…ë ¥ ì˜ì—­ */
        .chatbot-input {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .chatbot-input textarea {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            resize: none;
            min-height: 45px;
            max-height: 120px;
            font-family: inherit;
        }

        .chatbot-input textarea:focus {
            border-color: #4facfe;
        }

        .chatbot-send {
            background: #4facfe;
            color: white;
            border: none;
            border-radius: 25px;
            min-width: 80px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .chatbot-send:hover {
            background: #3d8bfe;
        }

        /* íŒì—… í˜ì´ì§€ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .popup-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }

        /* ê´€ë¦¬ì í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #2980b9;
        }

        .nav-btn.logout {
            background: #e74c3c;
        }

        .nav-btn.logout:hover {
            background: #c0392b;
        }

        .admin-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 20px;
        }

        /* API ì„¤ì • ìŠ¤íƒ€ì¼ */
        .api-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover {
            background: #3d8bfe;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
            white-space: pre-line;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .upload-area {
            border: 2px dashed #4facfe;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #3d8bfe;
            background: #f0f8ff;
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #f8fff8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-types {
            font-size: 12px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .file-details {
            font-size: 12px;
            color: #666;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .file-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .back-link, .admin-login-btn {
                position: static;
                margin: 5px;
                display: inline-block;
            }
            
            .chatbot-main {
                height: 80vh;
            }

            .admin-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .btn-group {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <a href="index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
        <button class="admin-login-btn" onclick="loginChatbotAdmin2()">ğŸ¤– AIì±—ë´‡ ê´€ë¦¬ ë¡œê·¸ì¸2</button>
        <h1>ğŸ¤– í”¼ë‹‰ìŠ¤ AI ìƒë‹´ì‚¬</h1>
        <p>24ì‹œê°„ ì–¸ì œë“  ê¶ê¸ˆí•œ ì ì„ ë¬¸ì˜í•´ì£¼ì„¸ìš”!</p>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="container">
        <div class="chatbot-main">
            <!-- ì±—ë´‡ í—¤ë” -->
            <div class="chatbot-header">
                <div class="chatbot-title">
                    <span>ğŸ¤–</span>
                    <span>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬</span>
                </div>
            </div>
            
            <!-- ì±—ë´‡ ë©”ì‹œì§€ ì˜ì—­ -->
            <div class="chatbot-messages" id="chatbotMessages2">
                <!-- ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ -->
                <div class="message bot">
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-content">
                        ì•ˆë…•í•˜ì„¸ìš”! í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ğŸ˜Š<br>
                        ì¹˜ê³¼ ê´€ë ¨ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜í•´ì£¼ì„¸ìš”!
                        <div class="quick-buttons">
                            <button class="quick-button" onclick="sendQuickMessage2('ì§„ë£Œì‹œê°„ ì•Œë ¤ì£¼ì„¸ìš”')">ì§„ë£Œì‹œê°„</button>
                            <button class="quick-button" onclick="sendQuickMessage2('ì˜ˆì•½í•˜ê³  ì‹¶ì–´ìš”')">ì˜ˆì•½ë¬¸ì˜</button>
                            <button class="quick-button" onclick="sendQuickMessage2('ì¹˜ë£Œë¹„ìš© ê¶ê¸ˆí•´ìš”')">ì¹˜ë£Œë¹„ìš©</button>
                            <button class="quick-button" onclick="sendQuickMessage2('ìœ„ì¹˜ ì•Œë ¤ì£¼ì„¸ìš”')">ì˜¤ì‹œëŠ”ê¸¸</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì±—ë´‡ ì…ë ¥ ì˜ì—­ -->
            <div class="chatbot-input">
                <textarea id="chatbotInput2" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Shift+Enter: ì „ì†¡)" onkeypress="handleChatKeyPress2(event)" rows="1"></textarea>
                <button class="chatbot-send" onclick="sendMessage2()">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <!-- AI ì±—ë´‡ ê´€ë¦¬ í˜ì´ì§€ -->
    <div class="popup-page" id="chatbotAdminPage2">
        <div class="admin-header">
            <div class="admin-title">ğŸ¤– AI ì±—ë´‡ ê´€ë¦¬ ì‹œìŠ¤í…œ 2</div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeChatbotAdmin2()">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
                <button class="nav-btn logout" onclick="closeChatbotAdmin2()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- AI ëª¨ë¸ API ì„¤ì • -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ğŸ¤– ì±—ë´‡ AI ëª¨ë¸ ì—°ê²°í•˜ê¸°</h3>
                </div>
                
                <div class="api-form">
                    <!-- ChatGPT ì„¤ì • -->
                    <div class="form-group">
                        <label for="chatgptApiKey2">ChatGPT API Key</label>
                        <input type="password" id="chatgptApiKey2" placeholder="sk-proj-...">
                    </div>
                    <div class="form-group">
                        <label for="chatgptModel2">ChatGPT ëª¨ë¸ì„ íƒ</label>
                        <select id="chatgptModel2" onchange="toggleFinetuningInput2('chatgpt')">
                            <option value="">-- ChatGPT ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            <option value="gpt-4o">GPT-4o (ìµœì‹  ë©€í‹°ëª¨ë‹¬)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (ê²½ì œì )</option>
                            <option value="finetuning">Finetuning Model (ì»¤ìŠ¤í…€ ëª¨ë¸)</option>
                        </select>
                    </div>
                    <div class="form-group" id="chatgptFinetuningGroup2" style="display: none;">
                        <label for="chatgptFinetuningModel2">Finetuning ëª¨ë¸ëª… ì…ë ¥</label>
                        <input type="text" id="chatgptFinetuningModel2" placeholder="ft:gpt-4o-mini-2024-07-18:...">
                    </div>

                    <!-- Gemini ì„¤ì • -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="geminiApiKey2">Gemini ëª¨ë¸ API Key</label>
                        <input type="password" id="geminiApiKey2" placeholder="AIza...">
                    </div>
                    <div class="form-group">
                        <label for="geminiModel2">Gemini ëª¨ë¸ì„ íƒ</label>
                        <select id="geminiModel2">
                            <option value="">-- Gemini ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (ë¹ ë¥¸ ì‘ë‹µ)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (ê³ ì„±ëŠ¥)</option>
                            <option value="gemini-1.0-pro">Gemini 1.0 Pro (ì•ˆì •ì„±)</option>
                        </select>
                    </div>

                    <!-- Claude ì„¤ì • -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="claudeApiKey2">Claude ëª¨ë¸ API Key</label>
                        <input type="password" id="claudeApiKey2" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label for="claudeModel2">Claude ëª¨ë¸ì„ íƒ</label>
                        <select id="claudeModel2">
                            <option value="">-- Claude ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            <option value="claude-3-haiku">Claude 3 Haiku (ë¹ ë¥´ê³  íš¨ìœ¨ì )</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (ê· í˜•ì  ì„±ëŠ¥)</option>
                            <option value="claude-3-opus">Claude 3 Opus (ìµœê³  ì„±ëŠ¥)</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet (ìµœì‹  ëª¨ë¸)</option>
                        </select>
                    </div>

                    <div class="btn-group" style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="saveApiSettings2()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                        <button class="btn btn-success" onclick="testApiConnection2()">ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                        <button class="btn btn-danger" onclick="resetApiSettings2()">ğŸ”„ ì„¤ì • ì´ˆê¸°í™”</button>
                    </div>
                    <div id="apiStatus2" class="status-message"></div>
                </div>
            </div>

            <!-- AI ì§€ì‹ íŒŒì¼ ì—…ë¡œë“œ -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ğŸ“š AI ì§€ì‹ íŒŒì¼ ì—…ë¡œë“œ</h3>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('fileInput2').click()" ondrop="handleFileDrop2(event)" ondragover="handleDragOver2(event)" ondragleave="handleDragLeave2(event)">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-types">ğŸ’¡ <strong>ì§€ì› í˜•ì‹: í…ìŠ¤íŠ¸ íŒŒì¼(.txt)</strong><br>
                    <small style="color: #666;">â€» PDF, Excel íŒŒì¼ì€ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</small></div>
                </div>
                <input type="file" id="fileInput2" class="file-input" accept=".txt" multiple onchange="handleFileUpload2(event)">
                
                <div class="file-list" id="fileList2">
                    <!-- ì—…ë¡œë“œëœ íŒŒì¼ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="knowledgeStatus2" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                    ğŸ“– ì—…ë¡œë“œëœ ì§€ì‹ íŒŒì¼: 0ê°œ | ìƒíƒœ: ë¹„í™œì„±
                </div>
                
                <!-- ì§€ì‹ íŒŒì¼ ì„¤ì • ì €ì¥ ë²„íŠ¼ -->
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveKnowledgeSettings2()">ğŸ’¾ ì§€ì‹ íŒŒì¼ ì„¤ì • ì €ì¥</button>
                    <button class="btn btn-primary" onclick="testKnowledgeBase2()">ğŸ” ì§€ì‹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</button>
                    <button class="btn" style="background: #17a2b8; color: white;" onclick="showParsedData2()">ğŸ“‹ íŒŒì‹±ëœ Q&A ë³´ê¸°</button>
                    <button class="btn btn-danger" onclick="clearAllKnowledge2()">ğŸ—‘ï¸ ëª¨ë“  ì§€ì‹ ì‚­ì œ</button>
                </div>
                <div id="knowledgeSettingsStatus2" class="status-message"></div>
                
                <!-- íŒŒì‹±ëœ Q&A í‘œì‹œ ì˜ì—­ -->
                <div id="parsedDataView2" style="display: none; margin-top: 20px; background: white; border-radius: 10px; padding: 20px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">ğŸ“‹ íŒŒì‹±ëœ Q&A ë°ì´í„°</h4>
                    <div id="parsedDataContent2"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('AI ì±—ë´‡ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');

        // ì „ì—­ ë³€ìˆ˜ (ê¸°ì¡´ê³¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ 2ë¥¼ ë¶™ì„)
        let apiSettings2 = {
            chatgpt: { apiKey: '', model: '', enabled: false },
            gemini: { apiKey: '', model: '', enabled: false },
            claude: { apiKey: '', model: '', enabled: false },
            activeProvider: ''
        };
        
        let knowledgeBase2 = {
            files: [],
            content: '',
            parsedData: [],
            enabled: false
        };

        // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
        function sendMessage2() {
            console.log('ë©”ì‹œì§€ ì „ì†¡');
            const input = document.getElementById('chatbotInput2');
            const message = input.value.trim();
            
            if (message) {
                addUserMessage2(message);
                input.value = '';
                input.style.height = '45px';
                
                const loadingMessage = addBotMessage2('ğŸ‘©â€âš•ï¸ğŸ• ìµœê³ ì˜ ë‹µë³€ì„ ì¤€ë¹„ ì¤‘ ì…ë‹ˆë‹¤...');
                
                generateAIResponse2(message).then(response => {
                    stopClockAnimation2(loadingMessage);
                    loadingMessage.remove();
                    addBotMessage2(response);
                }).catch(error => {
                    console.error('AI ì‘ë‹µ ì˜¤ë¥˜:', error);
                    stopClockAnimation2(loadingMessage);
                    loadingMessage.remove();
                    addBotMessage2('âŒ ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                });
            }
        }

        function sendQuickMessage2(message) {
            console.log('ë¹ ë¥¸ ë©”ì‹œì§€:', message);
            addUserMessage2(message);
            
            const loadingMessage = addBotMessage2('ğŸ‘©â€âš•ï¸ğŸ• ìµœê³ ì˜ ë‹µë³€ì„ ì¤€ë¹„ ì¤‘ ì…ë‹ˆë‹¤...');
            
            generateAIResponse2(message).then(response => {
                stopClockAnimation2(loadingMessage);
                loadingMessage.remove();
                addBotMessage2(response);
            }).catch(error => {
                console.error('AI ì‘ë‹µ ì˜¤ë¥˜:', error);
                stopClockAnimation2(loadingMessage);
                loadingMessage.remove();
                addBotMessage2('âŒ ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            });
        }

        function handleChatKeyPress2(event) {
            const textarea = event.target;
            
            if (event.key === 'Enter' && event.shiftKey) {
                event.preventDefault();
                sendMessage2();
                return;
            }
            
            if (event.key === 'Enter') {
                setTimeout(() => {
                    autoResizeTextarea2(textarea);
                }, 0);
            }
        }

        function autoResizeTextarea2(textarea) {
            textarea.style.height = '45px';
            const scrollHeight = textarea.scrollHeight;
            const maxHeight = 120;
            
            if (scrollHeight > 45) {
                textarea.style.height = Math.min(scrollHeight, maxHeight) + 'px';
            }
        }

        function addUserMessage2(message) {
            const messagesContainer = document.getElementById('chatbotMessages2');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">ğŸ‘¤</div>
                <div class="message-content">${message}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom2();
        }

        function addBotMessage2(message) {
            const messagesContainer = document.getElementById('chatbotMessages2');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            // ë¡œë”© ë©”ì‹œì§€ì¸ì§€ í™•ì¸ (ê³µí†µ ë©”ì‹œì§€ ì¶”ê°€í•˜ì§€ ì•ŠìŒ)
            const isLoadingMessage = message.includes('ìµœê³ ì˜ ë‹µë³€ì„ ì¤€ë¹„ ì¤‘ ì…ë‹ˆë‹¤') || message.includes('ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤');
            
            let finalMessage = message;
            
            // ë¡œë”© ë©”ì‹œì§€ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³µí†µ ë©”ì‹œì§€ì™€ ì˜ˆì•½ ë²„íŠ¼ ì¶”ê°€
            if (!isLoadingMessage) {
                finalMessage += `<br><br>
                <div style="background: #f0f8ff; padding: 12px; border-radius: 8px; margin-top: 10px; text-align: center;">
                    ğŸ’ <strong>ì¢€ë” ìì„¸í•œ ì‚¬í•­ì€ ì§ì ‘ ë°©ë¬¸í•˜ì‹œë©´ ì¹œì ˆí•˜ê²Œ ìƒë‹´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤!</strong><br><br>
                    <button class="reservation-link-btn" onclick="goToReservationPage2()" style="margin-top: 5px;">ğŸ“… ì˜ˆì•½í•˜ê¸°</button>
                </div>`;
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">ğŸ¤–</div>
                <div class="message-content">${finalMessage}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom2();
            
            // ë¡œë”© ë©”ì‹œì§€ì¸ ê²½ìš° ì‹œê³„ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            if (isLoadingMessage) {
                startClockAnimation2(messageDiv);
            }
            
            return messageDiv;
        }

        function scrollToBottom2() {
            const messagesContainer = document.getElementById('chatbotMessages2');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ì‹œê³„ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜ (í´ë¡  ì±—ë´‡ìš©)
        function startClockAnimation2(messageElement) {
            const clockEmojis = ['ğŸ•', 'ğŸ•‘', 'ğŸ•’', 'ğŸ•“', 'ğŸ•”', 'ğŸ••', 'ğŸ•–', 'ğŸ•—', 'ğŸ•˜', 'ğŸ•™', 'ğŸ•š', 'ğŸ•›'];
            let clockIndex = 0;
            
            const animationInterval = setInterval(() => {
                const messageContent = messageElement.querySelector('.message-content');
                if (messageContent) {
                    // í˜„ì¬ ë©”ì‹œì§€ì—ì„œ ì‹œê³„ ì´ëª¨í‹°ì½˜ì„ ë‹¤ìŒ ì‹œê³„ë¡œ êµì²´
                    const currentText = messageContent.innerHTML;
                    const newText = currentText.replace(/ğŸ•|ğŸ•‘|ğŸ•’|ğŸ•“|ğŸ•”|ğŸ••|ğŸ•–|ğŸ•—|ğŸ•˜|ğŸ•™|ğŸ•š|ğŸ•›/, clockEmojis[clockIndex]);
                    messageContent.innerHTML = newText;
                    
                    clockIndex = (clockIndex + 1) % clockEmojis.length;
                }
            }, 300); // 300msë§ˆë‹¤ ì‹œê³„ ë³€ê²½
            
            // ë©”ì‹œì§€ ìš”ì†Œì— ì• ë‹ˆë©”ì´ì…˜ ID ì €ì¥ (ë‚˜ì¤‘ì— ì¤‘ì§€ìš©)
            messageElement.clockAnimation = animationInterval;
        }

        // ì‹œê³„ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì§€ í•¨ìˆ˜ (í´ë¡  ì±—ë´‡ìš©)
        function stopClockAnimation2(messageElement) {
            if (messageElement && messageElement.clockAnimation) {
                clearInterval(messageElement.clockAnimation);
                messageElement.clockAnimation = null;
            }
        }

        // AI ì‘ë‹µ ìƒì„± í•¨ìˆ˜
        function generateAIResponse2(userMessage) {
            console.log('AI ì‘ë‹µ ìƒì„± ì‹œì‘ (í´ë¡  ì±—ë´‡):', userMessage);
            
            // APIê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ AI API í˜¸ì¶œ
            if (apiSettings2.activeProvider && apiSettings2[apiSettings2.activeProvider].enabled) {
                console.log('API í˜¸ì¶œë¡œ ë‹µë³€ ìƒì„±:', apiSettings2.activeProvider);
                return callAIAPI2(userMessage);
            }
            
            // API ì„¤ì •ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ FAQ ì‘ë‹µ
            console.log('ê¸°ë³¸ FAQ ì‘ë‹µ ì‚¬ìš©');
            return Promise.resolve(getDefaultResponse2(userMessage));
        }

        // ì‹¤ì œ AI API í˜¸ì¶œ í•¨ìˆ˜
        async function callAIAPI2(userMessage) {
            const provider = apiSettings2.activeProvider;
            const settings = apiSettings2[provider];
            
            try {
                let response;
                
                switch (provider) {
                    case 'chatgpt':
                        response = await callChatGPTAPI2(userMessage, settings);
                        break;
                    case 'gemini':
                        response = await callGeminiAPI2(userMessage, settings);
                        break;
                    case 'claude':
                        response = await callClaudeAPI2(userMessage, settings);
                        break;
                    default:
                        return getDefaultResponse2(userMessage);
                }
                
                // ì¹œì ˆí•˜ê³  ì •ë¦¬ëœ í˜•íƒœë¡œ ì‘ë‹µ í¬ë§·íŒ…
                return formatFriendlyResponse2(response, provider);
                
            } catch (error) {
                console.error('AI API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                return `âŒ <strong>ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</strong><br><br>
                ì£„ì†¡í•©ë‹ˆë‹¤. AI ì„œë¹„ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ìˆì–´ ì ì‹œ ê¸°ë³¸ ì•ˆë‚´ë¡œ ë„ì›€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br><br>
                ${getDefaultResponse2(userMessage)}<br><br>
                <small>ğŸ’¡ ì˜¤ë¥˜ ë‚´ìš©: ${error.message}</small>`;
            }
        }

        // ì¹œì ˆí•œ ì‘ë‹µ í¬ë§·íŒ…
        function formatFriendlyResponse2(response, provider) {
            // ê¸°ë³¸ ì‘ë‹µ ì •ë¦¬
            let formattedResponse = response.trim();
            
            // ì¤„ë°”ê¿ˆê³¼ êµ¬ì¡°í™”
            formattedResponse = formattedResponse
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // AI ëª¨ë¸ í‘œì‹œì™€ í•¨ê»˜ ì¹œì ˆí•œ í—¤ë” ì¶”ê°€
            const providerIcon = {
                'chatgpt': 'ğŸ§ ',
                'gemini': 'ğŸ’', 
                'claude': 'ğŸ¤–'
            };
            
            const providerName = {
                'chatgpt': 'ChatGPT',
                'gemini': 'Gemini',
                'claude': 'Claude'
            };
            
            return `${providerIcon[provider]} <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬ (${providerName[provider]})</strong><br><br>
            ${formattedResponse}<br><br>
            <small>ğŸ’¡ ì¶”ê°€ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜í•´ì£¼ì„¸ìš”!</small>`;
        }

        function getDefaultResponse2(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('ì§„ë£Œì‹œê°„') || message.includes('ì–¸ì œ') || message.includes('ëª‡ì‹œ') || message.includes('ìš´ì˜ì‹œê°„')) {
                return `ğŸ•˜ <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì§„ë£Œì‹œê°„ ì•ˆë‚´</strong><br><br>
                
                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    ğŸ“… <strong>í‰ì¼</strong>: ì˜¤ì „ 9ì‹œ ~ ì˜¤í›„ 6ì‹œ<br>
                    ğŸ“… <strong>í† ìš”ì¼</strong>: ì˜¤ì „ 9ì‹œ ~ ì˜¤í›„ 3ì‹œ<br>
                    ğŸ½ï¸ <strong>ì ì‹¬ì‹œê°„</strong>: 12ì‹œ 30ë¶„ ~ 1ì‹œ 30ë¶„<br>
                    ğŸš« <strong>íœ´ì§„</strong>: ì¼ìš”ì¼, ê³µíœ´ì¼
                </div>
                
                ğŸ’¡ <strong>ì˜ˆì•½ ì•ˆë‚´</strong><br>
                â€¢ ì˜¨ë¼ì¸ ì˜ˆì•½: 24ì‹œê°„ ì–¸ì œë“  ê°€ëŠ¥<br>
                â€¢ ì „í™” ì˜ˆì•½: 070-1234-1234<br>
                â€¢ ì‘ê¸‰ ìƒë‹´: 24ì‹œê°„ ê°€ëŠ¥<br><br>
                
                ğŸ˜Š í¸ë¦¬í•œ ì˜¨ë¼ì¸ ì˜ˆì•½ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤!<br>
                <button class="reservation-link-btn" onclick="goToReservationPage2()">ğŸ“… ì§€ê¸ˆ ë°”ë¡œ ì˜ˆì•½í•˜ê¸°</button>`;
            }
            
            if (message.includes('ì˜ˆì•½') || message.includes('ì‹ ì²­') || message.includes('ì ‘ìˆ˜') || message.includes('ë°©ë¬¸')) {
                return `ğŸ“ <strong>ì˜ˆì•½ ë° ìƒë‹´ ì•ˆë‚´</strong><br><br>
                
                <div style="background: #fff8f0; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    ğŸŒŸ <strong>ì˜¨ë¼ì¸ ì˜ˆì•½</strong> (ì¶”ì²œ)<br>
                    â€¢ 24ì‹œê°„ ì–¸ì œë“  ì˜ˆì•½ ê°€ëŠ¥<br>
                    â€¢ ì›í•˜ëŠ” ë‚ ì§œ/ì‹œê°„ ì„ íƒ<br>
                    â€¢ ì¦‰ì‹œ ì˜ˆì•½ í™•ì¸<br><br>
                    
                    ğŸ“± <strong>ì „í™” ì˜ˆì•½</strong><br>
                    â€¢ 070-1234-1234<br>
                    â€¢ í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00<br>
                    â€¢ 24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥
                </div>
                
                ğŸ’ <strong>ì´ˆì§„ í™˜ì íŠ¹ë³„ í˜œíƒ</strong><br>
                â€¢ ì •ë°€ ê²€ì§„ ë° ìƒë‹´<br>
                â€¢ ê°œì¸ë³„ ë§ì¶¤ ì¹˜ë£Œ ê³„íš ìˆ˜ë¦½<br>
                â€¢ 25ë…„ ê²½ë ¥ í™ê¸¸ë™ ì›ì¥ë‹˜ ì§ì ‘ ì§„ë£Œ<br><br>
                
                <button class="reservation-link-btn" onclick="goToReservationPage2()">ğŸ“… ì§€ê¸ˆ ë°”ë¡œ ì˜ˆì•½í•˜ê¸°</button>`;
            }
            
            if (message.includes('ë¹„ìš©') || message.includes('ê°€ê²©') || message.includes('ì–¼ë§ˆ') || message.includes('ëˆ') || message.includes('ê¸ˆì•¡')) {
                return `ğŸ’° <strong>ì¹˜ë£Œë¹„ ì•ˆë‚´</strong><br><br>
                
                <div style="background: #f8fff8; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    ğŸ¦· <strong>ê¸°ë³¸ ì§„ë£Œ</strong><br>
                    â€¢ ì´ˆì§„ë£Œ: 15,000ì›<br>
                    â€¢ ì¬ì§„ë£Œ: 10,000ì›<br>
                    â€¢ ìŠ¤ì¼€ì¼ë§: 50,000ì› (ê±´ê°•ë³´í—˜ ì ìš©ì‹œ ì—°1íšŒ ë¬´ë£Œ)<br><br>
                    
                    âœ¨ <strong>ì „ë¬¸ ì¹˜ë£Œ</strong><br>
                    â€¢ ë¯¸ë°±ì¹˜ë£Œ: 200,000 ~ 300,000ì›<br>
                    â€¢ êµì •ì¹˜ë£Œ: 1,500,000 ~ 6,000,000ì›<br>
                    â€¢ ì„í”Œë€íŠ¸: 1,200,000 ~ 1,500,000ì›<br>
                    â€¢ ë³´ì² ì¹˜ë£Œ: ê°œë³„ ìƒë‹´ í›„ ì•ˆë‚´
                </div>
                
                ğŸ’¡ <strong>ì•ˆë‚´ì‚¬í•­</strong><br>
                â€¢ ì •í™•í•œ ë¹„ìš©ì€ ê²€ì§„ í›„ ê°œë³„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤<br>
                â€¢ ë¶„í•  ê²°ì œ ë° ì¹´ë“œ ê²°ì œ ê°€ëŠ¥<br>
                â€¢ ê±´ê°•ë³´í—˜ ì ìš© í•­ëª© ë‹¤ìˆ˜<br><br>
                
                ğŸ¯ ì •í™•í•œ ì¹˜ë£Œë¹„ ìƒë‹´ì„ ìœ„í•´ ë°©ë¬¸í•´ì£¼ì„¸ìš”!`;
            }
            
            if (message.includes('ìœ„ì¹˜') || message.includes('ì£¼ì†Œ') || message.includes('ì–´ë””') || message.includes('ì°¾ì•„') || message.includes('êµí†µ')) {
                return `ğŸ¥ <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì˜¤ì‹œëŠ” ê¸¸</strong><br><br>
                
                <div style="background: #f0fff0; padding: 15px; border-radius: 10px; margin: 10px 0;">
                    ğŸ“ <strong>ì£¼ì†Œ</strong><br>
                    í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸<br><br>
                    
                    ğŸš‡ <strong>ì§€í•˜ì² </strong><br>
                    2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ â†’ ë„ë³´ 5ë¶„<br><br>
                    
                    ğŸšŒ <strong>ë²„ìŠ¤</strong><br>
                    ê°•ë‚¨ì—­ ì •ë¥˜ì¥ í•˜ì°¨ â†’ ë„ë³´ 3ë¶„<br><br>
                    
                    ğŸš— <strong>ì£¼ì°¨ ì•ˆë‚´</strong><br>
                    â€¢ ê±´ë¬¼ ì§€í•˜ 1~3ì¸µ ë¬´ë£Œ ì£¼ì°¨<br>
                    â€¢ 3ì‹œê°„ ë¬´ë£Œ ì´ìš©<br>
                    â€¢ ì£¼ì°¨ ê³µê°„ ë„‰ë„‰í•¨
                </div>
                
                ğŸ—ºï¸ <strong>ì°¾ì•„ì˜¤ì‹œëŠ” ê¸¸ì´ ê¶ê¸ˆí•˜ì‹œë©´</strong><br>
                ì „í™”ë¡œ ìì„¸í•œ ì•ˆë‚´ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤!<br>
                ğŸ“ 070-1234-1234`;
            }
            
            return `ğŸ˜Š <strong>ì•ˆë…•í•˜ì„¸ìš”! í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤</strong><br><br>
            
            <div style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); padding: 20px; border-radius: 12px; margin: 10px 0;">
                ğŸ¥ <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</strong><br><br>
                
                ğŸ’¡ <strong>ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</strong><br>
                â€¢ ì§„ë£Œì‹œê°„ ë° ì˜ˆì•½ ì•ˆë‚´<br>
                â€¢ ì¹˜ë£Œ ë¹„ìš© ìƒë‹´<br>
                â€¢ ì˜¤ì‹œëŠ” ê¸¸ ì•ˆë‚´<br>
                â€¢ ì§„ë£Œê³¼ëª© ìƒì„¸ ì •ë³´<br>
                â€¢ ê¸°íƒ€ ê¶ê¸ˆí•œ ì 
            </div>
            
            ğŸ¦· ê±´ê°•í•œ ë¯¸ì†Œë¥¼ ìœ„í•œ ì—¬ëŸ¬ë¶„ì˜ ë“ ë“ í•œ íŒŒíŠ¸ë„ˆê°€ ë˜ê² ìŠµë‹ˆë‹¤!<br>
            ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”! âœ¨`;
        }

        function goToReservationPage2() {
            window.location.href = 'reservation.html';
        }

        function loginChatbotAdmin2() {
            console.log('AI ì±—ë´‡ ê´€ë¦¬ ë¡œê·¸ì¸2 í´ë¦­ë¨');
            const username = prompt("AI ì±—ë´‡ ê´€ë¦¬ì ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (username === "phoenix") {
                const password = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
                if (password === "phoenix") {
                    openChatbotAdmin2();
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                }
            } else if (username !== null) {
                alert("ì•„ì´ë””ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            }
        }

        function openChatbotAdmin2() {
            console.log('AI ì±—ë´‡ ê´€ë¦¬ í˜ì´ì§€ ì—´ê¸°');
            document.getElementById('chatbotAdminPage2').style.display = 'block';
        }

        function closeChatbotAdmin2() {
            console.log('AI ì±—ë´‡ ê´€ë¦¬ í˜ì´ì§€ ë‹«ê¸°');
            document.getElementById('chatbotAdminPage2').style.display = 'none';
        }

        // ê´€ë¦¬ í˜ì´ì§€ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function saveApiSettings2() {
            console.log('API ì„¤ì • ì €ì¥ (í´ë¡  ì±—ë´‡)');
            
            // ChatGPT ì„¤ì •
            const chatgptModel = document.getElementById('chatgptModel2').value;
            const chatgptApiKey = document.getElementById('chatgptApiKey2').value.trim();
            const chatgptFinetuningModel = document.getElementById('chatgptFinetuningModel2').value.trim();
            
            // Gemini ì„¤ì •
            const geminiModel = document.getElementById('geminiModel2').value;
            const geminiApiKey = document.getElementById('geminiApiKey2').value.trim();
            
            // Claude ì„¤ì •
            const claudeModel = document.getElementById('claudeModel2').value;
            const claudeApiKey = document.getElementById('claudeApiKey2').value.trim();
            
            // ChatGPT ëª¨ë¸ ì²˜ë¦¬
            let finalChatGPTModel = chatgptModel;
            if (chatgptModel === 'finetuning' && chatgptFinetuningModel) {
                finalChatGPTModel = chatgptFinetuningModel;
            }
            
            // ì„¤ì • ì €ì¥
            apiSettings2.chatgpt.model = finalChatGPTModel;
            apiSettings2.chatgpt.apiKey = chatgptApiKey;
            apiSettings2.chatgpt.enabled = finalChatGPTModel && chatgptApiKey;
            
            apiSettings2.gemini.model = geminiModel;
            apiSettings2.gemini.apiKey = geminiApiKey;
            apiSettings2.gemini.enabled = geminiModel && geminiApiKey;
            
            apiSettings2.claude.model = claudeModel;
            apiSettings2.claude.apiKey = claudeApiKey;
            apiSettings2.claude.enabled = claudeModel && claudeApiKey;
            
            // í™œì„±í™”ëœ ì„œë¹„ìŠ¤ í™•ì¸
            let activeCount = 0;
            let lastActive = '';
            
            if (apiSettings2.chatgpt.enabled) {
                activeCount++;
                lastActive = 'ChatGPT';
                apiSettings2.activeProvider = 'chatgpt';
            }
            if (apiSettings2.gemini.enabled) {
                activeCount++;
                lastActive = 'Gemini';
                if (!apiSettings2.activeProvider) apiSettings2.activeProvider = 'gemini';
            }
            if (apiSettings2.claude.enabled) {
                activeCount++;
                lastActive = 'Claude';
                if (!apiSettings2.activeProvider) apiSettings2.activeProvider = 'claude';
            }
            
            if (activeCount === 0) {
                showStatus2('apiStatus2', 'âŒ ìµœì†Œ í•˜ë‚˜ì˜ AI ëª¨ë¸ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            let message = `âœ… ${activeCount}ê°œì˜ AI ëª¨ë¸ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`;
            if (activeCount > 1) {
                message += `\nğŸ¯ ê¸°ë³¸ ì‚¬ìš© ëª¨ë¸: ${lastActive}`;
            }
            if (chatgptModel === 'finetuning') {
                message += `\nğŸ”§ Finetuning ëª¨ë¸: ${chatgptFinetuningModel}`;
            }
            
            message += `\n\nğŸš€ ì´ì œ ì±—ë´‡ì—ì„œ AI ë‹µë³€ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!`;
            
            showStatus2('apiStatus2', message, 'success');
        }

        function testApiConnection2() {
            console.log('API ì—°ê²° í…ŒìŠ¤íŠ¸ (í´ë¡  ì±—ë´‡)');
            
            if (!apiSettings2.chatgpt.enabled && !apiSettings2.gemini.enabled && !apiSettings2.claude.enabled) {
                showStatus2('apiStatus2', 'âŒ ë¨¼ì € API ì„¤ì •ì„ ì €ì¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            showStatus2('apiStatus2', 'ğŸ”„ API ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'success');
            
            testAllAPIs2().then(results => {
                const message = results.join('\n') + '\nğŸ‰ ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!';
                showStatus2('apiStatus2', message, 'success');
            }).catch(error => {
                showStatus2('apiStatus2', `âŒ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            });
        }

        function resetApiSettings2() {
            console.log('API ì„¤ì • ì´ˆê¸°í™” (í´ë¡  ì±—ë´‡)');
            if (confirm('ëª¨ë“  API ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì €ì¥ëœ API í‚¤ì™€ ëª¨ë¸ ì„ íƒì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')) {
                // í¼ ì´ˆê¸°í™”
                document.getElementById('chatgptModel2').value = '';
                document.getElementById('chatgptApiKey2').value = '';
                document.getElementById('chatgptFinetuningModel2').value = '';
                document.getElementById('chatgptFinetuningGroup2').style.display = 'none';
                document.getElementById('geminiModel2').value = '';
                document.getElementById('geminiApiKey2').value = '';
                document.getElementById('claudeModel2').value = '';
                document.getElementById('claudeApiKey2').value = '';
                
                // ì„¤ì • ê°ì²´ ì´ˆê¸°í™”
                apiSettings2 = {
                    chatgpt: { apiKey: '', model: '', enabled: false },
                    gemini: { apiKey: '', model: '', enabled: false },
                    claude: { apiKey: '', model: '', enabled: false },
                    activeProvider: ''
                };
                
                showStatus2('apiStatus2', 'ğŸ”„ ëª¨ë“  API ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        function toggleFinetuningInput2(provider) {
            const selectElement = document.getElementById(`${provider}Model2`);
            const finetuningGroup = document.getElementById(`${provider}FinetuningGroup2`);
            
            if (selectElement.value === 'finetuning') {
                finetuningGroup.style.display = 'block';
            } else {
                finetuningGroup.style.display = 'none';
            }
        }

        function handleFileUpload2(event) {
            const files = event.target.files;
            console.log('íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ ì‹œì‘ (í´ë¡  ì±—ë´‡):', files.length, 'ê°œ');
            
            if (files.length === 0) return;
            
            showStatus2('knowledgeSettingsStatus2', 'ğŸ“ íŒŒì¼ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'success');
            
            // íŒŒì¼ ì²˜ë¦¬ ë¡œì§ (ê°„ë‹¨ ë²„ì „)
            Array.from(files).forEach((file, index) => {
                setTimeout(() => {
                    knowledgeBase2.files.push({
                        name: file.name,
                        size: file.size,
                        uploadTime: new Date()
                    });
                    
                    if (index === files.length - 1) {
                        // ë§ˆì§€ë§‰ íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ
                        showStatus2('knowledgeSettingsStatus2', 
                            `âœ… ${files.length}ê°œ íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\nğŸ’¡ "ì§€ì‹ íŒŒì¼ ì„¤ì • ì €ì¥" ë²„íŠ¼ì„ ëˆŒëŸ¬ í™œì„±í™”í•´ì£¼ì„¸ìš”.`, 
                            'success');
                    }
                }, index * 100); // ìˆœì°¨ ì²˜ë¦¬ íš¨ê³¼
            });
        }

        function handleFileDrop2(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
            console.log('íŒŒì¼ ë“œë¡­ (í´ë¡  ì±—ë´‡)');
        }

        function handleDragOver2(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave2(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('dragover');
        }

        function saveKnowledgeSettings2() {
            console.log('ì§€ì‹ íŒŒì¼ ì„¤ì • ì €ì¥ (í´ë¡  ì±—ë´‡)');
            
            if (knowledgeBase2.files.length === 0) {
                showStatus2('knowledgeSettingsStatus2', 'âŒ ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // ì§€ì‹ë² ì´ìŠ¤ í™œì„±í™”
            knowledgeBase2.enabled = true;
            
            showStatus2('knowledgeSettingsStatus2', 
                `âœ… ì§€ì‹ íŒŒì¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nğŸ“š ì´ ${knowledgeBase2.files.length}ê°œ íŒŒì¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\nğŸ¤– ì´ì œ ì±—ë´‡ì´ ì—…ë¡œë“œëœ ì§€ì‹ì„ í™œìš©í•©ë‹ˆë‹¤.`, 
                'success');
        }

        function testKnowledgeBase2() {
            console.log('ì§€ì‹ë² ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (í´ë¡  ì±—ë´‡)');
            
            if (!knowledgeBase2.enabled || knowledgeBase2.files.length === 0) {
                showStatus2('knowledgeSettingsStatus2', 'âŒ í™œì„±í™”ëœ ì§€ì‹ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const testQueries = ['ì§„ë£Œì‹œê°„', 'ì˜ˆì•½', 'ë¹„ìš©', 'ìœ„ì¹˜'];
            let testResults = [];
            
            testQueries.forEach(query => {
                // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                const hasMatch = Math.random() > 0.3; // 70% í™•ë¥ ë¡œ ë§¤ì¹­
                if (hasMatch) {
                    testResults.push(`âœ… "${query}" - ë‹µë³€ ë°œê²¬`);
                } else {
                    testResults.push(`âŒ "${query}" - ë‹µë³€ ì—†ìŒ`);
                }
            });
            
            const successCount = testResults.filter(r => r.includes('âœ…')).length;
            const message = `ğŸ” ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (${successCount}/${testQueries.length})\n${testResults.join('\n')}`;
            
            showStatus2('knowledgeSettingsStatus2', message, successCount > 0 ? 'success' : 'error');
        }

        function showParsedData2() {
            console.log('íŒŒì‹±ëœ ë°ì´í„° ë³´ê¸° (í´ë¡  ì±—ë´‡)');
            const viewElement = document.getElementById('parsedDataView2');
            const contentElement = document.getElementById('parsedDataContent2');
            
            contentElement.innerHTML = `
                <p style="text-align: center; color: #666; padding: 20px;">
                    ğŸ“š í´ë¡  ì±—ë´‡ì˜ ì§€ì‹ íŒŒì¼ ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.<br>
                    ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì—…ë¡œë“œëœ íŒŒì¼ë“¤ì˜ íŒŒì‹±ëœ Q&A ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </p>
            `;
            
            if (viewElement.style.display === 'none') {
                viewElement.style.display = 'block';
            } else {
                viewElement.style.display = 'none';
            }
        }

        function clearAllKnowledge2() {
            console.log('ëª¨ë“  ì§€ì‹ ì‚­ì œ (í´ë¡  ì±—ë´‡)');
            if (confirm('ëª¨ë“  ì—…ë¡œë“œëœ ì§€ì‹ íŒŒì¼ê³¼ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                // ì§€ì‹ë² ì´ìŠ¤ ì´ˆê¸°í™”
                knowledgeBase2 = {
                    files: [],
                    content: '',
                    parsedData: [],
                    enabled: false
                };
                
                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                document.getElementById('fileInput2').value = '';
                document.getElementById('fileList2').innerHTML = '';
                document.getElementById('parsedDataView2').style.display = 'none';
                
                showStatus2('knowledgeSettingsStatus2', 'ğŸ—‘ï¸ ëª¨ë“  ì§€ì‹ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // ì‹¤ì œ API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        async function testAllAPIs2() {
            const testResults = [];
            const testMessage = "ì•ˆë…•í•˜ì„¸ìš”. API ì—°ê²° í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.";
            
            if (apiSettings2.chatgpt.enabled) {
                try {
                    await callChatGPTAPI2(testMessage, apiSettings2.chatgpt);
                    testResults.push('âœ… ChatGPT API ì—°ê²° ì„±ê³µ');
                } catch (error) {
                    testResults.push(`âŒ ChatGPT API ì˜¤ë¥˜: ${error.message}`);
                }
            }
            
            if (apiSettings2.gemini.enabled) {
                try {
                    await callGeminiAPI2(testMessage, apiSettings2.gemini);
                    testResults.push('âœ… Gemini API ì—°ê²° ì„±ê³µ');
                } catch (error) {
                    testResults.push(`âŒ Gemini API ì˜¤ë¥˜: ${error.message}`);
                }
            }
            
            if (apiSettings2.claude.enabled) {
                try {
                    await callClaudeAPI2(testMessage, apiSettings2.claude);
                    testResults.push('âœ… Claude API ì—°ê²° ì„±ê³µ');
                } catch (error) {
                    testResults.push(`âŒ Claude API ì˜¤ë¥˜: ${error.message}`);
                }
            }
            
            return testResults;
        }

        // ChatGPT API í˜¸ì¶œ
        async function callChatGPTAPI2(message, settings) {
            const systemPrompt = `ë‹¹ì‹ ì€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›ì˜ ì „ë¬¸ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
            ë§¤ìš° ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

            === ë³‘ì› ê¸°ë³¸ ì •ë³´ ===
            â€¢ ë³‘ì›ëª…: í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›
            â€¢ ì›ì¥: í™ê¸¸ë™ (25ë…„ ê²½ë ¥ ì¹˜ì£¼ì§ˆí™˜ ì „ë¬¸ì˜)
            â€¢ ì§„ë£Œì‹œê°„: í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00, ì ì‹¬ì‹œê°„ 12:30-13:30
            â€¢ íœ´ì§„: ì¼ìš”ì¼, ê³µíœ´ì¼
            â€¢ ì „í™”: 070-1234-1234 (24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥)
            â€¢ ì£¼ì†Œ: í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸
            â€¢ êµí†µ: ì§€í•˜ì²  2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„
            â€¢ ì£¼ì°¨: ê±´ë¬¼ ì§€í•˜ 1-3ì¸µ ë¬´ë£Œ ì£¼ì°¨ (3ì‹œê°„)

            ë‹µë³€ ê°€ì´ë“œë¼ì¸:
            1. ë§¤ìš° ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
            2. ì „ë¬¸ì ì´ë©´ì„œë„ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•˜ì„¸ìš”
            3. ì˜ˆì•½ì´ë‚˜ ìƒë‹´ì´ í•„ìš”í•œ ê²½ìš° ì ê·¹ ì•ˆë‚´í•˜ì„¸ìš”`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${settings.apiKey}`
                },
                body: JSON.stringify({
                    model: settings.model,
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: message }
                    ],
                    max_tokens: 800,
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Gemini API í˜¸ì¶œ
        async function callGeminiAPI2(message, settings) {
            const prompt = `ë‹¹ì‹ ì€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›ì˜ ì „ë¬¸ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
            ë§¤ìš° ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

            === ë³‘ì› ê¸°ë³¸ ì •ë³´ ===
            â€¢ ë³‘ì›ëª…: í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›
            â€¢ ì›ì¥: í™ê¸¸ë™ (25ë…„ ê²½ë ¥ ì¹˜ì£¼ì§ˆí™˜ ì „ë¬¸ì˜)
            â€¢ ì§„ë£Œì‹œê°„: í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00, ì ì‹¬ì‹œê°„ 12:30-13:30
            â€¢ íœ´ì§„: ì¼ìš”ì¼, ê³µíœ´ì¼
            â€¢ ì „í™”: 070-1234-1234 (24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥)
            â€¢ ì£¼ì†Œ: í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸

            ì§ˆë¬¸: ${message}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${settings.model}:generateContent?key=${settings.apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { maxOutputTokens: 800, temperature: 0.7 }
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Claude API í˜¸ì¶œ
        async function callClaudeAPI2(message, settings) {
            const prompt = `ë‹¹ì‹ ì€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›ì˜ ì „ë¬¸ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
            ë§¤ìš° ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

            === ë³‘ì› ê¸°ë³¸ ì •ë³´ ===
            â€¢ ë³‘ì›ëª…: í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›
            â€¢ ì›ì¥: í™ê¸¸ë™ (25ë…„ ê²½ë ¥ ì¹˜ì£¼ì§ˆí™˜ ì „ë¬¸ì˜)
            â€¢ ì§„ë£Œì‹œê°„: í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00, ì ì‹¬ì‹œê°„ 12:30-13:30
            â€¢ íœ´ì§„: ì¼ìš”ì¼, ê³µíœ´ì¼
            â€¢ ì „í™”: 070-1234-1234 (24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥)
            â€¢ ì£¼ì†Œ: í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸

            ì§ˆë¬¸: ${message}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': settings.apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: settings.model,
                    max_tokens: 800,
                    messages: [{ role: "user", content: prompt }]
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        function showStatus2(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
            
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }

        // í…ìŠ¤íŠ¸ ì˜ì—­ ìë™ ë¦¬ì‚¬ì´ì¦ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatbotInput2');
            if (chatInput) {
                chatInput.addEventListener('input', function() {
                    autoResizeTextarea2(this);
                });
            }
        });

        console.log('AI ì±—ë´‡ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html> 