<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬</title>
    
    <!-- ìºì‹œ ë°©ì§€ ë° ëª¨ë°”ì¼ ìµœì í™” ë©”íƒ€ íƒœê·¸ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4facfe">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --vh: 1vh;
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        html, body {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .chatbot-main {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: white;
            position: relative;
        }

        /* í—¤ë” */
        .chatbot-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 18px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-title {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
            flex: 1;
        }

        .back-link {
            position: absolute;
            left: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            width: 60px;
            height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
            text-decoration: none;
            z-index: 1000;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .home-icon {
            font-size: 24px;
            line-height: 1;
        }

        .home-arrow {
            font-size: 14px;
            line-height: 1;
            margin-top: 2px;
        }

        /* API ìƒíƒœ í‘œì‹œ */
        #apiStatus {
            position: absolute;
            top: 10px;
            right: 140px;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
            font-weight: bold;
            z-index: 1001;
        }

        /* ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´ */
        .header-language-dropdown {
            position: absolute;
            right: 15px;
            z-index: 2000;
        }

        .language-dropdown {
            position: relative;
            display: inline-block;
        }

        .language-current {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: 2px solid #ffbf00;
            color: black !important;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 100px;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.4);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .language-current:hover {
            background: linear-gradient(135deg, #ffbf00 0%, #ffd700 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 215, 0, 0.6);
        }

        .language-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            display: none;
            min-width: 120px;
            margin-top: 5px;
        }

        .language-menu.show {
            display: block;
        }

        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid #eee;
            font-size: 12px;
            color: black !important;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .language-option:last-child {
            border-bottom: none;
        }

        .language-option:hover {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        }

        .language-option.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white !important;
        }

        /* ë©”ì‹œì§€ ì˜ì—­ */
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 80px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #e9ecef;
            color: #495057;
        }

        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 14px;
            word-wrap: break-word;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message.user .message-content {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 6px;
        }

        /* ë¹ ë¥¸ ë²„íŠ¼ ìµœì í™” */
        .quick-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .quick-button {
            background: #f0f8ff;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            border-radius: 15px;
            padding: 10px 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            will-change: transform, box-shadow;
            text-align: center;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .quick-button:active {
            transform: translateY(0);
        }

        /* íŠ¹ë³„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .clinic-hours-btn {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%) !important;
            color: #333 !important;
            border: none !important;
        }

        .treatment-cost-btn {
            background: linear-gradient(135deg, #1e88e5 0%, #42a5f5 100%) !important;
            color: white !important;
            border: none !important;
        }

        .reservation-btn {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%) !important;
            color: white !important;
            border: none !important;
        }

        .directions-btn {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%) !important;
            color: white !important;
            border: none !important;
        }

        /* ì…ë ¥ ì˜ì—­ */
        .chatbot-input {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            padding: 15px;
            display: flex;
            gap: 10px;
            align-items: flex-end;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .chatbot-input textarea {
            flex: 1;
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 16px;
            resize: none;
            outline: none;
            min-height: 45px;
            max-height: 120px;
            line-height: 1.4;
            -webkit-user-select: text;
            user-select: text;
            touch-action: manipulation;
            font-family: inherit;
        }

        .chatbot-input textarea:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }

        .chatbot-send {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 90px;
            height: 45px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .chatbot-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .chatbot-send:active {
            transform: scale(0.95);
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 80% { content: '...'; }
            100% { content: ''; }
        }

        /* ì˜ˆì•½ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .reservation-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%) !important;
            color: white !important;
            border: none !important;
            padding: 12px 24px !important;
            border-radius: 25px !important;
            font-size: 14px !important;
            font-weight: bold !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            text-decoration: none !important;
            display: inline-block !important;
            margin: 10px 0 !important;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3) !important;
            touch-action: manipulation !important;
            -webkit-tap-highlight-color: transparent !important;
        }

        .reservation-button:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5) !important;
        }

        .reservation-message {
            margin-top: 15px !important;
            padding: 15px !important;
            background: #f8f9fa !important;
            border-radius: 10px !important;
            border-left: 4px solid var(--primary-color) !important;
            text-align: center !important;
        }

        .reservation-message-text {
            font-size: 14px !important;
            color: #666 !important;
            margin-bottom: 10px !important;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .chatbot-header {
                padding: 12px 8px;
            }
            
            .chatbot-title {
                font-size: 16px;
                margin: 0 80px;
            }
            
            .back-link {
                width: 50px;
                height: 50px;
                left: 8px;
            }
            
            .home-icon {
                font-size: 20px;
            }
            
            .home-arrow {
                font-size: 12px;
            }
            
            #apiStatus {
                right: 90px;
                font-size: 10px;
                padding: 3px 6px;
            }
            
            .header-language-dropdown {
                right: 8px;
            }
            
            .language-current {
                padding: 6px 10px;
                font-size: 11px;
                min-width: 80px;
            }
            
            .chatbot-messages {
                padding: 12px;
                margin-bottom: 75px;
            }
            
            .message-content {
                max-width: 85%;
                font-size: 13px;
            }
            
            .quick-buttons {
                gap: 6px;
                max-width: 280px;
            }
            
            .quick-button {
                font-size: 11px;
                padding: 8px 6px;
                min-height: 40px;
            }
            
            .chatbot-input {
                padding: 10px;
            }
            
            .chatbot-send {
                min-width: 70px;
                padding: 10px 16px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .chatbot-title {
                font-size: 14px;
                margin: 0 70px;
            }
            
            .back-link {
                width: 45px;
                height: 45px;
                left: 5px;
            }
            
            .home-icon {
                font-size: 18px;
            }
            
            .home-arrow {
                font-size: 10px;
            }
            
            #apiStatus {
                right: 75px;
                font-size: 9px;
                padding: 2px 4px;
            }
            
            .header-language-dropdown {
                right: 5px;
            }
            
            .language-current {
                padding: 5px 8px;
                font-size: 10px;
                min-width: 70px;
            }
            
            .chatbot-messages {
                padding: 8px;
                margin-bottom: 70px;
            }
            
            .quick-buttons {
                gap: 4px;
                max-width: 250px;
            }
            
            .quick-button {
                font-size: 10px;
                padding: 6px 4px;
                min-height: 36px;
            }
            
            .chatbot-input {
                padding: 8px;
            }
            
            .chatbot-send {
                min-width: 60px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* iOS Safari ìµœì í™” */
        @supports (-webkit-touch-callout: none) {
            .chatbot-main {
                height: 100vh;
                height: -webkit-fill-available;
            }
            
            .chatbot-input {
                padding-bottom: env(safe-area-inset-bottom, 15px);
            }
        }

        /* í‚¤ë³´ë“œ ì—´ë¦¼ ìƒíƒœ ìµœì í™” */
        .keyboard-open .chatbot-messages {
            padding-bottom: 20px;
        }

        /* PC ìµœì í™” */
        @media (min-width: 1024px) {
            .chatbot-main {
                max-width: 800px;
                margin: 0 auto;
                height: 90vh;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.1);
                margin-top: 5vh;
            }
            
            .chatbot-header {
                border-radius: 20px 20px 0 0;
            }
            
            .chatbot-input {
                border-radius: 0 0 20px 20px;
            }
            
            #apiStatus {
                right: 160px;
                font-size: 12px;
                padding: 6px 10px;
            }
            
            .language-current {
                min-width: 120px;
                font-size: 14px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="chatbot-main">
        <!-- í—¤ë” -->
        <div class="chatbot-header">
            <a href="index.html" class="back-link" onclick="handleBackNavigation(event)">
                <span class="home-icon">ğŸ </span>
                <span class="home-arrow">â†</span>
            </a>
            <h1 class="chatbot-title">í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬ğŸ‘©â€âš•ï¸</h1>
            
            <!-- API ì„¤ì • ìƒíƒœ í‘œì‹œ -->
            <div id="apiStatus">âŒ AI API ì„¤ì • ì•ˆë¨</div>
            
            <!-- ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
            <div class="header-language-dropdown">
                <div class="language-dropdown">
                    <button class="language-current" onclick="toggleLanguageMenu()" ontouchstart="toggleLanguageMenu()">
                        <span id="currentLanguageText">ğŸ‡°ğŸ‡· KR</span>
                        <span>â–¼</span>
                    </button>
                    <div class="language-menu" id="languageMenu">
                        <div class="language-option active" data-lang="ko" onclick="selectLanguage('ko')" ontouchstart="selectLanguage('ko')">ğŸ‡°ğŸ‡· KR</div>
                        <div class="language-option" data-lang="en" onclick="selectLanguage('en')" ontouchstart="selectLanguage('en')">ğŸ‡ºğŸ‡¸ US</div>
                        <div class="language-option" data-lang="ru" onclick="selectLanguage('ru')" ontouchstart="selectLanguage('ru')">ğŸ‡·ğŸ‡º RU</div>
                        <div class="language-option" data-lang="ja" onclick="selectLanguage('ja')" ontouchstart="selectLanguage('ja')">ğŸ‡¯ğŸ‡µ JP</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ì˜ì—­ -->
        <div class="chatbot-messages" id="chatbotMessages">
            <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="chatbot-input">
            <textarea id="chatbotInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Shift+Enter: ì „ì†¡)" rows="1" oninput="adjustTextareaHeight(this)" onkeydown="handleInputKeyDown(event)"></textarea>
            <button class="chatbot-send" onclick="sendMessage()">ì „ì†¡</button>
        </div>
    </div>

    <script>
        console.log('ğŸš€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ì±—ë´‡ ì‹œì‘ (ìµœì í™” ë²„ì „)');

        // ğŸ¯ ì±—ë´‡ í•µì‹¬ í´ë˜ìŠ¤ (ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì ìš©)
        class PhoenixChatbot {
            constructor() {
                this.currentLanguage = 'ko';
                this.apiSettings = null;
                this.knowledgeBase = { enabled: false, files: [], parsedData: [] };
                this.isProcessingMessage = false;
                this.lastMessageTime = 0;
                this.lastMessage = '';
                
                this.initializeTranslations();
                this.init();
            }
            
            // ë²ˆì—­ ë°ì´í„° ì´ˆê¸°í™”
            initializeTranslations() {
                this.translations = {
                    ko: {
                        title: 'í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬ğŸ‘©â€âš•ï¸',
                        placeholder: 'ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Shift+Enter: ì „ì†¡)',
                        sendButton: 'ì „ì†¡',
                        currentLanguage: 'ğŸ‡°ğŸ‡· KR',
                        welcomeMessage: 'í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AIìƒë‹´ì‚¬ ì…ë‹ˆë‹¤!',
                        welcomeSubMessage: 'ìš°ì¸¡ ìƒë‹¨ì—ì„œ ì–¸ì–´ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤',
                        clinicHours: this.createClinicHoursContent('ko'),
                        treatmentCost: this.createTreatmentCostContent('ko'),
                        reservationInquiry: this.createReservationContent('ko'),
                        directions: this.createDirectionsContent('ko')
                    },
                    en: {
                        title: 'Phoenix Dental AI ConsultantğŸ‘©â€âš•ï¸',
                        placeholder: 'Enter your message... (Shift+Enter: Send)',
                        sendButton: 'Send',
                        currentLanguage: 'ğŸ‡ºğŸ‡¸ US',
                        welcomeMessage: 'I am Phoenix Dental AI consultant!',
                        welcomeSubMessage: 'Language change available in top right menu',
                        clinicHours: this.createClinicHoursContent('en'),
                        treatmentCost: this.createTreatmentCostContent('en'),
                        reservationInquiry: this.createReservationContent('en'),
                        directions: this.createDirectionsContent('en')
                    },
                    ru: {
                        title: 'ĞšĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ğ½Ñ‚ Ğ˜Ğ˜ ÑÑ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ PhoenixğŸ‘©â€âš•ï¸',
                        placeholder: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ... (Shift+Enter: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ)',
                        sendButton: 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ',
                        currentLanguage: 'ğŸ‡·ğŸ‡º RU',
                        welcomeMessage: 'Ğ¯ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ğ½Ñ‚ Ğ˜Ğ˜ ÑÑ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ Phoenix!',
                        welcomeSubMessage: 'Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ² Ğ¼ĞµĞ½Ñ ÑĞ¿Ñ€Ğ°Ğ²Ğ° Ğ²Ğ²ĞµÑ€Ñ…Ñƒ',
                        clinicHours: this.createClinicHoursContent('ru'),
                        treatmentCost: this.createTreatmentCostContent('ru'),
                        reservationInquiry: this.createReservationContent('ru'),
                        directions: this.createDirectionsContent('ru')
                    },
                    ja: {
                        title: 'ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘AIã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆğŸ‘©â€âš•ï¸',
                        placeholder: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„... (Shift+Enter: é€ä¿¡)',
                        sendButton: 'é€ä¿¡',
                        currentLanguage: 'ğŸ‡¯ğŸ‡µ JP',
                        welcomeMessage: 'ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘AIã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ï¼',
                        welcomeSubMessage: 'å³ä¸Šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§è¨€èªå¤‰æ›´ãŒå¯èƒ½ã§ã™',
                        clinicHours: this.createClinicHoursContent('ja'),
                        treatmentCost: this.createTreatmentCostContent('ja'),
                        reservationInquiry: this.createReservationContent('ja'),
                        directions: this.createDirectionsContent('ja')
                    }
                };
            }
            
            // ì´ˆê¸°í™”
            init() {
                this.loadSettings();
                this.setupEventListeners();
                this.setupMobileOptimization();
                setTimeout(() => this.addWelcomeMessage(), 500);
                this.updateLanguageUI();
            }
            
            // ì„¤ì • ë¡œë”©
            loadSettings() {
                this.loadApiSettings();
                this.loadKnowledgeBaseSettings();
                this.updateApiStatusDisplay();
            }
            
            // ğŸ¯ í•µì‹¬ ë©”ì‹œì§€ ì²˜ë¦¬ í•¨ìˆ˜ (ê°œì„ ëœ ìš°ì„ ìˆœìœ„)
            async processMessage(message) {
                console.log('ğŸ¯ ë©”ì‹œì§€ ì²˜ë¦¬ ì‹œì‘:', message);
                
                // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
                if (this.isDuplicateMessage(message)) {
                    console.log('âš ï¸ ì¤‘ë³µ ë©”ì‹œì§€ ì°¨ë‹¨');
                    return;
                }
                
                this.setProcessingFlag(true);
                
                try {
                    // âœ… 1ì°¨: ê´€ë¦¬ì ê¸°ëŠ¥ (ìµœìš°ì„ )
                    if (this.isAdminCommand(message)) {
                        console.log('ğŸ” 1ì°¨: ê´€ë¦¬ì ê¸°ëŠ¥ ì²˜ë¦¬');
                        this.handleAdminCommand();
                        return;
                    }
                    
                    // âœ… 1.5ì°¨: ì¸ì‚¬/ê°ì‚¬ ì²˜ë¦¬ (ë¹ ë¥¸ ì‘ë‹µ)
                    if (this.isGreetingOrThanks(message)) {
                        console.log('ğŸ˜Š 1.5ì°¨: ì¸ì‚¬/ê°ì‚¬ ì²˜ë¦¬');
                        const response = this.generateGreetingResponse(message);
                        this.addBotMessage(response);
                        return;
                    }
                    
                    // âœ… 2ì°¨: ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰
                    console.log('ğŸ“š 2ì°¨: ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰');
                    const knowledgeAnswer = this.searchInKnowledgeBase(message);
                    if (knowledgeAnswer) {
                        console.log('âœ… ì§€ì‹ë² ì´ìŠ¤ì—ì„œ ë‹µë³€ ë°œê²¬');
                        this.addBotMessage(knowledgeAnswer);
                        return;
                    }
                    
                    // âœ… 3ì°¨: ê¸°ë³¸ FAQ ë‹µë³€ (í‚¤ì›Œë“œ ê¸°ë°˜)
                    console.log('â“ 3ì°¨: ê¸°ë³¸ FAQ ê²€ìƒ‰');
                    const faqAnswer = this.getFAQAnswer(message);
                    if (faqAnswer) {
                        console.log('âœ… FAQ ë‹µë³€ ë°œê²¬:', faqAnswer.type);
                        this.addBotMessage(faqAnswer.content);
                        return;
                    }
                    
                    // âœ… 4ì°¨: AI API í˜¸ì¶œ
                    console.log('ğŸ¤– 4ì°¨: AI API í˜¸ì¶œ ì‹œë„');
                    if (this.hasActiveAPI()) {
                        console.log('âœ… í™œì„±í™”ëœ AI API ë°œê²¬');
                        await this.generateAIResponse(message);
                        return;
                    }
                    
                    // âœ… 5ì°¨: ì‹œë®¬ë ˆì´ì…˜ëœ ë‹µë³€ (ìµœí›„ ìˆ˜ë‹¨)
                    console.log('ğŸ­ 5ì°¨: ì‹œë®¬ë ˆì´ì…˜ëœ ë‹µë³€ ì‚¬ìš©');
                    setTimeout(() => {
                        const response = this.generateSimulatedResponse(message);
                        this.addBotMessage(response);
                    }, 800);
                    
                } catch (error) {
                    console.error('âŒ ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    this.addBotMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } finally {
                    this.setProcessingFlag(false);
                }
            }
            
            // ì¤‘ë³µ ë©”ì‹œì§€ í™•ì¸ (ê°œì„ ë¨)
            isDuplicateMessage(message) {
                const currentTime = Date.now();
                const isDuplicate = this.isProcessingMessage || 
                                   (currentTime - this.lastMessageTime < 1000 && this.lastMessage === message);
                
                this.lastMessageTime = currentTime;
                this.lastMessage = message;
                return isDuplicate;
            }
            
            // ì²˜ë¦¬ í”Œë˜ê·¸ ì„¤ì •
            setProcessingFlag(processing) {
                this.isProcessingMessage = processing;
                if (processing) {
                    setTimeout(() => { this.isProcessingMessage = false; }, 5000);
                }
            }
            
            // ê´€ë¦¬ì ëª…ë ¹ì–´ í™•ì¸
            isAdminCommand(message) {
                const adminKeywords = ['AIê´€ë¦¬ì', 'AI ê´€ë¦¬ì', 'ê´€ë¦¬ì', 'admin'];
                return adminKeywords.some(keyword => 
                    message.toLowerCase().includes(keyword.toLowerCase())
                );
            }
            
            // ì¸ì‚¬/ê°ì‚¬ í™•ì¸
            isGreetingOrThanks(message) {
                const greetings = ['ì•ˆë…•', 'hello', 'hi', 'í•˜ì´', 'ë°˜ê°€ì›Œ', 'ì•ˆë…•í•˜ì„¸ìš”'];
                const thanks = ['ê°ì‚¬', 'ê³ ë§ˆì›Œ', 'thanks', 'thank you', 'ë•¡í'];
                const meaningless = /^(ë–¼|ë°|í…Œ|ë•Œ|ë—˜|ë—´|ë°ë°|ë–¼ë–¼){1,}$/i;
                
                const lower = message.toLowerCase();
                return greetings.some(g => lower.includes(g)) || 
                       thanks.some(t => lower.includes(t)) || 
                       meaningless.test(lower);
            }
            
            // ì¸ì‚¬/ê°ì‚¬ ì‘ë‹µ ìƒì„±
            generateGreetingResponse(message) {
                const lower = message.toLowerCase();
                
                if (lower.includes('ê°ì‚¬') || lower.includes('ê³ ë§ˆì›Œ') || lower.includes('thank')) {
                    return 'ì²œë§Œì—ìš”! í”¼ë‹‰ìŠ¤ì¹˜ê³¼ë¥¼ ì´ìš©í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë” ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜í•´ì£¼ì„¸ìš” ğŸ˜Š';
                }
                
                return 'ì•ˆë…•í•˜ì„¸ìš”! í”¼ë‹‰ìŠ¤ì¹˜ê³¼ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë§ì”€í•´ ì£¼ì„¸ìš” ğŸ˜Š';
            }
            
            // FAQ ë‹µë³€ ì²˜ë¦¬ (ê°œì„ ëœ í‚¤ì›Œë“œ ë§¤ì¹­)
            getFAQAnswer(message) {
                const keywordGroups = this.getKeywordGroups();
                const normalized = message.toLowerCase().trim();
                
                for (const [groupName, group] of Object.entries(keywordGroups)) {
                    if (this.matchesKeywords(normalized, group.keywords)) {
                        const translations = this.translations[this.currentLanguage];
                        return {
                            type: group.type,
                            content: translations[group.type]
                        };
                    }
                }
                
                return null;
            }
            
            // í‚¤ì›Œë“œ ê·¸ë£¹ ì •ì˜ (ë” ì •í™•í•œ ë§¤ì¹­)
            getKeywordGroups() {
                return {
                    clinicHours: {
                        keywords: ['ì§„ë£Œì‹œê°„', 'ìš´ì˜ì‹œê°„', 'ë¬¸ì—¬ëŠ”', 'ì—´ì–´', 'clinic hours', 'hours', 'Ñ‡Ğ°ÑÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹', 'è¨ºç™‚æ™‚é–“'],
                        type: 'clinicHours'
                    },
                    treatmentCost: {
                        keywords: ['ì¹˜ë£Œë¹„ìš©', 'ì§„ë£Œë¹„', 'ë¹„ìš©', 'ê°€ê²©', 'ì–¼ë§ˆ', 'cost', 'price', 'ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ', 'æ–™é‡‘', 'ìŠ¤ì¼€ì¼ë§', 'ì„í”Œë€íŠ¸', 'êµì •', 'ë¯¸ë°±'],
                        type: 'treatmentCost'
                    },
                    reservation: {
                        keywords: ['ì˜ˆì•½', 'ì˜ˆì•½ë¬¸ì˜', 'ì‹ ì²­', 'reservation', 'booking', 'Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ', 'äºˆç´„', 'ì ‘ìˆ˜'],
                        type: 'reservationInquiry'
                    },
                    directions: {
                        keywords: ['ì˜¤ì‹œëŠ”ê¸¸', 'ì£¼ì†Œ', 'ìœ„ì¹˜', 'ì–´ë””', 'directions', 'location', 'address', 'Ğ°Ğ´Ñ€ĞµÑ', 'å ´æ‰€', 'ì°¾ì•„'],
                        type: 'directions'
                    }
                };
            }
            
            // í‚¤ì›Œë“œ ë§¤ì¹­ (ë” ì •í™•í•œ ì•Œê³ ë¦¬ì¦˜)
            matchesKeywords(message, keywords) {
                return keywords.some(keyword => {
                    // ì •í™•í•œ ë‹¨ì–´ ê²½ê³„ ë§¤ì¹­ ë˜ëŠ” ë¶€ë¶„ ë¬¸ìì—´ ë§¤ì¹­
                    const wordBoundary = new RegExp(`\\b${keyword.toLowerCase()}\\b`);
                    return wordBoundary.test(message) || message.includes(keyword.toLowerCase());
                });
            }
            
            // API í™œì„± ìƒíƒœ í™•ì¸
            hasActiveAPI() {
                return this.apiSettings && (
                    (this.apiSettings.chatgpt?.enabled && this.apiSettings.chatgpt?.apiKey) ||
                    (this.apiSettings.gemini?.enabled && this.apiSettings.gemini?.apiKey) ||
                    (this.apiSettings.claude?.enabled && this.apiSettings.claude?.apiKey)
                );
            }
            
            // í™œì„±í™”ëœ API ì œê³µì ê°€ì ¸ì˜¤ê¸°
            getActiveProvider() {
                if (this.apiSettings?.chatgpt?.enabled && this.apiSettings.chatgpt?.apiKey) {
                    return 'chatgpt';
                } else if (this.apiSettings?.gemini?.enabled && this.apiSettings.gemini?.apiKey) {
                    return 'gemini';
                } else if (this.apiSettings?.claude?.enabled && this.apiSettings.claude?.apiKey) {
                    return 'claude';
                }
                return null;
            }
            
            // ì§€ì‹ë² ì´ìŠ¤ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ì¶”ì¶œ
            getContextFromKnowledgeBase() {
                if (!this.knowledgeBase.enabled || this.knowledgeBase.parsedData.length === 0) {
                    return '';
                }
                
                // ëª¨ë“  Q&Aë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì •ë¦¬
                let context = '\n\n=== ë³‘ì› ì „ë¬¸ ì§€ì‹ ì •ë³´ ===\n';
                this.knowledgeBase.parsedData.forEach((qa, index) => {
                    context += `${index + 1}. Q: ${qa.question}\n   A: ${qa.answer}\n`;
                });
                
                return context;
            }
            
            // API í˜¸ì¶œ í•¨ìˆ˜
            async callAPI(provider, message, contextInfo) {
                const settings = this.apiSettings[provider];
                
                switch (provider) {
                    case 'chatgpt':
                        return await this.callChatGPTAPI(message, settings, contextInfo);
                    case 'gemini':
                        return await this.callGeminiAPI(message, settings, contextInfo);
                    case 'claude':
                        return await this.callClaudeAPI(message, settings, contextInfo);
                    default:
                        throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” API ì œê³µìì…ë‹ˆë‹¤.');
                }
            }
            
            // ChatGPT API í˜¸ì¶œ
            async callChatGPTAPI(message, settings, contextInfo) {
                const systemPrompt = `ë‹¹ì‹ ì€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›ì˜ ì „ë¬¸ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
                ë§¤ìš° ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

                === ë³‘ì› ê¸°ë³¸ ì •ë³´ ===
                â€¢ ë³‘ì›ëª…: í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›
                â€¢ ì›ì¥: í™ê¸¸ë™ (25ë…„ ê²½ë ¥ ì¹˜ì£¼ì§ˆí™˜ ì „ë¬¸ì˜)
                â€¢ ì§„ë£Œì‹œê°„: í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00, ì ì‹¬ì‹œê°„ 12:30-13:30
                â€¢ íœ´ì§„: ì¼ìš”ì¼, ê³µíœ´ì¼
                â€¢ ì „í™”: 070-1234-1234 (24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥)
                â€¢ ì£¼ì†Œ: í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸
                â€¢ êµí†µ: ì§€í•˜ì²  2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„
                â€¢ ì£¼ì°¨: ê±´ë¬¼ ì§€í•˜ 1-3ì¸µ ë¬´ë£Œ ì£¼ì°¨ (3ì‹œê°„)
                â€¢ ì§„ë£Œê³¼ëª©: ì¼ë°˜ì§„ë£Œ, ë¯¸ë°±ì¹˜ë£Œ, êµì •ì¹˜ë£Œ, ì„í”Œë€íŠ¸, ë³´ì² ì¹˜ë£Œ, ì†Œì•„ì¹˜ê³¼

                === ì¹˜ë£Œë¹„ ì•ˆë‚´ ===
                â€¢ ì¼ë°˜ì§„ë£Œ: ì´ˆì§„ 15,000ì›, ì¬ì§„ 10,000ì›
                â€¢ ìŠ¤ì¼€ì¼ë§: 50,000ì› (ê±´ê°•ë³´í—˜ ì ìš© ì‹œ ì—° 1íšŒ ë¬´ë£Œ)
                â€¢ ë¯¸ë°±ì¹˜ë£Œ: 200,000-300,000ì›
                â€¢ êµì •ì¹˜ë£Œ: 1,500,000-6,000,000ì›
                â€¢ ì„í”Œë€íŠ¸: 1,200,000-1,500,000ì›

                ${contextInfo}

                ë‹µë³€ ê°€ì´ë“œë¼ì¸:
                1. ë§¤ìš° ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
                2. ì „ë¬¸ì ì´ë©´ì„œë„ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•˜ì„¸ìš”
                3. êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ ì œê³µí•˜ë˜, ì •í™•í•˜ì§€ ì•Šì€ ì˜ë£Œ ì§„ë‹¨ì€ í”¼í•˜ì„¸ìš”
                4. ì˜ˆì•½ì´ë‚˜ ìƒë‹´ì´ í•„ìš”í•œ ê²½ìš° ì ê·¹ ì•ˆë‚´í•˜ì„¸ìš”
                5. ë‹µë³€ì„ êµ¬ì¡°í™”í•˜ì—¬ ì½ê¸° ì‰½ê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”
                6. ì§„ë£Œì‹œê°„, ì¹˜ë£Œë¹„ìš©, ì˜ˆì•½ë¬¸ì˜, ì˜¤ì‹œëŠ”ê¸¸ ë“± ì£¼ìš” ì§ˆë¬¸ì— ëŒ€í•´ì„œëŠ” ìì—°ìŠ¤ëŸ½ê³  ìƒì„¸í•œ ì„¤ëª…ì„ ì œê³µí•˜ì„¸ìš”
                7. ì‚¬ìš©ìì˜ í¸ì˜ë¥¼ ê³ ë ¤í•œ ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ í¬í•¨í•´ì£¼ì„¸ìš”`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${settings.apiKey}`
                    },
                    body: JSON.stringify({
                        model: settings.model,
                        messages: [
                            {
                                role: "system",
                                content: systemPrompt
                            },
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        max_tokens: 800,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }
            
            // Gemini API í˜¸ì¶œ
            async callGeminiAPI(message, settings, contextInfo) {
                const prompt = `ë‹¹ì‹ ì€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›ì˜ ì „ë¬¸ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
                ë§¤ìš° ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

                === ë³‘ì› ê¸°ë³¸ ì •ë³´ ===
                â€¢ ë³‘ì›ëª…: í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›
                â€¢ ì›ì¥: í™ê¸¸ë™ (25ë…„ ê²½ë ¥ ì¹˜ì£¼ì§ˆí™˜ ì „ë¬¸ì˜)
                â€¢ ì§„ë£Œì‹œê°„: í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00, ì ì‹¬ì‹œê°„ 12:30-13:30
                â€¢ íœ´ì§„: ì¼ìš”ì¼, ê³µíœ´ì¼
                â€¢ ì „í™”: 070-1234-1234 (24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥)
                â€¢ ì£¼ì†Œ: í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸
                â€¢ êµí†µ: ì§€í•˜ì²  2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„
                â€¢ ì£¼ì°¨: ê±´ë¬¼ ì§€í•˜ 1-3ì¸µ ë¬´ë£Œ ì£¼ì°¨ (3ì‹œê°„)
                â€¢ ì§„ë£Œê³¼ëª©: ì¼ë°˜ì§„ë£Œ, ë¯¸ë°±ì¹˜ë£Œ, êµì •ì¹˜ë£Œ, ì„í”Œë€íŠ¸, ë³´ì² ì¹˜ë£Œ, ì†Œì•„ì¹˜ê³¼

                === ì¹˜ë£Œë¹„ ì•ˆë‚´ ===
                â€¢ ì¼ë°˜ì§„ë£Œ: ì´ˆì§„ 15,000ì›, ì¬ì§„ 10,000ì›
                â€¢ ìŠ¤ì¼€ì¼ë§: 50,000ì› (ê±´ê°•ë³´í—˜ ì ìš© ì‹œ ì—° 1íšŒ ë¬´ë£Œ)
                â€¢ ë¯¸ë°±ì¹˜ë£Œ: 200,000-300,000ì›
                â€¢ êµì •ì¹˜ë£Œ: 1,500,000-6,000,000ì›
                â€¢ ì„í”Œë€íŠ¸: 1,200,000-1,500,000ì›

                ${contextInfo}

                ë‹µë³€ ê°€ì´ë“œë¼ì¸:
                1. ë§¤ìš° ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
                2. ì „ë¬¸ì ì´ë©´ì„œë„ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•˜ì„¸ìš”
                3. êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ ì œê³µí•˜ë˜, ì •í™•í•˜ì§€ ì•Šì€ ì˜ë£Œ ì§„ë‹¨ì€ í”¼í•˜ì„¸ìš”
                4. ì˜ˆì•½ì´ë‚˜ ìƒë‹´ì´ í•„ìš”í•œ ê²½ìš° ì ê·¹ ì•ˆë‚´í•˜ì„¸ìš”
                5. ë‹µë³€ì„ êµ¬ì¡°í™”í•˜ì—¬ ì½ê¸° ì‰½ê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”

                ì§ˆë¬¸: ${message}`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${settings.model}:generateContent?key=${settings.apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            maxOutputTokens: 800,
                            temperature: 0.7
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            }
            
            // Claude API í˜¸ì¶œ
            async callClaudeAPI(message, settings, contextInfo) {
                const prompt = `ë‹¹ì‹ ì€ í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›ì˜ ì „ë¬¸ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. 
                ë§¤ìš° ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”.

                === ë³‘ì› ê¸°ë³¸ ì •ë³´ ===
                â€¢ ë³‘ì›ëª…: í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ë³‘ì›
                â€¢ ì›ì¥: í™ê¸¸ë™ (25ë…„ ê²½ë ¥ ì¹˜ì£¼ì§ˆí™˜ ì „ë¬¸ì˜)
                â€¢ ì§„ë£Œì‹œê°„: í‰ì¼ 09:00-18:00, í† ìš”ì¼ 09:00-15:00, ì ì‹¬ì‹œê°„ 12:30-13:30
                â€¢ íœ´ì§„: ì¼ìš”ì¼, ê³µíœ´ì¼
                â€¢ ì „í™”: 070-1234-1234 (24ì‹œê°„ ì‘ê¸‰ìƒë‹´ ê°€ëŠ¥)
                â€¢ ì£¼ì†Œ: í”¼ë‹‰ìŠ¤ì‹œ í”¼ë‹‰ìŠ¤ë¡œ 11ê¸¸ 11, í”¼ë‹‰ìŠ¤íƒ€ì›Œ 11ì¸µ 11í˜¸
                â€¢ êµí†µ: ì§€í•˜ì²  2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„
                â€¢ ì£¼ì°¨: ê±´ë¬¼ ì§€í•˜ 1-3ì¸µ ë¬´ë£Œ ì£¼ì°¨ (3ì‹œê°„)
                â€¢ ì§„ë£Œê³¼ëª©: ì¼ë°˜ì§„ë£Œ, ë¯¸ë°±ì¹˜ë£Œ, êµì •ì¹˜ë£Œ, ì„í”Œë€íŠ¸, ë³´ì² ì¹˜ë£Œ, ì†Œì•„ì¹˜ê³¼

                === ì¹˜ë£Œë¹„ ì•ˆë‚´ ===
                â€¢ ì¼ë°˜ì§„ë£Œ: ì´ˆì§„ 15,000ì›, ì¬ì§„ 10,000ì›
                â€¢ ìŠ¤ì¼€ì¼ë§: 50,000ì› (ê±´ê°•ë³´í—˜ ì ìš© ì‹œ ì—° 1íšŒ ë¬´ë£Œ)
                â€¢ ë¯¸ë°±ì¹˜ë£Œ: 200,000-300,000ì›
                â€¢ êµì •ì¹˜ë£Œ: 1,500,000-6,000,000ì›
                â€¢ ì„í”Œë€íŠ¸: 1,200,000-1,500,000ì›

                ${contextInfo}

                ë‹µë³€ ê°€ì´ë“œë¼ì¸:
                1. ë§¤ìš° ì¹œì ˆí•˜ê³  ë”°ëœ»í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
                2. ì „ë¬¸ì ì´ë©´ì„œë„ ì´í•´í•˜ê¸° ì‰½ê²Œ ì„¤ëª…í•˜ì„¸ìš”
                3. êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ ì œê³µí•˜ë˜, ì •í™•í•˜ì§€ ì•Šì€ ì˜ë£Œ ì§„ë‹¨ì€ í”¼í•˜ì„¸ìš”
                4. ì˜ˆì•½ì´ë‚˜ ìƒë‹´ì´ í•„ìš”í•œ ê²½ìš° ì ê·¹ ì•ˆë‚´í•˜ì„¸ìš”
                5. ë‹µë³€ì„ êµ¬ì¡°í™”í•˜ì—¬ ì½ê¸° ì‰½ê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”

                ì§ˆë¬¸: ${message}`;

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': settings.apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: settings.model,
                        max_tokens: 800,
                        messages: [{
                            role: "user",
                            content: prompt
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                return data.content[0].text;
            }
            
            // AI ì‘ë‹µ í¬ë§·íŒ…
            formatAIResponse(response, provider) {
                const providerIcon = {
                    'chatgpt': 'ğŸ§ ',
                    'gemini': 'ğŸ’', 
                    'claude': 'ğŸ¤–'
                };
                
                const providerName = {
                    'chatgpt': 'ChatGPT',
                    'gemini': 'Gemini',
                    'claude': 'Claude'
                };
                
                return `${providerIcon[provider]} <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ìƒë‹´ì‚¬ (${providerName[provider]})</strong><br><br>
                ${response}<br><br>
                <small>ğŸ’¡ ì¶”ê°€ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜í•´ì£¼ì„¸ìš”!</small>`;
            }
            
            // AI ì‘ë‹µ ìƒì„±
            async generateAIResponse(message) {
                const loadingMessage = this.addBotMessage('ğŸ¤– AIê°€ ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤<span class="loading-dots"></span>');
                
                try {
                    // API í˜¸ì¶œ ë¡œì§
                    const activeProvider = this.getActiveProvider();
                    const contextInfo = this.getContextFromKnowledgeBase();
                    
                    const response = await this.callAPI(activeProvider, message, contextInfo);
                    this.removeMessage(loadingMessage);
                    this.addBotMessage(this.formatAIResponse(response, activeProvider));
                } catch (error) {
                    console.error('AI API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                    this.removeMessage(loadingMessage);
                    const fallbackResponse = this.generateSimulatedResponse(message);
                    this.addBotMessage(fallbackResponse);
                }
            }
            
            // ì‹œë®¬ë ˆì´ì…˜ëœ ì‘ë‹µ ìƒì„± (ë” ìì—°ìŠ¤ëŸ½ê²Œ)
            generateSimulatedResponse(message) {
                const responses = [
                    `ì•ˆë…•í•˜ì„¸ìš”! "${message}"ì— ëŒ€í•œ ë‹µë³€ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.`,
                    'í”¼ë‹‰ìŠ¤ì¹˜ê³¼ AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ë” ìì„¸í•œ ìƒë‹´ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”!',
                    'ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì§„ë£Œì‹œê°„, ì¹˜ë£Œë¹„ìš©, ì˜ˆì•½, ì˜¤ì‹œëŠ”ê¸¸ ë“±ì„ ì…ë ¥í•´ë³´ì„¸ìš”.'
                ];
                
                const apiStatus = this.hasActiveAPI() ? 
                    'ğŸ¤– AI APIê°€ ì—°ê²°ë˜ì–´ ìˆì–´ ë” ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' : 
                    'âŒ AI APIê°€ ì„¤ì •ë˜ì§€ ì•Šì•„ ê¸°ë³¸ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤. (ê´€ë¦¬ì ë©”ë‰´ì—ì„œ AI API ì„¤ì • ê°€ëŠ¥)';
                
                return responses[Math.floor(Math.random() * responses.length)] + `
                
ğŸ’¡ **ë¹ ë¥¸ ë¬¸ì˜ ë©”ë‰´:**
â€¢ "ì§„ë£Œì‹œê°„" - ë³‘ì› ìš´ì˜ì‹œê°„ ì•ˆë‚´
â€¢ "ì¹˜ë£Œë¹„ìš©" - ì¹˜ë£Œë¹„ ì •ë³´
â€¢ "ì˜ˆì•½" - ì˜ˆì•½ ë° ìƒë‹´ ë¬¸ì˜  
â€¢ "ì˜¤ì‹œëŠ”ê¸¸" - ë³‘ì› ìœ„ì¹˜ ì•ˆë‚´

${apiStatus}

ğŸ“ **ì§ì ‘ ë¬¸ì˜:** 070-1234-1234`;
            }
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addUserMessage(message) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message user';
                messageDiv.innerHTML = `
                    <div class="message-avatar">ğŸ‘¤</div>
                    <div class="message-content">${this.escapeHtml(message)}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }
            
            // ë´‡ ë©”ì‹œì§€ ì¶”ê°€
            addBotMessage(message) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                messageDiv.innerHTML = `
                    <div class="message-avatar">ğŸ‘©â€âš•ï¸</div>
                    <div class="message-content">${message}</div>
                `;
                messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();
                return messageDiv;
            }
            
            // HTML ì´ìŠ¤ì¼€ì´í”„
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // ë©”ì‹œì§€ ì œê±°
            removeMessage(messageElement) {
                if (messageElement && messageElement.parentNode) {
                    messageElement.parentNode.removeChild(messageElement);
                }
            }
            
            // ìŠ¤í¬ë¡¤ í•˜ë‹¨ ì´ë™
            scrollToBottom() {
                const messagesContainer = document.getElementById('chatbotMessages');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            // í™˜ì˜ ë©”ì‹œì§€ ì¶”ê°€
            addWelcomeMessage() {
                const t = this.translations[this.currentLanguage];
                
                const welcomeMessage = `
                    <div style="text-align: center; color: #333;">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #2c3e50;">
                            ${t.welcomeMessage}
                        </div>
                        <div style="font-size: 14px; color: #666; line-height: 1.5; margin-bottom: 15px;">
                            ${t.welcomeSubMessage}
                        </div>
                        <div style="font-size: 11px; color: #888; margin-bottom: 15px; padding: 8px; background: #f0f8ff; border-radius: 6px;">
                            ğŸ¯ <strong>ë‹µë³€ ìš°ì„ ìˆœìœ„:</strong> 1ì°¨ ê´€ë¦¬ì â†’ 2ì°¨ ì§€ì‹ë² ì´ìŠ¤ â†’ 3ì°¨ FAQ â†’ 4ì°¨ AI API â†’ 5ì°¨ ì‹œë®¬ë ˆì´ì…˜<br>
                            ${this.hasActiveAPI() ? 'ğŸ¤– AI API ì—°ê²°ë¨' : 'âŒ AI API ì„¤ì • í•„ìš” (ê´€ë¦¬ì ë©”ë‰´ì—ì„œ ì„¤ì •)'}
                        </div>
                        <div class="quick-buttons">
                            <button class="quick-button clinic-hours-btn" onclick="chatbot.handleQuickMessage('ì§„ë£Œì‹œê°„ ì•Œë ¤ì£¼ì„¸ìš”')">
                                ğŸ•˜ ì§„ë£Œì‹œê°„
                            </button>
                            <button class="quick-button treatment-cost-btn" onclick="chatbot.handleQuickMessage('ì¹˜ë£Œë¹„ìš© ê¶ê¸ˆí•´ìš”')">
                                ğŸ’° ì¹˜ë£Œë¹„ìš©
                            </button>
                            <button class="quick-button reservation-btn" onclick="chatbot.handleQuickMessage('ì˜ˆì•½ë¬¸ì˜ í•˜ê³ ì‹¶ì–´ìš”')">
                                ğŸ“ ì˜ˆì•½ë¬¸ì˜
                            </button>
                            <button class="quick-button directions-btn" onclick="chatbot.handleQuickMessage('ì˜¤ì‹œëŠ”ê¸¸ ì•Œë ¤ì£¼ì„¸ìš”')">
                                ğŸ—ºï¸ ì˜¤ì‹œëŠ”ê¸¸
                            </button>
                        </div>
                    </div>
                `;
                
                this.addBotMessage(welcomeMessage);
            }
            
            // ë¹ ë¥¸ ë©”ì‹œì§€ ì²˜ë¦¬
            handleQuickMessage(message) {
                console.log('âš¡ ë¹ ë¥¸ ë©”ì‹œì§€:', message);
                this.addUserMessage(message);
                this.processMessage(message);
            }
            
            // ì–¸ì–´ UI ì—…ë°ì´íŠ¸
            updateLanguageUI() {
                const t = this.translations[this.currentLanguage];
                
                document.querySelector('.chatbot-title').textContent = t.title;
                document.getElementById('chatbotInput').placeholder = t.placeholder;
                document.querySelector('.chatbot-send').textContent = t.sendButton;
                document.getElementById('currentLanguageText').textContent = t.currentLanguage;
                
                // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.language-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.getAttribute('data-lang') === this.currentLanguage) {
                        option.classList.add('active');
                    }
                });
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners() {
                // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.language-dropdown')) {
                        document.getElementById('languageMenu').classList.remove('show');
                    }
                });
            }
            
            // ëª¨ë°”ì¼ ìµœì í™” ì„¤ì •
            setupMobileOptimization() {
                this.setViewportHeight();
                window.addEventListener('resize', () => this.setViewportHeight());
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.setViewportHeight(), 100);
                });
                
                // í‚¤ë³´ë“œ ê°ì§€
                this.setupKeyboardDetection();
            }
            
            // ë·°í¬íŠ¸ ë†’ì´ ì„¤ì •
            setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            
            // í‚¤ë³´ë“œ ê°ì§€ ì„¤ì •
            setupKeyboardDetection() {
                const initialHeight = window.innerHeight;
                
                window.addEventListener('resize', () => {
                    const currentHeight = window.innerHeight;
                    const heightDiff = initialHeight - currentHeight;
                    
                    if (heightDiff > 150) {
                        document.body.classList.add('keyboard-open');
                    } else {
                        document.body.classList.remove('keyboard-open');
                    }
                });
            }
            
            // API ì„¤ì • ë¡œë”©
            loadApiSettings() {
                try {
                    const saved = localStorage.getItem('chatbotApiSettings');
                    if (saved) {
                        this.apiSettings = JSON.parse(saved);
                        console.log('âœ… API ì„¤ì • ë¡œë“œ ì™„ë£Œ:', this.apiSettings);
                    } else {
                        this.apiSettings = {
                            chatgpt: { enabled: false, apiKey: '', model: '' },
                            gemini: { enabled: false, apiKey: '', model: '' },
                            claude: { enabled: false, apiKey: '', model: '' }
                        };
                        console.log('âœ… ê¸°ë³¸ API ì„¤ì • ì´ˆê¸°í™” ì™„ë£Œ');
                    }
                } catch (error) {
                    console.error('âŒ API ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.apiSettings = {
                        chatgpt: { enabled: false, apiKey: '', model: '' },
                        gemini: { enabled: false, apiKey: '', model: '' },
                        claude: { enabled: false, apiKey: '', model: '' }
                    };
                }
            }
            
            // ì§€ì‹ë² ì´ìŠ¤ ì„¤ì • ë¡œë”©
            loadKnowledgeBaseSettings() {
                try {
                    const saved = localStorage.getItem('chatbotKnowledgeBase');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.knowledgeBase.enabled = parsed.enabled || false;
                        this.knowledgeBase.parsedData = parsed.parsedData || [];
                        console.log('âœ… ì§€ì‹ë² ì´ìŠ¤ ì„¤ì • ë¡œë“œ ì™„ë£Œ:', this.knowledgeBase.parsedData.length, 'ê°œ Q&A');
                    }
                } catch (error) {
                    console.error('âŒ ì§€ì‹ë² ì´ìŠ¤ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }
            
            // API ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateApiStatusDisplay() {
                const apiStatus = document.getElementById('apiStatus');
                if (!apiStatus) return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë¦¬í„´
                
                if (!this.hasActiveAPI()) {
                    apiStatus.textContent = 'âŒ AI API ì„¤ì • ì•ˆë¨';
                    apiStatus.style.background = '#f8f9fa';
                    apiStatus.style.color = '#6c757d';
                    return;
                }
                
                const activeApis = [];
                if (this.apiSettings?.chatgpt?.enabled && this.apiSettings.chatgpt?.apiKey) activeApis.push('ChatGPT');
                if (this.apiSettings?.gemini?.enabled && this.apiSettings.gemini?.apiKey) activeApis.push('Gemini');
                if (this.apiSettings?.claude?.enabled && this.apiSettings.claude?.apiKey) activeApis.push('Claude');
                
                apiStatus.textContent = `âœ… AI API (${activeApis.join(', ')})`;
                apiStatus.style.background = '#d4edda';
                apiStatus.style.color = '#155724';
            }
            
            // ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰ (ê°„ì†Œí™”ëœ ë²„ì „)
            searchInKnowledgeBase(message) {
                if (!this.knowledgeBase.enabled || this.knowledgeBase.parsedData.length === 0) {
                    return null;
                }
                
                const query = message.toLowerCase().trim();
                let bestMatch = null;
                let bestScore = 0;
                
                for (const qa of this.knowledgeBase.parsedData) {
                    const question = qa.question.toLowerCase();
                    const answer = qa.answer.toLowerCase();
                    
                    let score = 0;
                    
                    // ì™„ì „ ì¼ì¹˜
                    if (question === query) score += 1000;
                    
                    // ë¶€ë¶„ í¬í•¨
                    if (question.includes(query) || query.includes(question)) score += 500;
                    
                    // ë‹¨ì–´ ë§¤ì¹­
                    const queryWords = query.split(/\s+/).filter(w => w.length > 1);
                    for (const word of queryWords) {
                        if (question.includes(word)) score += 100;
                        if (answer.includes(word)) score += 50;
                    }
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMatch = qa;
                    }
                }
                
                if (bestScore >= 50) {
                    return `ğŸ“š <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì „ë¬¸ ì§€ì‹ ë‹µë³€</strong><br><br>
                            <strong>Q:</strong> ${bestMatch.question}<br><br>
                            <strong>A:</strong> ${bestMatch.answer}<br><br>
                            <small>ğŸ’¡ ì „ë¬¸ ì§€ì‹ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì œê³µëœ ë‹µë³€ì…ë‹ˆë‹¤.</small>`;
                }
                
                return null;
            }
            
            // ì½˜í…ì¸  ìƒì„± ë©”ì„œë“œë“¤
            createClinicHoursContent(lang) {
                const content = {
                    ko: 'ğŸ•˜ <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì§„ë£Œì‹œê°„ ì•ˆë‚´</strong><br><br>ğŸ“… <strong>í‰ì¼:</strong> 09:00 ~ 18:00<br>ğŸ“… <strong>í† ìš”ì¼:</strong> 09:00 ~ 15:00<br>ğŸ½ï¸ <strong>ì ì‹¬ì‹œê°„:</strong> 12:30 ~ 13:30<br>ğŸš« <strong>íœ´ì§„:</strong> ì¼ìš”ì¼, ê³µíœ´ì¼<br><br>ğŸ“ <strong>ì˜ˆì•½ ë¬¸ì˜:</strong> 070-1234-1234',
                    en: 'ğŸ•˜ <strong>Phoenix Dental Clinic Hours</strong><br><br>ğŸ“… <strong>Weekdays:</strong> 09:00 ~ 18:00<br>ğŸ“… <strong>Saturday:</strong> 09:00 ~ 15:00<br>ğŸ½ï¸ <strong>Lunch Break:</strong> 12:30 ~ 13:30<br>ğŸš« <strong>Closed:</strong> Sunday, Holidays<br><br>ğŸ“ <strong>Reservation:</strong> 070-1234-1234',
                    ru: 'ğŸ•˜ <strong>Ğ§Ğ°ÑÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑÑ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ Phoenix</strong><br><br>ğŸ“… <strong>Ğ‘ÑƒĞ´Ğ½Ğ¸:</strong> 09:00 ~ 18:00<br>ğŸ“… <strong>Ğ¡ÑƒĞ±Ğ±Ğ¾Ñ‚Ğ°:</strong> 09:00 ~ 15:00<br>ğŸ½ï¸ <strong>ĞĞ±ĞµĞ´:</strong> 12:30 ~ 13:30<br>ğŸš« <strong>Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ:</strong> Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ, Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¸<br><br>ğŸ“ <strong>Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ:</strong> 070-1234-1234',
                    ja: 'ğŸ•˜ <strong>ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘è¨ºç™‚æ™‚é–“æ¡ˆå†…</strong><br><br>ğŸ“… <strong>å¹³æ—¥:</strong> 09:00 ~ 18:00<br>ğŸ“… <strong>åœŸæ›œæ—¥:</strong> 09:00 ~ 15:00<br>ğŸ½ï¸ <strong>æ˜¼ä¼‘ã¿:</strong> 12:30 ~ 13:30<br>ğŸš« <strong>ä¼‘è¨º:</strong> æ—¥æ›œæ—¥ã€ç¥æ—¥<br><br>ğŸ“ <strong>äºˆç´„å•ã„åˆã‚ã›:</strong> 070-1234-1234'
                };
                
                return content[lang] + `<br><br><div class="reservation-message">
                    <div class="reservation-message-text">ìì„¸í•œ ë¬¸ì˜ëŠ” ë°©ë¬¸ ìƒë‹´ì„ ë°›ì•„ë³´ì„¸ìš”</div>
                    <button class="reservation-button" onclick="window.open('reservation.html', '_blank')">ğŸ“… ì˜ˆì•½í•˜ê¸°</button>
                </div>`;
            }
            
            createTreatmentCostContent(lang) {
                const content = {
                    ko: 'ğŸ’° <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì¹˜ë£Œë¹„ìš© ì•ˆë‚´</strong><br><br>ğŸ¦· <strong>ì¼ë°˜ ì§„ë£Œ:</strong> ìƒë‹´ í›„ ì•ˆë‚´<br>ğŸ¦· <strong>ìŠ¤ì¼€ì¼ë§:</strong> 30,000ì› ~ 50,000ì›<br>ğŸ¦· <strong>ì„í”Œë€íŠ¸:</strong> ìƒë‹´ í›„ ê°œë³„ ê²¬ì <br>ğŸ¦· <strong>êµì •:</strong> ìƒë‹´ í›„ ê°œë³„ ê²¬ì <br><br>ğŸ’¡ <strong>ì •í™•í•œ ë¹„ìš©ì€ ì§„ë£Œ í›„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤!</strong>',
                    en: 'ğŸ’° <strong>Phoenix Dental Treatment Costs</strong><br><br>ğŸ¦· <strong>General Treatment:</strong> Consultation required<br>ğŸ¦· <strong>Scaling:</strong> 30,000 ~ 50,000 KRW<br>ğŸ¦· <strong>Implant:</strong> Individual estimate<br>ğŸ¦· <strong>Orthodontics:</strong> Individual estimate<br><br>ğŸ’¡ <strong>Exact costs provided after examination!</strong>',
                    ru: 'ğŸ’° <strong>Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ Phoenix</strong><br><br>ğŸ¦· <strong>ĞĞ±Ñ‰ĞµĞµ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ:</strong> Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ†Ğ¸Ñ<br>ğŸ¦· <strong>Ğ§Ğ¸ÑÑ‚ĞºĞ°:</strong> 30,000 ~ 50,000 Ğ²Ğ¾Ğ½<br>ğŸ¦· <strong>Ğ˜Ğ¼Ğ¿Ğ»Ğ°Ğ½Ñ‚:</strong> Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°<br>ğŸ¦· <strong>ĞÑ€Ñ‚Ğ¾Ğ´Ğ¾Ğ½Ñ‚Ğ¸Ñ:</strong> Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°<br><br>ğŸ’¡ <strong>Ğ¢Ğ¾Ñ‡Ğ½Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ±ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!</strong>',
                    ja: 'ğŸ’° <strong>ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘æ²»ç™‚è²»æ¡ˆå†…</strong><br><br>ğŸ¦· <strong>ä¸€èˆ¬è¨ºç™‚:</strong> ç›¸è«‡å¾Œã”æ¡ˆå†…<br>ğŸ¦· <strong>ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°:</strong> 30,000å†† ~ 50,000å††<br>ğŸ¦· <strong>ã‚¤ãƒ³ãƒ—ãƒ©ãƒ³ãƒˆ:</strong> ç›¸è«‡å¾Œå€‹åˆ¥è¦‹ç©ã‚‚ã‚Š<br>ğŸ¦· <strong>çŸ¯æ­£:</strong> ç›¸è«‡å¾Œå€‹åˆ¥è¦‹ç©ã‚‚ã‚Š<br><br>ğŸ’¡ <strong>æ­£ç¢ºãªè²»ç”¨ã¯è¨ºç™‚å¾Œã«ã”æ¡ˆå†…ï¼</strong>'
                };
                
                return content[lang] + `<br><br><div class="reservation-message">
                    <div class="reservation-message-text">ìì„¸í•œ ë¬¸ì˜ëŠ” ë°©ë¬¸ ìƒë‹´ì„ ë°›ì•„ë³´ì„¸ìš”</div>
                    <button class="reservation-button" onclick="window.open('reservation.html', '_blank')">ğŸ“… ì˜ˆì•½í•˜ê¸°</button>
                </div>`;
            }
            
            createReservationContent(lang) {
                const content = {
                    ko: 'ğŸ“ <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì˜ˆì•½ ë¬¸ì˜</strong><br><br>ğŸ¥ <strong>ë³‘ì›ëª…:</strong> í”¼ë‹‰ìŠ¤ ì¹˜ê³¼<br>ğŸ“ <strong>ì „í™”ë²ˆí˜¸:</strong> 070-1234-1234<br>ğŸ’¬ <strong>ì¹´ì¹´ì˜¤í†¡:</strong> í”¼ë‹‰ìŠ¤ì¹˜ê³¼<br>ğŸŒ <strong>ì˜¨ë¼ì¸ ì˜ˆì•½:</strong> í™ˆí˜ì´ì§€ ì˜ˆì•½ ì‹œìŠ¤í…œ<br><br>ğŸ’¡ <strong>ì˜¨ë¼ì¸ ì˜ˆì•½ì´ ê°€ì¥ í¸ë¦¬í•©ë‹ˆë‹¤!</strong>',
                    en: 'ğŸ“ <strong>Phoenix Dental Reservation</strong><br><br>ğŸ¥ <strong>Clinic:</strong> Phoenix Dental<br>ğŸ“ <strong>Phone:</strong> 070-1234-1234<br>ğŸ’¬ <strong>KakaoTalk:</strong> Phoenix Dental<br>ğŸŒ <strong>Online:</strong> Website reservation system<br><br>ğŸ’¡ <strong>Online booking is most convenient!</strong>',
                    ru: 'ğŸ“ <strong>Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Phoenix Dental</strong><br><br>ğŸ¥ <strong>ĞšĞ»Ğ¸Ğ½Ğ¸ĞºĞ°:</strong> Phoenix Dental<br>ğŸ“ <strong>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:</strong> 070-1234-1234<br>ğŸ’¬ <strong>KakaoTalk:</strong> Phoenix Dental<br>ğŸŒ <strong>ĞĞ½Ğ»Ğ°Ğ¹Ğ½:</strong> Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ<br><br>ğŸ’¡ <strong>ĞĞ½Ğ»Ğ°Ğ¹Ğ½ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ ÑƒĞ´Ğ¾Ğ±Ğ½Ğ°!</strong>',
                    ja: 'ğŸ“ <strong>ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘äºˆç´„</strong><br><br>ğŸ¥ <strong>ç—…é™¢å:</strong> ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘<br>ğŸ“ <strong>é›»è©±ç•ªå·:</strong> 070-1234-1234<br>ğŸ’¬ <strong>ã‚«ã‚«ã‚ªãƒˆãƒ¼ã‚¯:</strong> ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘<br>ğŸŒ <strong>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³:</strong> ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸äºˆç´„ã‚·ã‚¹ãƒ†ãƒ <br><br>ğŸ’¡ <strong>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³äºˆç´„ãŒæœ€ã‚‚ä¾¿åˆ©ã§ã™!</strong>'
                };
                
                return content[lang] + `<br><br><div class="reservation-message">
                    <div class="reservation-message-text">ìì„¸í•œ ë¬¸ì˜ëŠ” ë°©ë¬¸ ìƒë‹´ì„ ë°›ì•„ë³´ì„¸ìš”</div>
                    <button class="reservation-button" onclick="window.open('reservation.html', '_blank')">ğŸ“… ì˜ˆì•½í•˜ê¸°</button>
                </div>`;
            }
            
            createDirectionsContent(lang) {
                const content = {
                    ko: 'ğŸ—ºï¸ <strong>í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ ì˜¤ì‹œëŠ”ê¸¸</strong><br><br>ğŸ“ <strong>ì£¼ì†Œ:</strong> ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123<br>ğŸš‡ <strong>ì§€í•˜ì² :</strong> 2í˜¸ì„  ê°•ë‚¨ì—­ 3ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„<br>ğŸšŒ <strong>ë²„ìŠ¤:</strong> ê°•ë‚¨ì—­ ì •ë¥˜ì¥ í•˜ì°¨<br>ğŸš— <strong>ì£¼ì°¨:</strong> ê±´ë¬¼ ì§€í•˜ 1ì¸µ (2ì‹œê°„ ë¬´ë£Œ)',
                    en: 'ğŸ—ºï¸ <strong>Directions to Phoenix Dental</strong><br><br>ğŸ“ <strong>Address:</strong> 123 Teheran-ro, Gangnam-gu, Seoul<br>ğŸš‡ <strong>Subway:</strong> Line 2 Gangnam Station Exit 3, 5 min walk<br>ğŸšŒ <strong>Bus:</strong> Gangnam Station<br>ğŸš— <strong>Parking:</strong> Building B1 (2 hours free)',
                    ru: 'ğŸ—ºï¸ <strong>ĞšĞ°Ğº Ğ´Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒÑÑ Ğ´Ğ¾ Phoenix Dental</strong><br><br>ğŸ“ <strong>ĞĞ´Ñ€ĞµÑ:</strong> Ğ¡ĞµÑƒĞ», ĞšĞ°Ğ½Ğ½Ğ°Ğ¼-Ğ³Ñƒ, Ğ¢ĞµÑ…ĞµÑ€Ğ°Ğ½-Ñ€Ğ¾ 123<br>ğŸš‡ <strong>ĞœĞµÑ‚Ñ€Ğ¾:</strong> Ğ›Ğ¸Ğ½Ğ¸Ñ 2, ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ ĞšĞ°Ğ½Ğ½Ğ°Ğ¼, Ğ²Ñ‹Ñ…Ğ¾Ğ´ 3, 5 Ğ¼Ğ¸Ğ½ Ğ¿ĞµÑˆĞºĞ¾Ğ¼<br>ğŸšŒ <strong>ĞĞ²Ñ‚Ğ¾Ğ±ÑƒÑ:</strong> ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞšĞ°Ğ½Ğ½Ğ°Ğ¼<br>ğŸš— <strong>ĞŸĞ°Ñ€ĞºĞ¾Ğ²ĞºĞ°:</strong> ĞŸĞ¾Ğ´Ğ·ĞµĞ¼Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ğ¶ (2 Ñ‡Ğ°ÑĞ° Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)',
                    ja: 'ğŸ—ºï¸ <strong>ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹æ­¯ç§‘ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹</strong><br><br>ğŸ“ <strong>ä½æ‰€:</strong> ã‚½ã‚¦ãƒ«ç‰¹åˆ¥å¸‚æ±Ÿå—åŒºãƒ†ãƒ˜ãƒ©ãƒ³è·¯123<br>ğŸš‡ <strong>åœ°ä¸‹é‰„:</strong> 2å·ç·šæ±Ÿå—é§…3ç•ªå‡ºå£å¾’æ­©5åˆ†<br>ğŸšŒ <strong>ãƒã‚¹:</strong> æ±Ÿå—é§…åœç•™æ‰€ä¸‹è»Š<br>ğŸš— <strong>é§è»Šå ´:</strong> å»ºç‰©åœ°ä¸‹1éšï¼ˆ2æ™‚é–“ç„¡æ–™ï¼‰'
                };
                
                return content[lang] + `<br><br><div class="reservation-message">
                    <div class="reservation-message-text">ìì„¸í•œ ë¬¸ì˜ëŠ” ë°©ë¬¸ ìƒë‹´ì„ ë°›ì•„ë³´ì„¸ìš”</div>
                    <button class="reservation-button" onclick="window.open('reservation.html', '_blank')">ğŸ“… ì˜ˆì•½í•˜ê¸°</button>
                </div>`;
            }
            
            // ê´€ë¦¬ì ê¸°ëŠ¥ ì²˜ë¦¬
            handleAdminCommand() {
                const adminLink = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; margin: 15px 0; text-align: center;">
                        <h4 style="margin-bottom: 15px;">ğŸ¤– AIì±—ë´‡ ê´€ë¦¬ ë¡œê·¸ì¸</h4>
                        <p style="margin-bottom: 10px;">ê´€ë¦¬ì í˜ì´ì§€ì— ì ‘ì†í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                        <p style="margin-bottom: 20px; font-size: 14px; opacity: 0.9;">ğŸ’¡ ì•„ì´ë””: <strong>phoenix</strong> | ë¹„ë°€ë²ˆí˜¸: <strong>phoenix</strong></p>
                        <button onclick="openAdminPanel()" style="background: white; color: #667eea; border: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 16px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                            ğŸ” ê´€ë¦¬ì í˜ì´ì§€ ì—´ê¸°
                        </button>
                    </div>
                `;
                this.addBotMessage(adminLink);
            }
        }

        // ğŸ¯ ì „ì—­ ì±—ë´‡ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        let chatbot;
        
        // ğŸ¯ í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì±—ë´‡ ì´ˆê¸°í™”');
            chatbot = new PhoenixChatbot();
            window.chatbot = chatbot; // ì „ì—­ìœ¼ë¡œ ì„¤ì •
        });

        // ğŸ¯ ì „ì—­ í•¨ìˆ˜ë“¤ (ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±)
        function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            chatbot.addUserMessage(message);
            input.value = '';
            input.style.height = 'auto';
            
            chatbot.processMessage(message);
        }

        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            menu.classList.toggle('show');
        }

        function selectLanguage(language) {
            if (chatbot) {
                chatbot.currentLanguage = language;
                chatbot.updateLanguageUI();
                
                const changeMessages = {
                    ko: 'ğŸ‡°ğŸ‡· í•œêµ­ì–´ë¡œ ì–¸ì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!',
                    en: 'ğŸ‡ºğŸ‡¸ Language changed to English!',
                    ru: 'ğŸ‡·ğŸ‡º Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¸Ğ¹!',
                    ja: 'ğŸ‡¯ğŸ‡µ è¨€èªãŒæ—¥æœ¬èªã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸï¼'
                };
                
                chatbot.addBotMessage(changeMessages[language] || changeMessages['ko']);
                document.getElementById('languageMenu').classList.remove('show');
            }
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleInputKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function handleBackNavigation(event) {
            // ë’¤ë¡œê°€ê¸° ë¡œì§
            if (document.referrer) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        // ğŸ¯ ê´€ë¦¬ì íŒ¨ë„ ì—´ê¸° (ê°„ì†Œí™”ëœ ë²„ì „)
        function openAdminPanel() {
            const username = prompt("ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸\n\nì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (username !== "phoenix") {
                alert("âŒ ì•„ì´ë””ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                return;
            }
            
            const password = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (password !== "phoenix") {
                alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                return;
            }
            
            console.log('âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ');
            document.getElementById('chatbotAdminPage').style.display = 'block';
            
            // ê´€ë¦¬ì í˜ì´ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setTimeout(() => {
                setupAdminEventListeners();
            }, 100);
        }

        // ê´€ë¦¬ì í˜ì´ì§€ ë‹«ê¸°
        function closeChatbotAdmin() {
            console.log('AI ì±—ë´‡ ê´€ë¦¬ í˜ì´ì§€ ë‹«ê¸°');
            document.getElementById('chatbotAdminPage').style.display = 'none';
        }

        // ê´€ë¦¬ì í˜ì´ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupAdminEventListeners() {
            console.log('ğŸ”§ ê´€ë¦¬ì í˜ì´ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');
            
            // API ì„¤ì • ì €ì¥ ë²„íŠ¼
            const saveApiBtn = document.getElementById('saveApiBtn');
            if (saveApiBtn) {
                saveApiBtn.addEventListener('click', function() {
                    try {
                        console.log('ğŸ’¾ API ì„¤ì • ì €ì¥ ì‹œì‘');
                        
                        // ì…ë ¥ í•„ë“œì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
                        const chatgptApiKey = document.getElementById('chatgptApiKey');
                        const chatgptModel = document.getElementById('chatgptModel');
                        const chatgptFinetuningModel = document.getElementById('chatgptFinetuningModel');
                        const geminiApiKey = document.getElementById('geminiApiKey');
                        const geminiModel = document.getElementById('geminiModel');
                        const claudeApiKey = document.getElementById('claudeApiKey');
                        const claudeModel = document.getElementById('claudeModel');
                        
                        if (!chatgptApiKey || !chatgptModel || !geminiApiKey || !geminiModel || !claudeApiKey || !claudeModel) {
                            throw new Error('í•„ìˆ˜ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                        
                        const settings = {
                            chatgpt: {
                                enabled: chatgptApiKey.value.trim() !== '',
                                apiKey: chatgptApiKey.value.trim(),
                                model: chatgptModel.value,
                                finetuningModel: chatgptFinetuningModel ? chatgptFinetuningModel.value : ''
                            },
                            gemini: {
                                enabled: geminiApiKey.value.trim() !== '',
                                apiKey: geminiApiKey.value.trim(),
                                model: geminiModel.value
                            },
                            claude: {
                                enabled: claudeApiKey.value.trim() !== '',
                                apiKey: claudeApiKey.value.trim(),
                                model: claudeModel.value
                            }
                        };
                        
                        localStorage.setItem('chatbotApiSettings', JSON.stringify(settings));
                        console.log('âœ… API ì„¤ì • ì €ì¥ ì™„ë£Œ:', settings);
                        
                        // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                        const statusDiv = document.getElementById('apiStatus');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<div style="color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">âœ… API ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                        }
                        
                        // ì±—ë´‡ ì¸ìŠ¤í„´ìŠ¤ ì—…ë°ì´íŠ¸
                        if (window.chatbot) {
                            window.chatbot.loadApiSettings();
                            window.chatbot.updateApiStatusDisplay();
                            console.log('âœ… ì±—ë´‡ API ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                        }
                        
                        // ì„±ê³µ ì•Œë¦¼
                        alert('âœ… API ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        
                    } catch (error) {
                        console.error('âŒ API ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                        alert('âŒ API ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                });
                console.log('âœ… API ì„¤ì • ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

                    // API ì—°ê²° í…ŒìŠ¤íŠ¸ ë²„íŠ¼
            const testApiBtn = document.getElementById('testApiBtn');
            if (testApiBtn) {
                testApiBtn.addEventListener('click', function() {
                    try {
                        console.log('ğŸ”— API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘');
                        
                        const statusDiv = document.getElementById('apiStatus');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<div style="color: #856404; padding: 10px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">ğŸ”„ API ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
                        }
                        
                        setTimeout(() => {
                            try {
                                const settings = JSON.parse(localStorage.getItem('chatbotApiSettings') || '{}');
                                let activeApis = [];
                                
                                if (settings.chatgpt?.enabled && settings.chatgpt?.apiKey) activeApis.push('ChatGPT');
                                if (settings.gemini?.enabled && settings.gemini?.apiKey) activeApis.push('Gemini');
                                if (settings.claude?.enabled && settings.claude?.apiKey) activeApis.push('Claude');
                                
                                console.log('ğŸ” í™œì„±í™”ëœ API:', activeApis);
                                
                                if (activeApis.length > 0) {
                                    const successMessage = `âœ… ì—°ê²° ì„±ê³µ! í™œì„±í™”ëœ API: ${activeApis.join(', ')}`;
                                    if (statusDiv) {
                                        statusDiv.innerHTML = `<div style="color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">${successMessage}</div>`;
                                    }
                                    alert(successMessage);
                                    
                                    // ì±—ë´‡ ì¸ìŠ¤í„´ìŠ¤ ì—…ë°ì´íŠ¸
                                    if (window.chatbot) {
                                        window.chatbot.loadApiSettings();
                                        window.chatbot.updateApiStatusDisplay();
                                    }
                                } else {
                                    const errorMessage = 'âŒ í™œì„±í™”ëœ APIê°€ ì—†ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                                    if (statusDiv) {
                                        statusDiv.innerHTML = `<div style="color: #721c24; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">${errorMessage}</div>`;
                                    }
                                    alert(errorMessage);
                                }
                            } catch (error) {
                                console.error('âŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                                const errorMessage = 'âŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                                if (statusDiv) {
                                    statusDiv.innerHTML = `<div style="color: #721c24; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">${errorMessage}</div>`;
                                }
                                alert(errorMessage);
                            }
                        }, 1000);
                        
                    } catch (error) {
                        console.error('âŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                        alert('âŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                });
                console.log('âœ… API ì—°ê²° í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // API ì„¤ì • ì´ˆê¸°í™” ë²„íŠ¼
            const resetApiBtn = document.getElementById('resetApiBtn');
            if (resetApiBtn) {
                resetApiBtn.addEventListener('click', function() {
                    try {
                        if (confirm('ì •ë§ë¡œ ëª¨ë“  API ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            console.log('ğŸ”„ API ì„¤ì • ì´ˆê¸°í™” ì‹œì‘');
                            
                            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                            const fields = [
                                'chatgptApiKey', 'chatgptModel', 'chatgptFinetuningModel',
                                'geminiApiKey', 'geminiModel',
                                'claudeApiKey', 'claudeModel'
                            ];
                            
                            fields.forEach(fieldId => {
                                const element = document.getElementById(fieldId);
                                if (element) {
                                    element.value = '';
                                }
                            });
                            
                            // Finetuning ê·¸ë£¹ ìˆ¨ê¸°ê¸°
                            const finetuningGroup = document.getElementById('chatgptFinetuningGroup');
                            if (finetuningGroup) {
                                finetuningGroup.style.display = 'none';
                            }
                            
                            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„¤ì • ì œê±°
                            localStorage.removeItem('chatbotApiSettings');
                            console.log('âœ… API ì„¤ì • ì´ˆê¸°í™” ì™„ë£Œ');
                            
                            // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                            const statusDiv = document.getElementById('apiStatus');
                            if (statusDiv) {
                                statusDiv.innerHTML = '<div style="color: #856404; padding: 10px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">ğŸ”„ API ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                            }
                            
                            // ì±—ë´‡ ì¸ìŠ¤í„´ìŠ¤ ì—…ë°ì´íŠ¸
                            if (window.chatbot) {
                                window.chatbot.loadApiSettings();
                                window.chatbot.updateApiStatusDisplay();
                                console.log('âœ… ì±—ë´‡ API ì„¤ì • ì´ˆê¸°í™” ì™„ë£Œ');
                            }
                            
                            alert('âœ… API ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        }
                    } catch (error) {
                        console.error('âŒ API ì„¤ì • ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                        alert('âŒ API ì„¤ì • ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }
                });
                console.log('âœ… API ì„¤ì • ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // ChatGPT ëª¨ë¸ ì„ íƒ ì´ë²¤íŠ¸
            const chatgptModel = document.getElementById('chatgptModel');
            if (chatgptModel) {
                chatgptModel.addEventListener('change', function() {
                    const finetuningGroup = document.getElementById('chatgptFinetuningGroup');
                    if (finetuningGroup) {
                        if (this.value === 'finetuning') {
                            finetuningGroup.style.display = 'block';
                        } else {
                            finetuningGroup.style.display = 'none';
                        }
                    }
                });
                console.log('âœ… ChatGPT ëª¨ë¸ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', function(event) {
                    const files = event.target.files;
                    const fileList = document.getElementById('fileList');
                    
                    for (let file of files) {
                        if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const content = e.target.result;
                                processKnowledgeFile(file.name, content);
                            };
                            reader.readAsText(file);
                        }
                    }
                });
                console.log('âœ… íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                // í´ë¦­ ì´ë²¤íŠ¸
                uploadArea.addEventListener('click', function() {
                    document.getElementById('fileInput').click();
                });
                
                // ë“œë˜ê·¸ ì˜¤ë²„ ì´ë²¤íŠ¸
                uploadArea.addEventListener('dragover', function(event) {
                    event.preventDefault();
                    this.style.borderColor = '#4facfe';
                });
                
                // ë“œë˜ê·¸ ë¦¬ë¸Œ ì´ë²¤íŠ¸
                uploadArea.addEventListener('dragleave', function(event) {
                    event.preventDefault();
                    this.style.borderColor = '#ddd';
                });
                
                // ë“œë¡­ ì´ë²¤íŠ¸
                uploadArea.addEventListener('drop', function(event) {
                    event.preventDefault();
                    this.style.borderColor = '#ddd';
                    
                    const files = event.dataTransfer.files;
                    const fileList = document.getElementById('fileList');
                    
                    for (let file of files) {
                        if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const content = e.target.result;
                                processKnowledgeFile(file.name, content);
                            };
                            reader.readAsText(file);
                        }
                    }
                });
                console.log('âœ… íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // ì§€ì‹ íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
            function processKnowledgeFile(filename, content) {
                const fileList = document.getElementById('fileList');
                const fileDiv = document.createElement('div');
                fileDiv.className = 'file-item';
                fileDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">
                        <div>
                            <strong>ğŸ“„ ${filename}</strong>
                            <div style="font-size: 12px; color: #666;">í¬ê¸°: ${(content.length / 1024).toFixed(2)} KB</div>
                        </div>
                        <button onclick="this.parentElement.remove(); updateKnowledgeStatus();" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">ì‚­ì œ</button>
                    </div>
                `;
                fileList.appendChild(fileDiv);
                
                // Q&A íŒŒì‹±
                const qaList = parseQAFromContent(content);
                if (qaList.length > 0) {
                    const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                    knowledgeData.parsedData = knowledgeData.parsedData.concat(qaList);
                    localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
                }
                
                updateKnowledgeStatus();
            }

            // Q&A íŒŒì‹± í•¨ìˆ˜
            function parseQAFromContent(content) {
                const lines = content.split('\n');
                const qaList = [];
                let currentQ = '';
                let currentA = '';
                
                for (let line of lines) {
                    line = line.trim();
                    if (line.startsWith('Q:') || line.startsWith('Q.') || line.startsWith('ì§ˆë¬¸:')) {
                        if (currentQ && currentA) {
                            qaList.push({ question: currentQ, answer: currentA });
                        }
                        currentQ = line.replace(/^Q[:.]\s*|^ì§ˆë¬¸:\s*/, '');
                        currentA = '';
                    } else if (line.startsWith('A:') || line.startsWith('A.') || line.startsWith('ë‹µë³€:')) {
                        currentA = line.replace(/^A[:.]\s*|^ë‹µë³€:\s*/, '');
                    } else if (currentA) {
                        currentA += ' ' + line;
                    } else if (currentQ) {
                        currentQ += ' ' + line;
                    }
                }
                
                if (currentQ && currentA) {
                    qaList.push({ question: currentQ, answer: currentA });
                }
                
                return qaList;
            }

            // ì§€ì‹ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateKnowledgeStatus() {
                const fileItems = document.querySelectorAll('.file-item');
                const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                
                const statusDiv = document.getElementById('knowledgeStatus');
                if (statusDiv) {
                    statusDiv.innerHTML = `ğŸ“– ì—…ë¡œë“œëœ ì§€ì‹ íŒŒì¼: ${fileItems.length}ê°œ | íŒŒì‹±ëœ Q&A: ${knowledgeData.parsedData.length}ê°œ | ìƒíƒœ: ${knowledgeData.enabled ? 'í™œì„±' : 'ë¹„í™œì„±'}`;
                }
            }

            // ì§€ì‹ ì„¤ì • ì €ì¥ ë²„íŠ¼
            const saveKnowledgeBtn = document.getElementById('saveKnowledgeBtn');
            if (saveKnowledgeBtn) {
                saveKnowledgeBtn.addEventListener('click', function() {
                    const fileItems = document.querySelectorAll('.file-item');
                    const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                    
                    knowledgeData.enabled = fileItems.length > 0;
                    knowledgeData.files = Array.from(fileItems).map(item => item.querySelector('strong').textContent.replace('ğŸ“„ ', ''));
                    
                    localStorage.setItem('chatbotKnowledgeBase', JSON.stringify(knowledgeData));
                    
                    const statusDiv = document.getElementById('knowledgeSettingsStatus');
                    if (statusDiv) {
                        statusDiv.innerHTML = '<div style="color: green; padding: 10px; background: #d4edda; border-radius: 5px; margin-top: 10px;">âœ… ì§€ì‹ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                    }
                    
                    if (window.chatbot) {
                        window.chatbot.loadKnowledgeBaseSettings();
                    }
                    
                    alert('âœ… ì§€ì‹ ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
                console.log('âœ… ì§€ì‹ ì„¤ì • ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // ì§€ì‹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ë²„íŠ¼
            const testKnowledgeBtn = document.getElementById('testKnowledgeBtn');
            if (testKnowledgeBtn) {
                testKnowledgeBtn.addEventListener('click', function() {
                    const testQuery = prompt('ê²€ìƒ‰í•  ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”:');
                    if (!testQuery) return;
                    
                    const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                    
                    if (!knowledgeData.enabled || knowledgeData.parsedData.length === 0) {
                        alert('í™œì„±í™”ëœ ì§€ì‹ë² ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    const result = searchInKnowledgeBase(testQuery, knowledgeData.parsedData);
                    if (result) {
                        alert(`ê²€ìƒ‰ ê²°ê³¼:\n\nQ: ${result.question}\n\nA: ${result.answer}`);
                    } else {
                        alert('ê´€ë ¨ ë‹µë³€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                });
                console.log('âœ… ì§€ì‹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰ í•¨ìˆ˜
            function searchInKnowledgeBase(query, parsedData) {
                const normalizedQuery = query.toLowerCase().trim();
                let bestMatch = null;
                let bestScore = 0;
                
                for (const qa of parsedData) {
                    const question = qa.question.toLowerCase();
                    const answer = qa.answer.toLowerCase();
                    
                    let score = 0;
                    
                    if (question === normalizedQuery) score += 1000;
                    if (question.includes(normalizedQuery) || normalizedQuery.includes(question)) score += 500;
                    
                    const queryWords = normalizedQuery.split(/\s+/).filter(w => w.length > 1);
                    for (const word of queryWords) {
                        if (question.includes(word)) score += 100;
                        if (answer.includes(word)) score += 50;
                    }
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMatch = qa;
                    }
                }
                
                return bestScore >= 50 ? bestMatch : null;
            }

            // íŒŒì‹±ëœ ë°ì´í„° ë³´ê¸° ë²„íŠ¼
            const showParsedDataBtn = document.getElementById('showParsedDataBtn');
            if (showParsedDataBtn) {
                showParsedDataBtn.addEventListener('click', function() {
                    const knowledgeData = JSON.parse(localStorage.getItem('chatbotKnowledgeBase') || '{"enabled": false, "files": [], "parsedData": []}');
                    const viewDiv = document.getElementById('parsedDataView');
                    const contentDiv = document.getElementById('parsedDataContent');
                    
                    if (viewDiv && contentDiv) {
                        if (knowledgeData.parsedData.length === 0) {
                            contentDiv.innerHTML = '<p style="color: #666;">íŒŒì‹±ëœ Q&A ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                        } else {
                            let html = '';
                            knowledgeData.parsedData.forEach((qa, index) => {
                                html += `
                                    <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">Q${index + 1}: ${qa.question}</div>
                                        <div style="color: #666;">A: ${qa.answer}</div>
                                    </div>
                                `;
                            });
                            contentDiv.innerHTML = html;
                        }
                        
                        viewDiv.style.display = viewDiv.style.display === 'none' ? 'block' : 'none';
                    }
                });
                console.log('âœ… íŒŒì‹±ëœ ë°ì´í„° ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }

            // ëª¨ë“  ì§€ì‹ ì‚­ì œ ë²„íŠ¼
            const clearKnowledgeBtn = document.getElementById('clearKnowledgeBtn');
            if (clearKnowledgeBtn) {
                clearKnowledgeBtn.addEventListener('click', function() {
                    if (confirm('ì •ë§ë¡œ ëª¨ë“  ì§€ì‹ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        const fileList = document.getElementById('fileList');
                        if (fileList) {
                            fileList.innerHTML = '';
                        }
                        localStorage.removeItem('chatbotKnowledgeBase');
                        updateKnowledgeStatus();
                        
                        const statusDiv = document.getElementById('knowledgeSettingsStatus');
                        if (statusDiv) {
                            statusDiv.innerHTML = '<div style="color: #856404; padding: 10px; background: #fff3cd; border-radius: 5px; margin-top: 10px;">ğŸ”„ ëª¨ë“  ì§€ì‹ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                        }
                        
                        if (window.chatbot) {
                            window.chatbot.loadKnowledgeBaseSettings();
                        }
                        
                        alert('âœ… ëª¨ë“  ì§€ì‹ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }
                });
                console.log('âœ… ëª¨ë“  ì§€ì‹ ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ì™„ë£Œ');
            }
            
            console.log('âœ… ê´€ë¦¬ì í˜ì´ì§€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('ğŸ“‹ ê´€ë¦¬ì í˜ì´ì§€ ì„¤ì • ë¡œë“œ ì‹œì‘');
                
                // ê¸°ì¡´ ì„¤ì • ë¡œë“œ
                const apiSettings = JSON.parse(localStorage.getItem('chatbotApiSettings') || '{}');
                
                // ChatGPT ì„¤ì • ë¡œë“œ
                if (apiSettings.chatgpt) {
                    const chatgptApiKey = document.getElementById('chatgptApiKey');
                    const chatgptModel = document.getElementById('chatgptModel');
                    const chatgptFinetuningModel = document.getElementById('chatgptFinetuningModel');
                    
                    if (chatgptApiKey) chatgptApiKey.value = apiSettings.chatgpt.apiKey || '';
                    if (chatgptModel) chatgptModel.value = apiSettings.chatgpt.model || '';
                    if (chatgptFinetuningModel) chatgptFinetuningModel.value = apiSettings.chatgpt.finetuningModel || '';
                    
                    // Finetuning ëª¨ë¸ì´ ì„ íƒëœ ê²½ìš° ê·¸ë£¹ í‘œì‹œ
                    if (apiSettings.chatgpt.model === 'finetuning') {
                        const finetuningGroup = document.getElementById('chatgptFinetuningGroup');
                        if (finetuningGroup) {
                            finetuningGroup.style.display = 'block';
                        }
                    }
                }
                
                // Gemini ì„¤ì • ë¡œë“œ
                if (apiSettings.gemini) {
                    const geminiApiKey = document.getElementById('geminiApiKey');
                    const geminiModel = document.getElementById('geminiModel');
                    
                    if (geminiApiKey) geminiApiKey.value = apiSettings.gemini.apiKey || '';
                    if (geminiModel) geminiModel.value = apiSettings.gemini.model || '';
                }
                
                // Claude ì„¤ì • ë¡œë“œ
                if (apiSettings.claude) {
                    const claudeApiKey = document.getElementById('claudeApiKey');
                    const claudeModel = document.getElementById('claudeModel');
                    
                    if (claudeApiKey) claudeApiKey.value = apiSettings.claude.apiKey || '';
                    if (claudeModel) claudeModel.value = apiSettings.claude.model || '';
                }
                
                if (window.updateKnowledgeStatus) {
                    window.updateKnowledgeStatus();
                }
                console.log('âœ… ê´€ë¦¬ì í˜ì´ì§€ ì„¤ì • ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ê´€ë¦¬ì í˜ì´ì§€ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        });

        console.log('âœ… í”¼ë‹‰ìŠ¤ ì¹˜ê³¼ AI ì±—ë´‡ ì´ˆê¸°í™” ì™„ë£Œ (ìµœì í™” ë²„ì „)');
    </script>

    <!-- AI ì±—ë´‡ ê´€ë¦¬ í˜ì´ì§€ -->
    <div class="popup-page" id="chatbotAdminPage" style="display: none;">
        <div class="admin-header">
            <div class="admin-title">ğŸ¤– AI ì±—ë´‡ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div class="admin-nav">
                <button class="nav-btn" onclick="closeChatbotAdmin()">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
                <button class="nav-btn logout" onclick="closeChatbotAdmin()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
        
        <div class="admin-content">
            <!-- AI ëª¨ë¸ API ì„¤ì • -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ğŸ¤– ì±—ë´‡ AI ëª¨ë¸ ì—°ê²°í•˜ê¸°</h3>
                </div>
                
                <div class="api-form">
                    <!-- ChatGPT ì„¤ì • -->
                    <div class="form-group">
                        <label for="chatgptApiKey">ChatGPT API Key</label>
                        <input type="password" id="chatgptApiKey" placeholder="sk-proj-...">
                    </div>
                    <div class="form-group">
                        <label for="chatgptModel">ChatGPT ëª¨ë¸ì„ íƒ</label>
                        <select id="chatgptModel">
                            <option value="">-- ChatGPT ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            <option value="gpt-4o">GPT-4o (ìµœì‹  ë©€í‹°ëª¨ë‹¬)</option>
                            <option value="gpt-4o-mini">GPT-4o Mini (ê²½ì œì )</option>
                            <option value="finetuning">Finetuning Model (ì»¤ìŠ¤í…€ ëª¨ë¸)</option>
                        </select>
                    </div>
                    <div class="form-group" id="chatgptFinetuningGroup" style="display: none;">
                        <label for="chatgptFinetuningModel">Finetuning ëª¨ë¸ëª… ì…ë ¥</label>
                        <input type="text" id="chatgptFinetuningModel" placeholder="ft:gpt-4o-mini-2024-07-18:...">
                    </div>

                    <!-- Gemini ì„¤ì • -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="geminiApiKey">Gemini ëª¨ë¸ API Key</label>
                        <input type="password" id="geminiApiKey" placeholder="AIza...">
                    </div>
                    <div class="form-group">
                        <label for="geminiModel">Gemini ëª¨ë¸ì„ íƒ</label>
                        <select id="geminiModel">
                            <option value="">-- Gemini ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash (ë¹ ë¥¸ ì‘ë‹µ)</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro (ê³ ì„±ëŠ¥)</option>
                            <option value="gemini-1.0-pro">Gemini 1.0 Pro (ì•ˆì •ì„±)</option>
                        </select>
                    </div>

                    <!-- Claude ì„¤ì • -->
                    <div class="form-group" style="margin-top: 25px;">
                        <label for="claudeApiKey">Claude ëª¨ë¸ API Key</label>
                        <input type="password" id="claudeApiKey" placeholder="sk-ant-...">
                    </div>
                    <div class="form-group">
                        <label for="claudeModel">Claude ëª¨ë¸ì„ íƒ</label>
                        <select id="claudeModel">
                            <option value="">-- Claude ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            <option value="claude-3-haiku">Claude 3 Haiku (ë¹ ë¥´ê³  íš¨ìœ¨ì )</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (ê· í˜•ì  ì„±ëŠ¥)</option>
                            <option value="claude-3-opus">Claude 3 Opus (ìµœê³  ì„±ëŠ¥)</option>
                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet (ìµœì‹  ëª¨ë¸)</option>
                        </select>
                    </div>

                    <div class="btn-group" style="margin-top: 30px;">
                        <button class="btn btn-primary" id="saveApiBtn">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                        <button class="btn btn-success" id="testApiBtn">ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                        <button class="btn btn-danger" id="resetApiBtn">ğŸ”„ ì„¤ì • ì´ˆê¸°í™”</button>
                    </div>
                    <div id="apiStatus" class="status-message"></div>
                </div>
            </div>

            <!-- AI ì§€ì‹ íŒŒì¼ ì—…ë¡œë“œ -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>ğŸ“š AI ì§€ì‹ íŒŒì¼ ì—…ë¡œë“œ</h3>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-types">ğŸ’¡ <strong>ì§€ì› í˜•ì‹: í…ìŠ¤íŠ¸ íŒŒì¼(.txt)</strong><br>
                    <small style="color: #666;">â€» PDF, Excel íŒŒì¼ì€ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</small></div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".txt" multiple>
                
                <div class="file-list" id="fileList">
                    <!-- ì—…ë¡œë“œëœ íŒŒì¼ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="knowledgeStatus" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                    ğŸ“– ì—…ë¡œë“œëœ ì§€ì‹ íŒŒì¼: 0ê°œ | ìƒíƒœ: ë¹„í™œì„±
                </div>
                
                <!-- ì§€ì‹ íŒŒì¼ ì„¤ì • ì €ì¥ ë²„íŠ¼ -->
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-success" id="saveKnowledgeBtn">ğŸ’¾ ì§€ì‹ íŒŒì¼ ì„¤ì • ì €ì¥</button>
                    <button class="btn btn-primary" id="testKnowledgeBtn">ğŸ” ì§€ì‹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</button>
                    <button class="btn" style="background: #17a2b8; color: white;" id="showParsedDataBtn">ğŸ“‹ íŒŒì‹±ëœ Q&A ë³´ê¸°</button>
                    <button class="btn btn-danger" id="clearKnowledgeBtn">ğŸ—‘ï¸ ëª¨ë“  ì§€ì‹ ì‚­ì œ</button>
                </div>
                <div id="knowledgeSettingsStatus" class="status-message"></div>
                
                <!-- íŒŒì‹±ëœ Q&A í‘œì‹œ ì˜ì—­ -->
                <div id="parsedDataView" style="display: none; margin-top: 20px; background: white; border-radius: 10px; padding: 20px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd;">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">ğŸ“‹ íŒŒì‹±ëœ Q&A ë°ì´í„°</h4>
                    <div id="parsedDataContent"></div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* ê´€ë¦¬ì í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .popup-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: #2980b9;
        }

        .nav-btn.logout {
            background: #e74c3c;
        }

        .nav-btn.logout:hover {
            background: #c0392b;
        }

        .admin-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 20px;
        }

        /* API ì„¤ì • ìŠ¤íƒ€ì¼ */
        .api-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover {
            background: #3d8bfe;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover {
            border-color: #4facfe;
            background: #f0f8ff;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .upload-types {
            font-size: 14px;
            color: #666;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            margin-bottom: 10px;
        }

        .status-message {
            margin-top: 15px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .admin-content {
                padding: 15px;
                max-height: 90vh;
            }
            
            .admin-section {
                padding: 15px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .upload-area {
                padding: 20px;
            }
            
            .upload-icon {
                font-size: 36px;
            }
            
            .upload-text {
                font-size: 16px;
            }
        }
    </style>
</body>
</html>